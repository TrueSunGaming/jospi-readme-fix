"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[223],{4026:(e,t,s)=>{s.d(t,{L:()=>f});var r,i=s(6540),a=s(9918),n=s(7634),o=s(1980),l=s(1883),c=s(2543);i.createElement,r={add:"fas fa-plus",fix:"fas fa-check",misc:"far fa-circle"};var u,d=function(e){var t,s;return t=e.entry,s=c.escape(t.title).replace(/(`+)([^`]+)\1/g,"<code>$2</code>"),(0,a.div)({className:"changelog-entry",key:t.id},(0,a.div)({className:"changelog-entry__row"},(0,a.div)({className:"changelog-entry__title "+(t.major?"changelog-entry__title--major":"")},(0,a.span)({className:"changelog-entry__title-icon"},(0,a.span)({className:"changelog-entry__icon "+r[t.type]})),null!=t.url?(0,a.a)({href:t.url,className:"changelog-entry__link",dangerouslySetInnerHTML:{__html:s}}):(0,a.span)({dangerouslySetInnerHTML:{__html:s}}),null!=t.github_url?(0,a.span)(null," (",(0,a.a)({className:"changelog-entry__link",href:t.github_url},t.repository.replace(/^.*\//,"")+"#"+t.github_pull_request_id),")"):void 0,function(){var e,s,r,i,n;return n=c.escape(t.github_user.display_name),e=null!=(i=null!=(s=t.github_user.github_url)?s:t.github_user.user_url)?"<a data-user-id='"+(null!=(r=t.github_user.user_id)?r:"")+"' class='changelog-entry__user-link js-usercard' href='"+c.escape(i)+"' >"+n+"</a>":n,(0,a.span)({className:"changelog-entry__user",dangerouslySetInnerHTML:{__html:(0,l.pw)("changelog.entry.by",{user:e})}})}())),null!=t.message_html?(0,a.div)({className:"changelog-entry__row changelog-entry__row--message",dangerouslySetInnerHTML:{__html:t.message_html}}):void 0)},p=s(2543),m=s(5093),h=function(e,t){return function(){return e.apply(t,arguments)}},b={}.hasOwnProperty;u=i.createElement;var f=function(e){function t(){return this.renderNav=h(this.renderNav,this),this.render=h(this.render,this),t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var s in t)b.call(t,s)&&(e[s]=t[s]);function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype}(t,e),t.prototype.render=function(){var e,t,s,r,i,l,c;return e=(0,n.Zt)("build",this.props.modifiers),r=p.groupBy(this.props.build.changelog_entries,"category"),t=p(r).keys().sort().value(),(0,a.div)({className:e+" t-changelog-stream--"+p.kebabCase(this.props.build.update_stream.display_name)},(0,a.div)({className:"build__version"},this.renderNav({version:"previous",icon:"fas fa-chevron-left"}),(0,a.a)({className:"build__version-link",href:(0,o.h1)(this.props.build)},(0,a.span)({className:"build__stream"},this.props.build.update_stream.display_name)," ",(0,a.span)({className:"u-changelog-stream--text"},this.props.build.display_version)),this.renderNav({version:"next",icon:"fas fa-chevron-right"})),null!=(l=this.props.showDate)&&l?(0,a.div)({className:"build__date"},m(this.props.build.created_at).format("LL")):void 0,null!=this.props.build.youtube_id&&null!=(c=this.props.showVideo)&&c?(0,a.div)({className:"build__video"},(0,a.iframe)({className:"u-embed-wide",allowFullScreen:!0,src:"https://www.youtube.com/embed/"+this.props.build.youtube_id+"?rel=0"})):void 0,function(){var e,n,o;for(o=[],e=0,n=t.length;e<n;e++)s=t[e],o.push((0,a.div)({key:s,className:"build__changelog-entries-container"},(0,a.div)({className:"build__changelog-entries-category"},s),(0,a.div)({className:"build__changelog-entries"},function(){var e,t,n,o,l;for(l=[],e=0,t=(n=r[s]).length;e<t;e++)i=n[e],l.push((0,a.div)({key:null!=(o=i.id)?o:i.created_at+"-"+i.title,className:"build__changelog-entry"},u(d,{entry:i})));return l}())));return o}())},t.prototype.renderNav=function(e){var t,s,r;if(r=e.version,s=e.icon,null!=this.props.build.versions)return null!=(t=this.props.build.versions[r])?(0,a.a)({className:"build__version-link",href:(0,o.h1)(t),title:t.display_version},(0,a.i)({className:s})):(0,a.span)({className:"build__version-link build__version-link--disabled"},(0,a.i)({className:s}))},t}(i.PureComponent)},8842:(e,t,s)=>{s.d(t,{F:()=>d});var r=s(6540),i=s(9918),a=s(7634),n=s(1883),o=s(1980),l=s(2543),c=function(e,t){return function(){return e.apply(t,arguments)}},u={}.hasOwnProperty;r.createElement;var d=function(e){function t(){return this.renderHeaderStream=c(this.renderHeaderStream,this),this.render=c(this.render,this),t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var s in t)u.call(t,s)&&(e[s]=t[s]);function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype}(t,e),t.prototype.render=function(){var e;return(0,i.div)({className:(0,a.Zt)("update-streams-v2",[null!=this.props.currentStreamId?"with-active":void 0])},(0,i.div)({className:"update-streams-v2__container"},function(){var t,s,r,i;for(i=[],t=0,s=(r=this.props.updateStreams).length;t<s;t++)e=r[t],i.push(this.renderHeaderStream({stream:e}));return i}.call(this)))},t.prototype.renderHeaderStream=function(e){var t,s,r;return s=e.stream,r=l.kebabCase(s.display_name),t=(0,a.Zt)("update-streams-v2__item",[r,s.is_featured?"featured":void 0,this.props.currentStreamId===s.id?"active":void 0]),t+=" t-changelog-stream--"+r,(0,i.a)({href:(0,o.h1)(s.latest_build),key:s.id,className:t},(0,i.div)({className:"update-streams-v2__bar u-changelog-stream--bg"}),(0,i.p)({className:"update-streams-v2__row update-streams-v2__row--name"},s.display_name),(0,i.p)({className:"update-streams-v2__row update-streams-v2__row--version"},s.latest_build.display_version),s.user_count>0?(0,i.p)({className:"update-streams-v2__row update-streams-v2__row--users"},(0,n.Mq)("changelog.builds.users_online",s.user_count)):void 0)},t}(r.PureComponent)},9833:(e,t,s)=>{s.d(t,{u:()=>r});class r{constructor(e){Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:e})}}},893:(e,t,s)=>{s.d(t,{A:()=>r});class r{}},2097:(e,t,s)=>{s.d(t,{A:()=>r});class r{constructor(e){Object.defineProperty(this,"userId",{enumerable:!0,configurable:!0,writable:!0,value:e})}}},7035:(e,t,s)=>{s.d(t,{JD:()=>i,D6:()=>a});const r=new class{constructor(){Object.defineProperty(this,"listeners",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"dispatch",{enumerable:!0,configurable:!0,writable:!0,value:e=>{this.listeners.forEach((t=>{t.handleDispatchAction(e)}))}})}get size(){return this.listeners.size}clear(){this.listeners.clear()}has(e){return this.listeners.has(e)}register(e){this.listeners.add(e)}unregister(e){this.listeners.delete(e)}};const i=r.dispatch;function a(e){return class extends e{constructor(...e){var t;super(...e),"object"==typeof(t=this)&&null!=t&&"handleDispatchAction"in t&&r.register(this)}}}},447:(e,t,s)=>{s.d(t,{u:()=>r});const r=["deleted","hype","mapperNotes","mine","pending","praises","resolved","total"]},738:(e,t,s)=>{s.d(t,{A:()=>n});var r=s(4403),i=s(6540),a=s(6606);function n({message:e,isTimeline:t}){return t?i.createElement(r.A,{maxLength:a.yD,message:e,modifiers:"discussion"}):null}},8931:(e,t,s)=>{s.d(t,{A:()=>v});var r=s(1091),i=s(6540),a=s(6181),n=s(6531),o=s(6978),l=s(5780),c=s(8623),u=s(9981),d=s(7813),p=s(1370),m=function(e,t,s,r){var i,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(n=(a<3?i(n):a>3?i(t,s,n):i(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n};let h=class extends i.Component{constructor(e){super(e),Object.defineProperty(this,"loaded",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"handleOnLoad",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.loaded=!0}}),(0,d.Gn)(this)}render(){if(null==this.props.src)return null;const e=(0,u.w)("beatmapsets.discussions.media-url",{url:this.props.src}),t=i.createElement(i.Fragment,null,!this.loaded&&this.renderSpinner(),i.createElement("img",Object.assign({},this.props.node.properties,{loading:"lazy",onLoad:this.handleOnLoad,src:e})));return i.createElement(r.s1.Consumer,null,(({inLink:s})=>s?i.createElement("span",{className:"beatmapset-discussion-image-link"},t):i.createElement("a",{className:"beatmapset-discussion-image-link",href:e,rel:"nofollow noreferrer",target:"_blank"},t)))}renderSpinner(){return i.createElement("span",{className:"beatmapset-discussion-image-link__spinner"},i.createElement(c.y,null))}};m([d.sH],h.prototype,"loaded",void 0),m([d.XI],h.prototype,"handleOnLoad",void 0),h=m([p.PA],h);const b=h,f=Object.freeze({a:r.Ei,em:(0,r.K9)("em"),img:b,li:(0,r.K9)("li"),p:(0,r.K9)("p"),strong:(0,r.K9)("strong")});class v extends i.Component{render(){return i.createElement(a.$,{className:"osu-md osu-md--discussions",components:f,remarkPlugins:[o.A,[l.A,{type:this.props.type}],n.A],transformLinkUri:r.lx,unwrapDisallowed:!0},this.props.markdown)}}},6614:(e,t,s)=>{s.d(t,{D:()=>r,u:()=>a});const r=["reviews","generalAll","general","timeline","events"],i=new Set(r);function a(e){return i.has(e)}},397:(e,t,s)=>{s.d(t,{d:()=>i,y:()=>r});const r=["hype","mapper_note","praise","problem","review","suggestion"],i={hype:"fas fa-bullhorn",mapper_note:"far fa-sticky-note",praise:"fas fa-heart",problem:"fas fa-exclamation-circle",resolved:"far fa-check-circle",review:"fas fa-tasks",suggestion:"far fa-circle"}},3652:(e,t,s)=>{s.d(t,{d:()=>G});var r=s(2543),i=s(7813),a=s(1370),n=s(8443),o=s(6823),l=s(6540),c=s(6606),u=s(9232),d=s(7634),p=s(1883),m=s(397),h=s(1831),b=s(9981),f=s(6407),v=s(6588),g=s(4692),y=function(e,t,s,r){var i,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(n=(a<3?i(n):a>3?i(t,s,n):i(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n};const w=["up","down"];let _=class extends l.Component{constructor(e){super(e),Object.defineProperty(this,"tooltipDisposers",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"voteXhr",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"handleClick",{enumerable:!0,configurable:!0,writable:!0,value:e=>{null==this.voteXhr&&((0,v.MB)(),this.voteXhr=g.ajax((0,b.w)("beatmapsets.discussions.vote",{discussion:this.props.discussion.id}),{data:{beatmap_discussion_vote:{score:e.currentTarget.dataset.score}},method:"PUT"}),this.voteXhr.done((e=>this.props.discussionsState.update({beatmapset:e}))).fail(f.S5).always((0,i.XI)((()=>{(0,v.vV)(),this.voteXhr=null}))))}}),Object.defineProperty(this,"handleHover",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var t,s;const r=e.currentTarget,i=r.dataset.type;null!==(t=(s=this.tooltipDisposers)[i])&&void 0!==t||(s[i]=(0,h.C)((()=>r),(()=>{const e=this.props.discussion.votes[i];return{count:e,title:e<1?(0,p.pw)(`beatmaps.discussions.votes.none.${i}`):`${(0,p.pw)(`beatmaps.discussions.votes.latest.${i}`)}:`,users:this.props.discussion.votes.voters[i].map((e=>{var t;return null!==(t=this.props.users.get(e))&&void 0!==t?t:{id:e}}))}}),"top center"))}}),(0,i.Gn)(this)}componentWillUnmount(){var e;null===(e=this.voteXhr)||void 0===e||e.abort(),Object.values(this.tooltipDisposers).forEach((e=>null==e?void 0:e()))}render(){return w.map((e=>l.createElement("div",{key:e,"data-type":e,onMouseOver:this.handleHover,onTouchStart:this.handleHover},this.renderVote(e))))}renderVote(e){var t;const[s,r]="up"===e?[1,"thumbs-up"]:[-1,"thumbs-down"],i=(null===(t=this.props.discussion.current_user_attributes)||void 0===t?void 0:t.vote_score)===s?0:s,a=null!=this.voteXhr||this.props.cannotVote;return l.createElement("button",{className:(0,d.Zt)("beatmap-discussion-vote",e,{inactive:0!==i}),"data-score":i,disabled:a,onClick:this.handleClick},l.createElement("i",{className:`fas fa-${r}`}),l.createElement("span",{className:"beatmap-discussion-vote__count"},this.props.discussion.votes[e]))}};y([i.sH],_.prototype,"voteXhr",void 0),y([i.XI],_.prototype,"handleClick",void 0),_=y([a.PA],_);const E=_;var P=s(4893),O=s(7833),j=s(241),k=s(7144),S=s(5812),N=s(738),A=s(4692),T=function(e,t,s,r){var i,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(n=(a<3?i(n):a>3?i(t,s,n):i(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n};const C="beatmap-discussion-post",x={reply:"fas fa-reply",reply_reopen:"fas fa-exclamation-circle",reply_resolve:"fas fa-check"},I={reply_reopen:!1,reply_resolve:!0};let R=class extends l.Component{get canReopen(){var e,t;return this.props.discussion.can_be_resolved&&null!==(t=null===(e=this.props.discussion.current_user_attributes)||void 0===e?void 0:e.can_reopen)&&void 0!==t&&t}get canResolve(){var e,t;return this.props.discussion.can_be_resolved&&null!==(t=null===(e=this.props.discussion.current_user_attributes)||void 0===e?void 0:e.can_resolve)&&void 0!==t&&t}get isTimeline(){return null!=this.props.discussion.timestamp}get storageKey(){return`beatmapset-discussion:reply:${this.props.discussion.id}:message`}get storedMessage(){var e;return null!==(e=localStorage.getItem(this.storageKey))&&void 0!==e?e:""}get validPost(){return(0,c.as)(this.message,this.isTimeline)}constructor(e){super(e),Object.defineProperty(this,"box",{enumerable:!0,configurable:!0,writable:!0,value:l.createRef()}),Object.defineProperty(this,"editing",{enumerable:!0,configurable:!0,writable:!0,value:(0,S.E)(this.storedMessage)}),Object.defineProperty(this,"handleKeyDown",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:this.storedMessage}),Object.defineProperty(this,"posting",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"postXhr",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"startEditing",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"editStart",{enumerable:!0,configurable:!0,writable:!0,value:()=>{o.A.userLogin.showIfGuest(this.editStart)||(this.editing=!0,this.startEditing=!0)}}),Object.defineProperty(this,"handleChange",{enumerable:!0,configurable:!0,writable:!0,value:e=>{this.setMessage(e.target.value)}}),Object.defineProperty(this,"handleKeyDownCallback",{enumerable:!0,configurable:!0,writable:!0,value:(e,t)=>{switch(e){case k.p.Cancel:this.editing=!1;break;case k.p.Submit:{const e=this.canResolve&&this.props.discussion.can_be_resolved&&t.ctrlKey?"reply_resolve":"reply";this.post(t,e);break}}}}),Object.defineProperty(this,"onCancelClick",{enumerable:!0,configurable:!0,writable:!0,value:()=>{(0,S.E)(this.message)&&!confirm((0,p.pw)("common.confirmation_unsaved"))||(this.editing=!1,this.setMessage(""))}}),Object.defineProperty(this,"post",{enumerable:!0,configurable:!0,writable:!0,value:(e,t)=>{if(null!=t||(t=e.currentTarget.dataset.action),!this.validPost||null!=this.postXhr||null==t)return;(0,v.MB)(),this.posting=t;const s={beatmap_discussion:{resolved:I[t]},beatmap_discussion_id:this.props.discussion.id,beatmap_discussion_post:{message:this.message}};this.postXhr=A.ajax((0,b.w)("beatmapsets.discussions.posts.store"),{data:s,method:"POST"}),this.postXhr.done((e=>(0,i.h5)((()=>{this.editing=!1,this.setMessage(""),this.props.discussionsState.update(e)})))).fail(f.S5).always((0,i.XI)((()=>{(0,v.vV)(),this.postXhr=null,this.posting=null})))}}),(0,i.Gn)(this),this.handleKeyDown=(0,k.R)(this.handleKeyDownCallback)}componentDidUpdate(e){var t;e.discussion.id===this.props.discussion.id?this.startEditing&&(this.startEditing=!1,null===(t=this.box.current)||void 0===t||t.focus()):this.message=this.storedMessage}componentWillUnmount(){var e;null===(e=this.postXhr)||void 0===e||e.abort()}render(){return this.editing?this.renderBox():this.renderPlaceholder()}renderBox(){return l.createElement("div",{className:`${C} ${C}--reply ${C}--new-reply`},this.renderCancelButton(),l.createElement("div",{className:`${C}__content`},l.createElement("div",{className:`${C}__avatar`},l.createElement(j.A,{modifiers:"full-rounded",user:o.A.currentUser})),l.createElement("div",{className:`${C}__message-container`},l.createElement(O.A,{className:`${C}__message ${C}__message--editor`,disabled:null!=this.posting,innerRef:this.box,onChange:this.handleChange,onKeyDown:this.handleKeyDown,placeholder:(0,p.pw)("beatmaps.discussions.reply_placeholder"),value:this.message}))),l.createElement("div",{className:`${C}__footer ${C}__footer--notice`},this.canResolve&&!this.props.discussion.resolved?(0,p.pw)("beatmaps.discussions.reply_resolve_notice"):(0,p.pw)("beatmaps.discussions.reply_notice"),l.createElement(N.A,{isTimeline:this.isTimeline,message:this.message})),l.createElement("div",{className:`${C}__footer`},l.createElement("div",{className:`${C}__actions`},l.createElement("div",{className:`${C}__actions-group`},this.canResolve&&!this.props.discussion.resolved&&this.renderReplyButton("reply_resolve"),this.canReopen&&this.props.discussion.resolved&&this.renderReplyButton("reply_reopen"),this.renderReplyButton("reply")))))}renderCancelButton(){return l.createElement("button",{className:`${C}__action ${C}__action--cancel`,disabled:null!=this.posting,onClick:this.onCancelClick},l.createElement("i",{className:"fas fa-times"}))}renderPlaceholder(){const[e,t,s]=null!=o.A.currentUser?[(0,p.pw)("beatmap_discussions.reply.open.user"),"fas fa-reply",o.A.currentUser.is_silenced]:[(0,p.pw)("beatmap_discussions.reply.open.guest"),"fas fa-sign-in-alt",!1];return l.createElement("div",{className:`${C} ${C}--reply ${C}--new-reply ${C}--new-reply-placeholder`},l.createElement(P.A,{disabled:s,icon:t,modifiers:"beatmap-discussion-reply-open",props:{onClick:this.editStart},text:e}))}renderReplyButton(e){return l.createElement("div",{className:`${C}__action`},l.createElement(P.A,{disabled:!this.validPost||null!=this.posting,icon:x[e],isBusy:this.posting===e,props:{"data-action":e,onClick:this.post},text:(0,p.pw)(`common.buttons.${e}`)}))}setMessage(e){this.message=e,(0,S.E)(this.message)?localStorage.setItem(this.storageKey,this.message):localStorage.removeItem(this.storageKey)}};T([i.sH],R.prototype,"box",void 0),T([i.sH],R.prototype,"editing",void 0),T([i.sH],R.prototype,"message",void 0),T([i.sH],R.prototype,"posting",void 0),T([i.XI],R.prototype,"componentDidUpdate",null),T([i.XI],R.prototype,"editStart",void 0),T([i.XI],R.prototype,"handleKeyDownCallback",void 0),T([i.XI],R.prototype,"onCancelClick",void 0),T([i.XI],R.prototype,"post",void 0),T([i.XI],R.prototype,"setMessage",null),R=T([a.PA],R);var M=s(5654),D=s(3358),H=s(450);function $({post:e,user:t}){"resolved"!==e.message.type&&(0,H.J)(e.message.type);const s=(0,d.Zt)("beatmap-discussion-system-post",e.message.type,{deleted:null!=e.deleted_at});return l.createElement("div",{className:s},l.createElement("div",{className:"beatmap-discussion-system-post__content"},l.createElement(D.A,{mappings:{user:l.createElement("a",{className:"beatmap-discussion-system-post__user",href:(0,b.w)("users.show",{user:t.id})},t.username)},pattern:(0,p.pw)(`beatmap_discussions.system.resolved.${e.message.value}`)})))}var L=s(3138),U=function(e,t,s,r){var i,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(n=(a<3?i(n):a>3?i(t,s,n):i(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n};const B="beatmap-discussion";function F({type:e}){const t="resolved"===e?"beatmaps.discussions.resolved":`beatmaps.discussions.message_type.${e}`;return l.createElement("span",{className:m.d[e],style:{color:`var(--beatmapset-discussion-colour--${e})`},title:(0,p.pw)(t)})}let G=class extends l.Component{get beatmapset(){var e;return null===(e=this.props.discussionsState)||void 0===e?void 0:e.beatmapset}get currentBeatmap(){var e;return null===(e=this.props.discussionsState)||void 0===e?void 0:e.currentBeatmap}get canBeRepliedTo(){var e;return null!=this.beatmapset&&!(0,u.PR)(this.beatmapset)&&(!this.beatmapset.discussion_locked||(0,c.pd)())&&(null==this.props.discussion.beatmap_id||null==(null===(e=this.currentBeatmap)||void 0===e?void 0:e.deleted_at))}get collapsed(){var e,t,s,r;return null!==(r=null!==(t=null===(e=this.props.discussionsState)||void 0===e?void 0:e.discussionCollapsed.get(this.props.discussion.id))&&void 0!==t?t:null===(s=this.props.discussionsState)||void 0===s?void 0:s.discussionDefaultCollapsed)&&void 0!==r&&r}get highlighted(){var e;return(null===(e=this.props.discussionsState)||void 0===e?void 0:e.highlightedDiscussionId)===this.props.discussion.id}get readonly(){return null==this.props.discussionsState}get readPostIds(){var e;return null===(e=this.props.discussionsState)||void 0===e?void 0:e.readPostIds}get resolvedStateChangedPostId(){var e;if(null==this.props.discussionsState)return-1;const t=(0,r.findLast)(this.props.discussion.posts,(e=>e.system&&"resolved"===e.message.type));return null!==(e=null==t?void 0:t.id)&&void 0!==e?e:-1}get showDeleted(){var e,t;return null===(t=null===(e=this.props.discussionsState)||void 0===e?void 0:e.showDeleted)||void 0===t||t}get users(){return this.props.store.users}constructor(e){super(e),Object.defineProperty(this,"lastResolvedState",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"handleCollapseClick",{enumerable:!0,configurable:!0,writable:!0,value:()=>{var e;null===(e=this.props.discussionsState)||void 0===e||e.discussionCollapsed.set(this.props.discussion.id,!this.collapsed)}}),Object.defineProperty(this,"handleSetHighlight",{enumerable:!0,configurable:!0,writable:!0,value:e=>{e.defaultPrevented||null==this.props.discussionsState||(this.props.discussionsState.highlightedDiscussionId=this.props.discussion.id)}}),Object.defineProperty(this,"renderReply",{enumerable:!0,configurable:!0,writable:!0,value:e=>{if(!this.isVisible(e))return null;if(e.system&&"resolved"===e.message.type){if(this.lastResolvedState===e.message.value)return null;this.lastResolvedState=e.message.value}return this.renderPost(e,"reply")}}),(0,i.Gn)(this)}render(){var e;if(!this.isVisible(this.props.discussion))return null;const t=(0,c.JL)(this.props.discussion);if(null==t)return null;const s=(0,d.Zt)(`${B}__line`,{resolved:this.props.discussion.resolved});this.lastResolvedState=!1;const r=null!==(e=this.users.get(this.props.discussion.user_id))&&void 0!==e?e:n.fc,i=(0,c.lz)({beatmapset:this.beatmapset,currentBeatmap:this.currentBeatmap,discussion:this.props.discussion,user:r}),a=(0,d.Zt)(B,{deleted:null!=this.props.discussion.deleted_at,highlighted:this.highlighted,"horizontal-desktop":"review"!==this.props.discussion.message_type,preview:this.readonly,review:"review"===this.props.discussion.message_type,timeline:null!=this.props.discussion.timestamp,unread:!this.isRead(t)});return l.createElement("div",{className:`${a}`,onClick:this.handleSetHighlight,style:{"--discussion-colour":`var(--beatmapset-discussion-colour--${this.props.discussion.message_type})`}},l.createElement("div",{className:`${B}__timestamp hidden-xs`},this.renderTimestamp()),l.createElement("div",{className:`${B}__discussion js-beatmap-discussion-jump`,"data-id":this.props.discussion.id},l.createElement("div",{className:`${B}__top`,style:(0,d.OS)(i)},l.createElement("div",{className:`${B}__top-user`},l.createElement(L.q,{group:i,hideStripe:!0,user:r})),l.createElement("div",{className:`${B}__top-message`},this.renderPost(t,"discussion")),this.renderPostButtons()),this.postFooter(),l.createElement("div",{className:s})))}isOwner(e){return null!=o.A.currentUser&&o.A.currentUser.id===e.user_id}isRead(e){var t;return(null===(t=this.readPostIds)||void 0===t?void 0:t.has(e.id))||this.isOwner(e)||this.readonly}isVisible(e){return null!=e&&(this.showDeleted||null==e.deleted_at)}postFooter(){if(null==this.props.discussionsState)return null;let e=`${B}__expanded`;return this.collapsed&&(e+=" hidden"),l.createElement("div",{className:e},l.createElement("div",{className:`${B}__replies`},this.props.discussion.posts.slice(1).map(this.renderReply)),null!=this.props.discussionsState&&this.canBeRepliedTo&&l.createElement(R,{discussion:this.props.discussion,discussionsState:this.props.discussionsState}))}renderPost(e,t){var s;const r=null!==(s=this.users.get(e.user_id))&&void 0!==s?s:n.fc;return e.system?l.createElement($,{key:e.id,post:e,user:r}):l.createElement(M.A,{key:e.id,discussion:this.props.discussion,discussionsState:this.props.discussionsState,post:e,read:this.isRead(e),readonly:this.readonly,resolvedStateChangedPostId:this.resolvedStateChangedPostId,store:this.props.store,type:t,user:r})}renderPostButtons(){var e;if(null==this.props.discussionsState)return null;const t=this.props.store.users.get(this.props.discussion.user_id);return l.createElement("div",{className:`${B}__top-actions`},l.createElement("div",{className:`${B}__actions`},null!=this.props.parentDiscussion&&l.createElement("a",{className:`${B}__link-to-parent js-beatmap-discussion--jump`,href:(0,c.Gm)({discussion:this.props.parentDiscussion}),title:(0,p.pw)("beatmap_discussions.review.go_to_parent")},l.createElement("i",{className:"fas fa-tasks"})),l.createElement("span",{className:"visible-xs"},l.createElement(F,{type:this.props.discussion.message_type})),l.createElement(E,{cannotVote:this.isOwner(this.props.discussion)||null!==(e=null==t?void 0:t.is_bot)&&void 0!==e&&e||!this.canBeRepliedTo,discussion:this.props.discussion,discussionsState:this.props.discussionsState,users:this.users}),l.createElement("button",{className:`${B}__action ${B}__action--with-line`,onClick:this.handleCollapseClick},l.createElement("div",{className:(0,d.Zt)("beatmap-discussion-expand",{expanded:!this.collapsed})},l.createElement("i",{className:"fas fa-chevron-down"})))))}renderTimestamp(){return l.createElement("div",{className:(0,d.Zt)("beatmap-discussion-timestamp",{sticky:this.props.isTimelineVisible})},null!=this.props.discussion.timestamp&&this.props.isTimelineVisible&&l.createElement("div",{className:"beatmap-discussion-timestamp__point"}),l.createElement("div",{className:"beatmap-discussion-timestamp__icons-container"},l.createElement("div",{className:"beatmap-discussion-timestamp__icons"},l.createElement(F,{type:this.props.discussion.message_type}),this.props.discussion.resolved&&l.createElement(F,{type:"resolved"})),null!=this.props.discussion.timestamp&&l.createElement("div",{className:"beatmap-discussion-timestamp__text"},(0,c.Ey)(this.props.discussion.timestamp))))}};U([i.EW],G.prototype,"canBeRepliedTo",null),U([i.EW],G.prototype,"collapsed",null),U([i.EW],G.prototype,"highlighted",null),U([i.EW],G.prototype,"resolvedStateChangedPostId",null),U([i.XI],G.prototype,"handleCollapseClick",void 0),U([i.XI],G.prototype,"handleSetHighlight",void 0),G=U([a.PA],G)},7013:(e,t,s)=>{s.d(t,{A:()=>he});var r=s(5325),i=s(8623),a=s(7746),n=s(9981),o=s(1370),l=s(6823),c=s(6540),u=s(7752),d=s(9184),p=s(5446),m=s(6407),h=s(6606),b=s(7634),f=s(1883);const v=c.createContext([]);var g=s(5176),y=s(1980),w=s(5810),_=s(7153),E=s(6968);const P=c.createContext(null);class O extends c.Component{constructor(){super(...arguments),Object.defineProperty(this,"renderButton",{enumerable:!0,configurable:!0,writable:!0,value:(e,t,s)=>{var r;const i=null!==(r=this.props.menuOptions.find((e=>e.id===this.props.selected)))&&void 0!==r?r:this.props.menuOptions[0],a=[];return this.props.disabled&&(s=()=>{},a.push("disabled")),c.createElement("div",{ref:t,className:(0,b.Zt)("icon-dropdown-menu",a),contentEditable:!1,onClick:s},i.icon,e)}}),Object.defineProperty(this,"renderMenuItem",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var t;return c.createElement("button",{key:e.id,className:(0,b.Zt)("simple-menu__item",{active:e.id===this.props.selected}),"data-id":e.id,onClick:this.select},null===(t=e.renderIcon)||void 0===t||t?c.createElement(c.Fragment,null,c.createElement("div",{className:(0,b.Zt)("simple-menu__item-icon","icon-dropdown-menu")},e.icon),c.createElement("div",{className:"simple-menu__label"},e.label)):e.label)}}),Object.defineProperty(this,"select",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var t;e.preventDefault();const s=e.currentTarget;null!=s&&this.props.onSelect(null!==(t=s.dataset.id)&&void 0!==t?t:"")}})}render(){return c.createElement(E.A,{customRender:this.renderButton,direction:"right"},(()=>c.createElement("div",{className:"simple-menu simple-menu--popup-menu-compact"},this.props.menuOptions.map(this.renderMenuItem))))}}Object.defineProperty(O,"contextType",{enumerable:!0,configurable:!0,writable:!0,value:P});const j=O;class k extends c.Component{constructor(){super(...arguments),Object.defineProperty(this,"select",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const t="all"!==e?parseInt(e,10):void 0,s=p.rL.findPath(this.context,this.props.element);u.gB.setNodes(this.context,{beatmapId:t},{at:s})}})}render(){var e;const t=[],s="full-width";return t.push({icon:c.createElement("i",{className:"fas fa-fw fa-star-of-life"}),id:"all",label:c.createElement("div",{className:(0,b.Zt)("beatmap-list-item",s)},c.createElement("div",{className:"beatmap-list-item__col beatmap-list-item__col--icon"},c.createElement("i",{className:"fas fa-xs fa-star-of-life"})),c.createElement("div",{className:"beatmap-list-item__col beatmap-list-item__col--main"},(0,f.pw)("beatmaps.discussions.mode.scopes.generalAll"))),renderIcon:!1}),this.props.beatmaps.forEach((e=>{null==e.deleted_at&&t.push({icon:c.createElement(w.k,{beatmap:e}),id:e.id.toString(),label:c.createElement(_.A,{beatmap:e,mapper:null,modifiers:s}),renderIcon:!1})})),c.createElement(j,{disabled:this.props.disabled,menuOptions:t,onSelect:this.select,selected:null===(e=this.props.element.beatmapId)||void 0===e?void 0:e.toString()})}}Object.defineProperty(k,"contextType",{enumerable:!0,configurable:!0,writable:!0,value:P});const S=k;var N=s(397);const A=["praise","problem","suggestion"];class T extends c.Component{constructor(){super(...arguments),Object.defineProperty(this,"select",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const t=p.rL.findPath(this.context,this.props.element);u.gB.setNodes(this.context,{discussionType:e},{at:t})}})}render(){const e=A.map((e=>({icon:c.createElement("span",{className:N.d[e],style:{color:`var(--beatmapset-discussion-colour--${e})`}}),id:e,label:(0,f.pw)(`beatmaps.discussions.message_type.${e}`)})));return c.createElement(j,{disabled:this.props.disabled,menuOptions:e,onSelect:this.select,selected:this.props.element.discussionType})}}Object.defineProperty(T,"contextType",{enumerable:!0,configurable:!0,writable:!0,value:P});const C=T;var x=s(2577),I=s(4692),R=function(e,t,s,r){var i,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(n=(a<3?i(n):a>3?i(t,s,n):i(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n};const M="beatmap-discussion-review-post-embed-preview";let D=class extends c.Component{constructor(){super(...arguments),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"tooltipContent",{enumerable:!0,configurable:!0,writable:!0,value:c.createRef()}),Object.defineProperty(this,"tooltipEl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"componentDidMount",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.editable()&&u.gB.setNodes(this.context,{timestamp:void 0},{at:this.path()})}}),Object.defineProperty(this,"componentDidUpdate",{enumerable:!0,configurable:!0,writable:!0,value:()=>{if(!this.editable())return;const e=this.path();let t=!1;if("embed"===this.props.element.type&&null!=this.props.element.beatmapId){const s=this.props.element.children[0].text,r=h._R.exec(s);let i;null!==r&&0===r.index&&(i=r[2]),i!==this.props.element.timestamp&&(t=!0),u.gB.setNodes(this.context,{timestamp:i},{at:e})}else u.gB.setNodes(this.context,{timestamp:void 0},{at:e}),t=!0;t&&(this.cache={},this.destroyTooltip())}}),Object.defineProperty(this,"createTooltip",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const t=this.timestamp();if(null==t)return;const s=e.currentTarget,r=`${this.selectedBeatmap()}-${t}`;this.tooltipEl&&this.tooltipEl._tooltip===r||(this.tooltipEl=s,s._tooltip=r,I(s).qtip({content:{text:()=>{var e;return null===(e=this.tooltipContent.current)||void 0===e?void 0:e.innerHTML}},hide:{delay:200,fixed:!0},position:{at:"top center",my:"bottom center",viewport:I(window)},show:{delay:200,ready:!0},style:{classes:"tooltip-default tooltip-default--interactable"}}),this.tooltipEl=s)}}),Object.defineProperty(this,"delete",{enumerable:!0,configurable:!0,writable:!0,value:()=>{window.setTimeout((()=>u.gB.delete(this.context,{at:this.path()})),0)}}),Object.defineProperty(this,"destroyTooltip",{enumerable:!0,configurable:!0,writable:!0,value:()=>{if(!this.tooltipEl)return;const e=I(this.tooltipEl).qtip("api");null!=e&&(e.destroy(),this.tooltipEl=void 0)}}),Object.defineProperty(this,"discussionType",{enumerable:!0,configurable:!0,writable:!0,value:()=>this.props.element.discussionType}),Object.defineProperty(this,"editable",{enumerable:!0,configurable:!0,writable:!0,value:()=>!(this.props.editMode&&null!=this.props.element.discussionId)}),Object.defineProperty(this,"isRelevantDiscussion",{enumerable:!0,configurable:!0,writable:!0,value:e=>null!=e&&e.beatmap_id===this.selectedBeatmap()}),Object.defineProperty(this,"nearbyDiscussions",{enumerable:!0,configurable:!0,writable:!0,value:()=>{const e=this.timestamp(),t=this.selectedBeatmap();if(null==e||null==t)return[];if(null==this.cache.nearbyDiscussions||this.cache.nearbyDiscussions.timestamp!==e||this.cache.nearbyDiscussions.beatmap_id!==t){const s=[...this.discussions.values()].filter(this.isRelevantDiscussion);this.cache.nearbyDiscussions={beatmap_id:t,discussions:(0,h.F3)(s,e),timestamp:e}}return this.cache.nearbyDiscussions.discussions}}),Object.defineProperty(this,"nearbyDraftEmbeds",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const t=this.timestamp();if(null!=t&&0!==e.length)return e.filter((e=>{if(null==e.timestamp||e.beatmapId!==this.props.element.beatmapId)return!1;const s=(0,h.EH)(e.timestamp);return null!=s&&Math.abs(s-t)<=5e3}))}}),Object.defineProperty(this,"nearbyIndicator",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var t;if(!this.editable()||null==this.timestamp()||"praise"===this.discussionType())return null;const s=this.nearbyDiscussions(),r=null!==(t=this.nearbyDraftEmbeds(e))&&void 0!==t?t:[];if(s.length>0||r.length>1){const e=[];s.forEach((t=>{if(null==t.timestamp)return;const s=(0,h.Ey)(t.timestamp);e.push(this.props.editMode?s:(0,y.eq)((0,h.Gm)({discussion:t}),s,{classNames:["js-beatmap-discussion--jump"]}))})),r.length>1&&e.push((0,f.pw)("beatmap_discussions.nearby_posts.unsaved",{count:r.length-1}));const t=(0,f.sc)(e),i=(0,f.pw)("beatmap_discussions.nearby_posts.notice",{existing_timestamps:t,timestamp:this.props.element.timestamp});return c.createElement("div",{className:`${M}__indicator ${M}__indicator--warning`,contentEditable:!1,onMouseOver:this.createTooltip,onTouchStart:this.createTooltip},c.createElement("script",{dangerouslySetInnerHTML:{__html:i},ref:this.tooltipContent,type:"text/html"}),c.createElement("i",{className:"fas fa-exclamation-triangle"}))}return null}}),Object.defineProperty(this,"path",{enumerable:!0,configurable:!0,writable:!0,value:()=>p.rL.findPath(this.context,this.props.element)}),Object.defineProperty(this,"selectedBeatmap",{enumerable:!0,configurable:!0,writable:!0,value:()=>this.props.element.beatmapId}),Object.defineProperty(this,"timestamp",{enumerable:!0,configurable:!0,writable:!0,value:()=>(0,h.EH)(this.props.element.timestamp)})}get discussions(){return this.props.store.discussions}componentWillUnmount(){this.destroyTooltip()}render(){var e;const t=this.editable(),s=t?[]:["read-only"],r=null!=this.props.element.beatmapId?"diff":"all-diff",i=(0,f.pw)(`beatmaps.discussions.review.embed.timestamp.${r}`,{type:(0,f.pw)(`beatmaps.discussions.message_type.${this.discussionType()}`)}),a=c.createElement("button",{className:`${M}__delete`,contentEditable:!1,disabled:this.props.readOnly,onClick:this.delete,title:(0,f.pw)("beatmaps.discussions.review.embed."+(t?"delete":"unlink"))},c.createElement("i",{className:"fas fa-"+(t?"trash-alt":"link")})),n=c.createElement(v.Consumer,null,(e=>c.createElement(g.nu,null,(()=>this.nearbyIndicator(e))))),o=this.props.editMode&&t?c.createElement("div",{className:`${M}__indicator`,contentEditable:!1,title:(0,f.pw)("beatmaps.discussions.review.embed.unsaved")},c.createElement("i",{className:"fas fa-pencil-alt"})):null,l=this.props.readOnly||!t,u=this.discussions.get(this.props.element.discussionId),d=null!=u?(0,x.q)(u):"praise"===this.discussionType()?"praise":null;return c.createElement("div",Object.assign({className:"beatmap-discussion beatmap-discussion--preview",contentEditable:t,suppressContentEditableWarning:!0},this.props.attributes),c.createElement("div",{className:(0,b.Zt)(M,s,d)},c.createElement("div",{className:`${M}__content`},c.createElement("div",{className:`${M}__selectors`,contentEditable:!1},c.createElement(S,{beatmaps:this.props.discussionsState.sortedBeatmaps,disabled:l,element:this.props.element}),c.createElement(C,{beatmaps:this.props.discussionsState.sortedBeatmaps,disabled:l,element:this.props.element}),c.createElement("div",{className:`${M}__timestamp`,contentEditable:!1},c.createElement("span",{title:t?i:""},null!==(e=this.props.element.timestamp)&&void 0!==e?e:(0,f.pw)("beatmap_discussions.timestamp_display.general"))),o,n),c.createElement("div",{className:`${M}__stripe`,contentEditable:!1}),c.createElement("div",{className:`${M}__message-container`},this.props.children),o,n)),a)}};Object.defineProperty(D,"contextType",{enumerable:!0,configurable:!0,writable:!0,value:P}),D=R([o.PA],D);const H=D;var $=s(5812);const L=e=>e.length,U=e=>{const t=F(e);return null!=t&&("type"in t&&"embed"===t.type)},B=(e,t)=>{const[s]=u.KE.nodes(e,{match:e=>u.EY.isText(e)&&!0===e[t],mode:"all"});return null!=s},F=e=>{if(e.selection)return u.bP.parent(e,u.Q6.start(e.selection).path)},G=(e,t)=>{u.gB.setNodes(e,{[t]:!B(e,t)||null},{match:e=>u.EY.isText(e),split:!0})};function X(e,t){const s=e.trim();if(0===s.length)return;const r=`${t}${s}${t}`;return s===e?r:e.replace(s,r)}function W(e){return e.children.map((e=>{if(""!==e.text){const t=e.text.replace(/([*_\\])/g,"\\$1");return e.bold&&e.italic?X(t,"***"):e.bold?X(t,"**"):e.italic?X(t,"*"):t}})).join("")}const V=e=>{const t=[];e.forEach((e=>{switch(e.type){case"paragraph":t.push({text:W(e),type:"paragraph"});break;case"embed":t.push(function(e){var t;return null!=e.discussionId?{discussion_id:e.discussionId,type:"embed"}:{beatmap_id:null!==(t=e.beatmapId)&&void 0!==t?t:null,discussion_type:e.discussionType,text:e.children[0].text,timestamp:(0,h.EH)(e.timestamp),type:"embed"}}(e))}}));const s=t[t.length-1];return"paragraph"!==s.type||(0,$.E)(s.text)||t.pop(),JSON.stringify(t)};var q=s(8156),z=s(2543),Z=s(3938),K=s(4692);class J extends c.Component{constructor(e){super(e),Object.defineProperty(this,"bn",{enumerable:!0,configurable:!0,writable:!0,value:"beatmap-discussion-editor-insertion-menu"}),Object.defineProperty(this,"eventId",{enumerable:!0,configurable:!0,writable:!0,value:`editor-insertion-menu-${(0,Z.L)()}`}),Object.defineProperty(this,"hideInsertMenuTimer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hoveredBlock",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"insertPosition",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"insertRef",{enumerable:!0,configurable:!0,writable:!0,value:c.createRef()}),Object.defineProperty(this,"mouseOver",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"scrollContainer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"throttledContainerMouseExit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"throttledContainerMouseMove",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"throttledMenuMouseEnter",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"throttledMenuMouseExit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"throttledScroll",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"containerMouseMove",{enumerable:!0,configurable:!0,writable:!0,value:e=>{if(!e.originalEvent)return;const t=e.originalEvent.clientY,s=this.scrollContainer.children[0].children;let r=0;for(const a of s){if(t<a.getBoundingClientRect().top){if(r>0){const e=s[r-1];t<e.getBoundingClientRect().top+e.getBoundingClientRect().height/2&&r--}break}r<s.length-1&&r++}this.hoveredBlock=s[r];const i=this.hoveredBlock.getBoundingClientRect();t>i.top+i.height/2?this.insertPosition="below":this.insertPosition="above",this.updatePosition(),this.showMenu(),this.startHideTimer()}}),Object.defineProperty(this,"forceHideMenu",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.mouseOver=!1,this.hideMenu()}}),Object.defineProperty(this,"hideMenu",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.insertRef.current&&!this.mouseOver&&(this.insertRef.current.style.display="none")}}),Object.defineProperty(this,"insertBlock",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var t,s,r,i,a,n;const o=this.context,l=null===(t=this.hoveredBlock)||void 0===t?void 0:t.lastChild,c=e.currentTarget.dataset.discussionType,d=null===(s=this.props.currentBeatmap)||void 0===s?void 0:s.id;let m;switch(c){case"suggestion":case"problem":case"praise":m={beatmapId:d,children:[{text:""}],discussionType:c,type:"embed"};break;case"paragraph":m={children:[{text:""}],type:"paragraph"}}if(!m||!l)return;let h,b=p.rL.toSlateNode(o,l);if(u.EY.isText(b)&&""===b.text||u.Hg.isElement(b)&&u.KE.isEmpty(o,b))if("above"===this.insertPosition){const e=null===(i=null===(r=this.hoveredBlock)||void 0===r?void 0:r.previousSibling)||void 0===i?void 0:i.lastChild;null!=e?(b=p.rL.toSlateNode(o,e),h=u.KE.end(o,p.rL.findPath(o,b))):h={offset:0,path:[]}}else{const e=null===(n=null===(a=this.hoveredBlock)||void 0===a?void 0:a.previousSibling)||void 0===n?void 0:n.lastChild;null!=e?(b=p.rL.toSlateNode(o,e),h=u.KE.start(o,p.rL.findPath(o,b))):h=u.KE.end(o,[])}else{const e=p.rL.findPath(o,b);h="above"===this.insertPosition?u.KE.start(o,e):u.KE.end(o,e)}u.gB.insertNodes(o,m,{at:h})}}),Object.defineProperty(this,"insertButton",{enumerable:!0,configurable:!0,writable:!0,value:e=>{let t="fas fa-question";switch(e){case"praise":case"problem":case"suggestion":t=N.d[e];break;case"paragraph":t="fas fa-indent"}return c.createElement("button",{className:`${this.bn}__menu-button ${this.bn}__menu-button--${e}`,"data-discussion-type":e,onClick:this.insertBlock,title:(0,f.pw)(`beatmaps.discussions.review.insert-block.${e}`),type:"button"},c.createElement("i",{className:t}))}}),Object.defineProperty(this,"menuMouseEnter",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.mouseOver=!0}}),Object.defineProperty(this,"menuMouseLeave",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.mouseOver=!1,this.startHideTimer()}}),this.throttledContainerMouseExit=(0,z.throttle)((()=>{setTimeout(this.hideMenu,100)}),10),this.throttledContainerMouseMove=(0,z.throttle)(this.containerMouseMove,10),this.throttledMenuMouseEnter=(0,z.throttle)(this.menuMouseEnter,10),this.throttledMenuMouseExit=(0,z.throttle)(this.menuMouseLeave,10),this.throttledScroll=(0,z.throttle)(this.forceHideMenu,10)}componentDidMount(){this.insertRef.current&&(K(this.insertRef.current).on(`mouseenter.${this.eventId}`,this.throttledMenuMouseEnter),K(this.insertRef.current).on(`mouseleave.${this.eventId}`,this.throttledMenuMouseExit)),K(window).on(`scroll.${this.eventId}`,this.throttledScroll)}componentDidUpdate(){this.forceHideMenu()}componentWillUnmount(){K(window).off(`.${this.eventId}`),this.scrollContainer&&K(this.scrollContainer).off(`.${this.eventId}`),this.insertRef.current&&K(this.insertRef.current).off(`.${this.eventId}`)}render(){return c.createElement(q.A,null,c.createElement("div",{ref:this.insertRef,className:`${this.bn}`},c.createElement("div",{className:`${this.bn}__body`},c.createElement("i",{className:"fas fa-plus"}),c.createElement("div",{className:`${this.bn}__buttons`},this.insertButton("suggestion"),this.insertButton("problem"),this.insertButton("praise"),this.insertButton("paragraph")))))}setScrollContainer(e){this.scrollContainer&&K(this.scrollContainer).off(`.${this.eventId}`),this.scrollContainer=e,K(this.scrollContainer).on(`mousemove.${this.eventId}`,this.throttledContainerMouseMove),K(this.scrollContainer).on(`mouseleave.${this.eventId}`,this.throttledContainerMouseExit),K(this.scrollContainer).on(`scroll.${this.eventId}`,this.throttledScroll)}showMenu(){this.insertRef.current&&(this.insertRef.current.style.display="flex")}startHideTimer(){window.clearTimeout(this.hideInsertMenuTimer),this.hideInsertMenuTimer=window.setTimeout(this.hideMenu,2e3)}updatePosition(){if(!this.scrollContainer||!this.hoveredBlock||!this.insertRef.current)return;const e=this.hoveredBlock.getBoundingClientRect(),t=this.scrollContainer.getBoundingClientRect();this.insertRef.current.style.left=`${t.left+15}px`,this.insertRef.current.style.width=t.width-30+"px","above"===this.insertPosition?this.insertRef.current.style.top=e.top-10+"px":"below"===this.insertPosition&&(this.insertRef.current.style.top=e.top+e.height-10+"px")}}Object.defineProperty(J,"contextType",{enumerable:!0,configurable:!0,writable:!0,value:P});const Y=e=>{const t=c.useContext(P),s=c.useCallback((s=>{s.preventDefault(),G(t,e.format)}),[t,e.format]);return c.createElement("button",{className:(0,b.Zt)("beatmap-discussion-editor-toolbar__button",{active:B(t,e.format)}),onMouseDown:s},c.createElement("i",{className:`fas fa-${e.format}`}))};var Q=s(4692);const ee="beatmap-discussion-editor-toolbar";class te extends c.Component{constructor(){super(...arguments),Object.defineProperty(this,"eventId",{enumerable:!0,configurable:!0,writable:!0,value:`editor-toolbar-${(0,Z.L)()}`}),Object.defineProperty(this,"ref",{enumerable:!0,configurable:!0,writable:!0,value:c.createRef()}),Object.defineProperty(this,"scrollContainer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"scrollTimer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"throttledUpdate",{enumerable:!0,configurable:!0,writable:!0,value:(0,z.throttle)((()=>this.updatePosition()),100)})}get selectionRange(){const{selection:e}=this.context;if(!e||!p.rL.isFocused(this.context)||u.Q6.isCollapsed(e)||""===u.KE.string(this.context,e))return null;const t=window.getSelection();return null==t?void 0:t.getRangeAt(0)}get visible(){return null!=this.selectionRange}componentDidMount(){Q(window).on(`scroll.${this.eventId}`,this.throttledUpdate),this.updatePosition()}componentDidUpdate(){this.updatePosition()}componentWillUnmount(){Q(window).off(`.${this.eventId}`),this.scrollContainer&&Q(this.scrollContainer).off(`.${this.eventId}`),this.throttledUpdate.cancel()}hide(){const e=this.ref.current;e&&(e.style.display="none")}render(){return null!=this.context&&this.visible?c.createElement(q.A,null,c.createElement("div",{ref:this.ref,className:ee},c.createElement(Y,{format:"bold"}),c.createElement(Y,{format:"italic"}),c.createElement("div",{className:`${ee}__popup-tail`}))):null}setScrollContainer(e){this.scrollContainer&&Q(this.scrollContainer).off(`.${this.eventId}`),this.scrollContainer=e,Q(this.scrollContainer).on(`scroll.${this.eventId}`,this.throttledUpdate)}updatePosition(){const e=this.ref.current;e&&null!=this.context&&(window.clearTimeout(this.scrollTimer),this.scrollTimer=window.setTimeout((()=>{var t,s;const r=this.selectionRange;if(null==r)return this.hide();for(const e of u.KE.positions(this.context,{at:null!==(t=this.context.selection)&&void 0!==t?t:void 0,unit:"block"})){const t=u.bP.parent(this.context,e.path);if(u.Hg.isElement(t)&&"embed"===t.type)return this.hide()}const i=null===(s=this.scrollContainer)||void 0===s?void 0:s.getBoundingClientRect(),a=r.getBoundingClientRect();if(null!=i&&(a.top<i.top||a.top>i.bottom))return this.hide();e.style.display="block",e.style.left=`${a.left+(window.pageXOffset-e.offsetWidth)/2+a.width/2}px`,e.style.top=a.top-e.clientHeight-10+"px"}),10))}}Object.defineProperty(te,"contextType",{enumerable:!0,configurable:!0,writable:!0,value:P});var se=s(9085),re=s(5780),ie=s(2172);function ae(e,t){let s;try{s=JSON.parse(e)}catch(a){return console.error("error parsing srcDoc"),[]}const r=(0,ie.l)().use(se.A).use(re.A,{type:"editor"}),i=[];return s.forEach((e=>{switch(e.type){case"paragraph":if((0,$.E)(e.text.trim())){const t=r.parse(e.text);if(null==t.children||t.children.length<1){console.error("children missing... ?");break}const s=ne(t.children);s.length>0?i.push({children:s,type:"paragraph"}):i.push({children:[{text:""}],type:"paragraph"})}else i.push({children:[{text:""}],type:"paragraph"});break;case"embed":{const r=e,a=t.get(r.discussion_id);if(null==a){console.error("unknown/external discussion referenced",r.discussion_id);break}if(s=a.message_type,!A.includes(s)){console.error("unsupported embed type",a.message_type);break}const n=(0,h.JL)(a);if(null==n||n.system){console.error("embed starting post is missing or is system post",r.discussion_id);break}i.push({beatmapId:a.beatmap_id,children:[{text:n.message}],discussionId:a.id,discussionType:a.message_type,timestamp:null!=a.timestamp?(0,h.Ey)(a.timestamp):void 0,type:"embed"});break}default:console.error("unknown block encountered",e)}var s})),i}function ne(e,t){let s=[];const r=null!=t?t:{bold:!1,italic:!1};return e.forEach((e=>{const t={bold:r.bold||"strong"===e.type,italic:r.italic||"emphasis"===e.type};var i;"children"in(i=e)&&Array.isArray(i.children)?s=s.concat(ne(e.children,t)):function(e){return"text"===e.type}(e)&&s.push({bold:t.bold,italic:t.italic,text:e.value})})),s}var oe=s(9457),le=s(4692),ce=function(e,t,s,r){var i,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(n=(a<3?i(n):a>3?i(t,s,n):i(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n},ue=function(e,t){var s={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(s[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(s[r[i]]=e[r[i]])}return s};const de=[Object.freeze({children:[{text:""}],type:"paragraph"})];function pe(e){return"embed"===e.type&&null==e.discussionId}let me=class extends c.Component{get beatmaps(){return this.props.store.beatmaps}get beatmapset(){return this.props.discussionsState.beatmapset}get discussions(){return this.props.store.discussions}get editMode(){return null!=this.props.document}constructor(e){if(super(e),Object.defineProperty(this,"bn",{enumerable:!0,configurable:!0,writable:!0,value:"beatmap-discussion-editor"}),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"insertMenuRef",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"localStorageKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"scrollContainerRef",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"slateEditor",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"toolbarRef",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"initialValue",{enumerable:!0,configurable:!0,writable:!0,value:de}),Object.defineProperty(this,"xhr",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"blockWrapper",{enumerable:!0,configurable:!0,writable:!0,value:e=>c.createElement("div",{className:`${this.bn}__block`},e)}),Object.defineProperty(this,"decorateTimestamps",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const[t,s]=e,r=[];if(!u.EY.isText(t))return r;const i=RegExp(h._R,"g");let a;for(;null!==(a=i.exec(t.text));)r.push({anchor:{offset:a.index,path:s},focus:{offset:a.index+a[0].length,path:s},timestamp:a[0]});return r}}),Object.defineProperty(this,"onChange",{enumerable:!0,configurable:!0,writable:!0,value:e=>{if(0===e.length&&(console.error("value is empty in Editor.onChange"),e=de),!this.editMode){const s=JSON.stringify(e);0===(t=e).length||1===t.length&&"paragraph"===t[0].type&&1===t[0].children.length&&""===t[0].children[0].text?localStorage.removeItem(this.localStorageKey):localStorage.setItem(this.localStorageKey,s)}var t;this.setState({blockCount:L(e),value:e},(()=>{var e,t;p.rL.isFocused(this.slateEditor)&&this.props.onFocus&&this.props.onFocus(),null===(t=(e=this.props).onChange)||void 0===t||t.call(e)}))}}),Object.defineProperty(this,"onKeyDown",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const t=e.nativeEvent;(0,a.Ay)("mod+b",t)?(e.preventDefault(),G(this.slateEditor,"bold")):(0,a.Ay)("mod+i",t)?(e.preventDefault(),G(this.slateEditor,"italic")):(0,a.Ay)("shift+enter",t)?U(this.slateEditor)&&(e.preventDefault(),this.slateEditor.insertText("\n")):((0,a.Ay)("delete",t)||(0,a.Ay)("backspace",t))&&(e=>{const t=F(e);return null!=t&&"type"in t&&u.KE.isEmpty(e,t)})(this.slateEditor)&&(e.preventDefault(),u.gB.removeNodes(this.slateEditor),0===this.slateEditor.children.length&&this.resetEditorValue())}}),Object.defineProperty(this,"post",{enumerable:!0,configurable:!0,writable:!0,value:()=>{null==this.xhr&&this.showConfirmationIfRequired()&&this.setState({posting:!0},(()=>{this.xhr=le.ajax((0,n.w)("beatmapsets.discussion.review",{beatmapset:this.beatmapset.id}),{data:{document:this.serialize()},method:"POST"}),this.xhr.done((e=>{this.props.discussionsState.update({beatmapset:e}),this.resetInput()})).fail(m.S5).always((()=>{this.xhr=null,this.setState({posting:!1})}))}))}}),Object.defineProperty(this,"renderBlockCount",{enumerable:!0,configurable:!0,writable:!0,value:e=>c.createElement(r.P,{current:this.state.blockCount,max:this.context.max_blocks,onlyShowAsWarning:!0,theme:e,tooltip:(0,f.pw)("beatmap_discussions.review.block_count",{max:this.context.max_blocks,used:this.state.blockCount})})}),Object.defineProperty(this,"renderElement",{enumerable:!0,configurable:!0,writable:!0,value:e=>{let t;switch(e.element.type){case"embed":{const{element:s}=e,r=ue(e,["element"]);t=c.createElement(H,Object.assign({discussionsState:this.props.discussionsState,editMode:this.editMode,element:s,readOnly:this.state.posting,store:this.props.store},r));break}default:t=e.children}return this.blockWrapper(t)}}),Object.defineProperty(this,"renderLeaf",{enumerable:!0,configurable:!0,writable:!0,value:e=>{let t=e.children;return e.leaf.bold&&(t=c.createElement("strong",Object.assign({},e.attributes),t)),e.leaf.italic&&(t=c.createElement("em",Object.assign({},e.attributes),t)),null!=e.leaf.timestamp?c.createElement("span",Object.assign({className:"beatmap-discussion-timestamp-decoration"},e.attributes),t):c.createElement("span",Object.assign({},e.attributes),t)}}),Object.defineProperty(this,"resetInput",{enumerable:!0,configurable:!0,writable:!0,value:e=>{e&&(e.preventDefault(),!confirm((0,f.pw)("common.confirmation")))||this.resetEditorValue()}}),Object.defineProperty(this,"scrollSelectionIntoView",{enumerable:!0,configurable:!0,writable:!0,value:(e,t)=>{var s;null===(s=t.startContainer.parentElement)||void 0===s||s.scrollIntoView({block:"nearest",inline:"nearest"})}}),Object.defineProperty(this,"serialize",{enumerable:!0,configurable:!0,writable:!0,value:()=>V(this.state.value)}),Object.defineProperty(this,"showConfirmationIfRequired",{enumerable:!0,configurable:!0,writable:!0,value:()=>{const e=this.state.value.some((e=>"embed"===e.type&&"problem"===e.discussionType&&null==e.discussionId));const t=null!=l.A.currentUser&&(l.A.currentUser.is_admin||l.A.currentUser.is_moderator||l.A.currentUser.is_full_bn),s="qualified"===this.beatmapset.status&&e,r=null!=l.A.currentUser&&(l.A.currentUser.is_admin||l.A.currentUser.is_nat||l.A.currentUser.is_bng),i="pending"===this.beatmapset.status&&this.props.discussionsState.nominationsCount("current")>0&&e;return t&&s?confirm((0,f.pw)("beatmaps.nominations.reset_confirm.disqualify")):!r||!i||confirm((0,f.pw)("beatmaps.nominations.reset_confirm.nomination_reset"))}}),Object.defineProperty(this,"updateDrafts",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.cache.draftEmbeds=this.state.value.filter(pe)}}),Object.defineProperty(this,"withNormalization",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const{insertData:t,normalizeNode:s}=e;return e.insertData=s=>{U(this.slateEditor)?e.insertText(s.getData("text/plain")):t(s)},e.normalizeNode=t=>{const[r,i]=t;if(u.Hg.isElement(r)&&"embed"===r.type)for(const[s,a]of u.bP.children(e,i)){if(u.Hg.isElement(s)&&!e.isInline(s))return void u.gB.unwrapNodes(e,{at:a});if(u.EY.isText(s)&&(s.bold||s.italic))return void u.gB.unsetNodes(e,["bold","italic"],{at:a});if(null!=r.beatmapId){const t=this.beatmaps.get(r.beatmapId);null!=t&&null==t.deleted_at||u.gB.setNodes(e,{beatmapId:void 0},{at:i})}}s(t)},e}}),this.slateEditor=this.withNormalization((0,p.o$)((0,d.$k)((0,u.ie)()))),this.scrollContainerRef=c.createRef(),this.toolbarRef=c.createRef(),this.insertMenuRef=c.createRef(),this.localStorageKey=`newDiscussion-${this.beatmapset.id}`,this.editMode)this.initialValue=this.valueFromProps();else{const e=localStorage.getItem(this.localStorageKey);if(null!=e)try{this.initialValue=JSON.parse(e)}catch(t){console.error("invalid json in localStorage, ignoring"),localStorage.removeItem(this.localStorageKey)}}this.state={blockCount:L(this.initialValue),posting:!1,value:this.initialValue}}get canSave(){return!this.state.posting&&this.state.blockCount<=this.context.max_blocks}componentDidMount(){this.scrollContainerRef.current&&(this.toolbarRef.current&&this.toolbarRef.current.setScrollContainer(this.scrollContainerRef.current),this.insertMenuRef.current&&this.insertMenuRef.current.setScrollContainer(this.scrollContainerRef.current))}componentDidUpdate(e){if(this.props.document!==e.document){const e=this.valueFromProps();this.setState({blockCount:L(e),value:e})}}componentWillUnmount(){var e;null===(e=this.xhr)||void 0===e||e.abort()}render(){this.cache={};const e="beatmap-discussion-editor",t=this.editMode?["edit-mode"]:[];return this.state.posting&&t.push("readonly"),this.updateDrafts(),c.createElement("div",{className:(0,b.Zt)(e,t)},c.createElement("div",{className:`${e}__content`},c.createElement(P.Provider,{value:this.slateEditor},c.createElement(p.A,{editor:this.slateEditor,onChange:this.onChange,value:this.initialValue},c.createElement("div",{ref:this.scrollContainerRef,className:`${e}__input-area`},c.createElement(te,{ref:this.toolbarRef}),c.createElement(J,{ref:this.insertMenuRef,currentBeatmap:this.props.discussionsState.currentBeatmap}),c.createElement(v.Provider,{value:this.cache.draftEmbeds||[]},c.createElement(p.Fo,{decorate:this.decorateTimestamps,onKeyDown:this.onKeyDown,placeholder:(0,f.pw)("beatmaps.discussions.message_placeholder.review"),readOnly:this.state.posting,renderElement:this.renderElement,renderLeaf:this.renderLeaf,scrollSelectionIntoView:this.scrollSelectionIntoView}))),this.editMode&&c.createElement("div",{className:`${e}__inner-block-count`},this.renderBlockCount("lighter")),!this.editMode&&c.createElement("div",{className:`${e}__button-bar`},c.createElement("button",{className:"btn-osu-big btn-osu-big--forum-secondary",disabled:this.state.posting,onClick:this.resetInput,type:"button"},(0,f.pw)("common.buttons.clear")),c.createElement("div",null,c.createElement("span",{className:`${e}__block-count`},this.renderBlockCount()),c.createElement("button",{className:"btn-osu-big btn-osu-big--forum-primary",disabled:!this.canSave,onClick:this.post,type:"submit"},this.state.posting?c.createElement(i.y,null):(0,f.pw)("common.buttons.post"))))))))}resetEditorValue(){u.gB.deselect(this.slateEditor),this.slateEditor.children=de,this.slateEditor.onChange()}valueFromProps(){return this.props.editing&&null!=this.props.document?ae(this.props.document,this.discussions):[]}};Object.defineProperty(me,"contextType",{enumerable:!0,configurable:!0,writable:!0,value:oe.j}),Object.defineProperty(me,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{editing:!1}}),me=ce([o.PA],me);const he=me},3863:(e,t,s)=>{s.d(t,{A:()=>r});const r=Object.freeze({colour:"hsl(var(--hsl-l1))",has_listing:!1,has_playmodes:!1,id:-1,identifier:"owner",is_probationary:!1,name:"Beatmap Mapper",short_name:"MAPPER"})},615:(e,t,s)=>{s.d(t,{A:()=>m});var r=s(1091),i=s(6540),a=s(6181),n=s(8793),o=s(6978),l=s(5780),c=s(6606),u=s(5812);const d=Object.freeze({a:function(e){const t=(0,c.ML)(e.href);return null!=t.children?i.createElement("a",Object.assign({},t)):i.createElement(i.Fragment,null,e.children)},code:p,em:p,img:function(e){var t;return i.createElement(i.Fragment,null,null!==(t=(0,u.I)(e.alt))&&void 0!==t?t:"[image]")},p,pre:p,strong:p});function p(e){return i.createElement(i.Fragment,null,(0,r.I$)(e.children))}class m extends i.Component{render(){var e;return i.createElement(a.$,{className:"plain-text-preview",components:d,rehypePlugins:[[n.A,{maxChars:null!==(e=this.props.maxLength)&&void 0!==e?e:c.Y5}]],remarkPlugins:[o.A,[l.A,{type:this.props.type}]],transformLinkUri:r.lx,unwrapDisallowed:!0},this.props.markdown)}}},5654:(e,t,s)=>{s.d(t,{A:()=>I});var r=s(7013),i=s(6540),a=s(8931),n=s(2577);class o extends i.Component{render(){const e=[];try{JSON.parse(this.props.post.message).forEach(((t,s)=>{switch(t.type){case"paragraph":{const r=""===t.text.trim()?"&nbsp;":t.text;e.push(i.createElement(a.A,{key:s,markdown:r,type:"reviews"}));break}case"embed":t.discussion_id&&e.push(i.createElement(n.U,{key:s,data:{discussion_id:t.discussion_id},store:this.props.store}))}}))}catch(t){e.push(i.createElement("div",{key:null},"[error parsing review]"))}return i.createElement("div",{className:"beatmap-discussion-review-post"},e)}}var l=s(4893),c=s(1556),u=s(5953),d=s(3358),p=s(7833),m=s(1518),h=s(8994),b=s(9981),f=s(2543),v=s(7813),g=s(1370),y=s(8443),w=s(6823),_=s(6407),E=s(6606),P=s(9232),O=s(7634),j=s(7144),k=s(1883),S=s(738),N=s(3138),A=s(4692),T=function(e,t,s,r){var i,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(n=(a<3?i(n):a>3?i(t,s,n):i(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n};const C="beatmap-discussion-post";let x=class extends i.Component{get beatmap(){var e;return null===(e=this.props.discussionsState)||void 0===e?void 0:e.currentBeatmap}get beatmapset(){var e;return null===(e=this.props.discussionsState)||void 0===e?void 0:e.beatmapset}get users(){return this.props.store.users}get canEdit(){return null!=this.beatmapset&&(this.isAdmin||!(0,P.PR)(this.beatmapset)&&this.isOwn&&this.props.post.id>this.props.resolvedStateChangedPostId&&!this.beatmapset.discussion_locked)}get canDelete(){var e;return"discussion"===this.props.type?null===(e=this.props.discussion.current_user_attributes)||void 0===e?void 0:e.can_destroy:this.canModerate||this.canEdit}get canModerate(){return(0,E.pd)()}get canReport(){return null!=w.A.currentUser&&this.props.post.user_id!==w.A.currentUser.id}get deleteModel(){return"reply"===this.props.type?this.props.post:this.props.discussion}get isAdmin(){var e,t;return null!==(t=null===(e=w.A.currentUser)||void 0===e?void 0:e.is_admin)&&void 0!==t&&t}get isOwn(){return null!=w.A.currentUser&&w.A.currentUser.id===this.props.post.user_id}get isPosting(){return null!=this.xhr}get isReview(){return"review"===this.props.discussion.message_type&&"discussion"===this.props.type}get isTimeline(){return null!=this.props.discussion.timestamp}constructor(e){super(e),Object.defineProperty(this,"canSave",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"editing",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"handleTextareaKeyDown",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"messageBodyRef",{enumerable:!0,configurable:!0,writable:!0,value:i.createRef()}),Object.defineProperty(this,"reviewEditorRef",{enumerable:!0,configurable:!0,writable:!0,value:i.createRef()}),Object.defineProperty(this,"textareaMinHeight",{enumerable:!0,configurable:!0,writable:!0,value:"0"}),Object.defineProperty(this,"textareaRef",{enumerable:!0,configurable:!0,writable:!0,value:i.createRef()}),Object.defineProperty(this,"xhr",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"editCancel",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.editing=!1}}),Object.defineProperty(this,"editStart",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.textareaMinHeight=null!=this.messageBodyRef.current?`${this.messageBodyRef.current.getBoundingClientRect().height+50}px`:"0",this.editing=!0,this.message=this.props.post.message}}),Object.defineProperty(this,"handleEditorChange",{enumerable:!0,configurable:!0,writable:!0,value:()=>{var e,t;this.canSave=null!==(t=null===(e=this.reviewEditorRef.current)||void 0===e?void 0:e.canSave)&&void 0!==t&&t}}),Object.defineProperty(this,"handleMarkRead",{enumerable:!0,configurable:!0,writable:!0,value:()=>{var e;null===(e=this.props.discussionsState)||void 0===e||e.markAsRead(this.props.post.id)}}),Object.defineProperty(this,"handleTextareaChange",{enumerable:!0,configurable:!0,writable:!0,value:e=>{this.message=e.target.value,this.canSave=(0,E.as)(this.message,this.isTimeline)}}),Object.defineProperty(this,"handleTextareaKeyDownCallback",{enumerable:!0,configurable:!0,writable:!0,value:e=>{e===j.p.Submit&&this.updatePost()}}),Object.defineProperty(this,"updatePost",{enumerable:!0,configurable:!0,writable:!0,value:()=>{if(!this.isPosting){if(this.isReview){if(null==this.reviewEditorRef.current)return void console.error("reviewEditor is missing!");const e=this.reviewEditorRef.current.serialize();if((0,f.isEqual)(JSON.parse(this.props.post.message),JSON.parse(e)))return void(this.editing=!1);if(!this.reviewEditorRef.current.showConfirmationIfRequired())return;this.message=e}this.message!==this.props.post.message?(this.xhr=A.ajax((0,b.w)("beatmapsets.discussions.posts.update",{post:this.props.post.id}),{data:{beatmap_discussion_post:{message:this.message}},method:"PUT"}),this.xhr.done((e=>(0,v.h5)((()=>{var t;this.editing=!1,null===(t=this.props.discussionsState)||void 0===t||t.update({beatmapset:e})})))).fail(_.S5).always((0,v.XI)((()=>this.xhr=null)))):this.editing=!1}}}),(0,v.Gn)(this),this.handleTextareaKeyDown=(0,j.R)(this.handleTextareaKeyDownCallback),(0,g.bH)(this,(0,v.fm)((()=>{this.editing&&setTimeout((()=>{var e;return null===(e=this.textareaRef.current)||void 0===e?void 0:e.focus()}),0)})))}componentWillUnmount(){var e;null===(e=this.xhr)||void 0===e||e.abort()}render(){const e=(0,O.Zt)(C,this.props.type,{deleted:null!=this.props.post.deleted_at,editing:this.editing,unread:!this.props.read&&"discussion"!==this.props.type});return i.createElement("div",{className:`${e} js-beatmap-discussion-jump`,"data-post-id":this.props.post.id,onClick:this.handleMarkRead},i.createElement("div",{className:`${C}__content`},"reply"===this.props.type&&i.createElement(N.q,{group:(0,E.lz)({beatmapset:this.beatmapset,currentBeatmap:this.beatmap,discussion:this.props.discussion,user:this.props.user}),user:this.props.user}),this.editing?this.renderMessageEditor():this.renderMessageViewer()))}deleteHref(e){const[t,s]="reply"===this.props.type?["beatmapsets.discussions.posts","post"]:["beatmapsets.discussions","discussion"];return(0,b.w)(`${t}.${e}`,{[s]:this.deleteModel.id})}renderDeletedBy(){var e;if(null==this.deleteModel.deleted_at)return null;const t=null!==(e=this.users.get(this.deleteModel.deleted_by_id))&&void 0!==e?e:y.fc;return i.createElement("span",{className:`${C}__info`},i.createElement(d.A,{mappings:{delete_time:i.createElement(m.A,{dateTime:this.deleteModel.deleted_at,relative:!0}),editor:i.createElement(h.A,{className:`${C}__info-user`,user:t})},pattern:(0,k.pw)("beatmaps.discussions.deleted")}))}renderEdited(){var e;if(null==this.props.post.last_editor_id||this.props.post.updated_at===this.props.post.created_at)return null;const t=null!==(e=this.users.get(this.props.post.last_editor_id))&&void 0!==e?e:y.fc;return i.createElement("span",{className:`${C}__info`},i.createElement(d.A,{mappings:{editor:i.createElement(h.A,{className:`${C}__info-user`,user:t}),update_time:i.createElement(m.A,{dateTime:this.props.post.updated_at,relative:!0})},pattern:(0,k.pw)("beatmaps.discussions.edited")}))}renderKudosuAction(e){return i.createElement("a",{className:`js-beatmapset-discussion-update ${C}__action ${C}__action--button`,"data-confirm":(0,k.pw)("common.confirmation"),"data-method":"POST","data-remote":!0,href:(0,b.w)(`beatmapsets.discussions.${e}-kudosu`,{discussion:this.props.discussion.id})},(0,k.pw)(`beatmaps.discussions.${e}_kudosu`))}renderMessageEditor(){if(null==this.props.discussionsState||!this.canEdit)return;const e=!this.isPosting&&this.canSave,t=this.props.post.message;return i.createElement("div",{className:`${C}__message-container`},this.isReview?i.createElement(r.A,{ref:this.reviewEditorRef,discussion:this.props.discussion,discussionsState:this.props.discussionsState,document:t,editing:this.editing,onChange:this.handleEditorChange,store:this.props.store}):i.createElement(i.Fragment,null,i.createElement(p.A,{className:`${C}__message ${C}__message--editor`,disabled:this.isPosting,innerRef:this.textareaRef,onChange:this.handleTextareaChange,onKeyDown:this.handleTextareaKeyDown,style:{minHeight:this.textareaMinHeight},value:this.message}),i.createElement(S.A,{isTimeline:this.isTimeline,message:this.message})),i.createElement("div",{className:`${C}__actions`},i.createElement("div",{className:`${C}__actions-group`},i.createElement("div",{className:`${C}__actions-group`},i.createElement("div",{className:`${C}__action`},i.createElement(l.A,{disabled:this.isPosting,props:{onClick:this.editCancel},text:(0,k.pw)("common.buttons.cancel")}))),i.createElement("div",{className:`${C}__action`},i.createElement(l.A,{disabled:!e,props:{onClick:this.updatePost},text:(0,k.pw)("common.buttons.save")})))))}renderMessageViewer(){return i.createElement("div",{className:`${C}__message-container`},this.isReview?i.createElement("div",{className:`${C}__message`},i.createElement(o,{post:this.props.post,store:this.props.store})):i.createElement("div",{ref:this.messageBodyRef,className:`${C}__message`},i.createElement(a.A,{markdown:this.props.post.message})),i.createElement("div",{className:`${C}__info-container`},i.createElement("span",{className:`${C}__info`},i.createElement(m.A,{dateTime:this.props.post.created_at,relative:!0})),this.renderDeletedBy(),this.renderEdited(),"discussion"===this.props.type&&this.props.discussion.kudosu_denied&&i.createElement("span",{className:`${C}__info`},(0,k.pw)("beatmaps.discussions.kudosu_denied"))),this.renderMessageViewerActions())}renderMessageViewerActions(){return i.createElement("div",{className:`${C}__actions`},i.createElement("div",{className:`${C}__actions-group`},i.createElement("span",{className:`${C}__action ${C}__action--button`},i.createElement(c.A,{label:(0,k.pw)("common.buttons.permalink"),value:(0,E.Gm)({discussion:this.props.discussion,post:"reply"===this.props.type?this.props.post:void 0}),valueAsUrl:!0})),this.renderMessageViewerEditingActions(),this.canReport&&i.createElement(u.r,{className:`${C}__action ${C}__action--button`,reportableId:this.props.post.id.toString(),reportableType:"beatmapset_discussion_post",user:this.props.user})))}renderMessageViewerEditingActions(){var e;if(!this.props.readonly&&null!=this.props.discussionsState)return i.createElement(i.Fragment,null,this.canEdit&&i.createElement("button",{className:`${C}__action ${C}__action--button`,onClick:this.editStart},(0,k.pw)("beatmaps.discussions.edit")),null==this.deleteModel.deleted_at&&this.canDelete&&i.createElement("a",{className:`js-beatmapset-discussion-update ${C}__action ${C}__action--button`,"data-confirm":(0,k.pw)("common.confirmation"),"data-method":"DELETE","data-remote":!0,href:this.deleteHref("destroy")},(0,k.pw)("beatmaps.discussions.delete")),null!=this.deleteModel.deleted_at&&this.canModerate&&i.createElement("a",{className:`js-beatmapset-discussion-update ${C}__action ${C}__action--button`,"data-confirm":(0,k.pw)("common.confirmation"),"data-method":"POST","data-remote":!0,href:this.deleteHref("restore")},(0,k.pw)("beatmaps.discussions.restore")),"discussion"===this.props.type&&(null===(e=this.props.discussion.current_user_attributes)||void 0===e?void 0:e.can_moderate_kudosu)&&(this.props.discussion.can_grant_kudosu?this.renderKudosuAction("deny"):this.props.discussion.kudosu_denied&&this.renderKudosuAction("allow")))}};Object.defineProperty(x,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{resolvedStateChangedPostId:-1}}),T([v.sH],x.prototype,"canSave",void 0),T([v.sH],x.prototype,"editing",void 0),T([v.sH],x.prototype,"message",void 0),T([v.sH],x.prototype,"textareaMinHeight",void 0),T([v.sH],x.prototype,"xhr",void 0),T([v.EW],x.prototype,"canEdit",null),T([v.EW],x.prototype,"canReport",null),T([v.EW],x.prototype,"deleteModel",null),T([v.EW],x.prototype,"isAdmin",null),T([v.EW],x.prototype,"isOwn",null),T([v.EW],x.prototype,"isPosting",null),T([v.EW],x.prototype,"isReview",null),T([v.EW],x.prototype,"isTimeline",null),T([v.XI],x.prototype,"editCancel",void 0),T([v.XI],x.prototype,"editStart",void 0),T([v.XI],x.prototype,"handleEditorChange",void 0),T([v.XI],x.prototype,"handleTextareaChange",void 0),T([v.XI],x.prototype,"updatePost",void 0),x=T([g.PA],x);const I=x},9457:(e,t,s)=>{s.d(t,{j:()=>r});const r=s(6540).createContext({max_blocks:0})},2577:(e,t,s)=>{s.d(t,{U:()=>p,q:()=>u});var r=s(397),i=s(5810),a=s(6540),n=s(6606),o=s(7634),l=s(1883),c=s(8931);function u(e){return{deleted:null!=e.deleted_at,"general-all":null==e.beatmap_id,praise:"praise"===e.message_type,resolved:e.resolved&&"praise"!==e.message_type}}const d="beatmap-discussion-review-post-embed-preview",p=({data:e,store:t})=>{const s=t.beatmaps,p=t.discussions.get(e.discussion_id);if(null==p)return a.createElement("div",{className:(0,o.Zt)(d,["deleted","lighter"])},a.createElement("div",{className:`${d}__missing`},(0,l.pw)("beatmaps.discussions.review.embed.missing")));const m=(0,n.JL)(p);if(null==m||m.system)return console.error("embed starting post is missing or is system post",p.id),null;const h=null==p.beatmap_id?void 0:s.get(p.beatmap_id),b=()=>{if(null!=p.parent_id)return a.createElement("div",{className:`${d}__link`},a.createElement("a",{className:`${d}__link-text js-beatmap-discussion--jump`,href:(0,n.Gm)({discussion:p}),title:(0,l.pw)("beatmap_discussions.review.go_to_child")},a.createElement("i",{className:"fas fa-external-link-alt"})))};return a.createElement("div",{className:(0,o.Zt)(d,"lighter",u(p))},a.createElement("div",{className:`${d}__content`},a.createElement("div",{className:`${d}__selectors`},a.createElement("div",{className:"icon-dropdown-menu icon-dropdown-menu--disabled"},null!=h&&a.createElement(i.k,{beatmap:h,withTooltip:!0}),null==p.beatmap_id&&a.createElement("i",{className:"fas fa-fw fa-star-of-life",title:(0,l.pw)("beatmaps.discussions.mode.scopes.generalAll")})),a.createElement("div",{className:"icon-dropdown-menu icon-dropdown-menu--disabled"},(()=>{const e=p.message_type;return a.createElement("div",null,a.createElement("span",{className:r.d[e],style:{color:`var(--beatmapset-discussion-colour--${e})`},title:(0,l.pw)(`beatmaps.discussions.message_type.${e}`)}))})()),a.createElement("div",{className:`${d}__timestamp`},a.createElement("div",{className:`${d}__timestamp-text`},null!==p.timestamp?(0,n.Ey)(p.timestamp):(0,l.pw)("beatmap_discussions.timestamp_display.general"))),a.createElement("div",{className:`${d}__stripe`}),b()),a.createElement("div",{className:`${d}__stripe`}),a.createElement("div",{className:`${d}__message-container`},a.createElement("div",{className:`${d}__body`},a.createElement(c.A,{markdown:m.message}))),b()))}},3138:(e,t,s)=>{s.d(t,{q:()=>u});var r=s(241),i=s(8547),a=s(9981),n=s(6540),o=s(7634),l=s(1883);const c="beatmap-discussion-user-card";class u extends n.PureComponent{render(){return n.createElement("div",{className:c,style:(0,o.OS)(this.props.group)},n.createElement("div",{className:`${c}__avatar`},this.props.user.is_deleted?n.createElement("span",{className:`${c}__user-link`},n.createElement(r.A,{modifiers:"full-rounded",user:this.props.user})):n.createElement("a",{className:`${c}__user-link`,href:(0,a.w)("users.show",{user:this.props.user.id})},n.createElement(r.A,{modifiers:"full-rounded",user:this.props.user}))),n.createElement("div",{className:`${c}__user`},n.createElement("div",{className:`${c}__user-row`},this.props.user.is_deleted?n.createElement("span",{className:`${c}__user-link`},this.renderUsername()):n.createElement("a",{className:`${c}__user-link`,href:(0,a.w)("users.show",{user:this.props.user.id})},this.renderUsername()),!this.props.user.is_bot&&!this.props.user.is_deleted&&n.createElement("a",{className:`${c}__user-modding-history-link`,href:(0,a.w)("users.modding.index",{user:this.props.user.id}),title:(0,l.pw)("beatmap_discussion_posts.item.modding_history_link")},n.createElement("i",{className:"fas fa-align-left"}))),n.createElement("div",{className:`${c}__user-badge`},n.createElement(i.A,{group:this.props.group}))),!this.props.hideStripe&&n.createElement("div",{className:`${c}__user-stripe`}))}renderUsername(){return n.createElement("span",{className:"u-ellipsis-overflow"},this.props.user.username)}}Object.defineProperty(u,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{hideStripe:!1}})},2385:(e,t,s)=>{s.d(t,{X:()=>I,A:()=>B});var r=s(42),i=s(7482),a=s(5325),n=s(3358),o=s(1518),l=s(8994),c=s(9981),u=s(2543),d=s(7813),p=s(1370),m=s(6823),h=s(6540),b=s(5),f=s(8243),v=s(9232),g=s(7634),y=s(256),w=s(1883),_=s(1980),E=s(7153),P=s(8156),O=s(4692),j=function(e,t,s,r){var i,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(n=(a<3?i(n):a>3?i(t,s,n):i(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n};const k={entered:{opacity:1},entering:{},exited:{},exiting:{},unmounted:{}},S=(0,p.PA)((({beatmaps:e})=>h.createElement("div",{className:"beatmaps-popup__group"},e.map((e=>h.createElement(N,{key:e.id,beatmap:e})))))),N=(0,p.PA)((({beatmap:e})=>h.createElement("a",{className:"beatmaps-popup-item",href:(0,c.w)("beatmaps.show",{beatmap:e.id})},h.createElement(E.A,{beatmap:e,mapper:null}))));let A=class extends h.Component{constructor(e){super(e),Object.defineProperty(this,"contentRef",{enumerable:!0,configurable:!0,writable:!0,value:h.createRef()}),Object.defineProperty(this,"position",{enumerable:!0,configurable:!0,writable:!0,value:{left:"0px",top:"0px",width:"0px"}}),Object.defineProperty(this,"updatePosition",{enumerable:!0,configurable:!0,writable:!0,value:()=>{const e=this.props.parent;if(null==e)return;const t=e.getBoundingClientRect();this.position.top=`${window.scrollY+t.bottom}px`,this.position.left=`${window.scrollX+t.left}px`,this.position.width=`${t.width}px`}}),(0,d.Gn)(this)}componentDidMount(){O(window).on("resize",this.updatePosition)}componentWillUnmount(){O(window).off("resize",this.updatePosition)}render(){this.updatePosition();const e=Object.assign(Object.assign({opacity:0,transitionDuration:`${this.props.transitionDuration}ms`},k[this.props.state]),this.position);return h.createElement(P.A,null,h.createElement("div",{ref:this.contentRef,className:(0,g.Zt)("beatmaps-popup",[`size-${m.A.userPreferences.get("beatmapset_card_size")}`]),onMouseEnter:this.props.onMouseEnter,onMouseLeave:this.props.onMouseLeave,style:e},h.createElement("div",{className:"beatmaps-popup__content"},[...this.props.groupedBeatmaps].map((([e,t])=>t.length>0&&h.createElement(S,{key:e,beatmaps:t}))))))}};j([d.sH],A.prototype,"position",void 0),j([d.XI],A.prototype,"updatePosition",void 0),A=j([p.PA],A);const T=A;var C=s(4692),x=function(e,t,s,r){var i,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(n=(a<3?i(n):a>3?i(t,s,n):i(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n};const I=["normal","extra"],R={approved:"ranked_date",graveyard:"last_updated",loved:"ranked_date",pending:"last_updated",qualified:"ranked_date",ranked:"ranked_date",wip:"last_updated"},M=(0,p.PA)((({beatmap:e})=>h.createElement("div",{className:"beatmapset-panel__beatmap-dot",style:{"--bg":(0,f.ID)(e.difficulty_rating)}}))),D=(0,p.PA)((({compact:e,beatmaps:t,mode:s})=>h.createElement("div",{className:"beatmapset-panel__extra-item beatmapset-panel__extra-item--dots"},h.createElement("div",{className:"beatmapset-panel__beatmap-icon"},h.createElement("i",{className:`fal fa-extra-mode-${s}`})),e?h.createElement("div",{className:"beatmapset-panel__beatmap-count"},t.length):t.map((e=>h.createElement(M,{key:e.id,beatmap:e})))))),H=(0,p.PA)((({beatmapset:e})=>h.createElement(l.A,{className:"beatmapset-panel__mapper-link u-hover",user:{id:e.user_id,username:e.creator}}))),$=({icon:e,titleVariant:t})=>h.createElement("div",{className:"beatmapset-panel__play-icon",title:(0,w.pw)(`beatmapsets.show.info.${t}`)},h.createElement("i",{className:e})),L=({icon:e,title:t,type:s,value:r})=>h.createElement("div",{className:`beatmapset-panel__stats-item beatmapset-panel__stats-item--${s}`,title:t},h.createElement("span",{className:"beatmapset-panel__stats-item-icon"},h.createElement("i",{className:`fa-fw ${e}`})),h.createElement("span",null,(0,y.h$)(r)));let U=class extends h.Component{get beatmapDotsCompact(){return null!=this.props.beatmapset.beatmaps&&this.props.beatmapset.beatmaps.length>12}get displayDate(){const e=R[this.props.beatmapset.status],t=this.props.beatmapset[e];if(null==t)throw Error("trying to display null date");return t}get downloadLink(){var e;if(null==m.A.currentUser)return{title:(0,w.pw)("beatmapsets.show.details.logged-out")};if(null===(e=this.props.beatmapset.availability)||void 0===e?void 0:e.download_disabled)return{title:(0,w.pw)("beatmapsets.availability.disabled")};let t,s,r=m.A.userPreferences.get("beatmapset_download");if("direct"!==r||m.A.currentUser.is_supporter||(r="all"),"direct"===r)t=(0,_.ou)(this.props.beatmapset.id),s="direct";else{const e={beatmapset:this.props.beatmapset.id};this.props.beatmapset.video?"no_video"===r?(e.noVideo=1,s="no_video"):s="video":s="all",t=(0,c.w)("beatmapsets.download",e)}return{title:(0,w.pw)(`beatmapsets.panel.download.${s}`),url:t}}get favourite(){return this.props.beatmapset.has_favourited?{icon:"fas fa-heart",toggleTitleVariant:"unfavourite"}:{icon:"far fa-heart",toggleTitleVariant:"favourite"}}get groupedBeatmaps(){return(0,f.Os)(this.props.beatmapset.beatmaps)}get isBeatmapsPopupVisible(){return this.beatmapsPopupHover||this.mobileExpanded}get nominations(){let e=0,t=0,s=0;if(null!=this.props.beatmapset.nominations_summary){const r=this.props.beatmapset.nominations_summary;e=r.current,t=r.required_meta.main_ruleset,s=r.required_meta.non_main_ruleset}else{if(null==this.props.beatmapset.nominations)return null;e=(0,u.sum)((0,u.values)(this.props.beatmapset.nominations.current)),t=this.props.beatmapset.nominations.required_meta.main_ruleset,s=this.props.beatmapset.nominations.required_meta.non_main_ruleset}const r=this.groupedBeatmaps,i=[];[...this.groupedBeatmaps.keys()].forEach((e=>{var t,s;(null!==(s=null===(t=r.get(e))||void 0===t?void 0:t.length)&&void 0!==s?s:0)>0&&i.push(e)}));return{current:e,required:t+s*(i.length-1)}}get showHypeCounts(){return null!=this.props.beatmapset.hype}get showVisual(){return(0,v.KY)(this.props.beatmapset)}get url(){return(0,c.w)("beatmapsets.show",{beatmapset:this.props.beatmapset.id})}constructor(e){super(e),Object.defineProperty(this,"beatmapsPopupHover",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"beatmapsPopupRef",{enumerable:!0,configurable:!0,writable:!0,value:h.createRef()}),Object.defineProperty(this,"blockRef",{enumerable:!0,configurable:!0,writable:!0,value:h.createRef()}),Object.defineProperty(this,"mobileExpanded",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"timeouts",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"beatmapsPopupDelayedHide",{enumerable:!0,configurable:!0,writable:!0,value:()=>{window.clearTimeout(this.timeouts.beatmapsPopup),this.beatmapsPopupHover&&(this.timeouts.beatmapsPopup=window.setTimeout((0,d.XI)((()=>{this.beatmapsPopupHover=!1})),500))}}),Object.defineProperty(this,"beatmapsPopupDelayedShow",{enumerable:!0,configurable:!0,writable:!0,value:()=>{window.clearTimeout(this.timeouts.beatmapsPopup),this.beatmapsPopupHover||(this.timeouts.beatmapsPopup=window.setTimeout((0,d.XI)((()=>{this.beatmapsPopupHover=!0})),100))}}),Object.defineProperty(this,"beatmapsPopupHide",{enumerable:!0,configurable:!0,writable:!0,value:()=>{window.clearTimeout(this.timeouts.beatmapsPopup),this.beatmapsPopupHover=!1}}),Object.defineProperty(this,"beatmapsPopupKeep",{enumerable:!0,configurable:!0,writable:!0,value:()=>{window.clearTimeout(this.timeouts.beatmapsPopup),this.beatmapsPopupHover=!0}}),Object.defineProperty(this,"onBeatmapsPopupEnter",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.beatmapsPopupKeep()}}),Object.defineProperty(this,"onBeatmapsPopupLeave",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.beatmapsPopupDelayedHide()}}),Object.defineProperty(this,"onDocumentClick",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var t,s,r;this.mobileExpanded&&((null===(t=this.blockRef.current)||void 0===t?void 0:t.contains(e.target))||(null===(r=null===(s=this.beatmapsPopupRef.current)||void 0===s?void 0:s.contentRef.current)||void 0===r?void 0:r.contains(e.target))||(C(document).off("click",this.onDocumentClick),this.mobileExpanded=!1))}}),Object.defineProperty(this,"onExtraRowEnter",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.beatmapsPopupDelayedShow()}}),Object.defineProperty(this,"onExtraRowLeave",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.beatmapsPopupDelayedHide()}}),Object.defineProperty(this,"onMobileExpandToggleClick",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.mobileExpanded=!this.mobileExpanded,this.mobileExpanded&&C(document).on("click",this.onDocumentClick)}}),Object.defineProperty(this,"toggleFavourite",{enumerable:!0,configurable:!0,writable:!0,value:()=>{(0,v.Mb)(this.props.beatmapset)}}),(0,d.Gn)(this)}componentWillUnmount(){C(document).off("click",this.onDocumentClick),Object.values(this.timeouts).forEach((e=>{window.clearTimeout(e)}))}render(){let e=(0,g.Zt)("beatmapset-panel",{"beatmaps-popup-visible":this.isBeatmapsPopupVisible,"mobile-expanded":this.mobileExpanded,[`size-${m.A.userPreferences.get("beatmapset_card_size")}`]:!0,"with-hype-counts":this.showHypeCounts});return this.showVisual&&(e+=" js-audio--player"),h.createElement("div",{ref:this.blockRef,className:e,"data-audio-url":this.props.beatmapset.preview_url,onMouseLeave:this.beatmapsPopupHide,style:{"--beatmaps-popup-transition-duration":"150ms"}},this.renderBeatmapsPopup(),this.renderCover(),h.createElement("div",{className:"beatmapset-panel__content"},this.renderPlayArea(),this.renderInfoArea(),this.renderMenuArea()),h.createElement("button",{className:"beatmapset-panel__mobile-expand",onClick:this.onMobileExpandToggleClick,type:"button"},h.createElement("span",{className:"fas fa-angle-"+(this.mobileExpanded?"up":"down")})))}renderBeatmapsPopup(){return h.createElement(b.Ay,{in:this.isBeatmapsPopupVisible,mountOnEnter:!0,timeout:{enter:0,exit:150},unmountOnExit:!0},(e=>h.createElement(T,{ref:this.beatmapsPopupRef,groupedBeatmaps:this.groupedBeatmaps,onMouseEnter:this.onBeatmapsPopupEnter,onMouseLeave:this.onBeatmapsPopupLeave,parent:this.blockRef.current,state:e,transitionDuration:150})))}renderCover(){return h.createElement("a",{className:"beatmapset-panel__cover-container",href:this.url},h.createElement("div",{className:"beatmapset-panel__cover-col beatmapset-panel__cover-col--play"},h.createElement(i.A,{beatmapset:this.props.beatmapset,modifiers:"full",size:"list"})),h.createElement("div",{className:"beatmapset-panel__cover-col beatmapset-panel__cover-col--info"},m.A.windowSize.isDesktop&&h.createElement(i.A,{beatmapset:this.props.beatmapset,modifiers:"full",size:"card"})))}renderInfoArea(){return h.createElement("div",{className:"beatmapset-panel__info"},h.createElement("div",{className:"beatmapset-panel__info-row beatmapset-panel__info-row--title"},h.createElement("a",{className:"beatmapset-panel__main-link u-ellipsis-overflow",href:this.url},(0,v.LK)(this.props.beatmapset)),h.createElement("div",{className:"beatmapset-panel__badge-container"},h.createElement(r.A,{beatmapset:this.props.beatmapset,type:"nsfw"}),h.createElement(r.A,{beatmapset:this.props.beatmapset,type:"spotlight"}))),h.createElement("div",{className:"beatmapset-panel__info-row beatmapset-panel__info-row--artist"},h.createElement("a",{className:"beatmapset-panel__main-link u-ellipsis-overflow",href:this.url},(0,w.pw)("beatmapsets.show.details.by_artist",{artist:(0,v.wp)(this.props.beatmapset)})),h.createElement("div",{className:"beatmapset-panel__badge-container"},h.createElement(r.A,{beatmapset:this.props.beatmapset,type:"featured_artist"}))),h.createElement("div",{className:"beatmapset-panel__info-row beatmapset-panel__info-row--source"},h.createElement("div",{className:"u-ellipsis-overflow"},this.props.beatmapset.source)),h.createElement("div",{className:"beatmapset-panel__info-row beatmapset-panel__info-row--mapper"},h.createElement("div",{className:"u-ellipsis-overflow"},h.createElement(n.A,{mappings:{mapper:h.createElement(H,{beatmapset:this.props.beatmapset})},pattern:(0,w.pw)("beatmapsets.show.details.mapped_by")}))),h.createElement("div",{className:"beatmapset-panel__info-row beatmapset-panel__info-row--stats"},this.showHypeCounts&&null!=this.props.beatmapset.hype&&h.createElement(L,{icon:"fas fa-bullhorn",title:(0,w.pw)("beatmaps.hype.required_text",{current:(0,y.ZV)(this.props.beatmapset.hype.current),required:(0,y.ZV)(this.props.beatmapset.hype.required)}),type:"hype",value:this.props.beatmapset.hype.current}),this.showHypeCounts&&null!=this.nominations&&h.createElement(L,{icon:"fas fa-thumbs-up",title:(0,w.pw)("beatmaps.nominations.required_text",{current:(0,y.ZV)(this.nominations.current),required:(0,y.ZV)(this.nominations.required)}),type:"nominations",value:this.nominations.current}),h.createElement(L,{icon:this.favourite.icon,title:(0,w.pw)("beatmaps.panel.favourites",{count:(0,y.ZV)(this.props.beatmapset.favourite_count)}),type:"favourite-count",value:this.props.beatmapset.favourite_count}),h.createElement(L,{icon:"fas fa-play-circle",title:(0,w.pw)("beatmaps.panel.playcount",{count:(0,y.ZV)(this.props.beatmapset.play_count)}),type:"play-count",value:this.props.beatmapset.play_count}),h.createElement("div",{className:"beatmapset-panel__stats-item beatmapset-panel__stats-item--date"},h.createElement("span",{className:"beatmapset-panel__stats-item-icon"},h.createElement("i",{className:"fa-fw fas fa-check-circle"})),h.createElement(o.A,{dateTime:this.displayDate}))),h.createElement("a",{className:"beatmapset-panel__info-row beatmapset-panel__info-row--extra",href:this.url,onMouseEnter:this.onExtraRowEnter,onMouseLeave:this.onExtraRowLeave},h.createElement("div",{className:"beatmapset-panel__extra-item"},h.createElement("div",{className:"beatmapset-status beatmapset-status--panel",style:{"--bg-hsl":`var(--beatmapset-${this.props.beatmapset.status}-bg-hsl)`,"--colour":`var(--beatmapset-${this.props.beatmapset.status}-colour)`}},(0,w.pw)(`beatmapsets.show.status.${this.props.beatmapset.status}`))),[...this.groupedBeatmaps].map((([e,t])=>t.length>0&&h.createElement(D,{key:e,beatmaps:t,compact:this.beatmapDotsCompact,mode:e})))))}renderMenuArea(){return h.createElement("div",{className:"beatmapset-panel__menu-container"},h.createElement("div",{className:"beatmapset-panel__menu"},null==m.A.currentUser?h.createElement("span",{className:"beatmapset-panel__menu-item beatmapset-panel__menu-item--disabled",title:(0,w.pw)("beatmapsets.show.details.favourite_login")},h.createElement("span",{className:this.favourite.icon})):h.createElement("button",{className:"beatmapset-panel__menu-item",onClick:this.toggleFavourite,title:(0,w.pw)(`beatmapsets.show.details.${this.favourite.toggleTitleVariant}`),type:"button"},h.createElement("span",{className:this.favourite.icon})),null==this.downloadLink.url?h.createElement("span",{className:"beatmapset-panel__menu-item beatmapset-panel__menu-item--disabled",title:this.downloadLink.title},h.createElement("span",{className:"fas fa-file-download"})):h.createElement("a",{className:"beatmapset-panel__menu-item","data-turbolinks":"false",href:this.downloadLink.url,title:this.downloadLink.title},h.createElement("span",{className:"fas fa-file-download"}))))}renderPlayArea(){return h.createElement("div",{className:"beatmapset-panel__play-container"},this.showVisual&&h.createElement("button",{className:"beatmapset-panel__play js-audio--play",type:"button"},h.createElement("span",{className:"play-button"})),h.createElement("div",{className:"beatmapset-panel__play-progress"},h.createElement(a.P,{current:0,ignoreProgress:!0,max:1,onlyShowAsWarning:!1,theme:"beatmapset-panel"})),h.createElement("div",{className:"beatmapset-panel__play-icons"},this.props.beatmapset.video&&h.createElement($,{icon:"fas fa-film",titleVariant:"video"}),this.props.beatmapset.storyboard&&h.createElement($,{icon:"fas fa-image",titleVariant:"storyboard"})))}};x([d.sH],U.prototype,"beatmapsPopupHover",void 0),x([d.sH],U.prototype,"mobileExpanded",void 0),x([d.EW],U.prototype,"beatmapDotsCompact",null),x([d.EW],U.prototype,"displayDate",null),x([d.EW],U.prototype,"downloadLink",null),x([d.EW],U.prototype,"favourite",null),x([d.EW],U.prototype,"groupedBeatmaps",null),x([d.EW],U.prototype,"isBeatmapsPopupVisible",null),x([d.EW],U.prototype,"showHypeCounts",null),x([d.EW],U.prototype,"showVisual",null),x([d.EW],U.prototype,"url",null),x([d.XI],U.prototype,"beatmapsPopupHide",void 0),x([d.XI],U.prototype,"beatmapsPopupKeep",void 0),x([d.XI],U.prototype,"onDocumentClick",void 0),x([d.XI],U.prototype,"onMobileExpandToggleClick",void 0),U=x([p.PA],U);const B=U},46:(e,t,s)=>{s.d(t,{A:()=>l});var r=s(9981),i=s(1883),a=s(450);const n=["show","discussions"];function o(e,t){switch(e){case"discussions":return(0,r.w)("beatmapsets.discussion",{beatmapset:t.id});case"show":if(null==t)throw new Error("can't make show url without beatmapset");return(0,r.w)("beatmapsets.show",{beatmapset:t.id});default:return(0,a.J)(e),""}}function l(e,t){return n.map((s=>({active:s===e,title:(0,i.pw)(`layout.header.beatmapsets.${s}`),url:o(s,t)})))}},903:(e,t,s)=>{s.d(t,{Cd:()=>f,Cg:()=>h,EC:()=>c,I_:()=>l,R$:()=>v,VL:()=>d,Wr:()=>p,_z:()=>g,aI:()=>b,c:()=>u,t3:()=>m});var r=s(9981),i=s(7813),a=s(1250),n=s(6823),o=s(4692);function l(e,t){return o.post((0,r.w)("chat.ack"),{history_since:t,since:e})}function c(e){return o.post((0,r.w)("chat.channels.store"),e)}function u(e){return o.get((0,r.w)("chat.channels.show",{channel:e})).then((0,i.XI)((e=>(n.A.dataStore.userStore.updateMany(e.users),e.channel))))}function d(e,t){return o.get((0,r.w)("chat.channels.messages.index",Object.assign({channel:e,return_object:1},t))).then((0,i.XI)((e=>(n.A.dataStore.userStore.updateMany(e.users),e.messages.map((e=>a.A.fromJson(e)))))))}function p(){return o.get((0,r.w)("chat.channels.index"))}function m(e,t){return o.get((0,r.w)("chat.updates"),{history_since:t,includes:["presence","silences"],since:e})}function h(e,t){return o.ajax({type:"PUT",url:(0,r.w)("chat.channels.join",{channel:e,user:t})})}function b(e,t){return o.ajax({type:"PUT",url:(0,r.w)("chat.channels.mark-as-read",{channel:e,message:t})})}function f(e,t){return o.post((0,r.w)("chat.new"),{is_action:t.isAction,message:t.content,target_id:e,uuid:t.uuid})}function v(e,t){return o.ajax((0,r.w)("chat.channels.part",{channel:e,user:t}),{method:"DELETE"})}function g(e){return o.post((0,r.w)("chat.channels.messages.store",{channel:e.channelId}),{is_action:e.isAction,message:e.content,target_id:e.channelId,target_type:"channel",uuid:e.uuid})}},3757:(e,t,s)=>{s.d(t,{A:()=>n});var r=s(6823),i=s(6540),a=s(3938);class n extends i.PureComponent{constructor(){super(...arguments),Object.defineProperty(this,"eventId",{enumerable:!0,configurable:!0,writable:!0,value:`admin-menu-${(0,a.L)()}`})}render(){var e;if(!(null===(e=r.A.currentUser)||void 0===e?void 0:e.is_admin))return null;const t=this.props.items.map((e=>i.createElement(e.component,Object.assign({key:`${e.icon}-${e.text}`,className:"admin-menu-item"},e.props),i.createElement("span",{className:"admin-menu-item__content"},i.createElement("span",{className:"admin-menu-item__label admin-menu-item__label--icon"},i.createElement("span",{className:e.icon})),i.createElement("span",{className:"admin-menu-item__label admin-menu-item__label--text"},e.text)))));return i.createElement("div",{className:"admin-menu"},i.createElement("button",{className:"admin-menu__button js-menu","data-menu-target":`admin-menu-${this.eventId}`},i.createElement("span",{className:"fas fa-angle-up"}),i.createElement("span",{className:"admin-menu__button-icon fas fa-tools"})),i.createElement("div",{className:"admin-menu__menu js-menu","data-menu-id":`admin-menu-${this.eventId}`,"data-visibility":"hidden"},t))}}},1327:(e,t,s)=>{s.d(t,{A:()=>u});var r=s(7813),i=s(1370),a=s(6540),n=s(1883),o=s(4692),l=function(e,t,s,r){var i,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(n=(a<3?i(n):a>3?i(t,s,n):i(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n};let c=class extends a.Component{constructor(e){super(e),Object.defineProperty(this,"lastScrollY",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"observer",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"reset",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.lastScrollY=null}}),Object.defineProperty(this,"onClick",{enumerable:!0,configurable:!0,writable:!0,value:()=>{var e,t,s;if(null==this.lastScrollY){const r=null==(null===(e=this.props.anchor)||void 0===e?void 0:e.current)?0:null!==(s=null===(t=o(this.props.anchor.current).offset())||void 0===t?void 0:t.top)&&void 0!==s?s:0;window.pageYOffset>r&&(this.lastScrollY=window.pageYOffset,window.scrollTo(window.pageXOffset,r),this.mountObserver())}else window.scrollTo(window.pageXOffset,this.lastScrollY),this.lastScrollY=null}}),Object.defineProperty(this,"onScroll",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.lastScrollY=null,document.removeEventListener("scroll",this.onScroll),this.removeObserver()}}),(0,r.Gn)(this)}componentWillUnmount(){document.removeEventListener("scroll",this.onScroll),this.removeObserver()}render(){return a.createElement("button",{className:"back-to-top","data-tooltip-float":"fixed",onClick:this.onClick,title:(0,n.pw)(null==this.lastScrollY?"common.buttons.back_to_top":"common.buttons.back_to_previous")},a.createElement("span",{className:null==this.lastScrollY?"fas fa-angle-up":"fas fa-angle-down"}))}mountObserver(){var e,t;const s=null!==(t=null===(e=this.props.anchor)||void 0===e?void 0:e.current)&&void 0!==t?t:document.body;this.observer=new IntersectionObserver((e=>{for(const t of e)if(t.target===s&&0===t.boundingClientRect.top){document.addEventListener("scroll",this.onScroll);break}})),this.observer.observe(s)}removeObserver(){null!=this.observer&&(this.observer.disconnect(),this.observer=null)}};l([r.sH],c.prototype,"lastScrollY",void 0),l([r.XI],c.prototype,"reset",void 0),l([r.XI],c.prototype,"onClick",void 0),l([r.XI],c.prototype,"onScroll",void 0),c=l([i.PA],c);const u=c},1547:(e,t,s)=>{s.d(t,{A:()=>o});var r=s(2543),i=s(6540),a=s(7634),n=s(256);function o(e){let t=0===e.total?0:e.current/e.total;return t=(0,r.clamp)(t,0,1),i.createElement("div",{className:(0,a.Zt)("bar",e.modifiers),style:{"--fill":100*t+"%"},title:e.title},i.createElement("div",{className:"bar__fill"}),null!=e.textPrecision&&i.createElement("div",{className:"bar__text"},(0,n.ZV)(t,e.textPrecision,{style:"percent"})))}},3672:(e,t,s)=>{s.d(t,{A:()=>c});var r=s(4467),i=s(9981),a=s(6540),n=s(8961),o=s(3944),l=s(1980);class c extends a.PureComponent{constructor(){super(...arguments),Object.defineProperty(this,"handleChange",{enumerable:!0,configurable:!0,writable:!0,value:e=>{(0,o.oo)(this.href(e.id))}}),Object.defineProperty(this,"renderOption",{enumerable:!0,configurable:!0,writable:!0,value:e=>a.createElement("a",{key:e.option.id,className:e.cssClasses,href:this.href(e.option.id),onClick:e.onClick},e.children)})}render(){return a.createElement(r.A,{onChange:this.handleChange,options:this.props.items,renderOption:this.renderOption,selected:this.props.currentItem})}href(e){switch(this.props.type){case"daily_challenge":return(0,i.w)("daily-challenge.show",{daily_challenge:null!=e?e:(0,n.f)("missing id parameter")});case"judge_results":return(0,i.w)("contest-entries.judge-results",{contest_entry:null!=e?e:0});case"multiplayer":return(0,i.w)("multiplayer.rooms.show",{room:null!=e?e:"latest"});case"seasons":return(0,i.w)("seasons.show",{season:null!=e?e:"latest"});case"spotlight":return(0,l.Ze)(null,{spotlight:null==e?void 0:e.toString()})}}}},1583:(e,t,s)=>{s.d(t,{A:()=>c});var r=s(2543),i=s(6540),a=s(7634),n=s(1883),o=s(1980);class l extends i.Component{constructor(){super(...arguments),Object.defineProperty(this,"bodyRef",{enumerable:!0,configurable:!0,writable:!0,value:i.createRef()}),Object.defineProperty(this,"sizeSelectRef",{enumerable:!0,configurable:!0,writable:!0,value:i.createRef()}),Object.defineProperty(this,"cancel",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var t;((null===(t=this.bodyRef.current)||void 0===t?void 0:t.value)===this.props.rawValue||confirm((0,n.pw)("common.confirmation_unsaved")))&&(null!=this.bodyRef.current&&(this.bodyRef.current.value=this.props.rawValue),this.sendOnChange({event:e,type:"cancel"}))}}),Object.defineProperty(this,"onKeyDown",{enumerable:!0,configurable:!0,writable:!0,value:e=>{this.props.ignoreEsc||"Escape"!==e.key||this.cancel()}}),Object.defineProperty(this,"save",{enumerable:!0,configurable:!0,writable:!0,value:e=>{this.sendOnChange({event:e,type:"save"})}})}componentDidMount(){null!=this.sizeSelectRef.current&&(this.sizeSelectRef.current.value=""),null!=this.bodyRef.current&&(this.bodyRef.current.selectionEnd=0,this.bodyRef.current.focus())}render(){let e=(0,a.Zt)("bbcode-editor",this.props.modifiers);return e+=" js-bbcode-preview--form",i.createElement("form",{className:e,"data-state":"write"},i.createElement("div",{className:"bbcode-editor__content"},i.createElement("textarea",{ref:this.bodyRef,className:"bbcode-editor__body js-bbcode-preview--body",defaultValue:this.props.rawValue,disabled:this.props.disabled,name:"body",onKeyDown:this.onKeyDown,placeholder:this.props.placeholder}),i.createElement("div",{className:"bbcode-editor__preview"},i.createElement("div",{className:"forum-post-content js-bbcode-preview--preview"})),i.createElement("div",{className:"bbcode-editor__buttons-bar"},i.createElement("div",{className:"bbcode-editor__buttons bbcode-editor__buttons--toolbar"},this.renderToolbar()),i.createElement("div",{className:"bbcode-editor__buttons bbcode-editor__buttons--actions"},i.createElement("div",{className:"bbcode-editor__button bbcode-editor__button--cancel"},this.actionButton(this.cancel,(0,n.pw)("common.buttons.cancel"))),i.createElement("div",{className:"bbcode-editor__button bbcode-editor__button--hide-on-write"},this.renderPreviewHideButton()),i.createElement("div",{className:"bbcode-editor__button bbcode-editor__button--hide-on-preview"},this.renderPreviewShowButton()),i.createElement("div",{className:"bbcode-editor__button"},this.actionButton(this.save,(0,n.pw)("common.buttons.save"),"forum-primary"))))))}actionButton(e,t,s="forum-secondary"){return i.createElement("button",{className:(0,a.Zt)("btn-osu-big",s),disabled:this.props.disabled,onClick:e,type:"button"},t)}renderPreviewHideButton(){return i.createElement("button",{className:"js-bbcode-preview--hide btn-osu-big btn-osu-big--forum-secondary",disabled:this.props.disabled,type:"button"},(0,n.pw)("forum.topic.create.preview_hide"))}renderPreviewShowButton(){return i.createElement("button",{className:"js-bbcode-preview--show btn-osu-big btn-osu-big--forum-secondary",disabled:this.props.disabled,type:"button"},(0,n.pw)("forum.topic.create.preview"))}renderToolbar(){return i.createElement("div",{className:"post-box-toolbar"},this.toolbarButton("bold","fas fa-bold"),this.toolbarButton("italic","fas fa-italic"),this.toolbarButton("strikethrough","fas fa-strikethrough"),this.toolbarButton("heading","fas fa-heading"),this.toolbarButton("link","fas fa-link"),this.toolbarButton("spoilerbox","fas fa-barcode"),this.toolbarButton("list-numbered","fas fa-list-ol"),this.toolbarButton("list","fas fa-list"),this.toolbarButton("image","fas fa-image"),this.toolbarButton("imagemap","fas fa-map"),this.toolbarSizeSelect(),i.createElement("a",{className:"post-box-toolbar__help",href:(0,o.iD)("BBCode"),rel:"noreferrer",target:"_blank"},(0,n.pw)("bbcode.help")))}sendOnChange({event:e,type:t}){var s,r;this.props.onChange({event:e,hasChanged:(null===(s=this.bodyRef.current)||void 0===s?void 0:s.value)!==this.props.rawValue,type:t,value:null===(r=this.bodyRef.current)||void 0===r?void 0:r.value})}toolbarButton(e,t){return i.createElement("button",{className:`btn-circle btn-circle--bbcode js-bbcode-btn--${e}`,disabled:this.props.disabled,title:(0,n.pw)(`bbcode.${(0,r.snakeCase)(e)}`),type:"button"},i.createElement("span",{className:"btn-circle__content"},i.createElement("span",{className:t})))}toolbarSizeSelect(){return i.createElement("label",{className:"bbcode-size-select",title:(0,n.pw)("bbcode.size._")},i.createElement("span",{className:"bbcode-size-select__label"},(0,n.pw)("bbcode.size._")),i.createElement("i",{className:"fas fa-chevron-down"}),i.createElement("select",{ref:this.sizeSelectRef,className:"bbcode-size-select__select js-bbcode-btn--size",disabled:this.props.disabled},i.createElement("option",{value:"50"},(0,n.pw)("bbcode.size.tiny")),i.createElement("option",{value:"85"},(0,n.pw)("bbcode.size.small")),i.createElement("option",{value:"100"},(0,n.pw)("bbcode.size.normal")),i.createElement("option",{value:"150"},(0,n.pw)("bbcode.size.large"))))}}Object.defineProperty(l,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{disabled:!1,ignoreEsc:!1}});const c=l},6145:(e,t,s)=>{s.d(t,{A:()=>d});var r=s(1370),i=s(6540),a=s(256),n=s(1883),o=function(e,t,s,r){var i,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(n=(a<3?i(n):a>3?i(t,s,n):i(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n};const l="beatmap-basic-stats",c=["total_length","bpm","count_circles","count_sliders"];let u=class extends i.Component{constructor(){super(...arguments),Object.defineProperty(this,"renderEntry",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const t={};let s="";const r=this.props.beatmap[e];let o;switch(e){case"bpm":{r>1e3&&(o="∞");const e=this.props.beatmapset.offset;0!==e&&(s+=` (${(0,n.pw)("beatmapsets.show.stats.offset",{offset:(0,a.ZV)(e)})})`);break}case"total_length":o=(0,a.a3)(this.props.beatmap[e]),t.hit_length=(0,a.a3)(this.props.beatmap.hit_length)}return null!=o||(o=(0,a.ZV)(r)),i.createElement("div",{key:e,className:`${l}__entry`,title:`${(0,n.pw)(`beatmapsets.show.stats.${e}`,t)}${s}`},i.createElement("div",{className:`${l}__entry-icon`,style:{backgroundImage:`url(/images/layout/beatmapset-page/${e}.svg)`}}),i.createElement("span",null,o))}})}render(){return i.createElement("div",{className:l},c.map(this.renderEntry))}};u=o([r.PA],u);const d=u},5810:(e,t,s)=>{s.d(t,{k:()=>u});var r=s(6540),i=s(5848),a=s(8243),n=s(7634),o=s(3938),l=s(3887),c=s(4692);class u extends r.Component{constructor(){super(...arguments),Object.defineProperty(this,"tooltipId",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"handleMouseOver",{enumerable:!0,configurable:!0,writable:!0,value:e=>{if(!this.props.withTooltip)return;const t=e.currentTarget;if(t._tooltip===this.tooltipId)return;const s=c((0,i.renderToStaticMarkup)(r.createElement("div",{className:"tooltip-beatmap"},r.createElement("div",{className:"tooltip-beatmap__content"},r.createElement("div",null,this.props.beatmap.version),r.createElement(l.A,{rating:this.props.beatmap.difficulty_rating})))));if(null!=t._tooltip)return t._tooltip=this.tooltipId,void c(t).qtip("set",{"content.text":s});t._tooltip=this.tooltipId;const a={content:s,hide:"touchstart"===e.type?{event:"touchstart unfocus",inactive:3e3}:{event:"click mouseleave"},overwrite:!1,position:{at:"top center",my:"bottom center",viewport:c(window)},show:{event:e.type,ready:!0},style:{classes:"qtip qtip--tooltip-beatmap",tip:{height:9,width:10}}};c(t).qtip(a,e)}})}render(){this.tooltipId=`beatmap-icon-${this.props.beatmap.id}-${(0,o.L)()}`;const e=this.props.beatmap.convert&&!this.props.showConvertMode?"osu":this.props.beatmap.mode,t=(0,n.Zt)("beatmap-icon",this.props.modifiers,{"with-hover":this.props.withTooltip}),s={"--diff":(0,a.ID)(this.props.beatmap.difficulty_rating)};return r.createElement("div",{className:t,onMouseOver:this.handleMouseOver,onTouchStart:this.handleMouseOver,style:s},r.createElement("i",{className:`fal fa-extra-mode-${e}`}))}}Object.defineProperty(u,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{showConvertMode:!1,withTooltip:!1}})},7153:(e,t,s)=>{s.d(t,{A:()=>c});var r=s(3887),i=s(8994),a=s(6540),n=s(7634),o=s(1883),l=s(3358);class c extends a.PureComponent{render(){const e="deleted_at"in this.props.beatmap&&null!==this.props.beatmap.deleted_at,t=`${this.props.beatmap.version}${e?` [${(0,o.pw)("beatmap_discussions.index.deleted_beatmap")}]`:""}`;return a.createElement("div",{className:(0,n.Zt)("beatmap-list-item",{deleted:e,inline:this.props.inline},this.props.modifiers)},a.createElement("div",{className:"beatmap-list-item__col beatmap-list-item__col--icon"},a.createElement("span",{className:`fal fa-extra-mode-${this.props.beatmap.mode}`})),a.createElement("div",{className:"beatmap-list-item__col"},a.createElement(r.A,{rating:this.props.beatmap.difficulty_rating})),a.createElement("div",{className:"beatmap-list-item__col beatmap-list-item__col--main"},a.createElement("div",{className:"beatmap-list-item__version "+(this.props.inline?"":"u-ellipsis-overflow")},null!=this.props.beatmapUrl?a.createElement("a",{className:"beatmap-list-item__version-link",href:this.props.beatmapUrl},t):t," ",a.createElement("span",{className:"beatmap-list-item__mapper"},this.renderMapper()))))}renderMapper(){if(null==this.props.mapper)return null;const e=this.props.beatmapset.user_id!==this.props.beatmap.user_id;if(!e&&!this.props.showNonGuestMapper)return null;const t=e?"mapped_by_guest":"mapped_by",s=e?this.props.mapper:{id:this.props.beatmapset.user_id,username:this.props.beatmapset.creator};return a.createElement(l.A,{mappings:{mapper:a.createElement(i.A,{user:s})},pattern:(0,o.pw)(`beatmapsets.show.details.${t}`)})}}},42:(e,t,s)=>{s.d(t,{A:()=>l});var r=s(9981),i=s(6540),a=s(7634),n=s(1883),o=s(1980);function l(e){let t;switch(e.type){case"featured_artist":if(null==e.beatmapset.track_id)return null;t=(0,r.w)("tracks.show",{track:e.beatmapset.track_id});break;case"nsfw":if(!e.beatmapset.nsfw)return null;break;case"spotlight":if(!e.beatmapset.spotlight)return null;t=(0,o.iD)("Beatmap_Spotlights")}const s=(0,n.pw)(`beatmapsets.${e.type}_badge.label`),l=(0,a.Zt)("beatmapset-badge",e.modifiers,e.type);return null==t?i.createElement("span",{className:l},s):i.createElement("a",{className:l,href:t},s)}},7482:(e,t,s)=>{s.d(t,{A:()=>l});var r=s(6540),i=s(9232),a=s(7634),n=s(256),o=s(1883);function l(e){var t;const s=(0,a.Zt)("beatmapset-cover",e.modifiers);if(null!==(t=e.isDeleted)&&void 0!==t&&t)return r.createElement("div",{className:s,title:(0,o.pw)("beatmapsets.cover.deleted")},r.createElement("span",{className:"fas fa-trash"}));const l=null!=e.beatmapset&&(e.forceShowVisual||(0,i.KY)(e.beatmapset))?(0,n.Dk)(e.beatmapset.covers[e.size]):void 0;return r.createElement("div",{className:s,style:l})}},5647:(e,t,s)=>{s.d(t,{A:()=>v});var r=s(615),i=s(7482),a=s(1518),n=s(9981),o=s(2543),l=s(8443),c=s(6540),u=s(6606),d=s(7634),p=s(256),m=s(1883),h=s(3358),b=s(8994);function f(e){return"string"==typeof e?e.toLowerCase().replace(/ /g,"-"):""}class v extends c.PureComponent{get beatmapsetId(){var e;return null===(e=this.props.event.beatmapset)||void 0===e?void 0:e.id}get discussionId(){const e=this.props.event.comment;if(null!=e&&"object"==typeof e&&"beatmap_discussion_id"in e)return e.beatmap_discussion_id}get discussion(){var e,t;return null!==(e=this.props.event.discussion)&&void 0!==e?e:null===(t=this.props.discussions)||void 0===t?void 0:t.get(this.discussionId)}get firstPost(){var e,t,s,r;const i=null!==(t=null===(e=this.discussion)||void 0===e?void 0:e.starting_post)&&void 0!==t?t:null===(r=null===(s=this.discussion)||void 0===s?void 0:s.posts)||void 0===r?void 0:r[0];return(null==i?void 0:i.system)?null:i}render(){return"discussions"===this.props.mode?this.renderDiscussionsVersion():this.renderProfileVersion()}renderDiscussionsVersion(){var e;const t=null!==(e=this.props.time)&&void 0!==e?e:this.props.event.created_at;return c.createElement("div",{className:"beatmapset-event"},c.createElement("div",{className:"beatmapset-event__icon",style:this.iconStyle()}),c.createElement("div",{className:"beatmapset-event__time"},c.createElement(a.A,{dateTime:t,format:"LT"})),c.createElement("div",{className:"beatmapset-event__content"},this.content()))}renderProfileVersion(){let e;return null!=this.beatmapsetId&&(e=(0,n.w)("beatmapsets.discussion",{beatmapset:this.beatmapsetId}),null!=this.discussionId&&(e=`${e}#/${this.discussionId}`)),c.createElement("div",{className:"beatmapset-event"},null!=e?c.createElement("a",{href:e},c.createElement(i.A,{beatmapset:this.props.event.beatmapset,size:"list"})):c.createElement(i.A,{isDeleted:!0}),c.createElement("div",{className:(0,d.Zt)("beatmapset-event__icon",["beatmapset-activities"]),style:this.iconStyle()}),c.createElement("div",null,c.createElement("div",{className:"beatmapset-event__content"},this.content()),c.createElement("div",{className:"beatmap-discussion-post__info"},c.createElement(a.A,{dateTime:this.props.event.created_at,relative:!0}))))}content(){var e,t,s,i;let a,o="",d="[unknown user]",v="",g="";if(null!=this.discussionId){if(null==this.discussion)g=(0,n.w)("beatmapsets.discussions.show",{discussion:this.discussionId}),v=(0,m.pw)("beatmapset_events.item.discussion_deleted");else{const s=null===(e=this.firstPost)||void 0===e?void 0:e.message;g=(0,u.Gm)({discussion:this.discussion}),v=null!=s?c.createElement(r.A,{markdown:s}):"[no preview]";const i=null!==(t=this.props.users.get(this.discussion.user_id))&&void 0!==t?t:l.fc;d=c.createElement(b.A,{user:i})}o=c.createElement("a",{className:"js-beatmap-discussion--jump",href:g},`#${this.discussionId}`)}else"string"==typeof this.props.event.comment&&(v=this.props.event.comment);if("discussion_lock"!==this.props.event.type&&"remove_from_loved"!==this.props.event.type||(v=this.props.event.comment.reason),null!=this.props.event.user_id){const e=this.props.users.get(this.props.event.user_id);a=null!=e?c.createElement(b.A,{user:e}):l.fd.username}const y={discussion:o,discussion_user:d,text:v,user:a};if(null!=this.props.event.comment&&"object"==typeof this.props.event.comment)for(const[r,n]of Object.entries(this.props.event.comment))"number"!=typeof n&&"string"!=typeof n||(y[r]=n);let w=this.props.event.type;switch(this.props.event.type){case"disqualify":"string"==typeof this.props.event.comment&&(w="disqualify_legacy");break;case"genre_edit":y.new=(0,m.pw)(`beatmaps.genre.${f(this.props.event.comment.new)}`),y.old=(0,m.pw)(`beatmaps.genre.${f(this.props.event.comment.old)}`);break;case"language_edit":y.new=(0,m.pw)(`beatmaps.language.${f(this.props.event.comment.new)}`),y.old=(0,m.pw)(`beatmaps.language.${f(this.props.event.comment.old)}`);break;case"nominate":{const e=null===(s=this.props.event.comment)||void 0===s?void 0:s.modes;if(null!=e&&e.length>0){w="nominate_modes";const t=e.map((e=>(0,m.pw)(`beatmaps.mode.${e}`)));y.modes=(0,m.sc)(t)}break}case"nsfw_toggle":w+=`.${(null===(i=this.props.event.comment)||void 0===i?void 0:i.new)?"to_1":"to_0"}`;break;case"beatmap_owner_change":{const e=this.props.event.comment;y.new_user=c.createElement("a",{href:(0,n.w)("users.show",{user:e.new_user_id})},e.new_user_username),y.beatmap=c.createElement("a",{href:(0,n.w)("beatmaps.show",{beatmap:e.beatmap_id})},e.beatmap_version);break}case"nomination_reset_received":{const e=this.props.event.comment;"profile"===this.props.mode?(w+="_profile",y.user=c.createElement("a",{href:(0,n.w)("users.show",{user:e.source_user_id})},e.source_user_username)):y.source_user=c.createElement("a",{href:(0,n.w)("users.show",{user:e.source_user_id})},e.source_user_username);break}case"offset_edit":y.new=(0,p.ZV)(this.props.event.comment.new),y.old=(0,p.ZV)(this.props.event.comment.old)}const _=`beatmapset_events.event.${w}`;let E=(0,m.pw)(_);return null==a||(0,m.pw)(_).includes(":user")||(E+=" (:user)"),c.createElement(h.A,{mappings:y,pattern:E})}iconStyle(){return{"--bg":`var(--bg-${(0,o.kebabCase)(this.props.event.type)})`}}}},7508:(e,t,s)=>{s.d(t,{A:()=>a});var r=s(5647),i=s(6540);class a extends i.PureComponent{render(){return this.props.events.map((e=>i.createElement(r.A,{key:e.id,event:e,mode:this.props.mode,users:this.props.users})))}}},8857:(e,t,s)=>{s.d(t,{A:()=>d});var r=s(3358),i=s(1518),a=s(241),n=s(8994),o=s(5093),l=s(6540),c=s(1883);const u="beatmapset-mapping";class d extends l.PureComponent{render(){var e;const t={username:this.props.beatmapset.creator},s=null!==(e=this.props.user)&&void 0!==e?e:this.props.beatmapset.user;return null!=s&&(t.id=s.id,t.avatar_url=s.avatar_url),l.createElement("div",{className:u},l.createElement(n.A,{user:t},l.createElement(a.A,{modifiers:"beatmapset",user:t})),l.createElement("div",{className:`${u}__content`},l.createElement("div",{className:`${u}__mapper`},l.createElement(r.A,{mappings:{mapper:l.createElement(n.A,{className:`${u}__user`,user:t})},pattern:(0,c.pw)("beatmapsets.show.details.mapped_by")})),this.renderDate("submitted","submitted_date"),this.props.beatmapset.ranked>0?this.renderDate(this.props.beatmapset.status,"ranked_date"):this.renderDate("updated","last_updated")))}renderDate(e,t){const s=this.props.beatmapset[t];if(null==s)throw new Error(`beatmapset data is missing the expected date attribute: ${t}`);const a=Math.abs(o().diff(o(s),"weeks"))<4;return l.createElement("div",null,l.createElement(r.A,{mappings:{timeago:l.createElement("strong",null,l.createElement(i.A,{dateTime:s,relative:a}))},pattern:(0,c.pw)(`beatmapsets.show.details_date.${e}`)}))}}},4893:(e,t,s)=>{s.d(t,{A:()=>l});var r=s(6540),i=s(7634),a=s(5812),n=s(8623);class o extends r.Component{get disabled(){return this.props.disabled||this.props.isBusy}get text(){return null==this.props.text?null:"string"==typeof this.props.text?{top:this.props.text}:this.props.text}render(){let e=(0,i.Zt)("btn-osu-big",this.props.modifiers,{disabled:this.disabled});return null!=this.props.extraClasses&&(e+=` ${this.props.extraClasses.join(" ")}`),this.disabled?r.createElement("span",Object.assign({className:e},this.props.props,{onClick:void 0}),this.renderChildren()):(0,a.E)(this.props.href)?r.createElement("a",Object.assign({className:e,href:this.props.href},this.props.props),this.renderChildren()):r.createElement("button",Object.assign({className:e,type:this.props.isSubmit?"submit":"button"},this.props.props),this.renderChildren())}renderChildren(){const e=this.text;return r.createElement("span",{className:(0,i.Zt)("btn-osu-big__content",{center:null==e||null==this.props.icon})},null!=e&&r.createElement("span",{className:"btn-osu-big__left"},r.createElement("span",{className:"btn-osu-big__text-top"},e.top),"bottom"in e&&null!=e.bottom&&r.createElement("span",{className:"btn-osu-big__text-bottom"},e.bottom)),null!=this.props.icon&&r.createElement("span",{className:"btn-osu-big__icon"},r.createElement("span",{className:"fa fa-fw"},this.props.isBusy?r.createElement(n.y,{modifiers:"center-inline"}):r.createElement("span",{className:this.props.icon}))))}}Object.defineProperty(o,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{disabled:!1,extraClasses:[],isBusy:!1,isSubmit:!1,props:{}}});const l=o},2370:(e,t,s)=>{s.d(t,{A:()=>f});var r=s(9981),i=s(7813),a=s(1370),n=s(6823),o=s(6540),l=s(6407),c=s(7634),u=s(1883),d=s(8623),p=s(4692),m=function(e,t,s,r){var i,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(n=(a<3?i(n):a>3?i(t,s,n):i(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n};const h="textual-button";let b=class extends o.Component{get block(){var e;return null===(e=n.A.currentUser)||void 0===e?void 0:e.blocks.find((e=>e.target_id===this.props.userId))}constructor(e){super(e),Object.defineProperty(this,"loading",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"xhr",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clicked",{enumerable:!0,configurable:!0,writable:!0,value:()=>{var e,t;confirm((0,u.pw)("common.confirmation"))?this.toggleBlock():null===(t=(e=this.props).onClick)||void 0===t||t.call(e)}}),Object.defineProperty(this,"toggleBlock",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.loading=!0,null==this.block?this.xhr=p.ajax((0,r.w)("blocks.store",{target:this.props.userId}),{type:"POST"}):this.xhr=p.ajax((0,r.w)("blocks.destroy",{block:this.props.userId}),{type:"DELETE"}),this.xhr.done(this.updateBlocks).fail((0,l.dI)(this.toggleBlock)).always((0,i.XI)((()=>this.loading=!1)))}}),Object.defineProperty(this,"updateBlocks",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var t,s;null!=n.A.currentUser&&(n.A.currentUser.blocks=e.filter((e=>"block"===e.relation_type)),n.A.currentUser.friends=e.filter((e=>"friend"===e.relation_type))),null===(s=(t=this.props).onClick)||void 0===s||s.call(t)}}),(0,i.Gn)(this)}get isVisible(){return null!=n.A.currentUser&&Number.isFinite(this.props.userId)&&this.props.userId!==n.A.currentUser.id}componentWillUnmount(){var e;null===(e=this.xhr)||void 0===e||e.abort()}render(){if(!this.isVisible)return null;const e=(0,c.Zt)(h,this.props.modifiers,"block");let t,s;return null==this.props.wrapperClass?s=e:(t=e,s=this.props.wrapperClass),o.createElement("button",{className:s,disabled:this.loading,onClick:this.clicked,type:"button"},o.createElement("span",{className:t},this.loading?o.createElement("span",{className:`${h}__icon fa-fw`},o.createElement(d.y,null)):o.createElement("span",{className:`${h}__icon fas fa-ban fa-fw`})," ",null==this.block?(0,u.pw)("users.blocks.button.block"):(0,u.pw)("users.blocks.button.unblock")))}};m([i.sH],b.prototype,"loading",void 0),m([i.EW],b.prototype,"block",null),m([i.EW],b.prototype,"isVisible",null),m([i.XI],b.prototype,"toggleBlock",void 0),m([i.XI],b.prototype,"updateBlocks",void 0),b=m([a.PA],b);const f=b},5325:(e,t,s)=>{s.d(t,{P:()=>n});var r=s(6540),i=s(7634),a=s(5812);class n extends r.PureComponent{constructor(){super(...arguments),Object.defineProperty(this,"bn",{enumerable:!0,configurable:!0,writable:!0,value:"circular-progress"})}render(){var e;const t=this.bn,s=Math.min(1,this.props.current/this.props.max);if(this.props.onlyShowAsWarning&&s<.75)return null;const n=this.props.ignoreProgress?void 0:{transform:`rotate(${s}turn)`};return r.createElement("div",{className:(0,i.Zt)(t,{over:1===s,over50:s>.5,warn:s>=.75&&s<1,[this.props.theme]:(0,a.E)(this.props.theme)}),title:null!==(e=this.props.tooltip)&&void 0!==e?e:`${this.props.current} / ${this.props.max}`},r.createElement("div",{className:`${t}__label`},this.props.max-this.props.current),r.createElement("div",{className:`${t}__slice`},r.createElement("div",{className:`${t}__circle`,style:n}),r.createElement("div",{className:`${t}__circle ${t}__circle--fill`})))}}Object.defineProperty(n,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{ignoreProgress:!1,onlyShowAsWarning:!1,theme:""}})},1556:(e,t,s)=>{s.d(t,{A:()=>c});var r=s(4908),i=s(6540),a=s(1883),n=s(4692);const o="click-to-copy";class l extends i.Component{constructor(){super(...arguments),Object.defineProperty(this,"linkRef",{enumerable:!0,configurable:!0,writable:!0,value:i.createRef()}),Object.defineProperty(this,"timer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"titles",{enumerable:!0,configurable:!0,writable:!0,value:{default:(0,a.pw)("common.buttons.click_to_copy"),onClick:(0,a.pw)("common.buttons.click_to_copy_copied")}}),Object.defineProperty(this,"onClick",{enumerable:!0,configurable:!0,writable:!0,value:e=>{e.preventDefault(),r.writeText(this.props.value);const t=this.api;null!=t&&(t.set("content.text",this.titles.onClick),window.clearTimeout(this.timer),this.timer=window.setTimeout(this.resetTooltip,1e3))}}),Object.defineProperty(this,"onMouseLeave",{enumerable:!0,configurable:!0,writable:!0,value:()=>{window.clearTimeout(this.timer),this.resetTooltip()}}),Object.defineProperty(this,"resetTooltip",{enumerable:!0,configurable:!0,writable:!0,value:()=>{const e=this.api;null!=e&&(e.hide(),this.timer=window.setTimeout((()=>{e.set("content.text",this.titles.default)}),100))}})}get api(){if(null!=this.linkRef.current)return n(this.linkRef.current).qtip("api")}componentWillUnmount(){window.clearTimeout(this.timer)}render(){var e;return this.props.value?i.createElement("a",{ref:this.linkRef,className:o,"data-tooltip-hide-events":"mouseleave","data-tooltip-pin-position":!0,"data-tooltip-position":"bottom center",href:this.props.valueAsUrl?this.props.value:"#",onClick:this.onClick,onMouseLeave:this.onMouseLeave,title:this.titles.default},null!==(e=this.props.label)&&void 0!==e?e:this.props.value,this.props.showIcon&&i.createElement("i",{className:`fas fa-paste ${o}__icon`})):i.createElement("span",null)}}Object.defineProperty(l,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{showIcon:!1,valueAsUrl:!1}});const c=l},4809:(e,t,s)=>{s.d(t,{A:()=>g});var r=s(7833),i=s(7813),a=s(1370),n=s(6823),o=s(6540),l=s(7634),c=s(7144),u=s(1883),d=s(4893),p=s(8623),m=s(241),h=function(e,t,s,r){var i,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(n=(a<3?i(n):a>3?i(t,s,n):i(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n};const b="comment-editor",f={edit:"save",new:"post",reply:"reply"};let v=class extends o.Component{get canComment(){return null!=n.A.currentUser&&("edit"===this.mode||null==this.canNewCommentReason)}get canNewCommentReason(){return null==this.props.commentableMeta?null:"current_user_attributes"in this.props.commentableMeta?this.props.commentableMeta.current_user_attributes.can_new_comment_reason:(0,u.pw)("authorization.comment.store.disabled")}get isValid(){return this.message.length>0}get initialMessage(){var e;return null!==(e=this.props.message)&&void 0!==e?e:""}get mode(){return null!=this.props.parent?"reply":null!=this.props.id?"edit":"new"}get placeholder(){var e;return this.canComment?(0,u.pw)(`comments.placeholder.${this.mode}`):null!==(e=this.canNewCommentReason)&&void 0!==e?e:void 0}constructor(e){super(e),Object.defineProperty(this,"handleKeyDown",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"posting",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"textarea",{enumerable:!0,configurable:!0,writable:!0,value:o.createRef()}),Object.defineProperty(this,"xhr",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"close",{enumerable:!0,configurable:!0,writable:!0,value:()=>{null!=this.props.close&&(this.initialMessage===this.message||confirm((0,u.pw)("common.confirmation_unsaved")))&&this.props.close()}}),Object.defineProperty(this,"handleKeyDownCallback",{enumerable:!0,configurable:!0,writable:!0,value:e=>{e===c.p.Cancel?this.close():e===c.p.Submit&&this.post()}}),Object.defineProperty(this,"onChange",{enumerable:!0,configurable:!0,writable:!0,value:e=>{this.message=e.currentTarget.value}}),Object.defineProperty(this,"post",{enumerable:!0,configurable:!0,writable:!0,value:()=>{var e,t,s,r;const a={commentableMeta:this.props.commentableMeta,id:this.props.id,message:this.message,mode:this.mode,parentId:null===(e=this.props.parent)||void 0===e?void 0:e.id};this.props.controller.isPosting(a)||("edit"!==this.mode||this.message!==(null!==(t=this.props.message)&&void 0!==t?t:"")?this.props.controller.apiPost(a,(0,i.XI)((()=>{var e,t,s,r;this.message="",null===(t=(e=this.props).onPosted)||void 0===t||t.call(e,this.mode),null===(r=(s=this.props).close)||void 0===r||r.call(s)}))):null===(r=(s=this.props).close)||void 0===r||r.call(s))}}),this.handleKeyDown=(0,c.R)(this.handleKeyDownCallback),this.message=this.initialMessage,(0,i.Gn)(this)}componentDidMount(){var e;null!==(e=this.props.focus)&&void 0!==e&&!e||null==this.textarea.current||(this.textarea.current.selectionStart=-1,this.textarea.current.focus())}componentWillUnmount(){var e;null===(e=this.xhr)||void 0===e||e.abort()}render(){const e=(0,l.Zt)(b,this.props.modifiers,{fancy:"new"===this.mode});return o.createElement("div",{className:e},"new"===this.mode&&o.createElement("div",{className:`${b}__avatar`},o.createElement(m.A,{modifiers:"full-circle",user:n.A.currentUser})),o.createElement(r.A,{className:`${b}__message`,disabled:!this.canComment||this.posting,innerRef:this.textarea,onChange:this.onChange,onKeyDown:this.handleKeyDown,placeholder:this.placeholder,value:this.message}),o.createElement("div",{className:`${b}__footer`},o.createElement("div",{className:`${b}__footer-item ${b}__footer-item--notice hidden-xs`},this.canComment&&(0,u.pw)("comments.editor.textarea_hint._",{action:(0,u.pw)(`comments.editor.textarea_hint.${this.mode}`)})),null!=this.props.close&&o.createElement("div",{className:`${b}__footer-item`},o.createElement(d.A,{disabled:this.posting,modifiers:"comment-editor",props:{onClick:this.props.close},text:(0,u.pw)("common.buttons.cancel")})),null!=n.A.currentUser?o.createElement("div",{className:`${b}__footer-item`},o.createElement(d.A,{disabled:!this.isValid,isBusy:this.posting,modifiers:"comment-editor",props:{onClick:this.post},text:{top:this.posting?o.createElement(p.y,{modifiers:"center-inline"}):(0,u.pw)(`common.buttons.${f[this.mode]}`)}})):o.createElement("div",{className:`${b}__footer-item`},o.createElement(d.A,{extraClasses:["js-user-link"],modifiers:"comment-editor",text:(0,u.pw)(`comments.guest_button.${this.mode}`)}))))}};h([i.sH],v.prototype,"message",void 0),h([i.sH],v.prototype,"posting",void 0),h([i.EW],v.prototype,"canComment",null),h([i.EW],v.prototype,"mode",null),h([i.EW],v.prototype,"placeholder",null),h([i.XI],v.prototype,"onChange",void 0),h([i.XI],v.prototype,"post",void 0),v=h([a.PA],v);const g=v},4691:(e,t,s)=>{s.d(t,{A:()=>p});var r=s(1370),i=s(6540),a=s(7634),n=s(1883),o=s(8102),l=s(8623),c=function(e,t,s,r){var i,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(n=(a<3?i(n):a>3?i(t,s,n):i(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n};const u="comment-show-more";let d=class extends i.Component{constructor(){super(...arguments),Object.defineProperty(this,"load",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.props.controller.apiLoadMore(this.props.parent)}})}get loading(){return this.props.controller.isLoading(this.props.parent)}get hasMoreComments(){var e;return null==this.props.parent||null===(e=this.props.controller.state.hasMore[this.props.parent.id])||void 0===e||e}render(){var e,t;return this.props.comments.length>=this.props.total?null:this.hasMoreComments?null!==(e=this.props.top)&&void 0!==e&&e?i.createElement(o.A,{callback:this.load,hasMore:!0,loading:this.loading,modifiers:"comments",remaining:this.props.total-this.props.comments.length}):i.createElement("div",{className:(0,a.Zt)(u,this.props.modifiers)},this.loading?i.createElement(l.y,null):i.createElement("button",{className:`${u}__link`,onClick:this.load},null!==(t=this.props.label)&&void 0!==t?t:(0,n.pw)("common.buttons.show_more"))):null}};d=c([r.PA],d);const p=d},1836:(e,t,s)=>{s.d(t,{A:()=>T});var r=s(9981),i=s(2543),a=s(7813),n=s(1370),o=s(9207),l=s(8443),c=s(6823),u=s(6540),d=s(7634);let p=null;function m(e){const t=function(){if(null==p&&(p=document.querySelector(".js-estimate-min-lines"),null==p))throw new Error("js-estimate-min-lines placeholder element is missing!");return p}();t.innerHTML=e;const s=t.firstChild;let r=t;s instanceof HTMLElement&&(r=s);const i=parseFloat(window.getComputedStyle(r).getPropertyValue("line-height")),a=t.scrollHeight;return{count:Math.ceil(a/i),height:a,lineHeight:i}}var h,b=s(256),f=s(1883),v=s(1556),g=s(4809),y=s(4691),w=s(4606),_=s(5953),E=s(8102),P=s(8623),O=s(3358),j=s(1518),k=s(241),S=s(8994),N=function(e,t,s,r){var i,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(n=(a<3?i(n):a>3?i(t,s,n):i(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n};let A=h=class extends u.Component{get hasVoted(){return this.props.controller.state.votedCommentIds.has(this.props.comment.id)}get isBlocked(){return null!=this.props.comment.userId&&c.A.currentUserModel.blocks.has(this.props.comment.userId)}get isLongContent(){return null!=this.lines&&this.lines.count>=9}get lines(){var e;return m(null!==(e=this.props.comment.messageHtml)&&void 0!==e?e:"")}get meta(){return this.props.controller.getCommentableMeta(this.props.comment)}get parentComment(){return null==this.props.comment.parentId?void 0:this.props.controller.state.comments[this.props.comment.parentId]}get parentPreview(){var e;const t=this.parentComment;if(null==t)throw new Error("trying to render parent preview without parent");return t.isDeleted?(0,f.pw)("comments.deleted"):null!=t.userId&&c.A.currentUserModel.blocks.has(t.userId)?(0,f.pw)("users.blocks.comment_text"):(0,i.truncate)((0,b.Kq)(null!==(e=t.messageHtml)&&void 0!==e?e:""),{length:100})}get postingVote(){return this.props.controller.isVoting(this.props.comment)}get replies(){return this.props.controller.getReplies(this.props.comment)}get shouldRender(){if(!this.props.comment.isDeleted)return!0;if(this.props.showToolbar)return!0;if((0,o.C)()&&c.A.userPreferences.get("comments_show_deleted"))return!0;const e=this.replies;return e.length>0&&e.some((e=>e.isVisible))}get shouldRenderContent(){return null!=this.props.comment.messageHtml&&(!(!(0,o.C)()||!c.A.userPreferences.get("comments_show_deleted"))||!this.props.comment.isDeleted)}get user(){return this.getCommentUser(this.props.comment)}constructor(e){if(super(e),Object.defineProperty(this,"clipped",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"editing",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"expandReplies",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"forceShow",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"showMoreRef",{enumerable:!0,configurable:!0,writable:!0,value:u.createRef()}),Object.defineProperty(this,"showNewReply",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"onCloseEdit",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.editing=!1}}),Object.defineProperty(this,"onCloseReplyBox",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.showNewReply=!1}}),Object.defineProperty(this,"onDelete",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.props.controller.apiDelete(this.props.comment)}}),Object.defineProperty(this,"onLoadReplies",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.props.controller.apiLoadMore(this.props.comment),this.onToggleReplies()}}),Object.defineProperty(this,"onReplyPosted",{enumerable:!0,configurable:!0,writable:!0,value:e=>{this.expandReplies="reply"===e}}),Object.defineProperty(this,"onRestore",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.props.controller.apiRestore(this.props.comment)}}),Object.defineProperty(this,"onShowDeletedToggleClick",{enumerable:!0,configurable:!0,writable:!0,value:()=>{c.A.userPreferences.set("comments_show_deleted",!c.A.userPreferences.get("comments_show_deleted"))}}),Object.defineProperty(this,"onToggleClip",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.clipped=!this.clipped}}),Object.defineProperty(this,"onToggleEdit",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.editing=!this.editing}}),Object.defineProperty(this,"onToggleForceShow",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.forceShow=!this.forceShow}}),Object.defineProperty(this,"onToggleNewReply",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.showNewReply=!this.showNewReply}}),Object.defineProperty(this,"onTogglePinned",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.props.controller.apiTogglePin(this.props.comment)}}),Object.defineProperty(this,"onToggleReplies",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.expandReplies=!this.expandReplies}}),Object.defineProperty(this,"onToggleVote",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.props.controller.apiToggleVote(this.props.comment)}}),Object.defineProperty(this,"renderComment",{enumerable:!0,configurable:!0,writable:!0,value:e=>u.createElement(h,{key:e.id,comment:e,controller:this.props.controller,depth:this.props.depth+1,expandReplies:this.props.expandReplies,modifiers:this.props.modifiers})}),c.A.windowSize.isMobile)this.expandReplies=!1;else if(this.props.comment.isDeleted)this.expandReplies=!1;else if(null!=this.props.expandReplies)this.expandReplies=this.props.expandReplies;else{const e=this.replies;this.expandReplies=!this.isBlocked&&(null==e?void 0:e.length)>0&&this.props.depth<6}(0,a.Gn)(this)}render(){return this.shouldRender?u.createElement("div",{className:(0,d.Zt)("comment",this.props.modifiers,{top:0===this.props.depth})},this.props.comment.isDeleted||!this.isBlocked||this.forceShow?this.renderMain():this.renderBlocked()):null}getCommentUser(e){var t;return null!==(t=this.getUser(e.userId))&&void 0!==t?t:null==e.legacyName?l.fc:{username:e.legacyName}}getUser(e){return this.props.controller.getUser(e)}renderBlocked(){return u.createElement("div",{className:(0,d.Zt)("comment__main","deleted")},u.createElement("span",{className:this.props.depth>0?"comment__avatar":void 0,style:{height:"auto"}}),u.createElement("div",{className:"comment__container"},u.createElement("div",{className:"comment__message"},u.createElement("p",{className:"osu-md osu-md--comment osu-md__paragraph"},(0,f.pw)("users.blocks.comment_text")," ",this.renderForceShowButton()))))}renderCommentableMeta(){if(!this.props.showCommentableMeta)return;const e=this.meta;return null!=e?u.createElement("div",{className:"comment__commentable-meta"},null!=this.props.comment.commentableType&&u.createElement("span",{className:"comment__commentable-meta-type"},u.createElement("span",{className:"comment__commentable-meta-icon fas fa-comment"})," ",(0,f.pw)(`comments.commentable_name.${this.props.comment.commentableType}`)),"url"in e?u.createElement("a",{className:"comment__link",href:e.url},e.title):u.createElement("span",null,e.title)):void 0}renderDelete(){if(!this.props.comment.isDeleted&&this.props.comment.canDelete)return u.createElement("div",{className:"comment__row-item"},u.createElement("button",{className:"comment__action",onClick:this.onDelete,type:"button"},(0,f.pw)("common.buttons.delete")))}renderDeletedBy(){var e;if(null!=this.props.comment.deletedAt&&this.props.comment.canModerate)return u.createElement("div",{className:"comment__row-item comment__row-item--info"},u.createElement(O.A,{mappings:{timeago:u.createElement(j.A,{dateTime:this.props.comment.deletedAt,relative:!0}),user:null==this.props.comment.deletedById?(0,f.pw)("comments.deleted_by_system"):u.createElement(S.A,{user:null!==(e=this.getUser(this.props.comment.deletedById))&&void 0!==e?e:l.fc})},pattern:(0,f.pw)("comments.deleted_by")}))}renderEdit(){if(this.props.comment.canEdit)return u.createElement("div",{className:"comment__row-item"},u.createElement("button",{className:(0,d.Zt)("comment__action",{active:this.editing}),onClick:this.onToggleEdit,type:"button"},(0,f.pw)("common.buttons.edit")))}renderEditedBy(){var e;if(null!=this.props.comment.editedAt&&!this.props.comment.isDeleted)return u.createElement("div",{className:"comment__row-item comment__row-item--info"},u.createElement(O.A,{mappings:{timeago:u.createElement(j.A,{dateTime:this.props.comment.editedAt,relative:!0}),user:u.createElement(S.A,{user:null!==(e=this.getUser(this.props.comment.editedById))&&void 0!==e?e:l.fc})},pattern:(0,f.pw)("comments.edited")}))}renderFooter(){return u.createElement("div",{className:"comment__row comment__row--footer"},this.props.comment.canHaveVote&&u.createElement("div",{className:"comment__row-item visible-xs"},this.renderVoteButton(!0)),u.createElement("div",{className:"comment__row-item comment__row-item--info"},u.createElement(j.A,{dateTime:this.props.comment.createdAt,relative:!0})),this.renderPermalink(),this.renderReplyButton(),this.renderEdit(),this.renderRestore(),this.renderDelete(),this.renderPin(),this.renderReport(),this.renderEditedBy(),this.renderDeletedBy(),this.renderForceShow(),this.renderRepliesText())}renderForceShow(){if(this.isBlocked&&!this.props.comment.isDeleted)return u.createElement("div",{className:"comment__row-item"},this.renderForceShowButton())}renderForceShowButton(){return u.createElement("button",{className:"comment__action",onClick:this.onToggleForceShow,type:"button"},this.forceShow?(0,f.pw)("users.blocks.hide_comment"):(0,f.pw)("users.blocks.show_comment"))}renderMain(){var e;return u.createElement(u.Fragment,null,this.renderRepliesToggle(),this.renderCommentableMeta(),this.renderToolbar(),u.createElement("div",{className:(0,d.Zt)("comment__main",{clip:this.clipped&&this.isLongContent,deleted:this.props.comment.isDeleted||this.isBlocked}),style:{"--clip-lines":7,"--line-height":null==this.lines?void 0:`${this.lines.lineHeight}px`}},this.props.comment.canHaveVote&&u.createElement("div",{className:"comment__float-container comment__float-container--left hidden-xs"},this.renderVoteButton(!1)),this.renderUserAvatar(),u.createElement("div",{className:"comment__container"},u.createElement("div",{className:"comment__row comment__row--header"},u.createElement(S.A,{className:"comment__row-item",user:this.user}),this.renderOwnerBadge(),this.props.comment.pinned&&u.createElement("span",{className:"comment__row-item  comment__row-item--pinned"},u.createElement("span",{className:"fa fa-thumbtack"})," ",(0,f.pw)("comments.pinned")),this.renderParentLink(),this.props.comment.isDeleted&&u.createElement("span",{className:"comment__row-item comment__row-item--deleted"},(0,f.pw)("comments.deleted"))),this.editing?u.createElement("div",{className:"comment__editor"},u.createElement(g.A,{close:this.onCloseEdit,controller:this.props.controller,id:this.props.comment.id,message:this.props.comment.message,modifiers:this.props.modifiers})):this.shouldRenderContent&&u.createElement(u.Fragment,null,u.createElement("div",{className:"comment__message",dangerouslySetInnerHTML:{__html:null!==(e=this.props.comment.messageHtml)&&void 0!==e?e:""}}),this.isLongContent&&this.renderToggleClipButton()),this.renderFooter(),this.renderReplyBox())),this.props.comment.visibleReplyCount>0&&u.createElement("div",{className:(0,d.Zt)("comment__replies",{hidden:!this.expandReplies,indented:this.props.depth<6})},this.replies.map(this.renderComment),u.createElement(w.A,{comments:this.replies}),u.createElement(y.A,{ref:this.showMoreRef,comments:this.replies,controller:this.props.controller,label:0===this.replies.length?(0,f.pw)("comments.load_replies"):void 0,modifiers:this.props.modifiers,parent:this.props.comment,total:this.props.comment.visibleReplyCount})))}renderOwnerBadge(){const e=this.meta;if(null!=e&&"owner_id"in e&&null!=e.owner_id&&this.props.comment.userId===e.owner_id)return u.createElement("div",{className:"comment__row-item"},u.createElement("div",{className:"comment__owner-badge"},e.owner_title))}renderParentLink(){const e=this.parentComment;if(null==e)return;const t=this.getCommentUser(e),s=u.createElement(u.Fragment,null,u.createElement("span",{className:"fas fa-reply"}),` ${t.username}`);return u.createElement("span",{className:"comment__row-item comment__row-item--parent"},this.props.linkParent?u.createElement("a",{className:"comment__link",href:(0,r.w)("comments.show",{comment:e.id}),title:this.parentPreview},s):u.createElement("span",{title:this.parentPreview},s))}renderPermalink(){return u.createElement("div",{className:"comment__row-item"},u.createElement("span",{className:"comment__action comment__action--permalink"},u.createElement(v.A,{label:(0,f.pw)("common.buttons.permalink"),value:(0,r.w)("comments.show",{comment:this.props.comment.id}),valueAsUrl:!0})))}renderPin(){if(this.props.comment.canPin)return u.createElement("div",{className:"comment__row-item"},u.createElement("button",{className:"comment__action",onClick:this.onTogglePinned,type:"button"},(0,f.pw)("common.buttons."+(this.props.comment.pinned?"unpin":"pin"))))}renderRepliesText(){if(0===this.props.comment.visibleReplyCount)return;let e,t;return this.expandReplies||0!==this.replies.length?(t=this.onToggleReplies,e=(0,f.Mq)("comments.replies_count",this.props.comment.repliesCount)):(t=this.onLoadReplies,e=(0,f.pw)("comments.load_replies")),u.createElement("div",{className:"comment__row-item comment__row-item--replies"},u.createElement(E.A,{callback:t,direction:this.expandReplies?"up":"down",hasMore:!0,label:e,modifiers:"comment-replies"}))}renderRepliesToggle(){if(!(this.props.depth>0||0===this.replies.length))return u.createElement("div",{className:"comment__float-container comment__float-container--right"},u.createElement("button",{className:"comment__top-show-replies",onClick:this.onToggleReplies,type:"button"},u.createElement("span",{className:"fas "+(this.expandReplies?"fa-angle-up":"fa-angle-down")})))}renderReplyBox(){if(this.showNewReply)return u.createElement("div",{className:"comment__reply-box"},u.createElement(g.A,{close:this.onCloseReplyBox,commentableMeta:this.meta,controller:this.props.controller,modifiers:this.props.modifiers,onPosted:this.onReplyPosted,parent:this.props.comment}))}renderReplyButton(){if(!this.props.comment.isDeleted)return u.createElement("div",{className:"comment__row-item"},u.createElement("button",{className:(0,d.Zt)("comment__action",{active:this.showNewReply}),onClick:this.onToggleNewReply,type:"button"},(0,f.pw)("common.buttons.reply")))}renderReport(){if(this.props.comment.canReport)return u.createElement("div",{className:"comment__row-item"},u.createElement(_.r,{className:"comment__action",reportableId:this.props.comment.id.toString(),reportableType:"comment",user:this.user}))}renderRestore(){if(this.props.comment.isDeleted&&this.props.comment.canRestore)return u.createElement("div",{className:"comment__row-item"},u.createElement("button",{className:"comment__action",onClick:this.onRestore,type:"button"},(0,f.pw)("common.buttons.restore")))}renderToggleClipButton(){return u.createElement("button",{className:"comment__toggle-clip",onClick:this.onToggleClip,type:"button"},(0,f.pw)("common.buttons."+(this.clipped?"read_more":"show_less")))}renderToolbar(){if(this.props.showToolbar&&(0,o.C)())return u.createElement("div",{className:"comment__toolbar"},u.createElement("div",{className:"sort"},u.createElement("div",{className:"sort__items"},u.createElement("button",{className:"sort__item sort__item--button",onClick:this.onShowDeletedToggleClick,type:"button"},u.createElement("span",{className:"sort__item-icon"},u.createElement("span",{className:c.A.userPreferences.get("comments_show_deleted")?"fas fa-check-square":"far fa-square"})),(0,f.pw)("common.buttons.show_deleted")))))}renderUserAvatar(){const e=this.user;return"id"in e?u.createElement("a",{className:"comment__avatar js-usercard","data-user-id":e.id,href:(0,r.w)("users.show",{user:e.id})},u.createElement(k.A,{modifiers:"full-circle",user:e})):u.createElement("span",{className:"comment__avatar"},u.createElement(k.A,{modifiers:"full-circle",user:Object.assign({avatar_url:void 0},e)}))}renderVoteButton(e){const t=this.hasVoted,s=(0,d.Zt)("comment-vote",this.props.modifiers,{disabled:!this.props.comment.canVote,inline:e,on:t,posting:this.postingVote}),r=e||t?null:u.createElement("div",{className:"comment-vote__hover"},"+1");return u.createElement("button",{className:s,disabled:this.postingVote||!this.props.comment.canVote,onClick:this.onToggleVote,type:"button"},u.createElement("span",{className:"comment-vote__text"},"+",(0,b.h$)(this.props.comment.votesCount)),this.postingVote&&u.createElement("span",{className:"comment-vote__spinner"},u.createElement(P.y,null)),r)}};Object.defineProperty(A,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{linkParent:!1,showCommentableMeta:!1,showToolbar:!1}}),N([a.sH],A.prototype,"clipped",void 0),N([a.sH],A.prototype,"editing",void 0),N([a.sH],A.prototype,"expandReplies",void 0),N([a.sH],A.prototype,"forceShow",void 0),N([a.sH],A.prototype,"showNewReply",void 0),N([a.EW],A.prototype,"isBlocked",null),N([a.EW],A.prototype,"lines",null),N([a.EW],A.prototype,"meta",null),N([a.EW],A.prototype,"parentComment",null),N([a.EW],A.prototype,"parentPreview",null),N([a.EW],A.prototype,"replies",null),N([a.EW],A.prototype,"shouldRender",null),N([a.EW],A.prototype,"shouldRenderContent",null),N([a.EW],A.prototype,"user",null),N([a.XI],A.prototype,"onCloseEdit",void 0),N([a.XI],A.prototype,"onCloseReplyBox",void 0),N([a.XI],A.prototype,"onReplyPosted",void 0),N([a.XI],A.prototype,"onToggleClip",void 0),N([a.XI],A.prototype,"onToggleEdit",void 0),N([a.XI],A.prototype,"onToggleForceShow",void 0),N([a.XI],A.prototype,"onToggleNewReply",void 0),N([a.XI],A.prototype,"onToggleReplies",void 0),A=h=N([n.PA],A);const T=A},4885:(e,t,s)=>{s.d(t,{A:()=>v});var r=s(9981),i=s(2543),a=s(7813),n=s(9207),o=s(6823),l=s(6407),c=s(1883),u=s(450),d=s(4692),p=function(e,t,s,r){var i,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(n=(a<3?i(n):a>3?i(t,s,n):i(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n};function m(e){Object.values(e).forEach((e=>null==e?void 0:e.abort()))}function h(){return{commentableMetaItems:{},commentIdsByParentId:{},comments:{},hasMore:{},isFollowing:!1,pinnedCommentIds:[],sort:"new",topLevelCount:0,total:0,users:{},votedCommentIds:new Set}}function b(e){return null!=e&&"id"in e?`${e.type}-${e.id}`:"null"}function f(e){var t,s;switch(e.mode){case"edit":return null!==(t=e.id)&&void 0!==t?t:0;case"new":return b(e.commentableMeta);case"reply":return null!==(s=e.parentId)&&void 0!==s?s:0;default:throw(0,u.J)(e.mode),new Error("unsupported mode")}}class v{get commentableMeta(){return this.state.commentableMetaItems[b(this.baseCommentableMeta)]}get pinnedComments(){return this.getComments(this.state.pinnedCommentIds)}get stateEl(){var e;const t=(null!==(e=window.newBody)&&void 0!==e?e:document.body).querySelector(this.stateSelector);if(t instanceof HTMLScriptElement)return t;throw new Error("missing state element")}get topLevelComments(){var e;return this.getComments(null!==(e=this.state.commentIdsByParentId[0])&&void 0!==e?e:[])}constructor(e,t){Object.defineProperty(this,"stateSelector",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"baseCommentableMeta",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"nextState",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"destroyed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"xhr",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"destroy",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.destroyed||(document.removeEventListener("turbolinks:before-cache",this.destroy),m(this.xhr),this.stateStore(),this.destroyed=!0)}});const s=this.stateEl,r=s.dataset.savedState;if(null!=r)this.state=this.stateFromJson(JSON.parse(r));else{this.state=h();const e=JSON.parse(s.text);this.loadBundle(e,!0,!0)}(0,a.Gn)(this),document.addEventListener("turbolinks:before-cache",this.destroy)}apiDelete(e){var t;if(this.isDeleting(e)||!confirm((0,c.pw)("common.confirmation")))return;const s=`delete-${e.id}`;this.xhr[s]=d.ajax((0,r.w)("comments.destroy",{comment:e.id}),{method:"DELETE"}),null===(t=this.xhr[s])||void 0===t||t.done((e=>this.loadBundle(e))).fail(l.S5).always((0,a.XI)((()=>{delete this.xhr[s]})))}apiLoadMore(e){var t,s,n;if(this.isLoading(e))return;const o=null!==(t=null==e?void 0:e.id)&&void 0!==t?t:0,l={parent_id:o,sort:this.state.sort};null==e?null!=this.baseCommentableMeta&&(l.commentable_id=this.baseCommentableMeta.id,l.commentable_type=this.baseCommentableMeta.type):(l.commentable_id=e.commentableId,l.commentable_type=e.commentableType);const c=(0,i.last)(null!==(s=this.state.commentIdsByParentId[o])&&void 0!==s?s:[]);null!=c&&(l.after=c);const u=`load-${o}`;this.xhr[u]=d.ajax((0,r.w)("comments.index"),{data:l,dataType:"json"}),null===(n=this.xhr[u])||void 0===n||n.done((e=>this.loadBundle(e))).always((0,a.XI)((()=>{delete this.xhr[u]})))}apiPost(e,t){var s;if(this.isPosting(e))return;if(o.A.userLogin.showIfGuest((()=>this.apiPost(e,t))))return;const i={comment:{message:e.message}};let n=(0,r.w)("comments.store"),c="POST";switch(e.mode){case"edit":if(null==e.id)throw new Error("missing post id in edit mode");n=(0,r.w)("comments.update",{comment:e.id}),c="PUT";break;case"new":if(null==e.commentableMeta||!("id"in e.commentableMeta))throw new Error("missing commentable meta in new mode");i.comment.commentable_type=e.commentableMeta.type,i.comment.commentable_id=e.commentableMeta.id;break;case"reply":if(null==e.parentId)throw new Error("missing parent in reply mode");i.comment.parent_id=e.parentId;break;default:throw(0,u.J)(e.mode),new Error("unsupported mode")}const p=`${e.mode}-${f(e)}`;this.xhr[p]=d.ajax(n,{data:i,method:c}),null===(s=this.xhr[p])||void 0===s||s.always((0,a.XI)((()=>{delete this.xhr[p]}))).done((e=>(0,a.h5)((()=>{t(),this.loadBundle(e,!1)})))).fail(l.S5)}apiRestore(e){var t;if(this.isDeleting(e)||!confirm((0,c.pw)("common.confirmation")))return;const s=`delete-${e.id}`;this.xhr[s]=d.ajax((0,r.w)("comments.restore",{comment:e.id}),{method:"POST"}),null===(t=this.xhr[s])||void 0===t||t.done((e=>this.loadBundle(e))).fail(l.S5).always((0,a.XI)((()=>{delete this.xhr[s]})))}apiSetSort(e){if(null!=this.xhr.sort)return;this.nextState.sort=e;const t={parent_id:0,sort:e};null!=this.commentableMeta&&"id"in this.commentableMeta&&(t.commentable_id=this.commentableMeta.id,t.commentable_type=this.commentableMeta.type),this.xhr.sort=d.ajax((0,r.w)("comments.index"),{data:t,dataType:"json"}),this.xhr.sort.done((e=>(0,a.h5)((()=>{m(this.xhr),this.state=h(),this.nextState={},this.xhr={},this.loadBundle(e,!0,!0),o.A.userPreferences.set("comments_sort",this.state.sort)}))))}apiToggleFollow(){if(null!=this.nextState.isFollowing)return;const e=this.commentableMeta;if(null==e||!("id"in e))return;const t=this.nextState.isFollowing=!this.state.isFollowing;this.xhr.follow=d.ajax((0,r.w)("follows.store"),{data:{follow:{notifiable_id:e.id,notifiable_type:e.type,subtype:"comment"}},dataType:"json",method:this.nextState.isFollowing?"POST":"DELETE"}),this.xhr.follow.always((0,a.XI)((()=>{delete this.xhr.follow,this.nextState.isFollowing=void 0}))).done((0,a.XI)((()=>{this.state.isFollowing=t}))).fail(l.S5)}apiTogglePin(e){var t;const s=`pin-${e.id}`;null==this.xhr[s]&&e.canPin&&(this.xhr[s]=d.ajax((0,r.w)("comments.pin",{comment:e.id}),{method:e.pinned?"DELETE":"POST"}),null===(t=this.xhr[s])||void 0===t||t.done((e=>this.loadBundle(e))).fail(l.S5).always((0,a.XI)((()=>{delete this.xhr[s]}))))}apiToggleVote(e){var t;if(this.isVoting(e))return;if(o.A.userLogin.showIfGuest((()=>this.apiToggleVote(e))))return;let s,i;this.state.votedCommentIds.has(e.id)?(s="DELETE",i="delete"):(s="POST",i="add");const n=`vote-${e.id}`;this.xhr[n]=d.ajax((0,r.w)("comments.vote",{comment:e.id}),{method:s}),null===(t=this.xhr[n])||void 0===t||t.done((t=>(0,a.h5)((()=>{this.loadBundle(t),this.state.votedCommentIds[i](e.id)})))).fail(l.S5).always((0,a.XI)((()=>{delete this.xhr[n]})))}getCommentableMeta(e){var t;return null!==(t=this.state.commentableMetaItems[`${e.commentableType}-${e.commentableId}`])&&void 0!==t?t:{title:""}}getComments(e){const t=[];for(const s of null!=e?e:[]){const e=this.state.comments[s];null!=e&&t.push(e)}return t}getReplies(e){const t=this.state.commentIdsByParentId[e.id];return this.getComments(t)}getUser(e){return null==e?void 0:this.state.users[e]}isLoading(e){var t;return null!=this.xhr[`load-${null!==(t=null==e?void 0:e.id)&&void 0!==t?t:0}`]}isPosting(e){return null!=this.xhr[`${e.mode}-${f(e)}`]}isVoting(e){return null!=this.xhr[`vote-${e.id}`]}addComment(e){var t;const s=e.id;(null===(t=this.state.comments[s])||void 0===t?void 0:t.updatedAt)!==e.updated_at&&(this.state.comments[s]=new n.A(e,this))}addCommentId(e,t){var s,r,i,a;const n=null!==(s=e.parent_id)&&void 0!==s?s:0;null!==(r=(a=this.state.commentIdsByParentId)[n])&&void 0!==r||(a[n]=[]);const o=null!==(i=this.state.commentIdsByParentId[n])&&void 0!==i?i:[],l=e.id;o.includes(l)||(t?o.push(l):o.unshift(l))}isDeleting(e){return null!=this.xhr[`delete-${e.id}`]}loadBundle(e,t=!0,s=!1){var r;s&&(this.state.commentIdsByParentId[-1]=e.comments.map((e=>e.id)),this.state.sort=e.sort,t=!0),e.comments.forEach((e=>{this.addCommentId(e,t),this.addComment(e)})),e.included_comments.forEach((e=>{this.addCommentId(e,!0),this.addComment(e)})),this.state.pinnedCommentIds=[],(null!==(r=e.pinned_comments)&&void 0!==r?r:[]).forEach((e=>{this.state.pinnedCommentIds.push(e.id),this.addComment(e)})),e.user_votes.forEach((e=>this.state.votedCommentIds.add(e))),this.state.isFollowing=e.user_follow,this.state.hasMore[e.has_more_id]=e.has_more,null!=e.top_level_count&&null!=e.total&&(this.state.topLevelCount=e.top_level_count,this.state.total=e.total);for(const a of e.users){const e=a.id;(0,i.isEqual)(this.state.users[e],a)||(this.state.users[e]=a)}for(const a of e.commentable_meta){const e=b(a);(0,i.isEqual)(this.state.commentableMetaItems[e],a)||(this.state.commentableMetaItems[e]=a)}}stateFromJson(e){const t={};for(const s of e.comments)t[s.id]=new n.A(s,this);return{commentableMetaItems:e.commentableMetaItems,commentIdsByParentId:e.commentIdsByParentId,comments:t,hasMore:e.hasMore,isFollowing:e.isFollowing,pinnedCommentIds:e.pinnedCommentIds,sort:e.sort,topLevelCount:e.topLevelCount,total:e.total,users:e.users,votedCommentIds:new Set(e.votedCommentIds)}}stateStore(){const e=[];for(const s of Object.values(this.state.comments))null!=s&&e.push(s.toJson());const t={commentableMetaItems:this.state.commentableMetaItems,commentIdsByParentId:this.state.commentIdsByParentId,comments:e,hasMore:this.state.hasMore,isFollowing:this.state.isFollowing,pinnedCommentIds:this.state.pinnedCommentIds,sort:this.state.sort,topLevelCount:this.state.topLevelCount,total:this.state.total,users:this.state.users,votedCommentIds:[...this.state.votedCommentIds]};this.stateEl.dataset.savedState=JSON.stringify(t)}}p([a.sH],v.prototype,"nextState",void 0),p([a.sH],v.prototype,"state",void 0),p([a.sH],v.prototype,"xhr",void 0),p([a.XI],v.prototype,"apiDelete",null),p([a.XI],v.prototype,"apiLoadMore",null),p([a.XI],v.prototype,"apiPost",null),p([a.XI],v.prototype,"apiRestore",null),p([a.XI],v.prototype,"apiSetSort",null),p([a.XI],v.prototype,"apiToggleFollow",null),p([a.XI],v.prototype,"apiTogglePin",null),p([a.XI],v.prototype,"apiToggleVote",null),p([a.XI],v.prototype,"loadBundle",null),p([a.XI],v.prototype,"stateFromJson",null),p([a.XI],v.prototype,"stateStore",null)},6646:(e,t,s)=>{s.d(t,{A:()=>E});var r=s(1370),i=s(9207),a=s(6823),n=s(6540),o=s(7634),l=s(256),c=s(1883),u=s(1836),d=s(4809),p=s(4691),m=s(4885),h=s(6338),b=function(e,t,s,r){var i,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(n=(a<3?i(n):a>3?i(t,s,n):i(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n};let f=class extends n.Component{constructor(){super(...arguments),Object.defineProperty(this,"handleChange",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var t;this.props.controller.apiSetSort(null!==(t=e.currentTarget.dataset.value)&&void 0!==t?t:"")}})}render(){var e;return n.createElement(h.F,{currentValue:null!==(e=this.props.controller.nextState.sort)&&void 0!==e?e:this.props.controller.state.sort,modifiers:this.props.modifiers,onChange:this.handleChange,values:["new","old","top"]})}};f=b([r.PA],f);const v=f;var g=s(4606),y=s(8623),w=function(e,t,s,r){var i,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(n=(a<3?i(n):a>3?i(t,s,n):i(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n};let _=class extends n.Component{constructor(e){super(e),Object.defineProperty(this,"controller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onToggleFollow",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.controller.apiToggleFollow()}}),this.controller=new m.A(this.props.controllerStateSelector,this.props.baseCommentableMeta)}componentWillUnmount(){this.controller.destroy()}render(){const e=this.controller.topLevelComments,t=e.filter((e=>!e.pinned)),s=this.controller.pinnedComments;return n.createElement("div",{className:(0,o.Zt)("comments",this.props.modifiers),id:"comments"},n.createElement("h2",{className:"comments__title"},(0,c.pw)("comments.title"),n.createElement("span",{className:"comments__count"},(0,l.ZV)(this.controller.state.total))),s.length>0&&n.createElement("div",{className:"comments__items comments__items--pinned"},this.renderComments(s,!0)),n.createElement("div",{className:"comments__new"},n.createElement(d.A,{commentableMeta:this.controller.commentableMeta,controller:this.controller,focus:!1,modifiers:this.props.modifiers})),n.createElement("div",{className:"comments__items comments__items--toolbar"},n.createElement(v,{controller:this.controller,modifiers:this.props.modifiers}),n.createElement("div",{className:(0,o.Zt)("sort",this.props.modifiers)},n.createElement("div",{className:"sort__items"},this.renderFollowToggle(),this.renderShowDeletedToggle()))),0===t.length?n.createElement("div",{className:"comments__items comments__items--empty"},0===s.length?(0,c.pw)("comments.empty"):(0,c.pw)("comments.empty_other")):n.createElement("div",{className:(0,o.Zt)("comments__items",{loading:null!=this.controller.nextState.sort})},this.renderComments(t,!1),n.createElement(g.A,{comments:e,modifiers:"top"}),n.createElement(p.A,{comments:e,controller:this.controller,modifiers:(0,o.hL)("top",this.props.modifiers),top:!0,total:this.controller.state.topLevelCount})))}onToggleShowDeleted(){a.A.userPreferences.set("comments_show_deleted",!a.A.userPreferences.get("comments_show_deleted"))}renderComment(e,t){return n.createElement(u.A,{key:e.id,comment:e,controller:this.controller,depth:0,expandReplies:t,modifiers:this.props.modifiers})}renderComments(e,t){const s=!t&&void 0;return e.map((e=>this.renderComment(e,s)))}renderFollowToggle(){let e,t;return null!=this.controller.nextState.isFollowing&&(e=n.createElement(y.y,{modifiers:"center-inline"})),this.controller.state.isFollowing?(null!=e||(e=n.createElement("span",{className:"fas fa-eye-slash"})),t=(0,c.pw)("common.buttons.watch.to_0")):(null!=e||(e=n.createElement("span",{className:"fas fa-eye"})),t=(0,c.pw)("common.buttons.watch.to_1")),n.createElement("button",{className:"sort__item sort__item--button",disabled:null!=this.controller.nextState.isFollowing,onClick:this.onToggleFollow,type:"button"},n.createElement("span",{className:"sort__item-icon"},e),t)}renderShowDeletedToggle(){if(!(0,i.C)())return null;const e=a.A.userPreferences.get("comments_show_deleted")?"fas fa-check-square":"far fa-square";return n.createElement("button",{className:"sort__item sort__item--button",onClick:this.onToggleShowDeleted,type:"button"},n.createElement("span",{className:"sort__item-icon"},n.createElement("span",{className:e})),(0,c.pw)("common.buttons.show_deleted"))}};_=w([r.PA],_);const E=_},4606:(e,t,s)=>{s.d(t,{A:()=>o});var r=s(9207),i=s(6540),a=s(7634),n=s(1883);class o extends i.Component{render(){if(!(0,r.C)())return null;const e=this.props.comments.filter((e=>null!=e.deletedAt)).length;return 0===e?null:i.createElement("div",{className:(0,a.Zt)("deleted-comments-count",this.props.modifiers)},i.createElement("span",{className:"deleted-comments-count__icon"},i.createElement("span",{className:"far fa-trash-alt"})),(0,n.Mq)("comments.deleted_count",e))}}},3887:(e,t,s)=>{s.d(t,{A:()=>o});var r=s(6540),i=s(8243),a=s(7634),n=s(256);function o(e){return r.createElement("div",{className:(0,a.Zt)("difficulty-badge",{"expert-plus":e.rating>=6.5}),style:{"--bg":(0,i.ID)(e.rating)}},r.createElement("span",{className:"difficulty-badge__icon"},r.createElement("span",{className:"fas fa-star"})),r.createElement("span",{className:"difficulty-badge__rating"},(0,n.ZV)(e.rating,2)))}},7131:(e,t,s)=>{s.d(t,{A:()=>n});var r=s(2543),i=s(6540),a=s(7634);function n(e){const t=Math.max(0,e.current),s=Math.max(1,e.total);return i.createElement("div",{className:(0,a.Zt)("discrete-bar",e.modifiers)},(0,r.times)(s,(s=>i.createElement("div",{key:s,className:(0,a.Zt)("discrete-bar__item",{on:s<t})},e.label))))}},8789:(e,t,s)=>{s.d(t,{A:()=>n});var r=s(6540),i=s(7634);const a=e=>`/assets/images/flags/${e.split("").map((e=>(e.charCodeAt(0)+127397).toString(16))).join("-")}.svg`;function n({country:e,modifiers:t}){return null==e||null==e.code?null:r.createElement("span",{className:(0,i.Zt)("flag-country",t),style:{backgroundImage:`url('${a(e.code)}')`},title:e.name})}},2980:(e,t,s)=>{s.d(t,{A:()=>h});var r=s(9981),i=s(7813),a=s(1370),n=s(6823),o=s(6540),l=s(7634),c=s(2599),u=s(8623),d=s(4692),p=function(e,t,s,r){var i,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(n=(a<3?i(n):a>3?i(t,s,n):i(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n};let m=class extends o.PureComponent{get following(){return"mapping"===this.props.follow.subtype?n.A.currentUserModel.followUserMapping.has(this.props.follow.notifiable_id):this._following}get jsonId(){return`json-follow-toggle-${this.props.follow.subtype}-${this.props.follow.notifiable_type}-${this.props.follow.notifiable_id}`}get toggling(){return null!=this.xhr}constructor(e){var t,s;super(e),Object.defineProperty(this,"_following",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"xhr",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onClick",{enumerable:!0,configurable:!0,writable:!0,value:()=>{if(null!=this.xhr)return;const e={data:{follow:{notifiable_id:this.props.follow.notifiable_id,notifiable_type:this.props.follow.notifiable_type,subtype:this.props.follow.subtype}},method:this.following?"DELETE":"POST"};this.xhr=d.ajax((0,r.w)("follows.store"),e).done((0,i.XI)((()=>{"mapping"===this.props.follow.subtype?n.A.currentUserModel.updateFollowUserMapping(!this.following,this.props.follow.notifiable_id):(this._following=!this.following,(0,c.Qv)(this.jsonId,{following:this.following}))}))).always((0,i.XI)((()=>{this.xhr=void 0})))}}),(0,i.Gn)(this),this._following=null===(s=null===(t=(0,c.Do)(this.jsonId,!0))||void 0===t?void 0:t.following)||void 0===s||s}render(){return o.createElement("button",{className:(0,l.Zt)("btn-circle",this.props.modifiers),disabled:this.toggling,onClick:this.onClick,type:"button"},o.createElement("span",{className:"btn-circle__content"},this.renderToggleIcon()))}renderToggleIcon(){if(this.toggling)return o.createElement("span",{className:"btn-circle__icon"},o.createElement(u.y,null));let e,t;return this.following?(t="fas fa-bell",e="fas fa-bell-slash"):(t="far fa-bell",e="fas fa-bell"),o.createElement(o.Fragment,null,o.createElement("span",{className:"btn-circle__icon btn-circle__icon--hover-show"},o.createElement("span",{className:e})),o.createElement("span",{className:"btn-circle__icon btn-circle__icon--hover-hide"},o.createElement("span",{className:t})))}};p([i.sH],m.prototype,"_following",void 0),p([i.sH],m.prototype,"xhr",void 0),p([i.XI],m.prototype,"onClick",void 0),m=p([a.PA],m);const h=m},2175:(e,t,s)=>{s.d(t,{A:()=>v});var r=s(9981),i=s(7813),a=s(1370),n=s(6823),o=s(6540),l=s(6407),c=s(7634),u=s(256),d=s(1883),p=s(8623),m=s(4692),h=function(e,t,s,r){var i,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(n=(a<3?i(n):a>3?i(t,s,n):i(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n};const b="user-action-button";let f=class extends o.Component{get following(){return n.A.currentUserModel.followUserMapping.has(this.props.userId)}get followerCount(){return this.followerCountWithoutSelf+(this.following?1:0)}get loading(){return null!=this.xhr}constructor(e){var t;super(e),Object.defineProperty(this,"buttonRef",{enumerable:!0,configurable:!0,writable:!0,value:o.createRef()}),Object.defineProperty(this,"followerCountWithoutSelf",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"xhr",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onClick",{enumerable:!0,configurable:!0,writable:!0,value:()=>{const e={data:{follow:{notifiable_id:this.props.userId,notifiable_type:"user",subtype:"mapping"}}};this.following?(e.type="DELETE",e.url=(0,r.w)("follows.destroy")):(e.type="POST",e.url=(0,r.w)("follows.store")),this.xhr=m.ajax(e).done(this.updateData).fail((0,l.uR)(this.buttonRef.current)).always((0,i.XI)((()=>this.xhr=void 0)))}}),Object.defineProperty(this,"updateData",{enumerable:!0,configurable:!0,writable:!0,value:()=>{n.A.currentUserModel.updateFollowUserMapping(!this.following,this.props.userId)}}),(0,i.Gn)(this),this.props.showFollowerCounter&&(this.followerCountWithoutSelf=null!==(t=this.props.followers)&&void 0!==t?t:0,this.following&&(this.followerCountWithoutSelf-=1))}componentWillUnmount(){var e;null===(e=this.xhr)||void 0===e||e.abort()}render(){const e=!(null==n.A.currentUser||n.A.currentUser.id===this.props.userId);if(!e&&!this.props.alwaysVisible)return null;const t=e?(0,d.pw)("follows.mapping."+(this.following?"to_0":"to_1")):(0,d.pw)("follows.mapping.followers"),s=(0,c.Zt)(b,this.props.modifiers,{friend:this.following}),r=this.loading||!e;return o.createElement("div",{title:t},o.createElement("button",{ref:this.buttonRef,className:s,disabled:r,onClick:this.onClick},this.renderIcon(),this.renderCounter()))}renderCounter(){if(null!=this.props.showFollowerCounter&&null!=this.props.followers)return o.createElement("span",{className:`${b}__counter`},(0,u.ZV)(this.followerCount))}renderIcon(){const e=this.loading?o.createElement(p.y,null):o.createElement("i",{className:"fas fa-bell"});return o.createElement("span",{className:`${b}__icon-container`},e)}};h([i.sH],f.prototype,"xhr",void 0),h([i.EW],f.prototype,"followerCount",null),h([i.XI],f.prototype,"onClick",void 0),h([i.XI],f.prototype,"updateData",void 0),f=h([a.PA],f);const v=f},1864:(e,t,s)=>{s.d(t,{A:()=>o});var r=s(9981),i=s(6540),a=s(7634),n=s(1883);function o(e){return i.createElement("div",{className:"page-tabs page-tabs--follows"},["comment","forum_topic","mapping","modding"].map((t=>i.createElement("a",{key:t,className:(0,a.Zt)("page-tabs__tab",{active:t===e.currentSubtype}),href:(0,r.w)("follows.index",{subtype:t})},(0,n.pw)(`follows.${t}.title`)))))}},4617:(e,t,s)=>{s.d(t,{A:()=>y});var r=s(2097),i=s(7035),a=s(9981),n=s(7813),o=s(1370),l=s(6823),c=s(6540),u=s(6407),d=s(7634),p=s(256),m=s(1883),h=s(8623),b=s(4692),f=function(e,t,s,r){var i,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(n=(a<3?i(n):a>3?i(t,s,n):i(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n};const v="user-action-button";let g=class extends c.Component{get followers(){return this.followersWithoutSelf+(null==this.friend?0:1)}get friend(){return l.A.currentUserModel.friends.get(this.props.userId)}get isFriendLimit(){return null==l.A.currentUser||l.A.currentUser.friends.length>=l.A.currentUser.max_friends}get isVisible(){return null!=l.A.currentUser&&Number.isFinite(this.props.userId)&&this.props.userId!==l.A.currentUser.id&&!l.A.currentUser.blocks.some((e=>e.target_id===this.props.userId))}get loading(){return null!=this.xhr}get showFollowerCounter(){return null!=this.props.followers}get title(){return this.isVisible?null!=this.friend?(0,m.pw)("friends.buttons.remove"):this.isFriendLimit?(0,m.pw)("friends.too_many"):(0,m.pw)("friends.buttons.add"):(0,m.pw)("friends.buttons.disabled")}constructor(e){var t;super(e),Object.defineProperty(this,"followersWithoutSelf",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"xhr",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clicked",{enumerable:!0,configurable:!0,writable:!0,value:()=>{null==this.xhr&&(this.xhr=null==this.friend?b.ajax((0,a.w)("friends.store",{target:this.props.userId}),{type:"POST"}):b.ajax((0,a.w)("friends.destroy",{friend:this.props.userId}),{type:"DELETE"}),this.xhr.done(this.updateFriends).fail((0,u.dI)(this.clicked)).always((0,n.XI)((()=>this.xhr=void 0))))}}),Object.defineProperty(this,"updateFriends",{enumerable:!0,configurable:!0,writable:!0,value:e=>{null!=l.A.currentUser&&(l.A.currentUser.friends=e,(0,i.JD)(new r.A(this.props.userId)))}}),this.followersWithoutSelf=null!==(t=this.props.followers)&&void 0!==t?t:0,(0,n.Gn)(this),(0,n.h5)((()=>{null!=this.friend&&(this.followersWithoutSelf-=1)}))}componentWillUnmount(){var e;null===(e=this.xhr)||void 0===e||e.abort()}render(){if(!this.props.alwaysVisible&&!this.isVisible)return null;const e=null==this.friend||this.loading?null:this.friend.mutual?"mutual":"friend",t=(0,d.Zt)(v,this.props.modifiers,e),s=!this.isVisible||this.loading||this.isFriendLimit&&null==this.friend;return c.createElement("div",{title:this.title},c.createElement("button",{className:t,disabled:s,onClick:this.clicked,type:"button"},c.createElement("span",{className:`${v}__icon-container`},this.renderIcon()),this.renderCounter()))}renderCounter(){if(this.showFollowerCounter)return c.createElement("span",{className:`${v}__counter`},(0,p.ZV)(this.followers))}renderIcon(){return this.loading?c.createElement(h.y,null):this.isVisible?null!=this.friend?c.createElement(c.Fragment,null,c.createElement("span",{className:`${v}__icon ${v}__icon--hover-visible`},c.createElement("span",{className:"fas fa-user-times"})),this.friend.mutual?c.createElement("span",{className:`${v}__icon ${v}__icon--hover-hidden`},c.createElement("span",{className:"fas fa-user-friends"})):c.createElement("span",{className:`${v}__icon ${v}__icon--hover-hidden`},c.createElement("span",{className:"fas fa-user"}))):c.createElement("span",{className:this.isFriendLimit?"fas fa-user":"fas fa-user-plus"}):c.createElement("span",{className:"fas fa-user"})}};Object.defineProperty(g,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{alwaysVisible:!1}}),f([n.sH],g.prototype,"followersWithoutSelf",void 0),f([n.sH],g.prototype,"xhr",void 0),f([n.EW],g.prototype,"followers",null),f([n.EW],g.prototype,"friend",null),f([n.EW],g.prototype,"isFriendLimit",null),f([n.EW],g.prototype,"isVisible",null),f([n.EW],g.prototype,"title",null),f([n.XI],g.prototype,"clicked",void 0),f([n.XI],g.prototype,"updateFriends",void 0),g=f([o.PA],g);const y=g},3398:(e,t,s)=>{s.d(t,{A:()=>p});var r=s(6823),i=s(6540),a=s(7634),n=s(2599),o=s(1883),l=s(5812),c=s(4692);const u={actionKey:{"forum.topic_watches_controller.index":"main.home_controller.index","main.account_controller.edit":"main.home_controller.index","main.beatmapset_watches_controller.index":"main.home_controller.index","main.follows_controller.index":"main.home_controller.index","main.friends_controller.index":"main.home_controller.index"},controllerKey:{"main.artist_tracks_controller._":"main.artists_controller._","main.store_controller._":"store._","multiplayer.rooms_controller._":"main.ranking_controller._"},namespaceKey:{"admin_forum._":"admin._"}};class d extends i.Component{constructor(){super(...arguments),Object.defineProperty(this,"cancelSyncHeight",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}componentDidMount(){this.cancelSyncHeight=r.A.reactTurbolinks.runAfterPageLoad((()=>{c.publish("sync-height:force")}))}componentWillUnmount(){var e;null===(e=this.cancelSyncHeight)||void 0===e||e.call(this)}render(){const e=(0,a.Zt)("header-v4",(0,l.I)(this.props.theme),this.props.modifiers);return i.createElement("div",{className:e},i.createElement("div",{className:"header-v4__container header-v4__container--main"},i.createElement("div",{className:"header-v4__bg-container"},i.createElement("div",{className:"header-v4__bg",style:{backgroundImage:(0,a.NZ)(this.props.backgroundImage)}})),i.createElement("div",{className:"hidden-xs js-sync-height--target","data-sync-height-id":"notification-banners"}),i.createElement("div",{className:"header-v4__content"},this.props.contentPrepend,i.createElement("div",{className:"header-v4__row header-v4__row--title"},i.createElement("div",{className:"header-v4__icon"}),i.createElement("div",{className:"header-v4__title"},this.title())),this.props.contentAppend)),this.props.links.length>0&&i.createElement("div",{className:"header-v4__container"},i.createElement("div",{className:"header-v4__content"},i.createElement("div",{className:"header-v4__row header-v4__row--bar"},this.renderLinks(),this.renderLinksMobile(),this.props.linksAppend))))}renderLinks(){const e=this.props.links.map((e=>{const t=[];return e.active&&t.push("active"),i.createElement("li",{key:`${e.url}-${e.title}`,className:"header-nav-v4__item"},i.createElement("a",Object.assign({className:(0,a.Zt)("header-nav-v4__link",t),href:e.url,onClick:this.props.onLinkClick},e.data),i.createElement("span",{className:"fake-bold","data-content":e.title},e.title)))})),t=this.props.linksBreadcrumb?"ol":"ul",s=[];return s.push(this.props.linksBreadcrumb?"breadcrumb":"list"),i.createElement(t,{className:(0,a.Zt)("header-nav-v4",s)},e)}renderLinksMobile(){if(this.props.linksBreadcrumb)return null;if(0===this.props.links.length)return null;let e=this.props.links[0];const t=this.props.links.map((t=>{const s=[];return t.active&&(s.push("active"),e=t),i.createElement("li",{key:`${t.url}-${t.title}`},i.createElement("a",Object.assign({className:"header-nav-mobile__item js-click-menu--close",href:t.url,onClick:this.props.onLinkClick},t.data),t.title))}));return i.createElement("div",{className:"header-nav-mobile"},i.createElement("a",{className:"header-nav-mobile__toggle js-click-menu","data-click-menu-target":"header-nav-mobile",href:e.url},e.title,i.createElement("span",{className:"header-nav-mobile__toggle-icon"},i.createElement("span",{className:"fas fa-chevron-down"}))),i.createElement("ul",{className:"header-nav-mobile__menu js-click-menu","data-click-menu-id":"header-nav-mobile","data-visibility":"hidden"},t))}title(){var e,t,s;const r=(0,n.qF)("json-route-section");let i=`${r.namespace}.${r.controller}.${r.action}`;i=null!==(e=u.actionKey[i])&&void 0!==e?e:i;let a=`${r.namespace}.${r.controller}._`;a=null!==(t=u.controllerKey[a])&&void 0!==t?t:a;let l=`${r.namespace}._`;l=null!==(s=u.namespaceKey[l])&&void 0!==s?s:l;const c=[`page_title.${i}`,`page_title.${a}`,`page_title.${l}`];for(const n of c)if((0,o.fP)(n,fallbackLocale))return(0,o.pw)(n);return"unknown"}}Object.defineProperty(d,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{links:[],linksBreadcrumb:!1}});const p=d},5191:(e,t,s)=>{s.d(t,{A:()=>n});var r=s(6540),i=s(256),a=function(e,t){var s={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(s[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(s[r[i]]=e[r[i]])}return s};function n(e){const{className:t="",src2x:s}=e,n=a(e,["className","src2x"]);return null==n.src?r.createElement("img",Object.assign({},n,{className:`${t} u-hidden`})):r.createElement("img",Object.assign({className:t,srcSet:`${n.src} 1x, ${null!=s?s:(0,i.b5)(n.src)} 2x`},n))}},9058:(e,t,s)=>{s.d(t,{A:()=>l});var r=s(1370),i=s(6540),a=s(7634),n=s(1883),o=s(4403);const l=(0,r.PA)((e=>{const t=e.hasError&&e.showError;return i.createElement("label",{className:(0,a.Zt)("input-container",{error:t},e.modifiers),htmlFor:e.for},null!=e.labelKey&&i.createElement("div",{className:"input-container__label"},(0,n.pw)(e.labelKey),null!=e.maxLength&&i.createElement(o.A,{maxLength:e.maxLength,message:e.input})),e.children)}))},963:(e,t,s)=>{s.d(t,{A:()=>r});const r=(0,s(6540).createContext)(null)},6591:(e,t,s)=>{s.d(t,{A:()=>p});var r=s(8623),i=s(7813),a=s(1370),n=s(6540),o=s(7634),l=s(1883),c=s(963),u=function(e,t,s,r){var i,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(n=(a<3?i(n):a>3?i(t,s,n):i(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n};let d=class extends n.Component{get ready(){var e,t;return this.hasUpdated||this.skipLazyLoad||this.loaded&&!(null!==(t=null===(e=this.context)||void 0===e?void 0:e.scrolling)&&void 0!==t&&t)}constructor(e){var t;super(e),Object.defineProperty(this,"error",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"hasUpdated",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"loaded",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"observer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ref",{enumerable:!0,configurable:!0,writable:!0,value:n.createRef()}),Object.defineProperty(this,"skipLazyLoad",{enumerable:!0,configurable:!0,writable:!0,value:null!==(t=this.props.hasData)&&void 0!==t&&t}),Object.defineProperty(this,"load",{enumerable:!0,configurable:!0,writable:!0,value:()=>{var e;this.error=!1,null===(e=this.observer)||void 0===e||e.disconnect(),this.props.onLoad().then((0,i.XI)((()=>{this.loaded=!0,this.error=!1}))).catch((0,i.XI)((()=>this.error=!0)))}}),this.loaded=this.skipLazyLoad,this.skipLazyLoad||(this.observer=new IntersectionObserver((e=>{e.some((e=>e.isIntersecting))&&this.load()}),{rootMargin:"400px 0px 400px 0px"})),(0,i.Gn)(this)}componentDidMount(){var e;this.skipLazyLoad||null==this.ref.current||null===(e=this.observer)||void 0===e||e.observe(this.ref.current)}componentDidUpdate(e,t,s){if(!this.hasUpdated&&!this.skipLazyLoad&&this.loaded&&null!=s){if(null==this.context)throw new Error("LazyLoadContext is missing.");this.hasUpdated=!0,this.context.done(this.props.name,s)}}componentWillUnmount(){var e;null===(e=this.observer)||void 0===e||e.disconnect()}getSnapshotBeforeUpdate(){var e,t;return null!==(t=null===(e=this.context)||void 0===e?void 0:e.getSnapshot(this.props.name))&&void 0!==t?t:null}render(){return n.createElement("div",{ref:this.ref,className:(0,o.Zt)("lazy-load",{loading:!this.ready})},this.ready?this.renderLoaded():this.renderNotLoaded())}renderLoaded(){if(!this.skipLazyLoad&&null==this.context)throw new Error("LazyLoadContext is missing.");return this.props.children}renderNotLoaded(){return this.error?n.createElement("div",{className:"lazy-load__error"},n.createElement("p",null,(0,l.pw)("errors.load_failed")),n.createElement("div",{className:"lazy-load__button"},n.createElement("button",{className:"btn-osu-big btn-osu-big--rounded-thin",onClick:this.load,type:"button"},(0,l.pw)("common.buttons.retry")))):n.createElement(r.y,null)}};Object.defineProperty(d,"contextType",{enumerable:!0,configurable:!0,writable:!0,value:c.A}),u([i.sH],d.prototype,"error",void 0),u([i.sH],d.prototype,"loaded",void 0),u([i.sH],d.prototype,"skipLazyLoad",void 0),u([i.EW],d.prototype,"ready",null),u([i.XI],d.prototype,"load",void 0),d=u([a.PA],d);const p=d},4403:(e,t,s)=>{s.d(t,{A:()=>n});var r=s(6540),i=s(7634);function a(e,t){return e.length>t?"over":e.length>.95*t?"almost-over":null}function n({maxLength:e,message:t,modifiers:s}){return r.createElement("div",{className:(0,i.Zt)("message-length-counter",a(t,e),s)},`${t.length} / ${e}`)}},1808:(e,t,s)=>{s.d(t,{A:()=>c});const r=JSON.parse('{"EZ":{"acronym":"EZ","name":"Easy","setting_labels":{"retries":"Extra Lives"},"type":"DifficultyReduction"},"NF":{"acronym":"NF","name":"No Fail","setting_labels":{},"type":"DifficultyReduction"},"HT":{"acronym":"HT","name":"Half Time","setting_labels":{"speed_change":"Speed decrease","adjust_pitch":"Adjust pitch"},"type":"DifficultyReduction"},"DC":{"acronym":"DC","name":"Daycore","setting_labels":{"speed_change":"Speed decrease"},"type":"DifficultyReduction"},"HR":{"acronym":"HR","name":"Hard Rock","setting_labels":{},"type":"DifficultyIncrease"},"SD":{"acronym":"SD","name":"Sudden Death","setting_labels":{"restart":"Restart on fail"},"type":"DifficultyIncrease"},"PF":{"acronym":"PF","name":"Perfect","setting_labels":{"restart":"Restart on fail"},"type":"DifficultyIncrease"},"DT":{"acronym":"DT","name":"Double Time","setting_labels":{"speed_change":"Speed increase","adjust_pitch":"Adjust pitch"},"type":"DifficultyIncrease"},"NC":{"acronym":"NC","name":"Nightcore","setting_labels":{"speed_change":"Speed increase"},"type":"DifficultyIncrease"},"HD":{"acronym":"HD","name":"Hidden","setting_labels":{"only_fade_approach_circles":"Only fade approach circles"},"type":"DifficultyIncrease"},"FL":{"acronym":"FL","name":"Flashlight","setting_labels":{"follow_delay":"Follow delay","size_multiplier":"Flashlight size","combo_based_size":"Change size based on combo"},"type":"DifficultyIncrease"},"BL":{"acronym":"BL","name":"Blinds","setting_labels":{},"type":"DifficultyIncrease"},"ST":{"acronym":"ST","name":"Strict Tracking","setting_labels":{},"type":"DifficultyIncrease"},"AC":{"acronym":"AC","name":"Accuracy Challenge","setting_labels":{"minimum_accuracy":"Minimum accuracy","accuracy_judge_mode":"Accuracy mode","restart":"Restart on fail"},"type":"DifficultyIncrease"},"TP":{"acronym":"TP","name":"Target Practice","setting_labels":{"seed":"Seed","metronome":"Metronome ticks"},"type":"Conversion"},"DA":{"acronym":"DA","name":"Difficulty Adjust","setting_labels":{"circle_size":"Circle Size","approach_rate":"Approach Rate","drain_rate":"HP Drain","overall_difficulty":"Accuracy","extended_limits":"Extended Limits","scroll_speed":"Scroll Speed","hard_rock_offsets":"Spicy Patterns"},"type":"Conversion"},"CL":{"acronym":"CL","name":"Classic","setting_labels":{"no_slider_head_accuracy":"No slider head accuracy requirement","classic_note_lock":"Apply classic note lock","always_play_tail_sample":"Always play a slider\'s tail sample","fade_hit_circle_early":"Fade out hit circles earlier","classic_health":"Classic health"},"type":"Conversion"},"RD":{"acronym":"RD","name":"Random","setting_labels":{"angle_sharpness":"Angle sharpness","seed":"Seed"},"type":"Conversion"},"MR":{"acronym":"MR","name":"Mirror","setting_labels":{"reflection":"Mirrored axes"},"type":"Conversion"},"AL":{"acronym":"AL","name":"Alternate","setting_labels":{},"type":"Conversion"},"SG":{"acronym":"SG","name":"Single Tap","setting_labels":{},"type":"Conversion"},"AT":{"acronym":"AT","name":"Autoplay","setting_labels":{},"type":"Automation"},"CN":{"acronym":"CN","name":"Cinema","setting_labels":{},"type":"Automation"},"RX":{"acronym":"RX","name":"Relax","setting_labels":{},"type":"Automation"},"AP":{"acronym":"AP","name":"Autopilot","setting_labels":{},"type":"Automation"},"SO":{"acronym":"SO","name":"Spun Out","setting_labels":{},"type":"Automation"},"TR":{"acronym":"TR","name":"Transform","setting_labels":{},"type":"Fun"},"WG":{"acronym":"WG","name":"Wiggle","setting_labels":{"strength":"Strength"},"type":"Fun"},"SI":{"acronym":"SI","name":"Spin In","setting_labels":{},"type":"Fun"},"GR":{"acronym":"GR","name":"Grow","setting_labels":{"start_scale":"Starting Size"},"type":"Fun"},"DF":{"acronym":"DF","name":"Deflate","setting_labels":{"start_scale":"Starting Size"},"type":"Fun"},"WU":{"acronym":"WU","name":"Wind Up","setting_labels":{"initial_rate":"Initial rate","final_rate":"Final rate","adjust_pitch":"Adjust pitch"},"type":"Fun"},"WD":{"acronym":"WD","name":"Wind Down","setting_labels":{"initial_rate":"Initial rate","final_rate":"Final rate","adjust_pitch":"Adjust pitch"},"type":"Fun"},"TC":{"acronym":"TC","name":"Traceable","setting_labels":{},"type":"Fun"},"BR":{"acronym":"BR","name":"Barrel Roll","setting_labels":{"spin_speed":"Roll speed","direction":"Direction"},"type":"Fun"},"AD":{"acronym":"AD","name":"Approach Different","setting_labels":{"scale":"Initial size","style":"Style"},"type":"Fun"},"MU":{"acronym":"MU","name":"Muted","setting_labels":{"inverse_muting":"Start muted","enable_metronome":"Enable metronome","mute_combo_count":"Final volume at combo","affects_hit_sounds":"Mute hit sounds"},"type":"Fun"},"NS":{"acronym":"NS","name":"No Scope","setting_labels":{"hidden_combo_count":"Hidden at combo"},"type":"Fun"},"MG":{"acronym":"MG","name":"Magnetised","setting_labels":{"attraction_strength":"Attraction strength"},"type":"Fun"},"RP":{"acronym":"RP","name":"Repel","setting_labels":{"repulsion_strength":"Repulsion strength"},"type":"Fun"},"AS":{"acronym":"AS","name":"Adaptive Speed","setting_labels":{"initial_rate":"Initial rate","adjust_pitch":"Adjust pitch"},"type":"Fun"},"FR":{"acronym":"FR","name":"Freeze Frame","setting_labels":{},"type":"Fun"},"BU":{"acronym":"BU","name":"Bubbles","setting_labels":{},"type":"Fun"},"SY":{"acronym":"SY","name":"Synesthesia","setting_labels":{},"type":"Fun"},"DP":{"acronym":"DP","name":"Depth","setting_labels":{"max_depth":"Maximum depth","show_approach_circles":"Show Approach Circles"},"type":"Fun"},"TD":{"acronym":"TD","name":"Touch Device","setting_labels":{},"type":"System"},"SV2":{"acronym":"SV2","name":"Score V2","setting_labels":{},"type":"System"},"SW":{"acronym":"SW","name":"Swap","setting_labels":{},"type":"Conversion"},"CS":{"acronym":"CS","name":"Constant Speed","setting_labels":{},"type":"Conversion"},"FF":{"acronym":"FF","name":"Floating Fruits","setting_labels":{},"type":"Fun"},"NR":{"acronym":"NR","name":"No Release","setting_labels":{},"type":"DifficultyReduction"},"FI":{"acronym":"FI","name":"Fade In","setting_labels":{},"type":"DifficultyIncrease"},"CO":{"acronym":"CO","name":"Cover","setting_labels":{"coverage":"Coverage","direction":"Direction"},"type":"DifficultyIncrease"},"DS":{"acronym":"DS","name":"Dual Stages","setting_labels":{},"type":"Conversion"},"IN":{"acronym":"IN","name":"Invert","setting_labels":{},"type":"Conversion"},"HO":{"acronym":"HO","name":"Hold Off","setting_labels":{},"type":"Conversion"},"1K":{"acronym":"1K","name":"One Key","setting_labels":{},"type":"Conversion"},"2K":{"acronym":"2K","name":"Two Keys","setting_labels":{},"type":"Conversion"},"3K":{"acronym":"3K","name":"Three Keys","setting_labels":{},"type":"Conversion"},"4K":{"acronym":"4K","name":"Four Keys","setting_labels":{},"type":"Conversion"},"5K":{"acronym":"5K","name":"Five Keys","setting_labels":{},"type":"Conversion"},"6K":{"acronym":"6K","name":"Six Keys","setting_labels":{},"type":"Conversion"},"7K":{"acronym":"7K","name":"Seven Keys","setting_labels":{},"type":"Conversion"},"8K":{"acronym":"8K","name":"Eight Keys","setting_labels":{},"type":"Conversion"},"9K":{"acronym":"9K","name":"Nine Keys","setting_labels":{},"type":"Conversion"},"10K":{"acronym":"10K","name":"Ten Keys","setting_labels":{},"type":"Conversion"},"V2":{"acronym":"V2","name":"Score V2","setting_labels":{},"type":"Conversion"},"NM":{"acronym":"NM","name":"No Mod","setting_labels":{},"type":"Conversion"}}');var i=s(6540),a=s(7634);const n=new Intl.NumberFormat("en");function o(e){return"boolean"==typeof e?e?"on":"off":"number"==typeof e?n.format(e):String(e)}function l(e,t){var s;const r=[];for(const[i,a]of Object.entries(null!==(s=t.settings)&&void 0!==s?s:{}))if("speed_change"===i)r.push(`${o(a)}×`);else{const t=e.setting_labels[i];null!=t&&r.push(`${t}: ${o(a)}`)}return 0===r.length?"":` (${r.join(", ")})`}function c({mod:e}){var t;const s=null!==(t=r[e.acronym])&&void 0!==t?t:{acronym:e.acronym,name:"",setting_labels:{},type:"Fun"};return i.createElement("div",{className:(0,a.Zt)("mod",s.acronym,`type-${s.type}`),"data-acronym":s.acronym,title:`${s.name}${l(s,e)}`})}},6131:(e,t,s)=>{s.d(t,{A:()=>c,o:()=>o});var r=s(6540),i=s(3368),a=s(8156),n=s(4692);const o=()=>0!==l.size,l=new Set;class c extends r.PureComponent{constructor(){super(...arguments),Object.defineProperty(this,"clickEndTarget",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clickStartTarget",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ref",{enumerable:!0,configurable:!0,writable:!0,value:r.createRef()}),Object.defineProperty(this,"close",{enumerable:!0,configurable:!0,writable:!0,value:()=>{l.delete(this),(0,i.Q)(this,!1)}}),Object.defineProperty(this,"handleBeforeCache",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.close()}}),Object.defineProperty(this,"handleEsc",{enumerable:!0,configurable:!0,writable:!0,value:e=>{null!=this.props.onClose&&"Escape"===e.key&&this.props.onClose()}}),Object.defineProperty(this,"handleMouseDown",{enumerable:!0,configurable:!0,writable:!0,value:e=>{this.clickStartTarget=e.target}}),Object.defineProperty(this,"handleMouseUp",{enumerable:!0,configurable:!0,writable:!0,value:e=>{this.clickEndTarget=e.target}}),Object.defineProperty(this,"hideModal",{enumerable:!0,configurable:!0,writable:!0,value:e=>{null!=this.props.onClose&&0===e.button&&e.target===this.ref.current&&this.clickEndTarget===this.clickStartTarget&&this.props.onClose()}}),Object.defineProperty(this,"open",{enumerable:!0,configurable:!0,writable:!0,value:()=>{l.add(this),(0,i.Q)(this,!0)}})}componentDidMount(){document.addEventListener("keydown",this.handleEsc),n(document).on("turbolinks:before-cache",this.handleBeforeCache),this.open()}componentWillUnmount(){this.close(),document.removeEventListener("keydown",this.handleEsc),n(document).off("turbolinks:before-cache",this.handleBeforeCache)}render(){return r.createElement(a.A,null,r.createElement("div",{ref:this.ref,className:"js-react-modal",onClick:this.hideModal,onMouseDown:this.handleMouseDown,onMouseUp:this.handleMouseUp},this.props.children))}}},2513:(e,t,s)=>{s.d(t,{A:()=>o});var r=s(9981),i=s(6540),a=s(1883),n=s(3398);function o(e){const t=[{active:"index"===e.section,title:(0,a.pw)("news.index.title.info"),url:(0,r.w)("news.index")}];return"show"===e.section&&null!=e.post&&t.push({active:!0,title:e.post.title,url:(0,r.w)("news.show",{news:e.post.slug})}),i.createElement(n.A,{links:t,linksBreadcrumb:!0,theme:"news"})}},5472:(e,t,s)=>{s.d(t,{A:()=>o});var r=s(6540),i=s(8156),a=s(4692);const n="notification-banner-v2";class o extends r.PureComponent{constructor(e){var t;super(e),Object.defineProperty(this,"portalRoot",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const s=(null!==(t=window.newBody)&&void 0!==t?t:document.body).querySelector(".js-notification-banners");if(null==s)throw new Error("Notification banner container is missing");this.portalRoot=s}componentDidMount(){this.notifySyncHeight()}componentWillUnmount(){window.setTimeout(this.notifySyncHeight)}render(){return r.createElement(i.A,{root:this.portalRoot},r.createElement("div",{className:`${n} ${n}--${this.props.type}`},r.createElement("div",{className:`${n}__col ${n}__col--icon`}),r.createElement("div",{className:`${n}__col ${n}__col--label`},r.createElement("div",{className:`${n}__type`},this.props.type),r.createElement("div",{className:`${n}__text`},this.props.title)),r.createElement("div",{className:`${n}__col`},r.createElement("div",{className:`${n}__text`},this.props.message))))}notifySyncHeight(){a.publish("sync-height:force")}}},5646:(e,t,s)=>{s.d(t,{p:()=>m});var r=s(8064),i=s(1370),a=s(6823),n=s(6540),o=s(8243),l=s(1883),c=s(3431),u=s(3816),d=s(5953),p=function(e,t,s,r){var i,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(n=(a<3?i(n):a>3?i(t,s,n):i(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n};let m=class extends n.Component{render(){const{score:e,user:t}=this.props,s=(0,o.kM)(e.ruleset_id);return n.createElement(u.V,null,(i=>{var o;return n.createElement("div",{className:"simple-menu"},a.A.scorePins.canBePinned(e)&&n.createElement(r.A,{className:"simple-menu__item",onUpdate:i,score:e}),(0,c.gI)(e)&&n.createElement("a",{className:"simple-menu__item",href:(0,c.qp)(e)},(0,l.pw)("users.show.extra.top_ranks.view_details")),(0,c.mu)(e)&&n.createElement("a",{className:"simple-menu__item js-login-required--click","data-turbolinks":!1,href:(0,c.yz)(e),onClick:i},(0,l.pw)("users.show.extra.top_ranks.download_replay")),(0,c.N3)(e)&&n.createElement(d.r,{className:"simple-menu__item",onFormOpen:i,reportableId:(null!==(o=e.best_id)&&void 0!==o?o:e.id).toString(),reportableType:"solo_score"===e.type?e.type:`score_best_${s}`,user:t}))}))}};m=p([i.PA],m)},6100:(e,t,s)=>{s.d(t,{A:()=>n});var r=s(6540),i=s(7634),a=s(1883);class n extends r.Component{constructor(){super(...arguments),Object.defineProperty(this,"onClick",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var t,s;const r=e.currentTarget.dataset.mode;this.props.currentMode===r?e.preventDefault():null===(s=(t=this.props).onClick)||void 0===s||s.call(t,e,r)}}),Object.defineProperty(this,"renderLink",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var t;const s=r.createElement(r.Fragment,null,r.createElement("span",{className:`fal fa-extra-mode-${e.mode}`,title:e.disabled?void 0:(0,a.pw)(`beatmaps.mode.${e.mode}`)}),e.mode===this.props.defaultMode&&r.createElement("span",{className:"game-mode-link__icon",title:(0,a.pw)("users.show.edit.default_playmode.is_default_tooltip")},r.createElement("span",{className:"fas fa-star"})),null!=e.count&&r.createElement("span",{className:"game-mode-link__badge",title:e.countTooltip},e.count)),n=(0,i.Zt)("game-mode-link",{active:e.mode===this.props.currentMode,disabled:e.disabled});return r.createElement("li",{key:e.mode},e.disabled?r.createElement("span",{className:n},s):r.createElement("a",{className:n,"data-mode":e.mode,href:null!==(t=e.href)&&void 0!==t?t:"#",onClick:this.onClick},s))}})}render(){return r.createElement("ul",{className:(0,i.Zt)("game-mode",this.props.modifiers)},this.props.entries.map(this.renderLink))}}},3816:(e,t,s)=>{s.d(t,{V:()=>n});var r=s(6968),i=s(6540),a=s(5374);function n(e){const t=i.useContext(a.Bz),s=i.useContext(a.tx),n=i.useCallback((()=>t.activeKeyDidChange(null)),[t]),o=i.useCallback((()=>t.activeKeyDidChange(s)),[t,s]);return i.useEffect((()=>()=>t.activeKeyDidChange(null)),[t]),i.createElement(r.A,Object.assign({onHide:n,onShow:o},e))}},6968:(e,t,s)=>{s.d(t,{A:()=>u});var r=s(6540),i=s(4466),a=s(2961),n=s(3938),o=s(8156),l=s(4692);class c extends r.PureComponent{constructor(){super(...arguments),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:{active:!1}}),Object.defineProperty(this,"buttonRef",{enumerable:!0,configurable:!0,writable:!0,value:r.createRef()}),Object.defineProperty(this,"eventId",{enumerable:!0,configurable:!0,writable:!0,value:`popup-menu-${(0,n.L)()}`}),Object.defineProperty(this,"menuRef",{enumerable:!0,configurable:!0,writable:!0,value:r.createRef()}),Object.defineProperty(this,"menuRootRef",{enumerable:!0,configurable:!0,writable:!0,value:r.createRef()}),Object.defineProperty(this,"tooltipHideEvent",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dismiss",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.setState({active:!1})}}),Object.defineProperty(this,"hide",{enumerable:!0,configurable:!0,writable:!0,value:e=>{if(!this.state.active||(0,a.h)())return;const t=e.originalEvent;null!=t&&("key"in t&&"Escape"===t.key||"button"in t&&0===t.button&&!this.isMenuInPath(t.composedPath()))&&this.setState({active:!1})}}),Object.defineProperty(this,"resize",{enumerable:!0,configurable:!0,writable:!0,value:()=>{if(!this.state.active)return;const e=this.buttonRef.current,t=this.menuRef.current,s=this.menuRootRef.current;if(null==e||null==t||null==s)throw new Error("missing button and/or menu element");if(null==e.offsetParent)return void(s.style.display="none");const r=e.getBoundingClientRect(),i=t.getBoundingClientRect(),{scrollX:a,scrollY:n}=window;let o=a+r.right;("right"===this.props.direction||r.x-i.width<0)&&(o+=i.width-r.width),s.style.display="block",s.style.position="absolute",s.style.top=`${Math.floor(n+r.bottom+5)}px`,s.style.left=`${Math.floor(o)}px`;const l=this.tooltipElement;null!=l&&(s.style.zIndex=getComputedStyle(l).zIndex)}}),Object.defineProperty(this,"toggle",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.setState({active:!this.state.active})}})}get $tooltipElement(){const e=this.tooltipElement;return null==e?null:l(e)}get tooltipElement(){var e;return null===(e=this.context)||void 0===e?void 0:e.closest(".qtip")}componentDidMount(){var e;this.tooltipHideEvent=null===(e=this.$tooltipElement)||void 0===e?void 0:e.qtip("option","hide.event"),l(window).on(`resize.${this.eventId}`,this.resize)}componentDidUpdate(e,t){var s,r,i,a,n;if(t.active!==this.state.active)if(this.state.active){this.resize();const e=this.$tooltipElement;null!=e&&(this.tooltipHideEvent=e.qtip("option","hide.event"),e.qtip("option","hide.event",!1)),l(document).on(`click.${this.eventId} keydown.${this.eventId}`,this.hide),null===(r=(s=this.props).onShow)||void 0===r||r.call(s)}else null===(i=this.$tooltipElement)||void 0===i||i.qtip("option","hide.event",this.tooltipHideEvent),l(document).off(`click.${this.eventId} keydown.${this.eventId}`,this.hide),null===(n=(a=this.props).onHide)||void 0===n||n.call(a)}componentWillUnmount(){l(document).off(`.${this.eventId}`),l(window).off(`.${this.eventId}`)}render(){return this.props.customRender?this.props.customRender(this.renderMenu(),this.buttonRef,this.toggle):r.createElement(r.Fragment,null,r.createElement("button",{ref:this.buttonRef,className:"popup-menu",onClick:this.toggle,type:"button"},r.createElement("span",{className:"fas fa-ellipsis-v"})),this.renderMenu())}isMenuInPath(e){for(const t of["menuRootRef","buttonRef"]){const s=this[t].current;if(null!=s&&e.includes(s))return!0}return!1}renderMenu(){return this.state.active?r.createElement(o.A,null,r.createElement("div",{ref:this.menuRootRef},r.createElement("div",{ref:this.menuRef,className:"popup-menu-float"},this.props.children(this.dismiss)))):null}}Object.defineProperty(c,"contextType",{enumerable:!0,configurable:!0,writable:!0,value:i.l}),Object.defineProperty(c,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{children:()=>null,direction:"left"}});const u=c},8156:(e,t,s)=>{s.d(t,{A:()=>o,e:()=>n});var r=s(6540),i=s(961);const a="js-portal";function n(){var e;for(const t of(null!==(e=window.newBody)&&void 0!==e?e:document.body).querySelectorAll(`.${a}`))t.remove()}class o extends r.PureComponent{constructor(e){super(e),Object.defineProperty(this,"container",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.container=document.createElement("div"),this.container.className=a}componentDidMount(){var e,t;(null!==(t=null!==(e=this.props.root)&&void 0!==e?e:window.newBody)&&void 0!==t?t:document.body).appendChild(this.container)}componentWillUnmount(){this.container.remove()}render(){return(0,i.createPortal)(this.props.children,this.container)}}},8305:(e,t,s)=>{s.d(t,{A:()=>n});var r=s(6540),i=s(256),a=s(1883);function n(e){return r.createElement("h3",{className:"title title--page-extra-small"},(0,a.pw)(e.titleKey),null!=e.count&&r.createElement("span",{className:"title__count"},(0,i.ZV)(e.count)))}},4988:(e,t,s)=>{s.d(t,{A:()=>n});var r=s(6540),i=s(7634),a=s(1883);function n(e){const t=(0,i.Zt)("page-mode-link","profile-page",{"is-active":e.page===e.currentPage}),s=(0,a.pw)(`users.show.extra.${e.page}.title`);return r.createElement("span",{className:t},r.createElement("span",{className:"fake-bold","data-content":s},s))}},5993:(e,t,s)=>{s.d(t,{A:()=>E});var r=s(7813),i=s(1370),a=s(8293),n=s(5349),o=s(6540),l=s(256),c=s(2599),u=s(1883),d=s(6900),p=s(1980),m=s(6591),h=s(8102),b=s(3358),f=s(1518),v=s(7726),g=function(e,t,s,r){var i,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(n=(a<3?i(n):a>3?i(t,s,n):i(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n};const y="json-kudosu";function w({kudosu:e}){const t={amount:o.createElement("strong",{className:"profile-extra-entries__kudosu-amount"},(0,u.pw)("users.show.extra.kudosu.entry.amount",{amount:(0,l.ZV)(Math.abs(e.amount))})),giver:null==e.giver?(0,u.pw)("users.deleted"):o.createElement("a",{href:e.giver.url},e.giver.username),post:null==e.post.url?e.post.title:o.createElement("a",{href:e.post.url},e.post.title)};return o.createElement("li",{className:"profile-extra-entries__item"},o.createElement("div",{className:"profile-extra-entries__detail"},o.createElement("div",{className:"profile-extra-entries__text"},o.createElement(b.A,{mappings:t,pattern:(0,u.pw)(`users.show.extra.kudosu.entry.${e.model}.${e.action}`)}))),o.createElement("div",{className:"profile-extra-entries__time"},o.createElement(f.A,{dateTime:e.created_at,relative:!0})))}let _=class extends o.Component{get hasData(){return null!=this.kudosu}constructor(e){var t;super(e),Object.defineProperty(this,"kudosu",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"showMoreXhr",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"xhr",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"handleOnLoad",{enumerable:!0,configurable:!0,writable:!0,value:()=>(this.xhr=(0,n.A)({id:this.props.userId},"kudosu"),this.xhr.done((e=>(0,r.h5)((()=>{this.kudosu=e,this.saveState()})))),this.xhr)}),Object.defineProperty(this,"handleShowMore",{enumerable:!0,configurable:!0,writable:!0,value:()=>{null!=this.kudosu&&(this.showMoreXhr=(0,d.$7)(this.kudosu,this.props.userId).done(this.saveState))}}),Object.defineProperty(this,"saveState",{enumerable:!0,configurable:!0,writable:!0,value:()=>{(0,c.Qv)(y,this.kudosu)}}),this.kudosu=null!==(t=(0,c.Do)(y))&&void 0!==t?t:e.kudosu,(0,r.Gn)(this)}componentWillUnmount(){var e,t;null===(e=this.xhr)||void 0===e||e.abort(),null===(t=this.showMoreXhr)||void 0===t||t.abort()}render(){return o.createElement("div",{className:"page-extra"},o.createElement(a.A,{name:this.props.name,withEdit:this.props.withEdit}),o.createElement(m.A,{hasData:this.hasData,name:this.props.name,onLoad:this.handleOnLoad},o.createElement("div",{className:"kudosu-box"},o.createElement(v.A,{description:o.createElement(b.A,{mappings:{link:o.createElement("a",{href:(0,p.iD)("Kudosu")},(0,u.pw)("users.show.extra.kudosu.total_info.link"))},pattern:(0,u.pw)("users.show.extra.kudosu.total_info._")}),label:(0,u.pw)("users.show.extra.kudosu.total"),modifiers:"kudosu",value:(0,l.ZV)(this.props.total)})),this.renderEntries()))}renderEntries(){return null==this.kudosu?null:0===this.kudosu.items.length?o.createElement("div",{className:"profile-extra-entries profile-extra-entries--kudosu"},(0,u.pw)("users.show.extra.kudosu.entry.empty")):o.createElement("ul",{className:"profile-extra-entries profile-extra-entries--kudosu"},this.kudosu.items.map((e=>o.createElement(w,{key:e.id,kudosu:e}))),o.createElement("li",{className:"profile-extra-entries__item u-contents"},o.createElement(h.A,Object.assign({},this.kudosu.pagination,{callback:this.handleShowMore,modifiers:"profile-page"}))))}};g([r.sH],_.prototype,"kudosu",void 0),g([r.EW],_.prototype,"hasData",null),g([r.XI],_.prototype,"handleOnLoad",void 0),g([r.XI],_.prototype,"handleShowMore",void 0),_=g([i.PA],_);const E=_},6420:(e,t,s)=>{s.d(t,{A:()=>n});var r=s(5191),i=s(9981),a=s(6540);function n({banner:e}){return null==e.image?null:a.createElement("a",{className:"profile-tournament-banner",href:(0,i.w)("tournaments.show",{tournament:e.tournament_id})},a.createElement(r.A,{className:"profile-tournament-banner__image",src:e.image,src2x:e["image@2x"]}))}},4681:(e,t,s)=>{s.d(t,{aI:()=>v,oF:()=>f});var r=s(4467),i=s(9981),a=s(7813),n=s(1370),o=s(6540),l=s(961),c=s(6407),u=s(1883),d=s(6131),p=s(3358),m=s(4692),h=function(e,t,s,r){var i,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(n=(a<3?i(n):a>3?i(t,s,n):i(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n};const b="report-form";function f(e){const t=document.createElement("div");(0,l.render)(o.createElement(_,{reportableId:e.reportableId,reportableType:e.reportableType,root:t,username:e.username}),t)}const v={beatmapset:"beatmapset",beatmapset_discussion_post:"beatmapset_discussion_post",comment:"comment",forum_post:"forum_post",message:"message",score_best_fruits:"scores",score_best_mania:"scores",score_best_osu:"scores",score_best_taiko:"scores",solo_score:"scores",user:"user"},g={Cheating:(0,u.pw)("users.report.options.cheating"),MultipleAccounts:(0,u.pw)("users.report.options.multiple_accounts"),Insults:(0,u.pw)("users.report.options.insults"),Spam:(0,u.pw)("users.report.options.spam"),UnwantedContent:(0,u.pw)("users.report.options.unwanted_content"),Nonsense:(0,u.pw)("users.report.options.nonsense"),Other:(0,u.pw)("users.report.options.other")},y={beatmapset:["UnwantedContent","Other"],post:["Insults","Spam","UnwantedContent","Nonsense","Other"],score:["Cheating","MultipleAccounts","Other"]},w={beatmapset:y.beatmapset,beatmapset_discussion_post:y.post,comment:y.post,forum_post:y.post,message:y.post,scores:y.score};let _=class extends o.Component{get canSubmit(){return!this.disabled&&(this.comments.length>0||"message"===this.props.reportableType)}get groupKey(){return v[this.props.reportableType]}get options(){var e;return(null!==(e=w[this.groupKey])&&void 0!==e?e:Object.keys(g)).map((e=>({id:e,text:g[e]})))}constructor(e){super(e),Object.defineProperty(this,"comments",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"completed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"disabled",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"selectedReason",{enumerable:!0,configurable:!0,writable:!0,value:this.options[0]}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"handleClose",{enumerable:!0,configurable:!0,writable:!0,value:()=>{(0,l.unmountComponentAtNode)(this.props.root)}}),Object.defineProperty(this,"handleCommentsChange",{enumerable:!0,configurable:!0,writable:!0,value:e=>{this.comments=e.target.value}}),Object.defineProperty(this,"handleReasonChange",{enumerable:!0,configurable:!0,writable:!0,value:e=>{this.selectedReason=e}}),Object.defineProperty(this,"handleSubmit",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.disabled=!0;const e={data:{comments:this.comments,reason:this.selectedReason.id,reportable_id:this.props.reportableId,reportable_type:this.props.reportableType},dataType:"json",type:"POST",url:(0,i.w)("reports.store")};m.ajax(e).done((0,a.XI)((()=>{this.timeout=window.setTimeout(this.handleClose,1e3),this.completed=!0}))).fail((0,a.XI)((e=>{(0,c.S5)(e),this.disabled=!1})))}}),(0,a.Gn)(this)}componentDidMount(){m(document).on("turbolinks:before-cache",this.handleClose)}componentWillUnmount(){m(document).off("turbolinks:before-cache",this.handleClose),window.clearTimeout(this.timeout)}render(){return o.createElement(d.A,{onClose:this.handleClose},o.createElement("div",{className:b},o.createElement("div",{className:`${b}__header`},o.createElement("div",{className:`${b}__row ${b}__row--exclamation`},o.createElement("i",{className:"fas fa-exclamation-triangle"})),o.createElement("div",{className:`${b}__row ${b}__row--title`},o.createElement("span",null,this.renderTitle()))),!this.completed&&this.renderFormContent()))}renderFormContent(){return o.createElement("div",null,0!==this.options.length&&o.createElement(o.Fragment,null,o.createElement("div",{className:`${b}__row`},(0,u.pw)("users.report.reason")),o.createElement("div",{className:`${b}__row`},o.createElement(r.A,{blackout:!1,modifiers:"report",onChange:this.handleReasonChange,options:this.options,selected:this.selectedReason}))),o.createElement("div",{className:`${b}__row`},(0,u.pw)("users.report.comments")),o.createElement("div",{className:`${b}__row`},o.createElement("textarea",{className:`${b}__textarea`,maxLength:2e3,onChange:this.handleCommentsChange,placeholder:(0,u.pw)("users.report.placeholder"),value:this.comments})),o.createElement("div",{className:`${b}__row ${b}__row--buttons`},o.createElement("button",{className:`${b}__button ${b}__button--report`,disabled:!this.canSubmit,onClick:this.handleSubmit,type:"button"},(0,u.pw)("users.report.actions.send")),o.createElement("button",{className:`${b}__button`,disabled:this.disabled,onClick:this.handleClose,type:"button"},(0,u.pw)("users.report.actions.cancel"))))}renderTitle(){return this.completed?(0,u.pw)("users.report.thanks"):o.createElement(p.A,{mappings:{username:o.createElement("strong",null,this.props.username)},pattern:(0,u.pw)(`report.${this.groupKey}.title`)})}};h([a.sH],_.prototype,"comments",void 0),h([a.sH],_.prototype,"completed",void 0),h([a.sH],_.prototype,"disabled",void 0),h([a.sH],_.prototype,"selectedReason",void 0),h([a.EW],_.prototype,"options",null),h([a.XI],_.prototype,"handleCommentsChange",void 0),h([a.XI],_.prototype,"handleReasonChange",void 0),h([a.XI],_.prototype,"handleSubmit",void 0),_=h([n.PA],_)},5953:(e,t,s)=>{s.d(t,{r:()=>o});var r=s(6540),i=s(1883),a=s(4681),n=function(e,t){var s={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(s[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(s[r[i]]=e[r[i]])}return s};class o extends r.PureComponent{constructor(){super(...arguments),Object.defineProperty(this,"onShowFormButtonClick",{enumerable:!0,configurable:!0,writable:!0,value:e=>{0===e.button&&(this.props.onFormOpen(),(0,a.oF)({reportableId:this.props.reportableId,reportableType:this.props.reportableType,username:this.props.user.username}))}})}render(){const e=this.props,{icon:t,onFormOpen:s,reportableId:o,reportableType:l,user:c}=e,u=n(e,["icon","onFormOpen","reportableId","reportableType","user"]),d=a.aI[this.props.reportableType],p=(0,i.pw)(`report.${d}.button`);return r.createElement("button",Object.assign({onClick:this.onShowFormButtonClick,type:"button"},u),t?r.createElement("span",{className:"textual-button textual-button--inline"},r.createElement("i",{className:"textual-button__icon fas fa-exclamation-triangle"})," ",p):p)}}Object.defineProperty(o,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{icon:!1,onFormOpen:()=>{}}})},9179:(e,t,s)=>{s.d(t,{A:()=>E});var r=s(8102),i=s(7813),a=s(1370),n=s(6540),o=s(1883),l=s(7482),c=s(3887),u=s(3358),d=s(8994),p=s(9981),m=s(5093),h=s(8243),b=s(7634),f=function(e,t,s,r){var i,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(n=(a<3?i(n):a>3?i(t,s,n):i(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n};let v=class extends n.Component{get playlistItemCount(){return this.props.room.active?this.props.room.playlist_item_stats.count_active:this.props.room.playlist_item_stats.count_total}get status(){if(!this.props.room.active)return"ended";if(null==this.props.room.ends_at)return"active";return new Date(this.props.room.ends_at).getTime()-(new Date).getTime()<36e5?"soon":"active"}constructor(e){super(e),(0,i.Gn)(this)}render(){const e=this.props.room.ends_at;return n.createElement("div",{className:"multiplayer-room"},this.renderCover(),n.createElement("div",{className:"multiplayer-room__content"},n.createElement("div",{className:"multiplayer-room__badge-container"},n.createElement("div",{className:(0,b.Zt)("multiplayer-room__badge",[this.status])},(0,o.pw)(`multiplayer.room.status.${this.status}`)),null!=e&&n.createElement("time",{className:"js-tooltip-time u-hover",title:e},"ended"===this.status?m(e).fromNow():(0,o.pw)("multiplayer.room.time_left",{time:m(e).fromNow(!0)}))),n.createElement("div",{className:"multiplayer-room__details"},n.createElement("div",{className:"multiplayer-room__name"},this.props.room.name),this.renderMembers()),n.createElement("div",{className:"multiplayer-room__badge-container multiplayer-room__badge-container--bottom"},n.createElement("div",{className:(0,b.Zt)("multiplayer-room__badge",["map-count"])},(0,o.Mq)("multiplayer.room.map_count",this.playlistItemCount)),n.createElement("div",{className:"multiplayer-room__difficulty",style:{"--max-difficulty":(0,h.ID)(this.props.room.difficulty_range.max),"--min-difficulty":(0,h.ID)(this.props.room.difficulty_range.min)}},n.createElement(c.A,{rating:this.props.room.difficulty_range.min}),this.props.room.difficulty_range.max!==this.props.room.difficulty_range.min&&n.createElement(c.A,{rating:this.props.room.difficulty_range.max})))))}renderCover(){var e,t;return n.createElement("a",{className:"multiplayer-room__cover-container",href:(0,p.w)("multiplayer.rooms.show",{room:this.props.room.id})},n.createElement(l.A,{beatmapset:null===(t=null===(e=this.props.room.current_playlist_item)||void 0===e?void 0:e.beatmap)||void 0===t?void 0:t.beatmapset,modifiers:"full",size:"cover"}))}renderHost(){return n.createElement("div",{className:"multiplayer-room__host"},n.createElement(u.A,{mappings:{user:n.createElement(d.A,{className:"u-hover",user:this.props.room.host})},pattern:(0,o.pw)("multiplayer.room.hosted_by")}))}renderMembers(){return n.createElement("div",{className:"multiplayer-room__members"},this.renderHost(),this.renderParticipants())}renderParticipants(){return n.createElement("div",{className:"multiplayer-room__participants"},(0,o.Mq)("multiplayer.room.player_count",this.props.room.participant_count))}};f([i.EW],v.prototype,"status",null),v=f([a.PA],v);const g=v;var y=s(4692),w=function(e,t,s,r){var i,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(n=(a<3?i(n):a>3?i(t,s,n):i(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n};let _=class extends n.Component{get hasMore(){return null!=this.props.store.cursorString}constructor(e){super(e),Object.defineProperty(this,"loading",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"handleShowMore",{enumerable:!0,configurable:!0,writable:!0,value:()=>{if(this.loading)return;this.loading=!0;const e=this.props.showMoreUrl;y.getJSON(e,{cursor_string:this.props.store.cursorString}).done((0,i.XI)((e=>{this.props.store.updateWithJson(e)}))).always((0,i.XI)((()=>{this.loading=!1})))}}),(0,i.Gn)(this)}render(){const e=null!=this.props.typeGroup?(0,o.pw)("multiplayer.empty._",{type_group:(0,o.pw)(`multiplayer.empty.${this.props.typeGroup}`)}):(0,o.pw)("rankings.seasons.empty");return 0===this.props.store.rooms.length?n.createElement("div",{className:"room-list"},e):n.createElement("div",{className:"room-list"},this.props.store.rooms.map((e=>n.createElement(g,{key:e.id,room:e}))),n.createElement(r.A,{callback:this.handleShowMore,hasMore:this.hasMore,loading:this.loading}))}};w([i.sH],_.prototype,"loading",void 0),w([i.EW],_.prototype,"hasMore",null),w([i.XI],_.prototype,"handleShowMore",void 0),_=w([a.PA],_);const E=_},8064:(e,t,s)=>{s.d(t,{A:()=>p});var r=s(7813),i=s(1370),a=s(6823),n=s(6540),o=s(6407),l=s(1883),c=s(3135),u=function(e,t,s,r){var i,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(n=(a<3?i(n):a>3?i(t,s,n):i(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n};let d=class extends n.Component{get isPinned(){return a.A.scorePins.isPinned(this.props.score)}get label(){const e=this.isPinned?"0":"1";return(0,l.pw)(`users.show.extra.top_ranks.pin.to_${e}`)}constructor(e){super(e),Object.defineProperty(this,"onUpdateCallbacks",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"onClick",{enumerable:!0,configurable:!0,writable:!0,value:()=>{const e=this.isPinned?"0":"1";this.onUpdateCallbacks={done:this.props.onUpdate,fail:(0,o.dI)(this.onClick)},a.A.scorePins.apiPin(this.props.score,!this.isPinned).done((()=>{var t,s;(0,c.l)((0,l.pw)(`users.show.extra.top_ranks.pin.to_${e}_done`),"info"),null===(s=null===(t=this.onUpdateCallbacks)||void 0===t?void 0:t.done)||void 0===s||s.call(t)})).fail(((e,t)=>{var s;return null===(s=this.onUpdateCallbacks)||void 0===s?void 0:s.fail(e,t)}))}}),(0,r.Gn)(this)}componentWillUnmount(){this.onUpdateCallbacks=null}render(){return n.createElement("button",{className:this.props.className,onClick:this.onClick,type:"button"},this.label)}};u([r.EW],d.prototype,"isPinned",null),u([r.EW],d.prototype,"label",null),d=u([i.PA],d);const p=d},2550:(e,t,s)=>{s.d(t,{A:()=>o});var r=s(1370),i=s(6540),a=s(256),n=s(3431);const o=(0,r.PA)((({score:e})=>i.createElement(i.Fragment,null,(0,a.ZV)((0,n.bP)(e)))))},4467:(e,t,s)=>{s.d(t,{A:()=>d});var r=s(7813),i=s(1370),a=s(6540),n=s(3368),o=s(7634),l=function(e,t,s,r){var i,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(n=(a<3?i(n):a>3?i(t,s,n):i(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n};const c="select-options";let u=class extends a.Component{constructor(e){super(e),Object.defineProperty(this,"ref",{enumerable:!0,configurable:!0,writable:!0,value:a.createRef()}),Object.defineProperty(this,"showingSelector",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"hideSelector",{enumerable:!0,configurable:!0,writable:!0,value:e=>{0!==e.button||null==this.ref.current||e.composedPath().includes(this.ref.current)||(this.showingSelector=!1)}}),Object.defineProperty(this,"optionSelected",{enumerable:!0,configurable:!0,writable:!0,value:(e,t)=>{var s,r;0===e.button&&(e.preventDefault(),this.showingSelector=!1,null===(r=(s=this.props).onChange)||void 0===r||r.call(s,t))}}),Object.defineProperty(this,"toggleSelector",{enumerable:!0,configurable:!0,writable:!0,value:e=>{0===e.button&&(e.preventDefault(),this.showingSelector=!this.showingSelector)}}),(0,r.Gn)(this),(0,i.bH)(this,(0,r.fm)((()=>{(0,n.Q)(this,this.props.blackout&&this.showingSelector)})))}componentDidMount(){document.addEventListener("click",this.hideSelector)}componentWillUnmount(){document.removeEventListener("click",this.hideSelector),(0,n.Q)(this,!1)}render(){var e;const t=(0,o.Zt)(c,{selecting:this.showingSelector},this.props.modifiers);return a.createElement("div",{ref:this.ref,className:t},a.createElement("div",{className:`${c}__select`},this.renderOption({children:a.createElement(a.Fragment,null,a.createElement("div",{className:"u-ellipsis-overflow"},null===(e=this.props.selected)||void 0===e?void 0:e.text),a.createElement("div",{className:`${c}__decoration`},a.createElement("span",{className:"fas fa-chevron-down"}))),onClick:this.toggleSelector,option:this.props.selected})),a.createElement("div",{className:`${c}__selector`},this.renderOptions()))}renderOption({children:e,onClick:t,option:s,selected:r=!1}){const i=(0,o.Zt)(`${c}__option`,{selected:r});return null!=this.props.renderOption?this.props.renderOption({children:e,cssClasses:i,onClick:t,option:s}):a.createElement("a",{key:s.id,className:i,href:"#",onClick:t},e)}renderOptions(){return this.props.options.map((e=>{var t;return this.renderOption({children:a.createElement("div",{className:"u-ellipsis-overflow"},e.text),onClick:t=>{this.optionSelected(t,e)},option:e,selected:(null===(t=this.props.selected)||void 0===t?void 0:t.id)===e.id})}))}};Object.defineProperty(u,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{blackout:!0}}),l([r.sH],u.prototype,"showingSelector",void 0),l([r.XI],u.prototype,"hideSelector",void 0),l([r.XI],u.prototype,"optionSelected",void 0),l([r.XI],u.prototype,"toggleSelector",void 0),u=l([i.PA],u);const d=u},8102:(e,t,s)=>{s.d(t,{A:()=>u});var r=s(6540),i=s(7634),a=s(1883),n=s(8623),o=s(4692);const l="show-more-link";class c extends r.PureComponent{constructor(){super(...arguments),Object.defineProperty(this,"onClick",{enumerable:!0,configurable:!0,writable:!0,value:()=>{null==this.props.callback?null==this.props.url&&null!=this.props.event&&o.publish(this.props.event,this.props.data):this.props.callback(this.props.data)}})}render(){if(!this.props.hasMore&&!this.props.loading)return null;const e={children:this.children(),className:(0,i.Zt)(l,this.props.modifiers)};return this.props.loading?r.createElement("span",Object.assign({"data-disabled":"1"},e)):null==this.props.url?r.createElement("button",Object.assign({onClick:this.onClick,type:"button"},e)):r.createElement("a",Object.assign({href:this.props.url,onClick:this.onClick},e))}children(){var e,t;const s=r.createElement("span",{className:`fas fa-angle-${null!==(e=this.props.direction)&&void 0!==e?e:"down"}`});return r.createElement(r.Fragment,null,r.createElement("span",{className:`${l}__spinner`},r.createElement(n.y,null)),r.createElement("span",{className:`${l}__label`},r.createElement("span",{className:`${l}__label-icon ${l}__label-icon--left`},s),r.createElement("span",{className:`${l}__label-text`},null!==(t=this.props.label)&&void 0!==t?t:(0,a.pw)("common.buttons.show_more"),null!=this.props.remaining&&` (${this.props.remaining})`),r.createElement("span",{className:`${l}__label-icon ${l}__label-icon--right`},s)))}}Object.defineProperty(c,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{hasMore:!1,loading:!1}});const u=c},6338:(e,t,s)=>{s.d(t,{F:()=>o});var r=s(6823),i=s(6540),a=s(7634),n=s(1883);class o extends i.PureComponent{render(){var e;const t=this.props.values.map((e=>{var t,s;let a="sort__item sort__item--button";return this.props.currentValue===e&&(a+=" sort__item--active"),i.createElement("button",{key:e,className:a,"data-value":e,onClick:this.props.onChange},"rank"===e?i.createElement("span",null,i.createElement("i",{className:`fas fa-extra-mode-${null!==(s=null===(t=r.A.currentUser)||void 0===t?void 0:t.playmode)&&void 0!==s?s:"osu"}`})," ",(0,n.pw)("sort.rank")):(0,n.pw)(`${this.props.transPrefix}${e}`))}));return i.createElement("div",{className:(0,a.Zt)("sort",this.props.modifiers)},i.createElement("div",{className:"sort__items"},this.props.showTitle&&i.createElement("span",{className:"sort__item sort__item--title"},null!==(e=this.props.title)&&void 0!==e?e:(0,n.pw)("sort._")),t))}}Object.defineProperty(o,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{showTitle:!0,transPrefix:"sort."}})},8623:(e,t,s)=>{s.d(t,{y:()=>a});var r=s(6540),i=s(7634);function a(e){return r.createElement("span",{className:(0,i.Zt)("la-ball-clip-rotate",e.modifiers)})}},3358:(e,t,s)=>{s.d(t,{A:()=>i});var r=s(6540);function i(e){const t=Object.keys(e.mappings).sort(((e,t)=>e<t?1:-1));if(0===t.length)return r.createElement(r.Fragment,null,e.pattern);const s=new RegExp(`(:${t.join("|:")})`),i=e.pattern.split(s);return r.createElement(r.Fragment,null,i.map((t=>{const s=":"===t[0]?t.slice(1):null,i=null==s||null==e.mappings[s]?t:e.mappings[s];return"string"==typeof i?i:r.createElement(r.Fragment,{key:t},i)})))}},368:(e,t,s)=>{s.d(t,{A:()=>o});var r=s(2543),i=s(6540),a=s(7634),n=s(1883);function o(e){var t;return i.createElement("span",{className:(0,a.Zt)("supporter-icon",e.modifiers),title:(0,n.pw)("users.show.is_supporter")},(0,r.times)(null!==(t=e.level)&&void 0!==t?t:1,(e=>i.createElement("span",{key:e,className:"fas fa-heart"}))))}},7833:(e,t,s)=>{s.d(t,{A:()=>l});var r=s(1173),i=s(6540),a=s(5812),n=function(e,t){var s={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(s[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(s[r[i]]=e[r[i]])}return s};class o extends i.PureComponent{get maxHeight(){return null!=this.props.maxRows&&Number.isFinite(this.state.lineHeight)?this.state.lineHeight*(this.props.maxRows+1):null}constructor(e){var t;super(e),Object.defineProperty(this,"ref",{enumerable:!0,configurable:!0,writable:!0,value:null!==(t=this.props.innerRef)&&void 0!==t?t:i.createRef()}),Object.defineProperty(this,"shouldUpdate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"handleInput",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var t,s;this.shouldUpdate=!1,null===(s=(t=this.props).onInput)||void 0===s||s.call(t,e)}}),this.state={lineHeight:NaN}}componentDidMount(){var e;null!=this.ref.current&&(null!=this.props.maxRows||(0,a.E)(null===(e=this.props.value)||void 0===e?void 0:e.toString())?window.setTimeout((()=>{if(null!=this.ref.current){if(null!=this.props.maxRows){const e=Math.ceil(parseFloat(window.getComputedStyle(this.ref.current).getPropertyValue("line-height")));this.setState({lineHeight:e})}(0,r.A)(this.ref.current)}}),0):(0,r.A)(this.ref.current))}componentDidUpdate(){null!=this.ref.current&&("hidden"!==this.ref.current.style.overflowX&&(this.ref.current.style.overflowX="hidden"),this.shouldUpdate?r.A.update(this.ref.current):this.shouldUpdate=!0)}componentWillUnmount(){null!=this.ref.current&&r.A.destroy(this.ref.current)}render(){const e=this.props,{innerRef:t,onInput:s,maxRows:r,style:a}=e,o=n(e,["innerRef","onInput","maxRows","style"]),l=this.maxHeight;return i.createElement("textarea",Object.assign({ref:this.ref,onInput:this.handleInput,style:null!=l?Object.assign(Object.assign({},a),{maxHeight:l}):a},o))}}Object.defineProperty(o,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{async:!1,rows:1}});const l=o},1518:(e,t,s)=>{s.d(t,{A:()=>n});var r=s(5093),i=s(6540),a=function(e,t){var s={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(s[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(s[r[i]]=e[r[i]])}return s};function n(e){const{dateTime:t,format:s="ll",relative:n=!1}=e,o=a(e,["dateTime","format","relative"]),l="string"==typeof t?t:t.format();let c,u=l;if(n)c="js-timeago";else{c="js-tooltip-time";u=("string"==typeof t?r(t):t).format(s)}return i.createElement("time",Object.assign({className:c,dateTime:l,title:l},o),u)}},799:(e,t,s)=>{s.d(t,{A:()=>u});var r=s(9981),i=s(6540),a=s(7634),n=s(256),o=s(1883),l=s(5812);class c extends i.PureComponent{get artist(){var e;return"artist"in this.props?null!==(e=this.props.track.artist)&&void 0!==e?e:this.props.artist:this.props.track.artist}render(){let e=(0,a.Zt)("artist-track",{original:this.props.track.exclusive},this.props.modifiers);return e+=" js-audio--player",i.createElement("div",{className:e,"data-audio-url":this.props.track.preview},i.createElement("div",{className:"artist-track__col artist-track__col--preview",style:{backgroundImage:(0,a.NZ)(this.props.track.cover_url)}},i.createElement("button",{className:"artist-track__button artist-track__button--play js-audio--play"},i.createElement("span",{className:"fa-fw play-button"}))),i.createElement("div",{className:"artist-track__col artist-track__col--names"},i.createElement("div",{className:"artist-track__title u-ellipsis-overflow"},this.props.track.title,(0,l.E)(this.props.track.version)&&i.createElement(i.Fragment,null," ",i.createElement("span",{className:"artist-track__version"},this.props.track.version))),i.createElement("div",{className:"artist-track__info"},i.createElement("a",{href:(0,r.w)("artists.show",{artist:this.artist.id})},this.artist.name)),this.props.showAlbum&&null!=this.props.track.album&&i.createElement("div",{className:"artist-track__info"},i.createElement("a",{href:`${(0,r.w)("artists.show",{artist:this.artist.id})}#album-${this.props.track.album_id}`},this.props.track.album.title))),i.createElement("div",{className:"artist-track__col artist-track__col--badges"},this.props.track.exclusive&&i.createElement("span",{className:"pill-badge pill-badge--pink pill-badge--with-shadow",title:(0,o.pw)("artist.songs.original")},(0,o.pw)("artist.songs.original_badge")),this.props.track.is_new&&i.createElement("span",{className:"pill-badge pill-badge--yellow pill-badge--with-shadow"},(0,o.pw)("common.badges.new"))),i.createElement("div",{className:"artist-track__col artist-track__col--details"},i.createElement("div",{className:"u-ellipsis-overflow artist-track__detail artist-track__detail--genre"},this.props.track.genre),i.createElement("div",{className:"artist-track__detail artist-track__detail--bpm"},(0,n.ZV)(this.props.track.bpm),"bpm"),i.createElement("div",{className:"artist-track__detail artist-track__detail--length"},this.props.track.length)),i.createElement("div",{className:"artist-track__col artist-track__col--buttons"},i.createElement("a",{className:"artist-track__button",href:this.props.track.osz,title:(0,o.pw)("artist.beatmaps.download")},i.createElement("span",{className:"fas fa-fw fa-download"}))))}}Object.defineProperty(c,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{showAlbum:!1}});const u=c},241:(e,t,s)=>{s.d(t,{A:()=>a});var r=s(6540),i=s(7634);function a(e){var t;return r.createElement("span",{className:(0,i.Zt)("avatar","guest",e.modifiers),style:{backgroundImage:(0,i.NZ)(null===(t=e.user)||void 0===t?void 0:t.avatar_url)}})}},8460:(e,t,s)=>{s.d(t,{A:()=>m});var r=s(9981),i=s(7813),a=s(1370),n=s(6823),o=s(6540),l=s(4909),c=s(7634),u=s(4692),d=function(e,t,s,r){var i,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(n=(a<3?i(n):a>3?i(t,s,n):i(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n};let p=class extends o.Component{get friendModifier(){var e;if(null==(null===(e=n.A.currentUser)||void 0===e?void 0:e.friends))return;const t=n.A.currentUser.friends.find((e=>e.target_id===this.props.user.id));if(null!=t){if(t.mutual)return"mutual";if(!this.context.isFriendsPage)return"friend"}}constructor(e){super(e),Object.defineProperty(this,"ref",{enumerable:!0,configurable:!0,writable:!0,value:o.createRef()}),Object.defineProperty(this,"handleRemoveClick",{enumerable:!0,configurable:!0,writable:!0,value:()=>{var e,t;null===(t=(e=this.props).onRemoveClick)||void 0===t||t.call(e,this.props.user)}}),(0,i.Gn)(this)}componentWillUnmount(){u.publish("user-card:remove",this.ref.current)}render(){const e=(0,c.Zt)("user-card-brick",this.props.modifiers,this.friendModifier),t=null!=this.props.user.groups&&this.props.user.groups.length>0?this.props.user.groups[0]:void 0;return o.createElement("div",{ref:this.ref,className:`js-usercard ${e}`,"data-user-id":this.props.user.id},o.createElement("a",{className:"user-card-brick__link",href:(0,r.w)("users.show",{user:this.props.user.id})},o.createElement("div",{className:"user-card-brick__group-bar",style:(0,c.OS)(t),title:null==t?void 0:t.name}),o.createElement("div",{className:"user-card-brick__username u-ellipsis-overflow"},this.props.user.username)),null!=this.props.onRemoveClick&&o.createElement("button",{className:"user-card-brick__remove",onClick:this.handleRemoveClick},o.createElement("span",{className:"fas fa-times"})))}};Object.defineProperty(p,"contextType",{enumerable:!0,configurable:!0,writable:!0,value:l.A}),d([i.EW],p.prototype,"friendModifier",null),p=d([a.PA],p);const m=p},7308:(e,t,s)=>{s.d(t,{g:()=>P,q:()=>O});var r=s(2370),i=s(4617),a=s(9981),n=s(2543),o=s(6823),l=s(6540),c=s(7634),u=s(1883),d=s(5812),p=s(1980),m=s(8789),h=s(2175),b=s(3816),f=s(5953),v=s(8623),g=s(3358),y=s(368),w=s(1518),_=s(8460),E=s(4944);const P=["card","list","brick"];class O extends l.PureComponent{constructor(){super(...arguments),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:{avatarLoaded:!1,backgroundLoaded:!1}}),Object.defineProperty(this,"url",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onAvatarLoad",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.setState({avatarLoaded:!0})}}),Object.defineProperty(this,"onBackgroundLoad",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.setState({backgroundLoaded:!0})}})}get canMessage(){var e,t;return!this.isSelf&&null==n.find(null!==(t=null===(e=o.A.currentUser)||void 0===e?void 0:e.blocks)&&void 0!==t?t:[],{target_id:this.user.id})}get isOnline(){return this.user.is_online}get isSelf(){return null!=o.A.currentUser&&o.A.currentUser.id===this.user.id}get isUserLoaded(){return Number.isFinite(this.user.id)&&this.user.id>0}get isUserNotFound(){return-1===this.user.id}get isUserVisible(){return this.isUserLoaded&&!this.user.is_deleted}get user(){return this.props.user||O.userLoading}render(){if("brick"===this.props.mode)return null==this.props.user?null:l.createElement(_.A,Object.assign({},this.props,{user:this.props.user}));const e=(0,c.Zt)("user-card",this.props.modifiers,this.props.mode,this.props.activated?"active":"highlightable");return this.url=this.isUserVisible?(0,a.w)("users.show",{user:this.user.id}):void 0,l.createElement("div",{className:e},this.renderBackground(),l.createElement("div",{className:"user-card__card"},l.createElement("div",{className:"user-card__content user-card__content--details"},l.createElement("div",{className:"user-card__user"},this.renderAvatar()),l.createElement("div",{className:"user-card__details"},this.renderIcons(),l.createElement("div",{className:"user-card__username-row"},this.renderUsername(),l.createElement("div",{className:"user-card__group-badges"},l.createElement(E.A,{groups:this.user.groups,short:!0,wrapper:"user-card__group-badge"}))),this.renderListModeIcons())),this.renderStatusBar()))}renderAvatar(){const e={loaded:this.state.avatarLoaded},t=(0,d.E)(this.user.avatar_url)&&!this.isUserNotFound;return l.createElement("div",{className:"user-card__avatar-space"},l.createElement("div",{className:(0,c.Zt)("user-card__avatar-spinner",e)},t&&l.createElement(v.y,{modifiers:e})),this.isUserLoaded&&t&&l.createElement("img",{className:(0,c.Zt)("user-card__avatar",e),onError:this.onAvatarLoad,onLoad:this.onAvatarLoad,src:this.user.avatar_url}))}renderBackground(){var e;let t,s;const r=(0,c.Zt)("user-card__background-overlay",this.isOnline?["online"]:[]);if(null!=(null===(e=this.user.cover)||void 0===e?void 0:e.url)){let e="user-card__background";this.state.backgroundLoaded||(e+=" user-card__background--loading"),t=l.createElement(l.Fragment,null,l.createElement("img",{className:e,onLoad:this.onBackgroundLoad,src:this.user.cover.url}),l.createElement("div",{className:r}))}else t=l.createElement("div",{className:r});return s=this.isUserVisible?l.createElement("a",{className:"user-card__background-container",href:this.url},t):t,s}renderIcons(){return this.isUserVisible?l.createElement("div",{className:"user-card__icons user-card__icons--card"},l.createElement("a",{className:"user-card__icon user-card__icon--flag",href:(0,a.w)("rankings",{country:this.user.country_code,mode:"osu",type:"performance"})},l.createElement(m.A,{country:this.user.country})),"card"===this.props.mode&&l.createElement(l.Fragment,null,this.user.is_supporter&&l.createElement("a",{className:"user-card__icon",href:(0,a.w)("support-the-game")},l.createElement(y.A,{modifiers:"user-card"})),l.createElement("div",{className:"user-card__icon"},l.createElement(i.A,{modifiers:"user-card",userId:this.user.id})),!this.user.is_bot&&l.createElement("div",{className:"user-card__icon"},l.createElement(h.A,{modifiers:["user-card"],userId:this.user.id})))):null}renderListModeIcons(){return"list"===this.props.mode&&this.isUserVisible?l.createElement("div",{className:"user-card__icons"},this.user.is_supporter&&l.createElement("a",{className:"user-card__icon",href:(0,a.w)("support-the-game")},l.createElement(y.A,{level:this.user.support_level,modifiers:"user-list"})),l.createElement("div",{className:"user-card__icon"},l.createElement(i.A,{modifiers:"user-list",userId:this.user.id})),!this.user.is_bot&&l.createElement("div",{className:"user-card__icon"},l.createElement(h.A,{modifiers:["user-list"],userId:this.user.id}))):null}renderMenuButton(){if(this.isSelf)return null;return l.createElement("div",{className:"user-card__icon user-card__icon--menu"},l.createElement(b.V,null,(e=>{var t,s,i,n;return l.createElement("div",{className:"simple-menu"},this.canMessage&&l.createElement("a",{className:"simple-menu__item js-login-required--click",href:(0,a.w)("messages.users.show",{user:this.user.id}),onClick:e},l.createElement("span",{className:"fas fa-envelope"}),` ${(0,u.pw)("users.card.send_message")}`),l.createElement("a",{className:"simple-menu__item",href:(0,p.SS)(this.user),onClick:e},l.createElement("span",{className:"fas fa-gift"}),` ${(0,u.pw)("users.card.gift_supporter")}`),l.createElement(r.A,{modifiers:"inline",onClick:e,userId:this.user.id,wrapperClass:"simple-menu__item"}),l.createElement(f.r,{className:"simple-menu__item",icon:!0,onFormOpen:e,reportableId:null!==(s=null===(t=this.props.reportable)||void 0===t?void 0:t.id)&&void 0!==s?s:this.user.id.toString(),reportableType:null!==(n=null===(i=this.props.reportable)||void 0===i?void 0:i.type)&&void 0!==n?n:"user",user:this.user}))})))}renderStatusBar(){if(!this.isUserVisible)return null;const e=this.isOnline?(0,u.pw)("users.status.online"):(0,u.pw)("users.status.offline");return l.createElement("div",{className:"user-card__content user-card__content--status"},l.createElement("div",{className:"user-card__status"},this.renderStatusIcon(),l.createElement("div",{className:"user-card__status-messages"},l.createElement("span",{className:"user-card__status-message user-card__status-message--sub u-ellipsis-overflow"},!this.isOnline&&null!=this.user.last_visit&&l.createElement(g.A,{mappings:{date:l.createElement(w.A,{dateTime:this.user.last_visit,relative:!0})},pattern:(0,u.pw)("users.show.lastvisit")})),l.createElement("span",{className:"user-card__status-message u-ellipsis-overflow"},e))),l.createElement("div",{className:"user-card__icons user-card__icons--menu"},this.renderMenuButton()))}renderStatusIcon(){return this.isUserVisible?l.createElement("div",{className:"user-card__status-icon-container"},l.createElement("div",{className:"user-card__status-icon user-card__status-icon--"+(this.isOnline?"online":"offline")})):null}renderUsername(){const e=this.user.is_deleted?(0,u.pw)("users.deleted"):this.user.username;return null==this.url?l.createElement("div",{className:"user-card__username u-ellipsis-pre-overflow"},e):l.createElement("a",{className:"user-card__username u-ellipsis-pre-overflow",href:this.url},e)}}Object.defineProperty(O,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{activated:!1,mode:"card"}}),Object.defineProperty(O,"userLoading",{enumerable:!0,configurable:!0,writable:!0,value:{avatar_url:"",country_code:"",cover:{custom_url:null,id:null,url:null},default_group:"",id:0,is_active:!1,is_bot:!1,is_deleted:!1,is_online:!1,is_supporter:!1,last_visit:"",pm_friends_only:!0,profile_colour:"",username:(0,u.pw)("users.card.loading")}})},1737:(e,t,s)=>{s.d(t,{L:()=>o});var r=s(6540),i=s(5374),a=s(7634),n=s(7308);class o extends r.PureComponent{constructor(){super(...arguments),Object.defineProperty(this,"activeKeyDidChange",{enumerable:!0,configurable:!0,writable:!0,value:i.xb.bind(this)}),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:{}})}render(){const e={"menu-active":null!=this.state.activeKey,[this.props.viewMode]:!0};return r.createElement(i.Bz.Provider,{value:{activeKeyDidChange:this.activeKeyDidChange}},r.createElement("div",{className:(0,a.Zt)("user-cards",e)},this.props.users.map((e=>{const t=this.state.activeKey===e.id;return r.createElement(i.tx.Provider,{key:e.id,value:e.id},r.createElement(n.q,{activated:t,mode:this.props.viewMode,modifiers:(0,a.hL)("has-outline",this.props.modifiers),user:e}))}))))}}},8547:(e,t,s)=>{s.d(t,{A:()=>o});var r=s(9981),i=s(6540),a=s(7634),n=s(1883);function o({group:e,modifiers:t}){if(null==e)return null;let s,o=e.name;if(null!=e.playmodes&&e.playmodes.length>0){s=i.createElement("div",{className:"user-group-badge__modes"},e.playmodes.map((e=>i.createElement("i",{key:e,className:`fal fa-extra-mode-${e}`}))));o+=` (${e.playmodes.map((e=>(0,n.pw)(`beatmaps.mode.${e}`))).join(", ")})`}const l={children:s,className:(0,a.Zt)("user-group-badge",{probationary:e.is_probationary},e.identifier,t),"data-label":e.short_name,style:(0,a.OS)(e),title:o};return e.has_listing?i.createElement("a",Object.assign({},l,{href:(0,r.w)("groups.show",{group:e.id})})):i.createElement("div",Object.assign({},l))}},4944:(e,t,s)=>{s.d(t,{A:()=>a});var r=s(6540),i=s(8547);function a(e){const{groups:t=[],modifiers:s,short:a=!1,wrapper:n}=e;let o=!1;return r.createElement(r.Fragment,null,t.map((e=>{const t=a&&o?`${n} u-hidden-narrow`:n;return o=!0,r.createElement("span",{key:e.identifier,className:t},r.createElement(i.A,{group:e,modifiers:s}))})))}},8994:(e,t,s)=>{s.d(t,{A:()=>a});var r=s(9981),i=s(6540);class a extends i.PureComponent{render(){var e,t;let s="js-usercard";null!=this.props.className&&(s+=` ${this.props.className}`);const a=(null!==(e=this.props.user.id)&&void 0!==e?e:-1)>0?(0,r.w)("users.show",{mode:this.props.mode,user:this.props.user.id}):void 0;return i.createElement("a",{className:s,"data-reportable":JSON.stringify(this.props.reportable),"data-tooltip-position":this.props.tooltipPosition,"data-user-id":this.props.user.id,href:a},null!==(t=this.props.children)&&void 0!==t?t:this.props.user.username)}}},1831:(e,t,s)=>{s.d(t,{C:()=>d});var r=s(241),i=s(8994),a=s(7813),n=s(6540),o=s(5848),l=s(1883),c=s(4692);const u={"right center":"left center","top center":"bottom center"};function d(e,t,s){var r;return c(null!==(r=e())&&void 0!==r?r:[]).qtip({content:{text:"[placeholder]"},hide:{delay:500,effect(){c(this).fadeTo(250,0)},fixed:!0},position:{at:s,my:u[s],viewport:c(window)},show:{delay:100,effect(){c(this).fadeTo(110,1)},ready:!0},style:{classes:"qtip qtip--user-list",def:!1,tip:!1}}),(0,a.fm)((()=>{var s;const r=(0,o.renderToStaticMarkup)(n.createElement(p,Object.assign({},t())));c(null!==(s=e())&&void 0!==s?s:[]).qtip("set",{"content.text":r})}))}function p(e){return n.createElement("div",{className:"user-list-popup"},e.title,e.users.length>0&&n.createElement("div",{className:"user-list-popup__users"},e.users.map((e=>n.createElement(i.A,{key:e.id,className:"user-list-popup__user",tooltipPosition:"top right",user:e},n.createElement(r.A,{modifiers:"full",user:e}))))),e.count>e.users.length&&n.createElement("div",{className:"user-list-popup__remainder-count"},(0,l.Mq)("common.count.plus_others",e.count-e.users.length)))}},1198:(e,t,s)=>{s.d(t,{w:()=>y});var r=s(8443),i=s(5093),a=s(6823),n=s(6540),o=s(7634),l=s(1883),c=s(3944),u=s(1980),d=s(6338),p=s(7308),m=s(1737),h=s(6224);const b=["all","online","offline"],f=["all","osu","taiko","fruits","mania"],v=["last_visit","rank","username"];function g(e,t){var s,r,i,a;return(null!==(r=null===(s=e.statistics)||void 0===s?void 0:s.global_rank)&&void 0!==r?r:Number.MAX_VALUE)-(null!==(a=null===(i=t.statistics)||void 0===i?void 0:i.global_rank)&&void 0!==a?a:Number.MAX_VALUE)}class y extends n.PureComponent{constructor(){super(...arguments),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:{filter:this.filterFromUrl,playMode:this.playmodeFromUrl,sortMode:this.sortFromUrl,viewMode:this.viewFromUrl}}),Object.defineProperty(this,"handleSortChange",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const t=e.currentTarget.dataset.value,s=(0,u.Ze)(null,{sort:t});h.controller.advanceHistory(s),this.setState({sortMode:t},(()=>{a.A.userPreferences.set("user_list_sort",this.state.sortMode)}))}}),Object.defineProperty(this,"onViewSelected",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const t=e.currentTarget.dataset.value,s=(0,u.Ze)(null,{view:t});h.controller.advanceHistory(s),this.setState({viewMode:t},(()=>{a.A.userPreferences.set("user_list_view",this.state.viewMode)}))}}),Object.defineProperty(this,"optionSelected",{enumerable:!0,configurable:!0,writable:!0,value:e=>{e.preventDefault();const t=e.currentTarget.dataset.key,s=(0,u.Ze)(null,{filter:t});h.controller.advanceHistory(s),this.setState({filter:t},(()=>{a.A.userPreferences.set("user_list_filter",this.state.filter)}))}}),Object.defineProperty(this,"playmodeSelected",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const t=e.currentTarget.dataset.value,s=(0,u.Ze)(null,{mode:t});h.controller.advanceHistory(s),this.setState({playMode:t})}})}get filterFromUrl(){return this.getAllowedQueryStringValue(b,(0,c.bN)().get("filter"),a.A.userPreferences.get("user_list_filter"))}get playmodeFromUrl(){return this.getAllowedQueryStringValue(f,(0,c.bN)().get("mode"),"all")}get sortedUsers(){const e=this.getFilteredUsers(this.state.filter).slice();switch(this.state.sortMode){case"rank":return e.sort(g);case"username":return e.sort(r.Vg);default:return e.sort(((e,t)=>{var s,a;return e.is_online&&t.is_online?(0,r.Vg)(e,t):e.is_online||t.is_online?e.is_online?-1:1:i(null!==(s=t.last_visit)&&void 0!==s?s:0).diff(i(null!==(a=e.last_visit)&&void 0!==a?a:0))}))}}get sortFromUrl(){return this.getAllowedQueryStringValue(v,(0,c.bN)().get("sort"),a.A.userPreferences.get("user_list_sort"))}get viewFromUrl(){return this.getAllowedQueryStringValue(p.g,(0,c.bN)().get("view"),a.A.userPreferences.get("user_list_view"))}render(){var e,t;return n.createElement(n.Fragment,null,this.renderSelections(),n.createElement("div",{className:"user-list"},null!=this.props.group&&n.createElement("h1",{className:"user-list__title"},this.props.group.name),null!=(null===(e=this.props.group)||void 0===e?void 0:e.description)&&n.createElement("div",{dangerouslySetInnerHTML:{__html:this.props.group.description.html},className:"user-list__description"}),n.createElement("div",{className:"user-list__toolbar"},(null===(t=this.props.group)||void 0===t?void 0:t.has_playmodes)&&n.createElement("div",{className:"user-list__toolbar-row"},n.createElement("div",{className:"user-list__toolbar-item"},this.renderPlaymodeFilter())),n.createElement("div",{className:"user-list__toolbar-row"},n.createElement("div",{className:"user-list__toolbar-item"},this.renderSorter()),n.createElement("div",{className:"user-list__toolbar-item"},this.renderViewMode()))),n.createElement("div",{className:"user-list__items"},n.createElement(m.L,{users:this.sortedUsers,viewMode:this.state.viewMode}))))}renderOption(e,t,s=!1){const r=s?["active"]:[];let i=(0,o.Zt)("update-streams-v2__item",r);return i+=` t-changelog-stream--${e}`,n.createElement("a",{key:e,className:i,"data-key":e,href:(0,u.Ze)(null,{filter:e}),onClick:this.optionSelected},n.createElement("div",{className:"update-streams-v2__bar u-changelog-stream--bg"}),n.createElement("p",{className:"update-streams-v2__row update-streams-v2__row--name"},(0,l.pw)(`users.status.${e}`)),n.createElement("p",{className:"update-streams-v2__row update-streams-v2__row--version"},t))}renderSelections(){return n.createElement("div",{className:"update-streams-v2 update-streams-v2--with-active update-streams-v2--user-list"},n.createElement("div",{className:"update-streams-v2__container"},b.map((e=>this.renderOption(e,this.getFilteredUsers(e).length,e===this.state.filter)))))}renderSorter(){return n.createElement(d.F,{currentValue:this.state.sortMode,modifiers:["user-list"],onChange:this.handleSortChange,values:v})}renderViewMode(){return n.createElement("div",{className:"user-list__view-modes"},n.createElement("button",{className:(0,o.Zt)("user-list__view-mode","card"===this.state.viewMode?["active"]:[]),"data-value":"card",onClick:this.onViewSelected,title:(0,l.pw)("users.view_mode.card")},n.createElement("span",{className:"fas fa-square"})),n.createElement("button",{className:(0,o.Zt)("user-list__view-mode","list"===this.state.viewMode?["active"]:[]),"data-value":"list",onClick:this.onViewSelected,title:(0,l.pw)("users.view_mode.list")},n.createElement("span",{className:"fas fa-bars"})),n.createElement("button",{className:(0,o.Zt)("user-list__view-mode","brick"===this.state.viewMode?["active"]:[]),"data-value":"brick",onClick:this.onViewSelected,title:(0,l.pw)("users.view_mode.brick")},n.createElement("span",{className:"fas fa-th"})))}getAllowedQueryStringValue(e,t,s){const r=t;if(e.indexOf(r)>-1)return r;const i=s;return e.indexOf(i)>-1?i:e[0]}getFilteredUsers(e){var t;let s=this.props.users.slice();const r=this.state.playMode;if("all"!==r&&(null===(t=this.props.group)||void 0===t?void 0:t.has_playmodes)){const e=this.props.group.id;s=s.filter((t=>{var s,i,a;return null===(a=null===(i=null===(s=t.groups)||void 0===s?void 0:s.find((t=>t.id===e)))||void 0===i?void 0:i.playmodes)||void 0===a?void 0:a.includes(r)}))}switch(e){case"online":return s.filter((e=>e.is_online));case"offline":return s.filter((e=>!e.is_online));default:return s}}renderPlaymodeFilter(){const e=f.map((e=>n.createElement("button",{key:e,className:(0,o.Zt)("user-list__view-mode",this.state.playMode===e?["active"]:[]),"data-value":e,onClick:this.playmodeSelected,title:(0,l.pw)(`beatmaps.mode.${e}`)},"all"===e?n.createElement("span",null,(0,l.pw)("beatmaps.mode.all")):n.createElement("span",{className:`fal fa-extra-mode-${e}`}))));return n.createElement("div",{className:"user-list__view-modes"},n.createElement("span",{className:"user-list__view-mode-title"},(0,l.pw)("users.filtering.by_game_mode"))," ",e)}}},1949:(e,t,s)=>{s.d(t,{A:()=>m});var r=s(2370),i=s(5472),a=s(7813),n=s(1370),o=s(6823),l=s(6540),c=s(7634),u=s(1883),d=function(e,t,s,r){var i,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(n=(a<3?i(n):a>3?i(t,s,n):i(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n};let p=class extends l.Component{get isBlocked(){return o.A.currentUserModel.blocks.has(this.props.user.id)}constructor(e){super(e),Object.defineProperty(this,"forceShow",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"handleClick",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.forceShow=!this.forceShow}}),(0,a.Gn)(this)}render(){const e=this.isBlocked&&!this.forceShow;return l.createElement("div",{className:e?"osu-layout__no-scroll":void 0},this.isBlocked&&this.renderBanner(),l.createElement("div",{className:(0,c.Zt)("osu-layout","full",{masked:e})},this.props.children))}renderBanner(){const e=l.createElement("div",{className:"grid-items grid-items--notification-banner-buttons"},l.createElement("div",null,l.createElement(r.A,{userId:this.props.user.id})),l.createElement("div",null,l.createElement("button",{className:"textual-button",onClick:this.handleClick,type:"button"},l.createElement("span",null,l.createElement("i",{className:"textual-button__icon fas fa-low-vision"})," ",this.forceShow?(0,u.pw)("users.blocks.hide_profile"):(0,u.pw)("users.blocks.show_profile")))));return l.createElement("div",{className:"osu-page"},l.createElement(i.A,{message:e,title:(0,u.pw)("users.blocks.banner_text"),type:"info"}))}};d([a.sH],p.prototype,"forceShow",void 0),d([a.EW],p.prototype,"isBlocked",null),d([a.XI],p.prototype,"handleClick",void 0),p=d([n.PA],p);const m=p},7726:(e,t,s)=>{s.d(t,{A:()=>n});var r=s(6540),i=s(7634);const a="value-display";function n({description:e,label:t,modifiers:s,value:n}){return r.createElement("div",{className:(0,i.Zt)(a,s)},r.createElement("div",{className:`${a}__label`},t),r.createElement("div",{className:`${a}__value`},n),null!=e&&r.createElement("div",{className:`${a}__description`},e))}},8476:(e,t,s)=>{s.d(t,{A:()=>a});var r=s(9981),i=s(1883);function a(e){return[{active:"home"===e,title:(0,i.pw)("home.user.title"),url:(0,r.w)("home")},{active:"friends.index"===e,title:(0,i.pw)("friends.title_compact"),url:(0,r.w)("friends.index")},{active:"follows.index"===e,title:(0,i.pw)("follows.index.title_compact"),url:(0,r.w)("follows.index",{subtype:"forum_topic"})},{active:"account.edit"===e,title:(0,i.pw)("accounts.edit.title_compact"),url:(0,r.w)("account.edit")}]}},6595:(e,t,s)=>{s.d(t,{$6:()=>a,XB:()=>r,f4:()=>i});const r=["ANNOUNCE","PUBLIC","GROUP","PM"],i=new Set(r);function a(e){return e.filter((e=>i.has(e.type)))}},3702:(e,t,s)=>{s.d(t,{H:()=>i,g:()=>r});const r=["osu","taiko","fruits","mania"];function i(e){if(r.includes(e))return e}},9981:(e,t,s)=>{s.d(t,{w:()=>l});var r=s(3944);const i={url:"https://osu.ppy.sh",port:null,defaults:{},routes:{"oauth.passport.token":{uri:"oauth/token",methods:["POST"]},"oauth.authorizations.authorize":{uri:"oauth/authorize",methods:["GET","HEAD"]},"oauth.":{uri:"oauth/authorize",methods:["DELETE"]},"wiki.image":{uri:"wiki/images/{path}",methods:["GET","HEAD"],wheres:{path:".+"},parameters:["path"]},"beatmapsets.discussions.media-url":{uri:"beatmapsets/discussions/media-url",methods:["GET","HEAD"]},"admin.beatmapsets.covers":{uri:"admin/beatmapsets/{beatmapset}/covers",methods:["GET","HEAD"],parameters:["beatmapset"]},"admin.beatmapsets.covers.regenerate":{uri:"admin/beatmapsets/{beatmapset}/covers/regenerate",methods:["POST"],parameters:["beatmapset"]},"admin.beatmapsets.covers.remove":{uri:"admin/beatmapsets/{beatmapset}/covers/remove",methods:["POST"],parameters:["beatmapset"]},"admin.beatmapsets.show":{uri:"admin/beatmapsets/{beatmapset}",methods:["GET","HEAD"],parameters:["beatmapset"]},"admin.beatmapsets.update":{uri:"admin/beatmapsets/{beatmapset}",methods:["PUT","PATCH"],parameters:["beatmapset"]},"admin.contests.get-zip":{uri:"admin/contests/{contest}/zip",methods:["POST"],parameters:["contest"]},"admin.contests.index":{uri:"admin/contests",methods:["GET","HEAD"]},"admin.contests.show":{uri:"admin/contests/{contest}",methods:["GET","HEAD"],parameters:["contest"]},"admin.user-contest-entries.destroy":{uri:"admin/user-contest-entries/{user_contest_entry}",methods:["DELETE"],parameters:["user_contest_entry"]},"admin.user-contest-entries.restore":{uri:"admin/user-contest-entries/{user_contest_entry}/restore",methods:["POST"],parameters:["user_contest_entry"]},"admin.logs.index":{uri:"admin/logs",methods:["GET","HEAD"]},"admin.root":{uri:"admin",methods:["GET","HEAD"]},"admin.forum.forum-covers.index":{uri:"admin/forum/forum-covers",methods:["GET","HEAD"]},"admin.forum.forum-covers.store":{uri:"admin/forum/forum-covers",methods:["POST"]},"admin.forum.forum-covers.update":{uri:"admin/forum/forum-covers/{forum_cover}",methods:["PUT","PATCH"],parameters:["forum_cover"]},"artists.tracks.index":{uri:"beatmaps/artists/tracks",methods:["GET","HEAD"]},"artists.index":{uri:"beatmaps/artists",methods:["GET","HEAD"]},"artists.show":{uri:"beatmaps/artists/{artist}",methods:["GET","HEAD"],parameters:["artist"]},"tracks.show":{uri:"beatmaps/artists/tracks/{track}",methods:["GET","HEAD"],parameters:["track"]},"packs.index":{uri:"beatmaps/packs",methods:["GET","HEAD"]},"packs.show":{uri:"beatmaps/packs/{pack}",methods:["GET","HEAD"],parameters:["pack"]},"beatmaps.":{uri:"beatmaps/{beatmap}/scores/users/{user}",methods:["GET","HEAD"],parameters:["beatmap","user"]},"beatmaps.scores":{uri:"beatmaps/{beatmap}/scores",methods:["GET","HEAD"],parameters:["beatmap"]},"beatmaps.solo-scores":{uri:"beatmaps/{beatmap}/solo-scores",methods:["GET","HEAD"],parameters:["beatmap"]},"beatmaps.update-owner":{uri:"beatmaps/{beatmap}/update-owner",methods:["PUT"],parameters:["beatmap"]},"beatmaps.show":{uri:"beatmaps/{beatmap}",methods:["GET","HEAD"],parameters:["beatmap"]},"redirect:beatmapsets.discussions.index":{uri:"beatmapsets/beatmap-discussions",methods:["GET","HEAD"]},"redirect:beatmapsets.discussions.destroy":{uri:"beatmapsets/beatmap-discussions/{beatmap_discussion}",methods:["DELETE"],parameters:["beatmap_discussion"]},"redirect:beatmapsets.discussions.show":{uri:"beatmapsets/beatmap-discussions/{beatmap_discussion}",methods:["GET","HEAD"],parameters:["beatmap_discussion"]},"redirect:beatmapsets.discussions.vote":{uri:"beatmapsets/beatmap-discussions/{beatmap_discussion}/vote",methods:["PUT"],parameters:["beatmap_discussion"]},"redirect:beatmapsets.discussions.restore":{uri:"beatmapsets/beatmap-discussions/{beatmap_discussion}/restore",methods:["POST"],parameters:["beatmap_discussion"]},"redirect:beatmapsets.discussions.deny-kudosu":{uri:"beatmapsets/beatmap-discussions/{beatmap_discussion}/deny-kudosu",methods:["POST"],parameters:["beatmap_discussion"]},"redirect:beatmapsets.discussions.allow-kudosu":{uri:"beatmapsets/beatmap-discussions/{beatmap_discussion}/allow-kudosu",methods:["POST"],parameters:["beatmap_discussion"]},"redirect:beatmapsets.discussions.posts.destroy":{uri:"beatmapsets/beatmap-discussion-posts/{beatmap_discussion_post}",methods:["DELETE"],parameters:["beatmap_discussion_post"]},"redirect:beatmapsets.discussions.posts.store":{uri:"beatmapsets/beatmap-discussion-posts/{beatmap_discussion_post}",methods:["POST"],parameters:["beatmap_discussion_post"]},"redirect:beatmapsets.discussions.posts.update":{uri:"beatmapsets/beatmap-discussion-posts/{beatmap_discussion_post}",methods:["PUT"],parameters:["beatmap_discussion_post"]},"redirect:beatmapsets.discussions.posts.restore":{uri:"beatmapsets/beatmap-discussion-posts/{beatmap_discussion_post}/restore",methods:["POST"],parameters:["beatmap_discussion_post"]},"redirect:beatmapsets.discussions.posts.index":{uri:"beatmapsets/beatmap-discussion-posts",methods:["GET","HEAD"]},"beatmapsets.events.index":{uri:"beatmapsets/events",methods:["GET","HEAD"]},"beatmapsets.redirect:follows.index":{uri:"beatmapsets/watches",methods:["GET","HEAD"]},"beatmapsets.watches.update":{uri:"beatmapsets/watches/{watch}",methods:["PUT","PATCH"],parameters:["watch"]},"beatmapsets.watches.destroy":{uri:"beatmapsets/watches/{watch}",methods:["DELETE"],parameters:["watch"]},"beatmapsets.discussions.vote":{uri:"beatmapsets/discussions/{discussion}/vote",methods:["PUT"],parameters:["discussion"]},"beatmapsets.discussions.restore":{uri:"beatmapsets/discussions/{discussion}/restore",methods:["POST"],parameters:["discussion"]},"beatmapsets.discussions.deny-kudosu":{uri:"beatmapsets/discussions/{discussion}/deny-kudosu",methods:["POST"],parameters:["discussion"]},"beatmapsets.discussions.allow-kudosu":{uri:"beatmapsets/discussions/{discussion}/allow-kudosu",methods:["POST"],parameters:["discussion"]},"beatmapsets.discussions.posts.restore":{uri:"beatmapsets/discussions/posts/{post}/restore",methods:["POST"],parameters:["post"]},"beatmapsets.discussions.posts.index":{uri:"beatmapsets/discussions/posts",methods:["GET","HEAD"]},"beatmapsets.discussions.posts.store":{uri:"beatmapsets/discussions/posts",methods:["POST"]},"beatmapsets.discussions.posts.show":{uri:"beatmapsets/discussions/posts/{post}",methods:["GET","HEAD"],parameters:["post"]},"beatmapsets.discussions.posts.update":{uri:"beatmapsets/discussions/posts/{post}",methods:["PUT","PATCH"],parameters:["post"]},"beatmapsets.discussions.posts.destroy":{uri:"beatmapsets/discussions/posts/{post}",methods:["DELETE"],parameters:["post"]},"beatmapsets.discussions.votes.index":{uri:"beatmapsets/discussions/votes",methods:["GET","HEAD"]},"beatmapsets.discussions.index":{uri:"beatmapsets/discussions",methods:["GET","HEAD"]},"beatmapsets.discussions.show":{uri:"beatmapsets/discussions/{discussion}",methods:["GET","HEAD"],parameters:["discussion"]},"beatmapsets.discussions.destroy":{uri:"beatmapsets/discussions/{discussion}",methods:["DELETE"],parameters:["discussion"]},"beatmapsets.favourites.store":{uri:"beatmapsets/{beatmapset}/favourites",methods:["POST"],parameters:["beatmapset"]},"beatmapsets.search":{uri:"beatmapsets/search",methods:["GET","HEAD"]},"beatmapsets.discussion":{uri:"beatmapsets/{beatmapset}/discussion/{beatmap?}/{mode?}/{filter?}",methods:["GET","HEAD"],parameters:["beatmapset","beatmap","mode","filter"]},"beatmapsets.discussion.review":{uri:"beatmapsets/{beatmapset}/discussion/review",methods:["POST"],parameters:["beatmapset"]},"beatmapsets.discussion-lock":{uri:"beatmapsets/{beatmapset}/discussion-lock",methods:["POST"],parameters:["beatmapset"]},"beatmapsets.discussion-unlock":{uri:"beatmapsets/{beatmapset}/discussion-unlock",methods:["POST"],parameters:["beatmapset"]},"beatmapsets.download":{uri:"beatmapsets/{beatmapset}/download",methods:["GET","HEAD"],parameters:["beatmapset"]},"beatmapsets.love":{uri:"beatmapsets/{beatmapset}/love",methods:["PUT"],parameters:["beatmapset"]},"beatmapsets.remove-from-loved":{uri:"beatmapsets/{beatmapset}/love",methods:["DELETE"],parameters:["beatmapset"]},"beatmapsets.nominate":{uri:"beatmapsets/{beatmapset}/nominate",methods:["PUT"],parameters:["beatmapset"]},"beatmapsets.index":{uri:"beatmapsets",methods:["GET","HEAD"]},"beatmapsets.show":{uri:"beatmapsets/{beatmapset}",methods:["GET","HEAD"],parameters:["beatmapset"]},"beatmapsets.update":{uri:"beatmapsets/{beatmapset}",methods:["PUT","PATCH"],parameters:["beatmapset"]},"beatmapsets.destroy":{uri:"beatmapsets/{beatmapset}",methods:["DELETE"],parameters:["beatmapset"]},"scores.download":{uri:"scores/{score}/download",methods:["GET","HEAD"],parameters:["score"]},"scores.download-legacy":{uri:"scores/{rulesetOrScore}/{score}/download",methods:["GET","HEAD"],parameters:["rulesetOrScore","score"]},"scores.show":{uri:"scores/{rulesetOrScore}/{score?}",methods:["GET","HEAD"],parameters:["rulesetOrScore","score"]},"score-pins.destroy":{uri:"score-pins",methods:["DELETE"]},"score-pins.reorder":{uri:"score-pins",methods:["PUT"]},"score-pins.store":{uri:"score-pins",methods:["POST"]},"client-verifications.create":{uri:"client-verifications/create",methods:["GET","HEAD"]},"client-verifications.store":{uri:"client-verifications",methods:["POST"]},"comments.index":{uri:"comments",methods:["GET","HEAD"]},"comments.store":{uri:"comments",methods:["POST"]},"comments.show":{uri:"comments/{comment}",methods:["GET","HEAD"],parameters:["comment"]},"comments.update":{uri:"comments/{comment}",methods:["PUT","PATCH"],parameters:["comment"]},"comments.destroy":{uri:"comments/{comment}",methods:["DELETE"],parameters:["comment"]},"comments.pin":{uri:"comments/{comment}/pin",methods:["POST"],parameters:["comment"]},"comments.restore":{uri:"comments/{comment}/restore",methods:["POST"],parameters:["comment"]},"comments.vote":{uri:"comments/{comment}/vote",methods:["POST"],parameters:["comment"]},"contests.index":{uri:"community/contests",methods:["GET","HEAD"]},"contests.show":{uri:"community/contests/{contest}",methods:["GET","HEAD"],parameters:["contest"]},"contests.judge":{uri:"community/contests/{contest}/judge",methods:["GET","HEAD"],parameters:["contest"]},"contest-entries.judge-results":{uri:"community/contest-entries/{contest_entry}/results",methods:["GET","HEAD"],parameters:["contest_entry"]},"contest-entries.judge-vote":{uri:"community/contest-entries/{contest_entry}/judge-vote",methods:["PUT"],parameters:["contest_entry"]},"contest-entries.vote":{uri:"community/contest-entries/{contest_entry}/vote",methods:["PUT"],parameters:["contest_entry"]},"contest-entries.store":{uri:"community/contest-entries",methods:["POST"]},"contest-entries.destroy":{uri:"community/contest-entries/{contest_entry}",methods:["DELETE"],parameters:["contest_entry"]},"livestreams.promote":{uri:"community/livestreams/promote",methods:["POST"]},"livestreams.index":{uri:"community/livestreams",methods:["GET","HEAD"]},"matches.show":{uri:"community/matches/{match}",methods:["GET","HEAD"],parameters:["match"]},"tournaments.unregister":{uri:"community/tournaments/{tournament}/unregister",methods:["POST"],parameters:["tournament"]},"tournaments.register":{uri:"community/tournaments/{tournament}/register",methods:["POST"],parameters:["tournament"]},"tournaments.index":{uri:"community/tournaments",methods:["GET","HEAD"]},"tournaments.show":{uri:"community/tournaments/{tournament}",methods:["GET","HEAD"],parameters:["tournament"]},"forum.forum-covers.store":{uri:"community/forums/forum-covers",methods:["POST"]},"forum.forum-covers.update":{uri:"community/forums/forum-covers/{forum_cover}",methods:["PUT","PATCH"],parameters:["forum_cover"]},"forum.forum-covers.destroy":{uri:"community/forums/forum-covers/{forum_cover}",methods:["DELETE"],parameters:["forum_cover"]},"forum.posts.raw":{uri:"community/forums/posts/{post}/raw",methods:["GET","HEAD"],parameters:["post"]},"forum.posts.restore":{uri:"community/forums/posts/{post}/restore",methods:["POST"],parameters:["post"]},"forum.posts.show":{uri:"community/forums/posts/{post}",methods:["GET","HEAD"],parameters:["post"]},"forum.posts.edit":{uri:"community/forums/posts/{post}/edit",methods:["GET","HEAD"],parameters:["post"]},"forum.posts.update":{uri:"community/forums/posts/{post}",methods:["PUT","PATCH"],parameters:["post"]},"forum.posts.destroy":{uri:"community/forums/posts/{post}",methods:["DELETE"],parameters:["post"]},"forum.topics.logs.index":{uri:"community/forums/topics/{topic}/logs",methods:["GET","HEAD"],parameters:["topic"]},"forum.topics.edit-poll.store":{uri:"community/forums/topics/{topic}/edit-poll",methods:["POST"],parameters:["topic"]},"forum.topics.edit-poll":{uri:"community/forums/topics/{topic}/edit-poll",methods:["GET","HEAD"],parameters:["topic"]},"forum.topics.issue-tag":{uri:"community/forums/topics/{topic}/issue-tag",methods:["POST"],parameters:["topic"]},"forum.topics.lock":{uri:"community/forums/topics/{topic}/lock",methods:["POST"],parameters:["topic"]},"forum.topics.move":{uri:"community/forums/topics/{topic}/move",methods:["POST"],parameters:["topic"]},"forum.topics.pin":{uri:"community/forums/topics/{topic}/pin",methods:["POST"],parameters:["topic"]},"forum.topics.reply":{uri:"community/forums/topics/{topic}/reply",methods:["POST"],parameters:["topic"]},"forum.topics.restore":{uri:"community/forums/topics/{topic}/restore",methods:["POST"],parameters:["topic"]},"forum.topics.vote":{uri:"community/forums/topics/{topic}/vote",methods:["POST"],parameters:["topic"]},"forum.topics.vote-feature":{uri:"community/forums/topics/{topic}/vote-feature",methods:["POST"],parameters:["topic"]},"forum.preview":{uri:"community/forums/topics/preview",methods:["POST"]},"forum.topics.create":{uri:"community/forums/topics/create",methods:["GET","HEAD"]},"forum.topics.store":{uri:"community/forums/topics",methods:["POST"]},"forum.topics.show":{uri:"community/forums/topics/{topic}",methods:["GET","HEAD"],parameters:["topic"]},"forum.topics.update":{uri:"community/forums/topics/{topic}",methods:["PUT","PATCH"],parameters:["topic"]},"forum.topics.destroy":{uri:"community/forums/topics/{topic}",methods:["DELETE"],parameters:["topic"]},"forum.topic-covers.store":{uri:"community/forums/topic-covers",methods:["POST"]},"forum.topic-covers.update":{uri:"community/forums/topic-covers/{topic_cover}",methods:["PUT","PATCH"],parameters:["topic_cover"]},"forum.topic-covers.destroy":{uri:"community/forums/topic-covers/{topic_cover}",methods:["DELETE"],parameters:["topic_cover"]},"forum.redirect:follows.index":{uri:"community/forums/topic-watches",methods:["GET","HEAD"]},"forum.topic-watches.update":{uri:"community/forums/topic-watches/{topic_watch}",methods:["PUT","PATCH"],parameters:["topic_watch"]},"forum.forums.mark-as-read":{uri:"community/forums/mark-as-read",methods:["POST"]},"forum.forums.index":{uri:"community/forums",methods:["GET","HEAD"]},"forum.forums.show":{uri:"community/forums/{forum}",methods:["GET","HEAD"],parameters:["forum"]},"chat.ack":{uri:"community/chat/ack",methods:["POST"]},"chat.new":{uri:"community/chat/new",methods:["POST"]},"chat.presence":{uri:"community/chat/presence",methods:["GET","HEAD"]},"chat.updates":{uri:"community/chat/updates",methods:["GET","HEAD"]},"chat.channels.messages.index":{uri:"community/chat/channels/{channel}/messages",methods:["GET","HEAD"],parameters:["channel"]},"chat.channels.messages.store":{uri:"community/chat/channels/{channel}/messages",methods:["POST"],parameters:["channel"]},"chat.channels.join":{uri:"community/chat/channels/{channel}/users/{user}",methods:["PUT"],parameters:["channel","user"]},"chat.channels.part":{uri:"community/chat/channels/{channel}/users/{user}",methods:["DELETE"],parameters:["channel","user"]},"chat.channels.mark-as-read":{uri:"community/chat/channels/{channel}/mark-as-read/{message}",methods:["PUT"],parameters:["channel","message"]},"chat.channels.index":{uri:"community/chat/channels",methods:["GET","HEAD"]},"chat.channels.store":{uri:"community/chat/channels",methods:["POST"]},"chat.channels.show":{uri:"community/chat/channels/{channel}",methods:["GET","HEAD"],parameters:["channel"]},"chat.index":{uri:"community/chat",methods:["GET","HEAD"]},"group-history.index":{uri:"groups/history",methods:["GET","HEAD"]},"groups.show":{uri:"groups/{group}",methods:["GET","HEAD"],parameters:["group"]},"account.edit":{uri:"home/account/edit",methods:["GET","HEAD"]},"account.avatar":{uri:"home/account/avatar",methods:["POST"]},"account.country":{uri:"home/account/country",methods:["PUT"]},"account.cover":{uri:"home/account/cover",methods:["POST"]},"account.email":{uri:"home/account/email",methods:["PUT"]},"account.notification-options":{uri:"home/account/notification-options",methods:["PUT"]},"account.options":{uri:"home/account/options",methods:["PUT"]},"account.password":{uri:"home/account/password",methods:["PUT"]},"account.reissue-code":{uri:"home/account/reissue-code",methods:["POST"]},"account.sessions.destroy":{uri:"home/account/sessions/{session}",methods:["DELETE"],parameters:["session"]},"account.":{uri:"home/account/verify",methods:["GET","HEAD"]},"account.verify":{uri:"home/account/verify",methods:["POST"]},"account.update":{uri:"home/account",methods:["PUT"]},"account.github-users.callback":{uri:"home/account/github-users/callback",methods:["GET","HEAD"]},"account.github-users.create":{uri:"home/account/github-users/create",methods:["GET","HEAD"]},"account.github-users.destroy":{uri:"home/account/github-users",methods:["DELETE"]},"quick-search":{uri:"home/quick-search",methods:["GET","HEAD"]},search:{uri:"home/search",methods:["GET","HEAD"]},"bbcode-preview":{uri:"home/bbcode-preview",methods:["POST"]},"changelog.build":{uri:"home/changelog/{stream}/{build}",methods:["GET","HEAD"],parameters:["stream","build"]},"changelog.index":{uri:"home/changelog",methods:["GET","HEAD"]},"changelog.show":{uri:"home/changelog/{changelog}",methods:["GET","HEAD"],parameters:["changelog"]},download:{uri:"home/download",methods:["GET","HEAD"]},"set-locale":{uri:"home/set-locale",methods:["POST"]},"support-the-game":{uri:"home/support",methods:["GET","HEAD"]},testflight:{uri:"home/testflight",methods:["GET","HEAD"]},"password-reset":{uri:"home/password-reset",methods:["GET","HEAD"]},"password-reset.reset":{uri:"home/password-reset/reset",methods:["GET","HEAD"]},"password-reset.resend-mail":{uri:"home/password-reset/resend-mail",methods:["POST"]},"download-quota-check":{uri:"home/download-quota-check",methods:["GET","HEAD"]},"blocks.store":{uri:"home/blocks",methods:["POST"]},"blocks.destroy":{uri:"home/blocks/{block}",methods:["DELETE"],parameters:["block"]},"friends.index":{uri:"home/friends",methods:["GET","HEAD"]},"friends.store":{uri:"home/friends",methods:["POST"]},"friends.destroy":{uri:"home/friends/{friend}",methods:["DELETE"],parameters:["friend"]},"news.index":{uri:"home/news",methods:["GET","HEAD"]},"news.store":{uri:"home/news",methods:["POST"]},"news.show":{uri:"home/news/{news}",methods:["GET","HEAD"],parameters:["news"]},"news.update":{uri:"home/news/{news}",methods:["PUT","PATCH"],parameters:["news"]},"messages.users.show":{uri:"home/messages/users/{user}",methods:["GET","HEAD"],parameters:["user"]},"follows.store":{uri:"home/follows",methods:["POST"]},"follows.index":{uri:"home/follows/{subtype?}",methods:["GET","HEAD"],parameters:["subtype"]},"follows.destroy":{uri:"home/follows",methods:["DELETE"]},"legacy-api-key.store":{uri:"legacy-api-key",methods:["POST"]},"legacy-api-key.destroy":{uri:"legacy-api-key",methods:["DELETE"]},"legacy-irc-key.store":{uri:"legacy-irc-key",methods:["POST"]},"legacy-irc-key.destroy":{uri:"legacy-irc-key",methods:["DELETE"]},"notifications.index":{uri:"notifications",methods:["GET","HEAD"]},"notifications.endpoint":{uri:"notifications/endpoint",methods:["GET","HEAD"]},"notifications.mark-read":{uri:"notifications/mark-read",methods:["POST"]},legal:{uri:"legal/{locale?}/{path?}",methods:["GET","HEAD"],parameters:["locale","path"]},"multiplayer.rooms.show":{uri:"multiplayer/rooms/{room}",methods:["GET","HEAD"],parameters:["room"]},"oauth.authorized-clients.destroy":{uri:"oauth/authorized-clients/{authorized_client}",methods:["DELETE"],parameters:["authorized_client"]},"oauth.clients.index":{uri:"oauth/clients",methods:["GET","HEAD"]},"oauth.clients.store":{uri:"oauth/clients",methods:["POST"]},"oauth.clients.update":{uri:"oauth/clients/{client}",methods:["PUT","PATCH"],parameters:["client"]},"oauth.clients.destroy":{uri:"oauth/clients/{client}",methods:["DELETE"],parameters:["client"]},"oauth.clients.reset-secret":{uri:"oauth/clients/{client}/reset-secret",methods:["POST"],parameters:["client"]},"rankings.kudosu":{uri:"rankings/kudosu",methods:["GET","HEAD"]},"daily-challenge.index":{uri:"rankings/daily-challenge",methods:["GET","HEAD"]},"daily-challenge.show":{uri:"rankings/daily-challenge/{daily_challenge}",methods:["GET","HEAD"],parameters:["daily_challenge"]},rankings:{uri:"rankings/{mode?}/{type?}",methods:["GET","HEAD"],parameters:["mode","type"]},"reports.store":{uri:"reports",methods:["POST"]},"seasons.show":{uri:"seasons/{season}",methods:["GET","HEAD"],parameters:["season"]},"seasons.rooms":{uri:"seasons/{season}/rooms",methods:["GET","HEAD"],parameters:["season"]},login:{uri:"session",methods:["POST"]},logout:{uri:"session",methods:["DELETE"]},"user-cover-presets.batch-activate":{uri:"user-cover-presets/batch-activate",methods:["POST"]},"user-cover-presets.index":{uri:"user-cover-presets",methods:["GET","HEAD"]},"user-cover-presets.store":{uri:"user-cover-presets",methods:["POST"]},"user-cover-presets.update":{uri:"user-cover-presets/{user_cover_preset}",methods:["PUT","PATCH"],parameters:["user_cover_preset"]},"users.check-username-availability":{uri:"users/check-username-availability",methods:["POST"]},"users.lookup-users":{uri:"users/lookup-users",methods:["POST"]},"users.disabled":{uri:"users/disabled",methods:["GET","HEAD"]},"users.create":{uri:"users/create",methods:["GET","HEAD"]},"users.store-web":{uri:"users/store-web",methods:["POST"]},"users.card":{uri:"users/{user}/card",methods:["GET","HEAD"],parameters:["user"]},"users.extra-page":{uri:"users/{user}/extra-pages/{page}",methods:["GET","HEAD"],parameters:["user","page"]},"users.page":{uri:"users/{user}/page",methods:["PUT"],parameters:["user"]},"users.multiplayer.index":{uri:"users/{user}/{typeGroup}",methods:["GET","HEAD"],wheres:{typeGroup:"multiplayer|playlists|realtime"},parameters:["user","typeGroup"]},"users.modding.index":{uri:"users/{user}/modding",methods:["GET","HEAD"],parameters:["user"]},"users.modding.posts":{uri:"users/{user}/modding/posts",methods:["GET","HEAD"],parameters:["user"]},"users.modding.votes-given":{uri:"users/{user}/modding/votes-given",methods:["GET","HEAD"],parameters:["user"]},"users.modding.votes-received":{uri:"users/{user}/modding/votes-received",methods:["GET","HEAD"],parameters:["user"]},"users.kudosu":{uri:"users/{user}/kudosu",methods:["GET","HEAD"],parameters:["user"]},"users.recent-activity":{uri:"users/{user}/recent_activity",methods:["GET","HEAD"],parameters:["user"]},"users.scores":{uri:"users/{user}/scores/{type}",methods:["GET","HEAD"],parameters:["user","type"]},"users.beatmapsets":{uri:"users/{user}/beatmapsets/{type}",methods:["GET","HEAD"],parameters:["user","type"]},"users.posts":{uri:"users/{user}/posts",methods:["GET","HEAD"],parameters:["user"]},"users.show":{uri:"users/{user}/{mode?}",methods:["GET","HEAD"],parameters:["user","mode"]},"users.store":{uri:"users",methods:["POST"]},"wiki.sitemap":{uri:"wiki/{locale}/Sitemap",methods:["GET","HEAD"],parameters:["locale"]},"wiki.show":{uri:"wiki/{locale?}/{path?}",methods:["GET","HEAD"],wheres:{path:".+"},parameters:["locale","path"]},"wiki-suggestions":{uri:"wiki-suggestions",methods:["GET","HEAD"]},"store.redirect:store.products.index":{uri:"store",methods:["GET","HEAD"]},"store.products.index":{uri:"store/listing",methods:["GET","HEAD"]},"store.invoice.show":{uri:"store/invoice/{invoice}",methods:["GET","HEAD"],parameters:["invoice"]},"store.notification-request":{uri:"store/products/{product}/notification-request",methods:["POST"],parameters:["product"]},"store.":{uri:"store/products/{product}/notification-request",methods:["DELETE"],parameters:["product"]},"store.cart.show":{uri:"store/cart",methods:["GET","HEAD"]},"store.cart.empty":{uri:"store/cart",methods:["DELETE"]},"store.cart.store":{uri:"store/cart",methods:["POST"]},"store.checkout.store":{uri:"store/checkout",methods:["POST"]},"store.checkout.show":{uri:"store/checkout/{checkout}",methods:["GET","HEAD"],parameters:["checkout"]},"store.orders.index":{uri:"store/orders",methods:["GET","HEAD"]},"store.orders.destroy":{uri:"store/orders/{order}",methods:["DELETE"],parameters:["order"]},"store.redirect:store.products.show":{uri:"store/product/{product}",methods:["GET","HEAD"],parameters:["product"]},"store.products.show":{uri:"store/products/{product}",methods:["GET","HEAD"],parameters:["product"]},"payments.paypal.approved":{uri:"payments/paypal/approved",methods:["GET","HEAD"]},"payments.paypal.declined":{uri:"payments/paypal/declined",methods:["GET","HEAD"]},"payments.paypal.create":{uri:"payments/paypal/create",methods:["POST"]},"payments.paypal.completed":{uri:"payments/paypal/completed",methods:["GET","HEAD"]},"payments.paypal.ipn":{uri:"payments/paypal/ipn",methods:["POST"]},"payments.xsolla.completed":{uri:"payments/xsolla/completed",methods:["GET","HEAD"]},"payments.xsolla.token":{uri:"payments/xsolla/token",methods:["POST"]},"payments.xsolla.callback":{uri:"payments/xsolla/callback",methods:["POST"]},"payments.shopify.callback":{uri:"payments/shopify/callback",methods:["POST"]},home:{uri:"/",methods:["GET","HEAD"]},"redirect:forum.posts.show":{uri:"forum/p/{post}",methods:["GET","HEAD"],parameters:["post"]},"redirect:forum.posts.show:":{uri:"po/{post}",methods:["GET","HEAD"],parameters:["post"]},"redirect:forum.topics.show":{uri:"forum/t/{topic}",methods:["GET","HEAD"],parameters:["topic"]},"redirect:forum.forums.show":{uri:"forum/{forum}",methods:["GET","HEAD"],parameters:["forum"]},"redirect:beatmaps.show":{uri:"b/{beatmap}",methods:["GET","HEAD"],parameters:["beatmap"]},"redirect:groups.show":{uri:"g/{group}",methods:["GET","HEAD"],parameters:["group"]},"redirect:beatmapsets.show":{uri:"s/{beatmapset}",methods:["GET","HEAD"],parameters:["beatmapset"]},"redirect:users.show":{uri:"u/{user}",methods:["GET","HEAD"],parameters:["user"]},"redirect:forum.forums.index":{uri:"forum",methods:["GET","HEAD"]},"redirect:matches.show":{uri:"mp/{match}",methods:["GET","HEAD"],parameters:["match"]},"redirect:wiki.show":{uri:"help/wiki/{path?}",methods:["GET","HEAD"],wheres:{path:".+"},parameters:["path"]},"api.verify":{uri:"api/v2/session/verify",methods:["POST"]},"api.verify.reissue":{uri:"api/v2/session/verify/reissue",methods:["POST"]},"api.beatmaps.lookup":{uri:"api/v2/beatmaps/lookup",methods:["GET","HEAD"]},"api.beatmaps.packs.index":{uri:"api/v2/beatmaps/packs",methods:["GET","HEAD"]},"api.beatmaps.packs.show":{uri:"api/v2/beatmaps/packs/{pack}",methods:["GET","HEAD"],parameters:["pack"]},"api.beatmaps.user.score":{uri:"api/v2/beatmaps/{beatmap}/scores/users/{user}",methods:["GET","HEAD"],parameters:["beatmap","user"]},"api.beatmaps.user.scores":{uri:"api/v2/beatmaps/{beatmap}/scores/users/{user}/all",methods:["GET","HEAD"],parameters:["beatmap","user"]},"api.beatmaps.scores":{uri:"api/v2/beatmaps/{beatmap}/scores",methods:["GET","HEAD"],parameters:["beatmap"]},"api.beatmaps.solo-scores":{uri:"api/v2/beatmaps/{beatmap}/solo-scores",methods:["GET","HEAD"],parameters:["beatmap"]},"api.beatmaps.solo.score-tokens.store":{uri:"api/v2/beatmaps/{beatmap}/solo/scores",methods:["POST"],parameters:["beatmap"]},"api.beatmaps.solo.scores.store":{uri:"api/v2/beatmaps/{beatmap}/solo/scores/{token}",methods:["PUT"],parameters:["beatmap","token"]},"api.beatmaps.index":{uri:"api/v2/beatmaps",methods:["GET","HEAD"]},"api.beatmaps.show":{uri:"api/v2/beatmaps/{beatmap}",methods:["GET","HEAD"],parameters:["beatmap"]},"api.beatmaps.attributes":{uri:"api/v2/beatmaps/{beatmap}/attributes",methods:["POST"],parameters:["beatmap"]},"api.beatmapsets.events.index":{uri:"api/v2/beatmapsets/events",methods:["GET","HEAD"]},"api.beatmapsets.discussions.posts.index":{uri:"api/v2/beatmapsets/discussions/posts",methods:["GET","HEAD"]},"api.beatmapsets.discussions.votes.index":{uri:"api/v2/beatmapsets/discussions/votes",methods:["GET","HEAD"]},"api.beatmapsets.discussions.index":{uri:"api/v2/beatmapsets/discussions",methods:["GET","HEAD"]},"api.beatmapsets.favourites.store":{uri:"api/v2/beatmapsets/{beatmapset}/favourites",methods:["POST"],parameters:["beatmapset"]},"api.comments.index":{uri:"api/v2/comments",methods:["GET","HEAD"]},"api.comments.store":{uri:"api/v2/comments",methods:["POST"]},"api.comments.show":{uri:"api/v2/comments/{comment}",methods:["GET","HEAD"],parameters:["comment"]},"api.comments.update":{uri:"api/v2/comments/{comment}",methods:["PUT","PATCH"],parameters:["comment"]},"api.comments.destroy":{uri:"api/v2/comments/{comment}",methods:["DELETE"],parameters:["comment"]},"api.comments.vote":{uri:"api/v2/comments/{comment}/vote",methods:["POST"],parameters:["comment"]},"api.":{uri:"api/v2/beatmapsets/{beatmapset}/download",methods:["GET","HEAD"],parameters:["beatmapset"]},"api.chat.ack":{uri:"api/v2/chat/ack",methods:["POST"]},"api.chat.new":{uri:"api/v2/chat/new",methods:["POST"]},"api.chat.updates":{uri:"api/v2/chat/updates",methods:["GET","HEAD"]},"api.chat.presence":{uri:"api/v2/chat/presence",methods:["GET","HEAD"]},"api.chat.channels.messages.index":{uri:"api/v2/chat/channels/{channel}/messages",methods:["GET","HEAD"],parameters:["channel"]},"api.chat.channels.messages.store":{uri:"api/v2/chat/channels/{channel}/messages",methods:["POST"],parameters:["channel"]},"api.chat.channels.join":{uri:"api/v2/chat/channels/{channel}/users/{user}",methods:["PUT"],parameters:["channel","user"]},"api.chat.channels.part":{uri:"api/v2/chat/channels/{channel}/users/{user}",methods:["DELETE"],parameters:["channel","user"]},"api.chat.channels.mark-as-read":{uri:"api/v2/chat/channels/{channel}/mark-as-read/{message}",methods:["PUT"],parameters:["channel","message"]},"api.chat.channels.index":{uri:"api/v2/chat/channels",methods:["GET","HEAD"]},"api.chat.channels.store":{uri:"api/v2/chat/channels",methods:["POST"]},"api.chat.channels.show":{uri:"api/v2/chat/channels/{channel}",methods:["GET","HEAD"],parameters:["channel"]},"api.changelog.build":{uri:"api/v2/changelog/{stream}/{build}",methods:["GET","HEAD"],parameters:["stream","build"]},"api.changelog.index":{uri:"api/v2/changelog",methods:["GET","HEAD"]},"api.changelog.show":{uri:"api/v2/changelog/{changelog}",methods:["GET","HEAD"],parameters:["changelog"]},"api.events.index":{uri:"api/v2/events",methods:["GET","HEAD"]},"api.forum.topics.reply":{uri:"api/v2/forums/topics/{topic}/reply",methods:["POST"],parameters:["topic"]},"api.forum.topics.store":{uri:"api/v2/forums/topics",methods:["POST"]},"api.forum.topics.show":{uri:"api/v2/forums/topics/{topic}",methods:["GET","HEAD"],parameters:["topic"]},"api.forum.topics.update":{uri:"api/v2/forums/topics/{topic}",methods:["PUT","PATCH"],parameters:["topic"]},"api.forum.posts.update":{uri:"api/v2/forums/posts/{post}",methods:["PUT","PATCH"],parameters:["post"]},"api.matches.index":{uri:"api/v2/matches",methods:["GET","HEAD"]},"api.matches.show":{uri:"api/v2/matches/{match}",methods:["GET","HEAD"],parameters:["match"]},"api.reports.store":{uri:"api/v2/reports",methods:["POST"]},"api.rooms.join":{uri:"api/v2/rooms/{room}/users/{user}",methods:["PUT"],parameters:["room","user"]},"api.rooms.part":{uri:"api/v2/rooms/{room}/users/{user}",methods:["DELETE"],parameters:["room","user"]},"api.rooms.":{uri:"api/v2/rooms/{room}/leaderboard",methods:["GET","HEAD"],parameters:["room"]},"api.rooms.playlist.":{uri:"api/v2/rooms/{room}/playlist/{playlist}/scores/users/{user}",methods:["GET","HEAD"],parameters:["room","playlist","user"]},"api.rooms.playlist.scores.index":{uri:"api/v2/rooms/{room}/playlist/{playlist}/scores",methods:["GET","HEAD"],parameters:["room","playlist"]},"api.rooms.playlist.scores.store":{uri:"api/v2/rooms/{room}/playlist/{playlist}/scores",methods:["POST"],parameters:["room","playlist"]},"api.rooms.playlist.scores.show":{uri:"api/v2/rooms/{room}/playlist/{playlist}/scores/{score}",methods:["GET","HEAD"],parameters:["room","playlist","score"]},"api.rooms.playlist.scores.update":{uri:"api/v2/rooms/{room}/playlist/{playlist}/scores/{score}",methods:["PUT","PATCH"],parameters:["room","playlist","score"]},"api.rooms.index":{uri:"api/v2/rooms",methods:["GET","HEAD"]},"api.rooms.store":{uri:"api/v2/rooms",methods:["POST"]},"api.rooms.show":{uri:"api/v2/rooms/{room}",methods:["GET","HEAD"],parameters:["room"]},"api.seasonal-backgrounds.index":{uri:"api/v2/seasonal-backgrounds",methods:["GET","HEAD"]},"api.scores.download":{uri:"api/v2/scores/{score}/download",methods:["GET","HEAD"],parameters:["score"]},"api.scores.download-legacy":{uri:"api/v2/scores/{rulesetOrScore}/{score}/download",methods:["GET","HEAD"],parameters:["rulesetOrScore","score"]},"api.scores.show":{uri:"api/v2/scores/{rulesetOrScore}/{score?}",methods:["GET","HEAD"],parameters:["rulesetOrScore","score"]},"api.beatmapsets.show":{uri:"api/v2/beatmapsets/{beatmapset}",methods:["GET","HEAD"],parameters:["beatmapset"]},"api.friends.index":{uri:"api/v2/friends",methods:["GET","HEAD"]},"api.download-quota-check":{uri:"api/v2/me/download-quota-check",methods:["GET","HEAD"]},"api.me":{uri:"api/v2/me/{mode?}",methods:["GET","HEAD"],parameters:["mode"]},"api.oauth.tokens.current":{uri:"api/v2/oauth/tokens/current",methods:["DELETE"]},"api.news.index":{uri:"api/v2/news",methods:["GET","HEAD"]},"api.news.show":{uri:"api/v2/news/{news}",methods:["GET","HEAD"],parameters:["news"]},"api.notifications.index":{uri:"api/v2/notifications",methods:["GET","HEAD"]},"api.notifications.mark-read":{uri:"api/v2/notifications/mark-read",methods:["POST"]},"api.rankings":{uri:"api/v2/rankings/{mode}/{type}",methods:["GET","HEAD"],parameters:["mode","type"]},"api.spotlights.index":{uri:"api/v2/spotlights",methods:["GET","HEAD"]},"api.users.show":{uri:"api/v2/users/{user}/{mode?}",methods:["GET","HEAD"],parameters:["user","mode"]},"api.users.index":{uri:"api/v2/users",methods:["GET","HEAD"]},"api.wiki.show":{uri:"api/v2/wiki/{locale}/{path}",methods:["GET","HEAD"],wheres:{path:".+"},parameters:["locale","path"]},"interop.":{uri:"_lio/artist-tracks/reindex-all",methods:["POST"]},"interop.beatmapsets.broadcast-new":{uri:"_lio/beatmapsets/{beatmapset}/broadcast-new",methods:["POST"],parameters:["beatmapset"]},"interop.beatmapsets.broadcast-revive":{uri:"_lio/beatmapsets/{beatmapset}/broadcast-revive",methods:["POST"],parameters:["beatmapset"]},"interop.beatmapsets.disqualify":{uri:"_lio/beatmapsets/{beatmapset}/disqualify",methods:["POST"],parameters:["beatmapset"]},"interop.beatmapsets.destroy":{uri:"_lio/beatmapsets/{beatmapset}",methods:["DELETE"],parameters:["beatmapset"]},"interop.indexing.bulk.store":{uri:"_lio/indexing/bulk",methods:["POST"]},"interop.users.achievement":{uri:"_lio/user-achievement/{user}/{achievement}/{beatmap?}",methods:["POST"],parameters:["user","achievement","beatmap"]},"interop.user-group.update":{uri:"_lio/users/{user}/groups/{group}",methods:["PUT"],parameters:["user","group"]},"interop.user-group.destroy":{uri:"_lio/users/{user}/groups/{group}",methods:["DELETE"],parameters:["user","group"]},"interop.user-group.set-default":{uri:"_lio/users/{user}/groups/{group}/default",methods:["POST"],parameters:["user","group"]},"interop.users.store":{uri:"_lio/users",methods:["POST"]}}};"undefined"!=typeof window&&void 0!==window.Ziggy&&Object.assign(i.routes,window.Ziggy.routes);var a=s(5948),n=s.n(a);const o=(0,r.bS)();function l(e,t,s){return n()(e,t,s,i)}i.port=+o.port||null,i.url=o.origin},1091:(e,t,s)=>{s.d(t,{Ei:()=>c,I$:()=>u,K9:()=>l,lx:()=>d,s1:()=>o});var r=s(6540),i=s(2811),a=s(6606),n=s(1980);const o=r.createContext({inLink:!1});function l(e){return function(t){return r.createElement(e,null,u(t.children))}}function c(e){const t=(0,a.ML)(e.href),s=(0,n.Nd)(t.href),i=null==t.children||e.children instanceof Array&&e.children.length>0&&e.children[0]!==e.href?e.children:t.children;return r.createElement(o.Consumer,null,(({inLink:e})=>r.createElement(o.Provider,{value:{inLink:!0}},e?i:r.createElement("a",Object.assign({},t,{href:s}),i))))}function u(e){var t;if("string"==typeof e){const s=[...e.matchAll(a.Fm)];if(s.length>0){let i=0;const a=[];for(const o of s){const s=null!==(t=o.index)&&void 0!==t?t:0,l=e.substring(i,s);a.push(l);const[,,,c,u,d,p]=o,m=`${c}:${u}:${d}${null!=p?p:""}`;a.push(r.createElement("a",{key:`timestamp-${s}`,className:"beatmap-discussion-timestamp-decoration",href:(0,n.Ir)(m)},m)),i=s+o[0].length}return a.push(e.substring(i,e.length)),a}}else if(Array.isArray(e))return e.map(u);return e}function d(e){return e.startsWith("osu://edit/")?e:(0,i.Q)(e)}},7542:(e,t,s)=>{s.d(t,{A:()=>b,s:()=>m});var r=s(903),i=s(6595),a=s(2543),n=s(7813),o=s(8443),l=s(6823),c=s(1250),u=function(e,t,s,r){var i,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(n=(a<3?i(n):a>3?i(t,s,n):i(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n},d=function(e,t,s,r){return new(s||(s=Promise))((function(i,a){function n(e){try{l(r.next(e))}catch(t){a(t)}}function o(e){try{l(r.throw(e))}catch(t){a(t)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(n,o)}l((r=r.apply(e,t||[])).next())}))};const p=new Set(["ANNOUNCE","PM"]),m=1024;class h{get announcementUsers(){return this.usersLoaded?this.userIds.map((e=>l.A.dataStore.userStore.get(e))).filter((e=>null!=e)).sort(o.Vg):null}get canMessage(){return null==this.canMessageError}get firstMessage(){return this.messages.length>0?this.messages[0]:void 0}get hasEarlierMessages(){return this.firstMessageId!==this.minMessageId}get isDisplayable(){return this.name.length>0&&null!=this.icon}get isHideable(){return p.has(this.type)}get isUnread(){return null!=this.lastReadId?this.lastMessageId>this.lastReadId:this.lastMessageId>-1}get lastMessage(){return this.messages[this.messages.length-1]}get lastMessageId(){var e;for(let t=this.messages.length-1;t>=0;t--)if("number"==typeof this.messages[t].messageId)return this.messages[t].messageId;return null!==(e=this.serverLastMessageId)&&void 0!==e?e:-1}get messages(){return(0,a.sortBy)([...this.messagesMap.values()],["timestamp","channelId"])}get minMessageId(){const e=this.messages.length>0?this.messages[0].messageId:void 0;return"number"==typeof e?e:-1}get pmTarget(){if("PM"===this.type)return this.userIds.find((e=>e!==l.A.currentUserOrFail.id))}get supportedType(){return i.f4.has(this.type)?this.type:null}constructor(e){Object.defineProperty(this,"canMessageError",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"channelId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstMessageId",{enumerable:!0,configurable:!0,writable:!0,value:-1}),Object.defineProperty(this,"icon",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputText",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"lastReadId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"loadingEarlierMessages",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"loadingMessages",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"messageLengthLimit",{enumerable:!0,configurable:!0,writable:!0,value:m}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"needsRefresh",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"newPmChannel",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"throttledSendMarkAsRead",{enumerable:!0,configurable:!0,writable:!0,value:(0,a.throttle)((()=>this.sendMarkAsRead()),1e3)}),Object.defineProperty(this,"type",{enumerable:!0,configurable:!0,writable:!0,value:"TEMPORARY"}),Object.defineProperty(this,"uiState",{enumerable:!0,configurable:!0,writable:!0,value:{autoScroll:!0,scrollY:0}}),Object.defineProperty(this,"userIds",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"markAsReadLastSent",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"messagesMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"serverLastMessageId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"usersLoaded",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.channelId=e,(0,n.Gn)(this)}static newPM(e,t){const s=new h(null!=t?t:-1);return s.newPmChannel=null==t,s.type="PM",s.name=e.username,s.icon=e.avatarUrl,s.userIds=[l.A.currentUserOrFail.id,e.id],s}addMessage(e){var t;if(null!=e.uuid&&e.sender_id===(null===(t=l.A.currentUser)||void 0===t?void 0:t.id)){const t=this.messagesMap.get(e.uuid);if(null!=t)return this.persistMessage(t,e)}const s=c.A.fromJson(e);this.messagesMap.set(s.messageId,s)}addMessages(e){e.forEach((e=>this.messagesMap.set(e.messageId,e)))}addSendingMessage(e){this.messagesMap.set(e.messageId,e),this.moveMarkAsReadMarker()}afterSendMesssage(e,t){null!=t?(this.persistMessage(e,t),this.setLastReadId(t.message_id)):e.errored=!0}load(){this.newPmChannel||("ANNOUNCE"!==this.type||this.usersLoaded||this.loadMetadata(),this.loadRecentMessages())}loadEarlierMessages(){return d(this,void 0,void 0,(function*(){if(!this.hasEarlierMessages||this.loadingEarlierMessages)return;let e;this.loadingEarlierMessages=!0,this.minMessageId>0&&(e=this.minMessageId);try{const t=yield(0,r.VL)(this.channelId,{until:e});(0,n.h5)((()=>{this.addMessages(t),0===t.length&&(this.firstMessageId=this.minMessageId)}))}finally{(0,n.h5)((()=>{this.loadingEarlierMessages=!1}))}}))}loadMetadata(){(0,r.c)(this.channelId).done((e=>{(0,n.h5)((()=>{this.updateWithJson(e),this.usersLoaded=!0}))}))}moveMarkAsReadMarker(){this.setLastReadId(this.lastMessageId)}removeMessagesFromUserIds(e){for(const[,t]of this.messagesMap)e.has(t.senderId)&&this.messagesMap.delete(t.messageId)}setInputText(e){this.inputText=e}updateWithJson(e){var t,s,r;if(this.name=e.name,this.description=e.description,this.type=e.type,this.icon=null!==(t=e.icon)&&void 0!==t?t:h.defaultIcon,this.messageLengthLimit=e.message_length_limit,this.userIds=null!==(s=e.users)&&void 0!==s?s:this.userIds,this.serverLastMessageId=e.last_message_id,null!=e.current_user_attributes){this.canMessageError=e.current_user_attributes.can_message_error;const t=null!==(r=e.current_user_attributes.last_read_id)&&void 0!==r?r:0;this.setLastReadId(t),t>this.markAsReadLastSent&&(this.markAsReadLastSent=t)}}loadRecentMessages(){return d(this,void 0,void 0,(function*(){if(!this.needsRefresh||this.loadingMessages)return;let e;this.loadingMessages=!0,this.messages.length>0&&this.lastMessageId>0&&(e=this.lastMessageId);try{const t=yield(0,r.VL)(this.channelId);(0,n.h5)((()=>{const s=function(e){let t;for(const s of e)"number"==typeof s.messageId&&(null==t||s.messageId<t)&&(t=s.messageId);return null!=t?t:-1}(t);s>this.lastMessageId&&this.messagesMap.clear(),this.addMessages(t),this.needsRefresh=!1,this.loadingMessages=!1,0!==t.length||null!=e||(this.firstMessageId=this.minMessageId)}))}catch(t){(0,n.h5)((()=>this.loadingMessages=!1))}}))}persistMessage(e,t){null!=t.uuid&&this.messagesMap.delete(t.uuid),e.persist(t),this.messagesMap.set(e.messageId,e)}sendMarkAsRead(){var e;const t=null!==(e=this.lastReadId)&&void 0!==e?e:0;this.markAsReadLastSent>=t||(this.markAsReadLastSent=t,(0,r.aI)(this.channelId,t))}setLastReadId(e){var t;e>(null!==(t=this.lastReadId)&&void 0!==t?t:0)&&(this.lastReadId=e)}}Object.defineProperty(h,"defaultIcon",{enumerable:!0,configurable:!0,writable:!0,value:"/images/layout/chat/channel-default.png"});const b=h;u([n.sH],h.prototype,"canMessageError",void 0),u([n.sH],h.prototype,"channelId",void 0),u([n.sH],h.prototype,"description",void 0),u([n.sH],h.prototype,"firstMessageId",void 0),u([n.sH],h.prototype,"icon",void 0),u([n.sH],h.prototype,"inputText",void 0),u([n.sH],h.prototype,"lastReadId",void 0),u([n.sH],h.prototype,"loadingEarlierMessages",void 0),u([n.sH],h.prototype,"loadingMessages",void 0),u([n.sH],h.prototype,"messageLengthLimit",void 0),u([n.sH],h.prototype,"name",void 0),u([n.sH],h.prototype,"newPmChannel",void 0),u([n.sH],h.prototype,"type",void 0),u([n.sH],h.prototype,"uiState",void 0),u([n.sH],h.prototype,"userIds",void 0),u([n.sH],h.prototype,"messagesMap",void 0),u([n.sH],h.prototype,"usersLoaded",void 0),u([n.EW],h.prototype,"announcementUsers",null),u([n.EW],h.prototype,"canMessage",null),u([n.EW],h.prototype,"firstMessage",null),u([n.EW],h.prototype,"hasEarlierMessages",null),u([n.EW],h.prototype,"isDisplayable",null),u([n.EW],h.prototype,"isUnread",null),u([n.EW],h.prototype,"lastMessage",null),u([n.EW],h.prototype,"lastMessageId",null),u([n.EW],h.prototype,"messages",null),u([n.EW],h.prototype,"minMessageId",null),u([n.EW],h.prototype,"pmTarget",null),u([n.EW],h.prototype,"supportedType",null),u([n.XI],h.prototype,"addMessage",null),u([n.XI],h.prototype,"addMessages",null),u([n.XI],h.prototype,"addSendingMessage",null),u([n.XI],h.prototype,"afterSendMesssage",null),u([n.XI],h.prototype,"load",null),u([n.XI],h.prototype,"loadEarlierMessages",null),u([n.XI],h.prototype,"loadMetadata",null),u([n.XI],h.prototype,"moveMarkAsReadMarker",null),u([n.XI],h.prototype,"removeMessagesFromUserIds",null),u([n.XI],h.prototype,"setInputText",null),u([n.XI],h.prototype,"updateWithJson",null),u([n.XI],h.prototype,"loadRecentMessages",null),u([n.XI],h.prototype,"persistMessage",null),u([n.XI],h.prototype,"sendMarkAsRead",null),u([n.XI],h.prototype,"setLastReadId",null)},3437:(e,t,s)=>{s.d(t,{Ay:()=>p,Kd:()=>d});var r=s(7813),i=s(3938),a=s(5812),n=s(7542),o=function(e,t,s,r){var i,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(n=(a<3?i(n):a>3?i(t,s,n):i(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n};const l=["description","message","name","users"],c="createAnnouncement",u=Object.freeze({description:255,message:n.s,name:50,users:void 0});function d(e){return l.includes(e)}class p{get errors(){return{description:!this.isValidLength("description",!0),message:!this.isValidLength("message"),name:!this.isValidLength("name"),users:0===this.validUsers.size||(0,a.E)(this.inputs.users.trim())}}get isValid(){return!Object.values(this.errors).some(Boolean)}get propsForUsernameInput(){return{initialUsers:[...this.validUsers.values()],initialValue:this.inputs.users}}constructor(){Object.defineProperty(this,"inputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"showError",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"validUsers",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"initialized",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"uuid",{enumerable:!0,configurable:!0,writable:!0,value:(0,i.u)()}),this.inputs=this.resetInputs(),this.showError=this.resetErrors(),(0,r.Gn)(this)}clear(){this.resetErrors(),this.resetInputs(),this.validUsers.clear()}initialize(){if(this.initialized)return;const e=localStorage.getItem(c);if(null!=e)try{const t=JSON.parse(e);this.inputs.description=t.description,this.inputs.message=t.message,this.inputs.name=t.name,this.inputs.users=[...t.validUsers,t.users].join(",")}catch(t){console.error("invalid json in localStorage"),localStorage.removeItem(c)}(0,r.fm)((()=>{const e=Object.assign(Object.assign({},this.inputs),{validUsers:[...this.validUsers.keys()]});localStorage.setItem(c,JSON.stringify(e))})),this.initialized=!0}inputContainerPropsFor(e){return{hasError:this.errors[e],input:this.inputs[e],maxLength:u[e],showError:this.showError[e]}}toJson(){const{description:e,message:t,name:s}=this.inputs;return{channel:{description:e,name:s},message:t,target_ids:[...this.validUsers.keys()],type:"ANNOUNCE",uuid:this.uuid}}isValidLength(e,t=!1){return(t||(0,a.E)(this.inputs[e]))&&this.inputs[e].length<=u[e]}resetErrors(){return this.showError={description:!1,message:!1,name:!1,users:!1}}resetInputs(){return this.inputs={description:"",message:"",name:"",users:""}}}o([r.sH],p.prototype,"inputs",void 0),o([r.sH],p.prototype,"showError",void 0),o([r.sH],p.prototype,"validUsers",void 0),o([r.EW],p.prototype,"errors",null),o([r.EW],p.prototype,"isValid",null),o([r.XI],p.prototype,"clear",null),o([r.XI],p.prototype,"initialize",null),o([r.XI],p.prototype,"resetErrors",null),o([r.XI],p.prototype,"resetInputs",null)},1250:(e,t,s)=>{s.d(t,{A:()=>c});var r=s(7813),i=s(8443),a=s(5093),n=s(6823),o=s(3938),l=function(e,t,s,r){var i,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(n=(a<3?i(n):a>3?i(t,s,n):i(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n};class c{get sender(){var e;return null!==(e=n.A.dataStore.userStore.get(this.senderId))&&void 0!==e?e:new i.Ay(-1)}constructor(){Object.defineProperty(this,"channelId",{enumerable:!0,configurable:!0,writable:!0,value:-1}),Object.defineProperty(this,"content",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"errored",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"isAction",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"messageId",{enumerable:!0,configurable:!0,writable:!0,value:(0,o.u)()}),Object.defineProperty(this,"persisted",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"senderId",{enumerable:!0,configurable:!0,writable:!0,value:-1}),Object.defineProperty(this,"timestamp",{enumerable:!0,configurable:!0,writable:!0,value:a().toISOString()}),Object.defineProperty(this,"type",{enumerable:!0,configurable:!0,writable:!0,value:"plain"}),Object.defineProperty(this,"uuid",{enumerable:!0,configurable:!0,writable:!0,value:this.messageId}),(0,r.Gn)(this)}static fromJson(e){var t;const s=new c;return s.channelId=e.channel_id,s.content=e.content,s.isAction=e.is_action,s.messageId=e.message_id,s.persisted=!0,s.senderId=e.sender_id,s.timestamp=e.timestamp,s.type=e.type,s.uuid=null!==(t=e.uuid)&&void 0!==t?t:s.uuid,s}persist(e){this.persisted||(this.content=e.content,this.messageId=e.message_id,this.timestamp=e.timestamp,this.persisted=!0)}}l([r.sH],c.prototype,"channelId",void 0),l([r.sH],c.prototype,"content",void 0),l([r.sH],c.prototype,"errored",void 0),l([r.sH],c.prototype,"isAction",void 0),l([r.sH],c.prototype,"messageId",void 0),l([r.sH],c.prototype,"persisted",void 0),l([r.sH],c.prototype,"senderId",void 0),l([r.sH],c.prototype,"timestamp",void 0),l([r.sH],c.prototype,"type",void 0),l([r.sH],c.prototype,"uuid",void 0),l([r.EW],c.prototype,"sender",null),l([r.XI],c.prototype,"persist",null)},9207:(e,t,s)=>{s.d(t,{A:()=>o,C:()=>n});var r=s(7813),i=s(6823),a=function(e,t,s,r){var i,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(n=(a<3?i(n):a>3?i(t,s,n):i(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n};function n(){return null!=i.A.currentUser&&(i.A.currentUser.is_admin||i.A.currentUser.is_moderator)}class o{constructor(e,t){Object.defineProperty(this,"controller",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"commentableId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"commentableType",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"createdAt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"deletedAt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"deletedById",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"editedAt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"editedById",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"legacyName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"messageHtml",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parentId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"pinned",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"repliesCount",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"updatedAt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"userId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"votesCount",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.commentableId=e.commentable_id,this.commentableType=e.commentable_type,this.createdAt=e.created_at,this.deletedAt=e.deleted_at,this.deletedById=e.deleted_by_id,this.editedAt=e.edited_at,this.editedById=e.edited_by_id,this.id=e.id,this.legacyName=e.legacy_name,this.message=e.message,this.messageHtml=e.message_html,this.parentId=e.parent_id,this.pinned=e.pinned,this.repliesCount=e.replies_count,this.updatedAt=e.updated_at,this.userId=e.user_id,this.votesCount=e.votes_count,(0,r.Gn)(this)}get canDelete(){return this.canModerate||this.isOwner}get canEdit(){return this.canModerate||this.isOwner&&!this.isDeleted}get canHaveVote(){return!this.isDeleted}get canModerate(){return n()}get canPin(){if(null==i.A.currentUser||null!=this.parentId&&!this.pinned)return!1;if(i.A.currentUser.is_admin)return!0;if("beatmapset"!==this.commentableType||!this.pinned&&this.controller.state.pinnedCommentIds.length>0)return!1;if(this.canModerate)return!0;if(!this.isOwner)return!1;const e=this.controller.getCommentableMeta(this);return null!=e&&"owner_id"in e&&e.owner_id===i.A.currentUser.id}get canReport(){return null!=i.A.currentUser&&this.userId!==i.A.currentUser.id}get canRestore(){return this.canModerate}get canVote(){return!this.isOwner}get isDeleted(){return null!=this.deletedAt}get isEdited(){return null!=this.editedAt}get isVisible(){return!this.isDeleted||this.visibleReplyCount>0}get isOwner(){return null!=i.A.currentUser&&this.userId===i.A.currentUser.id}get visibleReplyCount(){const e=this.repliesCount;if(n())return e;const t=this.controller.getReplies(this).filter((e=>!e.isVisible)).length;return Math.max(0,e-t)}toJson(){return{commentable_id:this.commentableId,commentable_type:this.commentableType,created_at:this.createdAt,deleted_at:this.deletedAt,deleted_by_id:this.deletedById,edited_at:this.editedAt,edited_by_id:this.editedById,id:this.id,legacy_name:this.legacyName,message:this.message,message_html:this.messageHtml,parent_id:this.parentId,pinned:this.pinned,replies_count:this.repliesCount,updated_at:this.updatedAt,user_id:this.userId,votes_count:this.votesCount}}}a([r.EW],o.prototype,"canDelete",null),a([r.EW],o.prototype,"canEdit",null),a([r.EW],o.prototype,"canHaveVote",null),a([r.EW],o.prototype,"canModerate",null),a([r.EW],o.prototype,"canPin",null),a([r.EW],o.prototype,"canReport",null),a([r.EW],o.prototype,"canRestore",null),a([r.EW],o.prototype,"canVote",null),a([r.EW],o.prototype,"isDeleted",null),a([r.EW],o.prototype,"isEdited",null),a([r.EW],o.prototype,"isVisible",null),a([r.EW],o.prototype,"isOwner",null),a([r.EW],o.prototype,"visibleReplyCount",null)},9328:(e,t,s)=>{s.d(t,{Ay:()=>o,DK:()=>a,Ir:()=>n});var r=s(7813),i=function(e,t,s,r){var i,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(n=(a<3?i(n):a>3?i(t,s,n):i(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n};const a=[null,"user","beatmapset","forum_topic","news_post","build","channel"];function n(e){const t=e;return a.indexOf(t)>-1?t:a[0]}class o{get hasMore(){return null!==this.cursor&&this.stackNotificationCount<this.total}get hasVisibleNotifications(){return this.total>0&&this.stacks.size>0}get identity(){return{objectType:this.name}}get isEmpty(){return this.total<=0}get total(){return this._total>0?this._total:0}set total(e){this._total=e}get stackNotificationCount(){return[...this.stacks.values()].reduce(((e,t)=>e+t.total),0)}constructor(e,t){Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"resolver",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"cursor",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"isDeleting",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"isLoading",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"isMarkingAsRead",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"stacks",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"_total",{enumerable:!0,configurable:!0,writable:!0,value:0}),(0,r.Gn)(this)}static fromJson(e,t){const s=new o(e.name,t);return s.updateWithJson(e),s}delete(){this.resolver.delete(this)}loadMore(e){null!==this.cursor&&(this.isLoading=!0,this.resolver.loadMore(this.identity,e,this.cursor).always((0,r.XI)((()=>{this.isLoading=!1}))))}markTypeAsRead(){this.resolver.queueMarkAsRead(this)}removeStack(e){const t=this.stacks.delete(e.id);return t&&(this.total-=e.total),t}updateWithJson(e){this.cursor=e.cursor,this.total=e.total}}i([r.sH],o.prototype,"cursor",void 0),i([r.sH],o.prototype,"isDeleting",void 0),i([r.sH],o.prototype,"isLoading",void 0),i([r.sH],o.prototype,"isMarkingAsRead",void 0),i([r.sH],o.prototype,"stacks",void 0),i([r.sH],o.prototype,"_total",void 0),i([r.EW],o.prototype,"hasMore",null),i([r.EW],o.prototype,"hasVisibleNotifications",null),i([r.EW],o.prototype,"isEmpty",null),i([r.EW],o.prototype,"total",null),i([r.EW],o.prototype,"stackNotificationCount",null),i([r.XI],o.prototype,"delete",null),i([r.XI],o.prototype,"loadMore",null),i([r.XI],o.prototype,"markTypeAsRead",null),i([r.XI],o.prototype,"removeStack",null),i([r.XI],o.prototype,"updateWithJson",null)},8408:(e,t,s)=>{s.d(t,{A:()=>c});var r=s(2543),i=s(7813);var a=s(6913);var n=s(6823),o=s(5812),l=function(e,t,s,r){var i,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(n=(a<3?i(n):a>3?i(t,s,n):i(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n};class c{get canMarkRead(){return this.id>0&&!this.isRead}get category(){var e;return(0,a.cE)(null!==(e=this.name)&&void 0!==e?e:"")}get categoryGroupKey(){return(0,a.Lq)(this)}get displayType(){return function(e){if(null!=e.objectType&&null!=e.objectId)return"user_achievement_unlock"===e.name?"user_achievement":e.objectType}(this)}get identity(){return{category:this.category,id:this.id,objectId:this.objectId,objectType:this.objectType}}get stackId(){return`${this.objectType}-${this.objectId}-${this.category}`}get title(){var e;return n.A.userPreferences.get("beatmapset_title_show_original")&&null!==(e=(0,o.I)(this.details.titleUnicode))&&void 0!==e?e:this.details.title}constructor(e,t){Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"objectType",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"createdAtJson",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:{coverUrl:null,title:""}}),Object.defineProperty(this,"isDeleting",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"isMarkingAsRead",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"isRead",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"objectId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sourceUserId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"updateFromJson",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var t,s;return this.createdAtJson=e.created_at,this.isRead=e.is_read,this.name=e.name,this.objectId=e.object_id,this.sourceUserId=e.source_user_id,this.details={coverUrl:null,title:""},"object"==typeof e.details&&((0,r.forEach)(e.details,((e,t)=>{this.details[(0,r.camelCase)(t)]=e})),"comment_new"===e.name&&(null===(t=e.details.reply_to)||void 0===t?void 0:t.user_id)===(null===(s=n.A.currentUser)||void 0===s?void 0:s.id)&&(this.name="comment_reply")),this}}),(0,i.Gn)(this)}static fromJson(e){return new c(e.id,e.object_type).updateFromJson(e)}}l([i.sH],c.prototype,"isDeleting",void 0),l([i.sH],c.prototype,"isMarkingAsRead",void 0),l([i.sH],c.prototype,"isRead",void 0),l([i.EW],c.prototype,"canMarkRead",null),l([i.EW],c.prototype,"category",null),l([i.EW],c.prototype,"categoryGroupKey",null),l([i.EW],c.prototype,"displayType",null),l([i.EW],c.prototype,"stackId",null),l([i.EW],c.prototype,"title",null)},8443:(e,t,s)=>{s.d(t,{Ay:()=>l,Vg:()=>o,Vy:()=>n,fc:()=>u,fd:()=>c});var r=s(7813),i=s(1883),a=function(e,t,s,r){var i,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(n=(a<3?i(n):a>3?i(t,s,n):i(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n};function n(e){return e.trim().toLowerCase()}function o(e,t){return e.username.localeCompare(t.username)}class l{constructor(e){Object.defineProperty(this,"avatarUrl",{enumerable:!0,configurable:!0,writable:!0,value:"/images/layout/avatar-guest@2x.png"}),Object.defineProperty(this,"countryCode",{enumerable:!0,configurable:!0,writable:!0,value:"XX"}),Object.defineProperty(this,"defaultGroup",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"groups",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"isActive",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"isBot",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"isDeleted",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"isOnline",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"isSupporter",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lastVisit",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"pmFriendsOnly",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"profileColour",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"username",{enumerable:!0,configurable:!0,writable:!0,value:""}),this.id=e,(0,r.Gn)(this)}is(e){return null!=e&&e.id===this.id}toJson(){return{avatar_url:this.avatarUrl,country_code:this.countryCode,default_group:this.defaultGroup,groups:this.groups,id:this.id,is_active:this.isActive,is_bot:this.isBot,is_deleted:this.isDeleted,is_online:this.isOnline,is_supporter:this.isSupporter,last_visit:this.lastVisit,pm_friends_only:this.pmFriendsOnly,profile_colour:this.profileColour,username:this.username}}updateWithJson(e){var t,s;this.avatarUrl=e.avatar_url,this.countryCode=e.country_code,this.defaultGroup=null!==(t=e.default_group)&&void 0!==t?t:"",this.isActive=e.is_active,this.isBot=e.is_bot,this.isOnline=e.is_online,this.isSupporter=e.is_supporter,this.pmFriendsOnly=e.pm_friends_only,this.profileColour=null!==(s=e.profile_colour)&&void 0!==s?s:"",this.username=e.username,null!=e.groups&&(this.groups=e.groups)}}a([r.sH],l.prototype,"avatarUrl",void 0),a([r.sH],l.prototype,"countryCode",void 0),a([r.sH],l.prototype,"defaultGroup",void 0),a([r.sH],l.prototype,"groups",void 0),a([r.sH],l.prototype,"id",void 0),a([r.sH],l.prototype,"isActive",void 0),a([r.sH],l.prototype,"isBot",void 0),a([r.sH],l.prototype,"isDeleted",void 0),a([r.sH],l.prototype,"isOnline",void 0),a([r.sH],l.prototype,"isSupporter",void 0),a([r.sH],l.prototype,"lastVisit",void 0),a([r.sH],l.prototype,"pmFriendsOnly",void 0),a([r.sH],l.prototype,"profileColour",void 0),a([r.sH],l.prototype,"username",void 0),a([r.XI],l.prototype,"updateWithJson",null);const c=new l(-1);c.isDeleted=!0,c.username=(0,i.pw)("users.deleted"),Object.freeze(c);const u=Object.freeze(c.toJson())},4620:(e,t,s)=>{s.d(t,{A:()=>c});var r=s(3358),i=s(9981),a=s(5093),n=s(6540),o=s(7634),l=s(1883);function c({modifiers:e,post:t}){let s;null!=t.first_image&&(s=n.createElement("img",{className:"news-card__cover",src:t.first_image}));let c=t.preview;return null==c&&(c=""),n.createElement("a",{className:(0,o.Zt)("news-card",null!=e?e:["index","hover"]),href:(0,i.w)("news.show",{news:t.slug})},n.createElement("div",{className:"news-card__cover-container"},s,n.createElement("div",{className:"news-card__time js-tooltip-time",title:t.published_at},a.utc(t.published_at).format("ll"))),n.createElement("div",{className:"news-card__main"},n.createElement("div",{className:"news-card__row news-card__row--title"},t.title),n.createElement("div",{dangerouslySetInnerHTML:{__html:c},className:"news-card__row news-card__row--preview"}),n.createElement("div",{className:"news-card__row news-card__row--author"},n.createElement(r.A,{mappings:{user:n.createElement("strong",null,t.author)},pattern:(0,l.pw)("news.show.by")}))))}},6426:(e,t,s)=>{s.d(t,{A:()=>u});var r=s(5093),i=s(6540),a=s(1883),n=s(9981),o=s(6823);class l extends i.Component{get stateRecordKey(){return this.props.date.format("YYYYMM")}get stateRecordValue(){return this.stateRecord instanceof HTMLElement&&null!=this.stateRecord.dataset[this.stateRecordKey]?"1"===this.stateRecord.dataset[this.stateRecordKey]:null}constructor(e){if(super(e),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:{expanded:!1}}),Object.defineProperty(this,"stateRecord",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"recordState",{enumerable:!0,configurable:!0,writable:!0,value:()=>{null!=this.stateRecord&&(this.stateRecord.dataset[this.stateRecordKey]=this.state.expanded?"1":"")}}),Object.defineProperty(this,"renderPost",{enumerable:!0,configurable:!0,writable:!0,value:e=>{let t="news-sidebar-month__item";return null!=this.props.currentPost&&this.props.currentPost.id===e.id&&(t+=" news-sidebar-month__item--active"),i.createElement("li",{key:e.id},i.createElement("a",{className:t,href:(0,n.w)("news.show",{news:e.slug})},e.title))}}),Object.defineProperty(this,"toggleExpand",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.setState({expanded:!this.state.expanded},this.recordState)}}),o.A.windowSize.isMobile)this.state.expanded=!1;else if(null==e.currentPost)this.state.expanded=e.initialExpand;else{const t=r.utc(e.currentPost.published_at);this.state.expanded=t.year()===e.date.year()&&t.month()===e.date.month()}const t=document.querySelector(".js-news-sidebar-record");t instanceof HTMLElement&&(this.stateRecord=t),null==this.stateRecordValue?this.recordState():this.state.expanded=this.stateRecordValue}render(){return i.createElement("div",{className:"news-sidebar-month"},i.createElement("button",{className:"news-sidebar-month__toggle",onClick:this.toggleExpand,type:"button"},this.props.date.format((0,a.pw)("common.datetime.year_month_short.moment")),i.createElement("span",{className:"news-sidebar-month__toggle-icon"},i.createElement("i",{className:this.state.expanded?"fas fa-chevron-up":"fas fa-chevron-down"}))),i.createElement("ul",{className:"news-sidebar-month__items "+(this.state.expanded?"":"hidden")},this.props.posts.map(this.renderPost)))}}function c(e){return i.createElement("div",{className:"news-sidebar-years"},e.years.map((t=>i.createElement("a",{key:t,className:"news-sidebar-years__item "+(t===e.currentYear?"news-sidebar-years__item--active":""),href:(0,n.w)("news.index",{year:t})},t))))}function u(e){var t;const s={},n={},o=new Set;for(const i of e.data.news_posts){const e=r.utc(i.published_at),a=e.format("YYYY-MM");(s[a]=null!==(t=s[a])&&void 0!==t?t:[]).push(i),n[a]=e,o.add(a)}const u=[...o].sort().reverse();let d=!0;return i.createElement("div",{className:"sidebar"},i.createElement("button",{className:"sidebar__mobile-toggle sidebar__mobile-toggle--mobile-only js-mobile-toggle","data-mobile-toggle-target":"news-archive",type:"button"},i.createElement("h2",{className:"sidebar__title"},(0,a.pw)("news.sidebar.archive")),i.createElement("div",{className:"sidebar__mobile-toggle-icon"},i.createElement("i",{className:"fas fa-chevron-down"}))),i.createElement("div",{className:"sidebar__content hidden-xs js-mobile-toggle","data-mobile-toggle-id":"news-archive"},i.createElement(c,{currentYear:e.data.current_year,years:e.data.years}),u.map((t=>{const r=n[t],a=s[t];if(null==a||null==r)return;const o=d;return d=!1,i.createElement(l,{key:t,currentPost:e.currentPost,date:r,initialExpand:o,posts:a})}))))}},6913:(e,t,s)=>{function r(e){return null==e.objectId||null==e.name||null==e.category?null:"user_achievement_unlock"===e.name?`achievement:${e.id}`:`${e.category}:${e.objectId}`}function i(e){var t;return null!==(t=a[e])&&void 0!==t?t:e}s.d(t,{Lq:()=>r,cE:()=>i});const a={beatmap_owner_change:"beatmap_owner_change",beatmapset_discussion_lock:"beatmapset_discussion",beatmapset_discussion_post_new:"beatmapset_discussion",beatmapset_discussion_qualified_problem:"beatmapset_problem",beatmapset_discussion_review_new:"beatmapset_discussion",beatmapset_discussion_unlock:"beatmapset_discussion",beatmapset_disqualify:"beatmapset_state",beatmapset_love:"beatmapset_state",beatmapset_nominate:"beatmapset_state",beatmapset_qualify:"beatmapset_state",beatmapset_rank:"beatmapset_state",beatmapset_remove_from_loved:"beatmapset_state",beatmapset_reset_nominations:"beatmapset_state",channel_announcement:"announcement",channel_message:"channel",comment_new:"comment",comment_reply:"comment",forum_topic_reply:"forum_topic_reply",user_achievement_unlock:"user_achievement_unlock",user_beatmapset_new:"user_beatmapset_new",user_beatmapset_revive:"user_beatmapset_new"}},8395:(e,t,s)=>{s.d(t,{A:()=>$});var r=s(1370),i=s(6540),a=s(8102);const n={announcement:["fas fa-bullhorn"],beatmap_owner_change:["fas fa-drafting-compass","fas fa-user-friends"],beatmapset_discussion:["fas fa-drafting-compass","fas fa-comment"],beatmapset_problem:["fas fa-drafting-compass","fas fa-exclamation-circle"],beatmapset_state:["fas fa-drafting-compass"],channel:["fas fa-comments"],comment:["fas fa-comment"],forum_topic_reply:["fas fa-comment-medical"],user_achievement_unlock:["fas fa-medal"],user_beatmapset_new:["fas fa-music"]},o={beatmap_owner_change:["fas fa-drafting-compass","fas fa-user-friends"],beatmapset_discussion_lock:["fas fa-drafting-compass","fas fa-lock"],beatmapset_discussion_post_new:["fas fa-drafting-compass","fas fa-comment-medical"],beatmapset_discussion_qualified_problem:["fas fa-drafting-compass","fas fa-exclamation-circle"],beatmapset_discussion_unlock:["fas fa-drafting-compass","fas fa-unlock"],beatmapset_disqualify:["fas fa-drafting-compass","far fa-times-circle"],beatmapset_love:["fas fa-drafting-compass","fas fa-heart"],beatmapset_nominate:["fas fa-drafting-compass","fas fa-vote-yea"],beatmapset_qualify:["fas fa-drafting-compass","fas fa-check"],beatmapset_rank:["fas fa-drafting-compass","fas fa-check-double"],beatmapset_remove_from_loved:["fas fa-drafting-compass","fas fa-heart-broken"],beatmapset_reset_nominations:["fas fa-drafting-compass","fas fa-undo"],channel_announcement:["fas fa-bullhorn"],channel_message:["fas fa-comments"],comment_new:["fas fa-comment"],comment_reply:["fas fa-reply"],forum_topic_reply:["fas fa-comment-medical"],user_achievement_unlock:["fas fa-trophy"],user_beatmapset_new:["fas fa-music"],user_beatmapset_revive:["fas fa-trash-restore"]},l={beatmap_owner_change:["fas fa-user-edit"],beatmapset_discussion_lock:["fas fa-lock"],beatmapset_discussion_post_new:["fas fa-comment-medical"],beatmapset_discussion_qualified_problem:["fas fa-exclamation-circle"],beatmapset_discussion_unlock:["fas fa-unlock"],beatmapset_disqualify:["far fa-times-circle"],beatmapset_love:["fas fa-heart"],beatmapset_nominate:["fas fa-vote-yea"],beatmapset_qualify:["fas fa-check"],beatmapset_rank:["fas fa-check-double"],beatmapset_remove_from_loved:["fas fa-heart-broken"],beatmapset_reset_nominations:["fas fa-undo"],channel_announcement:["fas fa-bullhorn"],channel_message:["fas fa-comments"],comment_new:["fas fa-comment"],comment_reply:["fas fa-reply"],forum_topic_reply:["fas fa-comment-medical"],user_beatmapset_new:["fas fa-music"],user_beatmapset_revive:["fas fa-trash-restore"]};var c=s(8408);function u(e){return"beatmap_owner_change"===e.name}c.A;var d=s(1883);function p(e,t=!1){const s={content:e.details.content,title:e.title,username:e.details.username};u(e)&&(s.beatmap=e.details.version),"beatmapset_discussion_review_new"===e.name&&null!=e.details.embeds&&function(e,t){const s=[];for(const r of["praises","problems","suggestions"]){const i=e[r];i>0&&s.push((0,d.Mq)(`notifications.item.beatmapset.beatmapset_discussion.review_count.${r}`,i)),t[r]=i}0===s.length&&s.push((0,d.Mq)("notifications.item.beatmapset.beatmapset_discussion.review_count.problems",0)),t.review_counts=(0,d.sc)(s)}(e.details.embeds,s);let r=`notifications.item.${e.displayType}.${e.category}`;"channel"===e.objectType&&(r+=`.${e.details.type}`),r+=`.${e.name}`,t&&(r+="_compact");const i=`${r}_empty`;return null==e.details.content&&(0,d.fP)(i,window.fallbackLocale)&&(r=i),(0,d.pw)(r,s)}function m(e){if("channel"===e.objectType){const t={title:e.title,username:e.details.username},s=`notifications.item.${e.objectType}.${e.category}.${e.details.type}.${e.name}_group`;return(0,d.pw)(s,t)}if("user_achievement_unlock"===e.name){const t={username:e.details.username};return(0,d.pw)(`notifications.item.${e.displayType}.${e.category}.${e.name}_group`,t)}if("user_beatmapset_new"===e.category){const t={username:e.details.username};return(0,d.pw)(`notifications.item.${e.displayType}.${e.category}.${e.category}_group`,t)}return e.title}var h=s(9981),b=s(6606);function f(e){if(u(e))return(0,h.w)("beatmapsets.discussion",{beatmap:"-",beatmapset:e.objectId,mode:"events"});if("comment_new"===e.name||"comment_reply"===e.name)switch(e.objectType){case"beatmapset":return(0,h.w)("beatmapsets.show",{beatmapset:e.objectId});case"build":return(0,h.w)("changelog.show",{changelog:e.objectId,key:"id"});case"news_post":return(0,h.w)("news.show",{key:"id",news:e.objectId})}else{if("user_achievement_unlock"===e.name)return g(e);if("user_beatmapset_new"===e.category)return`${(0,h.w)("users.show",{user:e.objectId})}#beatmaps`}switch(e.objectType){case"beatmapset":return(0,h.w)("beatmapsets.discussion",{beatmapset:e.objectId});case"channel":return null!=e.details.channelId?(0,h.w)("chat.index",{channel_id:e.details.channelId}):(0,h.w)("chat.index",{sendto:e.sourceUserId});case"forum_topic":return(0,h.w)("forum.topics.show",{start:"unread",topic:e.objectId})}}function v(e){if(u(e))return(0,h.w)("beatmapsets.discussion",{beatmap:e.details.beatmapId,beatmapset:e.objectId});switch(e.name){case"beatmapset_discussion_lock":case"beatmapset_discussion_unlock":case"beatmapset_disqualify":case"beatmapset_love":case"beatmapset_nominate":case"beatmapset_qualify":case"beatmapset_remove_from_loved":case"beatmapset_reset_nominations":return(0,h.w)("beatmapsets.discussion",{beatmapset:e.objectId});case"beatmapset_discussion_post_new":case"beatmapset_discussion_qualified_problem":case"beatmapset_discussion_review_new":return(0,b.Gm)({beatmapId:e.details.beatmapId,beatmapsetId:e.objectId,discussionId:e.details.discussionId,postId:e.details.postId});case"beatmapset_rank":return(0,h.w)("beatmapsets.show",{beatmapset:e.objectId});case"channel_announcement":return(0,h.w)("chat.index",{channel_id:e.details.channelId});case"channel_message":return(0,h.w)("chat.index",{sendto:e.sourceUserId});case"comment_new":case"comment_reply":return(0,h.w)("comments.show",{comment:e.details.commentId});case"forum_topic_reply":return(0,h.w)("forum.posts.show",{post:e.details.postId});case"user_achievement_unlock":return g(e);case"user_beatmapset_new":case"user_beatmapset_revive":return(0,h.w)("beatmapsets.show",{beatmapset:e.details.beatmapsetId})}}function g(e){var t;const s={mode:null!==(t=e.details.achievementMode)&&void 0!==t?t:void 0,user:e.details.userId};return`${(0,h.w)("users.show",s)}#medals`}var y=s(9749),w=s(9262),_=s(1113),E=s(1518),P=s(7634),O=function(e,t,s,r){var i,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(n=(a<3?i(n):a>3?i(t,s,n):i(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n};let j=class extends i.Component{constructor(){super(...arguments),Object.defineProperty(this,"onLinkClick",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var t,s;0!==e.button&&1!==e.button||null===(s=(t=this.props).markRead)||void 0===s||s.call(t)}})}get canMarkAsRead(){var e;return null!==(e=this.props.canMarkAsRead)&&void 0!==e?e:this.props.item.canMarkRead}render(){const e=(0,P.hL)(this.props.modifiers,this.props.item.category,{read:this.props.item.isRead&&!this.props.canMarkAsRead});return i.createElement("div",{className:(0,P.Zt)("notification-popup-item",e)},i.createElement("a",{className:"notification-popup-item__link",href:this.props.url,onAuxClick:this.onLinkClick,onClick:this.onLinkClick}),this.renderCover(),i.createElement("div",{className:"notification-popup-item__main"},i.createElement("div",{className:"notification-popup-item__content"},this.renderCategory(),this.renderMessage(),this.renderTime(),this.renderExpandButton()),this.renderMarkAsReadButton(),this.renderDeleteButton()),this.renderUnreadStripe())}renderCategory(){if(!this.props.withCategory)return null;const e=(0,d.pw)(`notifications.item.${this.props.item.displayType}.${this.props.item.category}._`);return""===e?null:i.createElement("div",{className:"notification-popup-item__row notification-popup-item__row--category"},e)}renderCover(){const e=this.props.withCoverImage?this.props.item.details.coverUrl:null;return i.createElement("div",{className:"notification-popup-item__cover",style:{backgroundImage:(0,P.NZ)(e)}},i.createElement("div",{className:"notification-popup-item__cover-overlay"},this.renderCoverIcons()))}renderCoverIcons(){return null==this.props.icons?null:this.props.icons.map((e=>i.createElement("div",{key:e,className:"notification-popup-item__cover-icon"},i.createElement("span",{className:e}))))}renderDeleteButton(){var e;return this.context.isWidget?null:i.createElement(w.A,{isDeleting:null!==(e=this.props.isDeleting)&&void 0!==e?e:this.props.item.isDeleting,modifiers:["fancy"],onDelete:this.props.delete})}renderExpandButton(){return null==this.props.expandButton?null:i.createElement("div",{className:"notification-popup-item__row notification-popup-item__row--expand"},this.props.expandButton)}renderMarkAsReadButton(){var e;return this.canMarkAsRead?i.createElement(_.A,{isMarkingAsRead:null!==(e=this.props.isMarkingAsRead)&&void 0!==e?e:this.props.item.isMarkingAsRead,modifiers:["fancy"],onMarkAsRead:this.props.markRead}):null}renderMessage(){return i.createElement("div",{className:"notification-popup-item__row notification-popup-item__row--message"},this.props.message)}renderTime(){if(null!=this.props.item.createdAtJson)return i.createElement("a",{className:"notification-popup-item__row notification-popup-item__row--time u-hover",href:this.props.url,onAuxClick:this.onLinkClick,onClick:this.onLinkClick},i.createElement(E.A,{dateTime:this.props.item.createdAtJson,relative:!0}))}renderUnreadStripe(){return this.context.isWidget||!this.canMarkAsRead?null:i.createElement("span",{className:"notification-popup-item__unread-stripe"})}};Object.defineProperty(j,"contextType",{enumerable:!0,configurable:!0,writable:!0,value:y.V}),j=O([r.PA],j);const k=j;var S=function(e,t,s,r){var i,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(n=(a<3?i(n):a>3?i(t,s,n):i(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n};let N=class extends i.Component{constructor(){super(...arguments),Object.defineProperty(this,"handleDelete",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.props.stack.deleteItem(this.props.item)}}),Object.defineProperty(this,"handleMarkAsRead",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.props.stack.markAsRead(this.props.item)}})}render(){var e;return i.createElement(k,{delete:this.handleDelete,icons:l[null!==(e=this.props.item.name)&&void 0!==e?e:""],item:this.props.item,markRead:this.handleMarkAsRead,message:p(this.props.item,!0),modifiers:["compact"],url:v(this.props.item),withCategory:!1,withCoverImage:"user_achievement_unlock"===this.props.item.name||"user_beatmapset_new"===this.props.item.category})}};N=S([r.PA],N);const A=N;var T=function(e,t,s,r){var i,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(n=(a<3?i(n):a>3?i(t,s,n):i(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n};let C=class extends i.Component{constructor(){super(...arguments),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:{expanded:!1}}),Object.defineProperty(this,"handleDelete",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.props.stack.delete()}}),Object.defineProperty(this,"handleMarkAsRead",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.props.stack.markStackAsRead()}}),Object.defineProperty(this,"handleShowLess",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.setState({expanded:!1})}}),Object.defineProperty(this,"handleShowMore",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.props.stack.loadMore(this.context)}}),Object.defineProperty(this,"renderItem",{enumerable:!0,configurable:!0,writable:!0,value:e=>i.createElement("div",{key:e.id,className:"notification-popup-item-group__item"},i.createElement(A,{item:e,stack:this.props.stack}))}),Object.defineProperty(this,"toggleExpand",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.setState({expanded:!this.state.expanded})}})}render(){const e=this.props.stack.first;return null==e?null:i.createElement("div",{className:"notification-popup-item-group"},i.createElement(k,{canMarkAsRead:this.props.stack.canMarkAsRead,delete:this.handleDelete,expandButton:this.renderExpandButton(),icons:n[e.category],isDeleting:this.props.stack.isDeleting,isMarkingAsRead:this.props.stack.isMarkingAsRead,item:e,markRead:this.handleMarkAsRead,message:m(e),modifiers:["group"],url:f(e),withCategory:!0,withCoverImage:!0}),this.renderItems())}renderExpandButton(){const e=this.props.stack.total,t=this.context.isWidget?"common.count.update":"common.count.notifications";return i.createElement("button",{className:"show-more-link show-more-link--notification-group u-hover",onClick:this.toggleExpand,type:"button"},i.createElement("span",{className:"show-more-link__label"},i.createElement("span",{className:"show-more-link__label-text"},(0,d.Mq)(t,e)),i.createElement("span",{className:"show-more-link__label-icon"},i.createElement("span",{className:"fas fa-angle-"+(this.state.expanded?"up":"down")}))))}renderItems(){return this.state.expanded?i.createElement("div",{className:"notification-popup-item-group__items"},this.props.stack.orderedNotifications.map(this.renderItem),i.createElement("div",{className:"notification-popup-item-group__show-more"},i.createElement("div",{className:"notification-popup-item-group__expand"},this.renderShowMore()),i.createElement("div",{className:"notification-popup-item-group__collapse"},this.renderShowLess(),this.props.stack.canMarkAsRead&&i.createElement(_.A,{isMarkingAsRead:this.props.stack.isMarkingAsRead,onMarkAsRead:this.handleMarkAsRead}),!this.context.isWidget&&i.createElement(w.A,{isDeleting:this.props.stack.isDeleting,onDelete:this.handleDelete})))):null}renderShowLess(){return i.createElement(a.A,{callback:this.handleShowLess,direction:"up",hasMore:!0,label:(0,d.pw)("common.buttons.show_less"),modifiers:["notification-group"]})}renderShowMore(){const e=this.props.stack;return e.hasMore?i.createElement(a.A,{callback:this.handleShowMore,hasMore:null!=e.cursor,loading:e.isLoading,modifiers:["notification-group"]}):null}};Object.defineProperty(C,"contextType",{enumerable:!0,configurable:!0,writable:!0,value:y.V}),C=T([r.PA],C);const x=C;var I=function(e,t,s,r){var i,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(n=(a<3?i(n):a>3?i(t,s,n):i(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n};let R=class extends i.Component{constructor(){super(...arguments),Object.defineProperty(this,"handleDelete",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.props.stack.deleteItem(this.props.stack.first)}}),Object.defineProperty(this,"handleMarkAsRead",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.props.stack.markAsRead(this.props.stack.first)}})}render(){var e;const t=this.props.stack.first;return null==t?null:i.createElement(k,{delete:this.handleDelete,icons:o[null!==(e=t.name)&&void 0!==e?e:""],isDeleting:t.isDeleting,isMarkingAsRead:t.isMarkingAsRead,item:t,markRead:this.handleMarkAsRead,message:p(t),modifiers:["one"],url:v(t),withCategory:!0,withCoverImage:!0})}};R=I([r.PA],R);const M=R;var D=function(e,t,s,r){var i,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(n=(a<3?i(n):a>3?i(t,s,n):i(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n};let H=class extends i.Component{render(){if(!this.props.stack.hasVisibleNotifications)return null;const e=this.props.stack.isSingle?M:x;return i.createElement(e,{key:this.props.stack.id,stack:this.props.stack})}};H=D([r.PA],H);const $=H},9749:(e,t,s)=>{s.d(t,{V:()=>r});const r=(0,s(6540).createContext)({excludes:[],isWidget:!1})},9098:(e,t,s)=>{s.d(t,{A:()=>c});var r=s(7813),i=s(9328),a=s(3944),n=s(1980),o=s(6224),l=function(e,t,s,r){var i,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(n=(a<3?i(n):a>3?i(t,s,n):i(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n};class c{get isMarkingCurrentTypeAsRead(){return this.getNonNullTypes(this.type).some((e=>e.isMarkingAsRead))}get stacks(){return this.store.orderedStacksOfType(this.currentFilter).filter((e=>e.hasVisibleNotifications&&!this.isExcluded(e.objectType)))}get type(){return this.getType(this.currentFilter)}get typeNameFromUrl(){return(0,i.Ir)((0,a.bN)().get("type"))}constructor(e,t,s){Object.defineProperty(this,"notificationStore",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"contextType",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"currentFilter",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"store",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"typeNamesWithoutNull",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"getType",{enumerable:!0,configurable:!0,writable:!0,value:e=>this.store.getOrCreateType({objectType:e})}),this.typeNamesWithoutNull=i.DK.filter((e=>!(null==e||this.isExcluded(e)))),this.currentFilter=void 0!==s?s:this.typeNameFromUrl,this.store=t.isWidget?e.unreadStacks:e.stacks,(0,r.Gn)(this)}getTotal(e){return this.getNonNullTypes(e).reduce(((e,t)=>e+t.total),0)}loadMore(){var e;null===(e=this.type)||void 0===e||e.loadMore(this.contextType)}markCurrentTypeAsRead(){this.getNonNullTypes(this.type).forEach((e=>{e.markTypeAsRead()}))}navigateTo(e){if(this.currentFilter=e,0===[...this.stacks].length&&this.loadMore(),!this.contextType.isWidget){let t;if(null==e){const e=new URL((0,a.bS)().href);e.searchParams.delete("type"),t=e.href}else t=(0,n.Ze)(null,{type:e});o.controller.advanceHistory(t)}}getNonNullTypes(e){return null!=e.name?[e]:this.typeNamesWithoutNull.map(this.getType)}isExcluded(e){return this.contextType.excludes.includes(e)}}l([r.sH],c.prototype,"currentFilter",void 0),l([r.EW],c.prototype,"isMarkingCurrentTypeAsRead",null),l([r.EW],c.prototype,"stacks",null),l([r.EW],c.prototype,"type",null),l([r.XI],c.prototype,"loadMore",null),l([r.XI],c.prototype,"markCurrentTypeAsRead",null),l([r.XI],c.prototype,"navigateTo",null)},9262:(e,t,s)=>{s.d(t,{A:()=>c});var r=s(8623),i=s(1370),a=s(6540),n=s(7634),o=function(e,t,s,r){var i,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(n=(a<3?i(n):a>3?i(t,s,n):i(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n};let l=class extends a.Component{render(){return this.props.isDeleting?a.createElement("div",{className:(0,n.Zt)("notification-action-button",this.props.modifiers)},a.createElement("span",{className:"notification-action-button__text"},this.props.text),a.createElement("div",{className:"notification-action-button__icon"},a.createElement(r.y,null))):a.createElement("button",{className:(0,n.Zt)("notification-action-button",this.props.modifiers),onClick:this.props.onDelete,type:"button"},a.createElement("span",{className:"notification-action-button__text"},this.props.text),a.createElement("div",{className:"notification-action-button__icon"},a.createElement("span",{className:"fas fa-trash"})))}};Object.defineProperty(l,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{modifiers:[]}}),l=o([i.PA],l);const c=l},8307:(e,t,s)=>{s.d(t,{an:()=>l,kx:()=>n,yz:()=>a,zv:()=>o});var r=s(893),i=s(7448);class a extends r.A{constructor(e,t){super(),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"context",{enumerable:!0,configurable:!0,writable:!0,value:t})}}class n extends r.A{constructor(e){super(),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:e})}}class o extends r.A{constructor(e,t){super(),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"readCount",{enumerable:!0,configurable:!0,writable:!0,value:t})}static fromJson(e){const t=e.data.notifications.map((e=>(0,i.Rf)(e)));return new o(t,e.data.read_count)}}class l extends r.A{constructor(e,t){super(),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"readCount",{enumerable:!0,configurable:!0,writable:!0,value:t})}static fromJson(e){const t=e.data.notifications.map((e=>(0,i.Rf)(e)));return new l(t,e.data.read_count)}}},7448:(e,t,s)=>{function r(e){return`${e.objectType}-${e.objectId}-${e.category}`}function i(e){return null!=e.objectId&&null!=e.category?null!=e.id?"notification":"stack":"type"}function a(e){return{category:e.category,id:e.id,objectId:e.object_id,objectType:e.object_type}}function n(e){return{category:e.category,id:e.id,object_id:e.objectId,object_type:e.objectType}}function o(e){return`${e.objectType}-${e.objectId}-${e.category}-${e.id}`}s.d(t,{Rf:()=>a,UR:()=>r,aB:()=>n,bv:()=>i,dI:()=>o})},1113:(e,t,s)=>{s.d(t,{A:()=>c});var r=s(8623),i=s(1370),a=s(6540),n=s(7634),o=function(e,t,s,r){var i,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(n=(a<3?i(n):a>3?i(t,s,n):i(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n};let l=class extends a.Component{render(){return this.props.isMarkingAsRead?a.createElement("div",{className:(0,n.Zt)("notification-action-button",this.props.modifiers)},a.createElement("span",{className:"notification-action-button__text"},this.props.text),a.createElement("div",{className:"notification-action-button__icon"},a.createElement(r.y,null))):a.createElement("button",{className:(0,n.Zt)("notification-action-button",this.props.modifiers),onClick:this.props.onMarkAsRead,type:"button"},a.createElement("span",{className:"notification-action-button__text"},this.props.text),a.createElement("div",{className:"notification-action-button__icon"},a.createElement("span",{className:"fas fa-check"})))}};Object.defineProperty(l,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{modifiers:[]}}),l=o([i.PA],l);const c=l},6823:(e,t,s)=>{s.d(t,{A:()=>ur});var r=s(7813),i=function(e,t,s,r){var i,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(n=(a<3?i(n):a>3?i(t,s,n):i(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n};class a{get hasMoreForPager(){return this.hasMore&&this.beatmapsetIds.size<this.total}get isExpired(){return null==this.fetchedAt||(new Date).getTime()-this.fetchedAt.getTime()>a.CACHE_DURATION_MS}constructor(){Object.defineProperty(this,"beatmapsetIds",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"cursorString",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchedAt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hasMore",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"total",{enumerable:!0,configurable:!0,writable:!0,value:0}),(0,r.Gn)(this)}append(e){for(const t of e.beatmapsets)this.beatmapsetIds.add(t.id);this.cursorString=e.cursor_string,this.fetchedAt=new Date,this.hasMore=null!==e.cursor_string,this.total=e.total}reset(){this.beatmapsetIds.clear(),this.fetchedAt=void 0,this.cursorString=void 0,this.hasMore=!1,this.total=0}}Object.defineProperty(a,"CACHE_DURATION_MS",{enumerable:!0,configurable:!0,writable:!0,value:6e4});const n=a;i([r.sH],a.prototype,"beatmapsetIds",void 0),i([r.sH],a.prototype,"hasMore",void 0),i([r.sH],a.prototype,"total",void 0),i([r.EW],a.prototype,"hasMoreForPager",null),i([r.EW],a.prototype,"isExpired",null),i([r.XI],a.prototype,"append",null),i([r.XI],a.prototype,"reset",null);var o=s(2543),l=s(5812),c=s(1980),u=function(e,t,s,r){var i,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(n=(a<3?i(n):a>3?i(t,s,n):i(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n};const d={c:"general",e:"extra",g:"genre",l:"language",m:"mode",nsfw:"nsfw",played:"played",q:"query",r:"rank",s:"status",sort:"sort"},p=(0,o.invert)(d),m=["extra","general","genre","language","mode","nsfw","played","query","rank","sort","status"],h=["query","status"],b=["played","rank"];function f(e){const t=new URL(e).searchParams,s={};for(const[r,i]of Object.entries(d)){const e=t.get(r);null!=e&&0!==e.length&&(s[i]=e)}return s}class v{get displaySort(){return this.selectedValue("sort")}get queryParams(){const e={};for(const t of m){const s=this[t];e[p[t]]=s===this.getDefault(t)?null:s}return e}get searchSort(){var e;const[t,s]=(null!==(e=this.displaySort)&&void 0!==e?e:"").split("_");return{field:t,order:s}}get supporterRequired(){return m.filter((e=>null!=this[e]&&b.includes(e)))}constructor(e){var t;Object.defineProperty(this,"extra",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"general",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"genre",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"language",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"mode",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"nsfw",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"played",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"query",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"rank",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"sort",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:null});const s=f(e);for(const r of m){const e=null!==(t=s[r])&&void 0!==t?t:null;this[r]=e===this.getDefault(r)?null:e}(0,r.Gn)(this),(0,r.Zc)(this,"query",(e=>{var t;return e.newValue=(0,l.I)(null===(t=e.newValue)||void 0===t?void 0:t.trim()),e}))}getDefault(e){var t;switch(e){case"nsfw":return String(ur.userPreferences.get("beatmapset_show_nsfw"));case"played":return"any";case"status":return"leaderboard";case"sort":return(0,l.E)(this.query)?"relevance_desc":["pending","wip","graveyard","mine"].includes(null!==(t=this.status)&&void 0!==t?t:"")?"updated_desc":"ranked_desc"}return null}href(e,t){const s=t===this.getDefault(e)?null:t;return(0,c.Ze)(null,Object.assign(Object.assign({},this.queryParams),{[p[e]]:s}))}selectedValue(e){var t;return null!==(t=this[e])&&void 0!==t?t:this.getDefault(e)}toKeyString(){return m.map((e=>`${e}=${this.selectedValue(e)}`)).join("&")}update(e,t){t!==this[e]&&(h.includes(e)&&(this.sort=null),this[e]=t===this.getDefault(e)?null:t)}}u([r.sH],v.prototype,"extra",void 0),u([r.sH],v.prototype,"general",void 0),u([r.sH],v.prototype,"genre",void 0),u([r.sH],v.prototype,"language",void 0),u([r.sH],v.prototype,"mode",void 0),u([r.sH],v.prototype,"nsfw",void 0),u([r.sH],v.prototype,"played",void 0),u([r.sH],v.prototype,"query",void 0),u([r.sH],v.prototype,"rank",void 0),u([r.sH],v.prototype,"sort",void 0),u([r.sH],v.prototype,"status",void 0),u([r.EW],v.prototype,"displaySort",null),u([r.EW],v.prototype,"queryParams",null),u([r.EW],v.prototype,"searchSort",null),u([r.EW],v.prototype,"supporterRequired",null),u([r.XI],v.prototype,"update",null);var g=s(9981),y=s(1883),w=s(3135),_=s(3944),E=s(6224),P=function(e,t,s,r){var i,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(n=(a<3?i(n):a>3?i(t,s,n):i(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n},O=function(e,t,s,r){return new(s||(s=Promise))((function(i,a){function n(e){try{l(r.next(e))}catch(t){a(t)}}function o(e){try{l(r.throw(e))}catch(t){a(t)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(n,o)}l((r=r.apply(e,t||[])).next())}))};const j=["genre","language","extra","rank","played"];class k{constructor(e){Object.defineProperty(this,"beatmapsetSearch",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"advancedSearch",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"currentResultSet",{enumerable:!0,configurable:!0,writable:!0,value:new n}),Object.defineProperty(this,"filters",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"isExpanded",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"searchStatus",{enumerable:!0,configurable:!0,writable:!0,value:{error:null,from:0,state:"completed"}}),Object.defineProperty(this,"debouncedFilterChangedSearch",{enumerable:!0,configurable:!0,writable:!0,value:(0,o.debounce)((()=>this.filterChangedSearch()),500)}),Object.defineProperty(this,"filtersObserver",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"initialErrorMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filterChangedHandler",{enumerable:!0,configurable:!0,writable:!0,value:e=>{"update"===e.type&&e.oldValue===e.newValue||(this.searchStatus.state="input",this.debouncedFilterChangedSearch(),"query"!==e.name&&this.debouncedFilterChangedSearch.flush())}}),(0,r.Gn)(this)}get currentBeatmapsetIds(){return[...this.currentResultSet.beatmapsetIds]}get error(){return this.searchStatus.error}get hasMore(){return this.currentResultSet.hasMoreForPager}get isBusy(){return"searching"===this.searchStatus.state||"input"===this.searchStatus.state}get isPaging(){return"paging"===this.searchStatus.state}get isSupporterMissing(){var e,t;return!(null!==(t=null===(e=ur.currentUser)||void 0===e?void 0:e.is_supporter)&&void 0!==t&&t)&&this.filters.supporterRequired.length>0}get recommendedDifficulty(){return this.beatmapsetSearch.recommendedDifficulties.get(this.filters.mode)}get supporterRequiredFilterText(){const e=this.filters.supporterRequired.map((e=>(0,y.pw)(`beatmaps.listing.search.filters.${e}`)));return(0,y.sc)(e)}cancel(){this.debouncedFilterChangedSearch.cancel(),this.beatmapsetSearch.cancel()}getFilters(e){const t=this.filters.selectedValue(e);return null!=t?t.split("."):t}initialize(e){this.restoreStateFromUrl(),this.beatmapsetSearch.initialize(this.filters,e),this.initialErrorMessage=e.error}loadMore(){!this.isBusy&&this.hasMore&&this.search(this.currentResultSet.beatmapsetIds.size)}restoreTurbolinks(){this.restoreStateFromUrl(),this.search(0,!0),null!=this.initialErrorMessage&&((0,w.l)(this.initialErrorMessage,"danger"),delete this.initialErrorMessage)}search(e=0,t=!1){return O(this,void 0,void 0,(function*(){if(this.isSupporterMissing||e<0)return void(this.searchStatus={error:null,from:e,restore:t,state:"completed"});let s;this.searchStatus={from:0,restore:t,state:0===e?"searching":"paging"};try{yield this.beatmapsetSearch.get(this.filters,e)}catch(i){s=0!==i.readyState?i:null}(0,r.h5)((()=>{this.searchStatus={error:s,from:e,restore:t,state:"completed"},this.currentResultSet=this.beatmapsetSearch.getResultSet(this.filters)}))}))}filterChangedSearch(){const e=(0,g.w)("beatmapsets.index",this.filters.queryParams);E.controller.advanceHistory(e),this.search()}restoreStateFromUrl(){const e=(0,_.bS)().href;null!=this.filtersObserver&&this.filtersObserver(),this.filters=new v(e),E.controller.replaceHistory((0,c.Ze)(null,Object.assign({},this.filters.queryParams))),this.filtersObserver=(0,r.lB)(this.filters,this.filterChangedHandler),this.isExpanded=(0,o.intersection)(Object.keys(f(e)),j).length>0}}P([r.sH],k.prototype,"advancedSearch",void 0),P([r.sH],k.prototype,"currentResultSet",void 0),P([r.sH],k.prototype,"filters",void 0),P([r.sH],k.prototype,"isExpanded",void 0),P([r.sH],k.prototype,"searchStatus",void 0),P([r.EW],k.prototype,"currentBeatmapsetIds",null),P([r.EW],k.prototype,"hasMore",null),P([r.EW],k.prototype,"isBusy",null),P([r.EW],k.prototype,"isPaging",null),P([r.EW],k.prototype,"isSupporterMissing",null),P([r.EW],k.prototype,"recommendedDifficulty",null),P([r.EW],k.prototype,"supporterRequiredFilterText",null),P([r.XI],k.prototype,"cancel",null),P([r.XI],k.prototype,"loadMore",null),P([r.XI],k.prototype,"restoreTurbolinks",null),P([r.XI],k.prototype,"search",null),P([r.XI],k.prototype,"filterChangedHandler",void 0),P([r.XI],k.prototype,"restoreStateFromUrl",null);var S=s(7035);const N=["chat.channel.join","chat.channel.part"];var A=s(893);class T extends A.A{constructor(e){super(),Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:e})}}class C extends A.A{constructor(e){super(),Object.defineProperty(this,"json",{enumerable:!0,configurable:!0,writable:!0,value:e})}}class x extends A.A{constructor(e){super(),Object.defineProperty(this,"channelId",{enumerable:!0,configurable:!0,writable:!0,value:e})}}class I extends A.A{constructor(e){super(),Object.defineProperty(this,"json",{enumerable:!0,configurable:!0,writable:!0,value:e})}}var R=function(e,t,s,r){var i,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(n=(a<3?i(n):a>3?i(t,s,n):i(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n};function M(e){if("chat.message.new"===e.event)return new I(e.data);if(function(e){return null!=e.event&&N.includes(e.event)}(e))switch(e.event){case"chat.channel.join":return new C(e.data);case"chat.channel.part":return new x(e.data.channel_id)}}let D=class{handleDispatchAction(e){if(!(e instanceof T))return;const t=M(e.message);null!=t&&(0,S.JD)(t)}};D=R([S.D6],D);const H=D;var $=s(6407),L=s(4692);const U=".js-account-edit__input",B=new Set(["array","radio"]);class F{constructor(e,t){if(Object.defineProperty(this,"container",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"core",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"debouncedUpdate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"xhr",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"update",{enumerable:!0,configurable:!0,writable:!0,value:()=>{var e;this.xhr=L.ajax(null!==(e=this.dataset.url)&&void 0!==e?e:(0,g.w)("account.update"),{data:this.getData(),method:"PUT"}),this.xhr.done((e=>{"1"===this.dataset.userPreferencesUpdate&&null!=e&&this.core.setCurrentUser(e),this.saved()})).fail((e=>{this.clear(),(0,$.S5)(e)}))}}),this.debouncedUpdate=(0,o.debounce)(this.update,1e3),B.has(this.dataset.accountEditType)&&null==this.dataset.field)throw new Error("data-field required")}get dataset(){return this.container.dataset}get fieldName(){if(null!=this.dataset.field)return this.dataset.field;const e=this.container.querySelector(U);if(null==e)throw new Error("missing input name");return e.name}clear(){window.clearTimeout(this.timeout),this.dataset.accountEditState=""}onInput(){var e;null===(e=this.xhr)||void 0===e||e.abort(),this.saving(),this.debouncedUpdate()}saved(){window.clearTimeout(this.timeout),this.dataset.accountEditState="saved",this.timeout=window.setTimeout((()=>this.clear()),3e3)}saving(){window.clearTimeout(this.timeout),this.dataset.accountEditState="saving"}getData(){let e;switch(this.dataset.accountEditType){case"multi":{const e={};for(const t of this.container.querySelectorAll(U))e[t.name]=t.checked;return e}case"array":e=[""];for(const t of this.container.querySelectorAll("input"))t.checked&&e.push(t.value);break;case"radio":for(const t of this.container.querySelectorAll('input[type="radio"]'))if(t.checked){e=t.value;break}if(null==e)throw new Error("missing radio value");break;default:{const t=this.container.querySelector(U);if(null==t)throw new Error("missing input");e="checkbox"===t.type?String(t.checked):t.value}}return{[this.fieldName]:e}}}var G=s(4692);const X=".js-account-edit";class W{constructor(e){Object.defineProperty(this,"core",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"handleAjaxError",{enumerable:!0,configurable:!0,writable:!0,value:e=>{this.getState(e).clear()}}),Object.defineProperty(this,"handleAjaxSend",{enumerable:!0,configurable:!0,writable:!0,value:e=>{this.getState(e).saving()}}),Object.defineProperty(this,"handleAjaxSuccess",{enumerable:!0,configurable:!0,writable:!0,value:e=>{this.getState(e).saved()}}),Object.defineProperty(this,"handleInputChange",{enumerable:!0,configurable:!0,writable:!0,value:e=>{this.getState(e).onInput()}}),G(document).on("input change",".js-account-edit-auto-submit",this.handleInputChange),G(document).on("ajax:error",X,this.handleAjaxError),G(document).on("ajax:send",X,this.handleAjaxSend),G(document).on("ajax:success",X,this.handleAjaxSuccess)}getState(e){var t,s;return null!==(t=(s=e.currentTarget).state)&&void 0!==t?t:s.state=new F(e.currentTarget,this.core)}}var V=s(4692);const q="js-account-edit-avatar--hover",z="js-account-edit-avatar--saving",Z="js-account-edit-avatar--start";class K{constructor(e){Object.defineProperty(this,"core",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"dragging",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"element",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"overlayLeaveTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"initialize",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.element=document.querySelector(".js-account-edit-avatar");const e=this.element;null!=e&&(V(".js-account-edit-avatar__button").fileupload({always:()=>{e.classList.remove(z)},dataType:"json",done:(e,t)=>{this.core.setCurrentUser(t.result)},dropZone:V(e),fail:$.ho,submit:()=>{e.classList.add(z),V.publish("dragendGlobal")},url:(0,g.w)("account.avatar")}),V(".js-account-edit-avatar--reset").on("ajax:send",(()=>{e.classList.add(z)})).on("ajax:complete",(()=>{e.classList.remove(z)})).on("ajax:success",((e,t)=>{this.core.setCurrentUser(t)})))}}),Object.defineProperty(this,"overlayEnd",{enumerable:!0,configurable:!0,writable:!0,value:()=>{var e;null===(e=this.element)||void 0===e||e.classList.remove(Z)}}),Object.defineProperty(this,"overlayEnter",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.dragging=!0}}),Object.defineProperty(this,"overlayHover",{enumerable:!0,configurable:!0,writable:!0,value:()=>{var e;this.dragging&&(null===(e=this.element)||void 0===e||e.classList.add(q),window.clearTimeout(this.overlayLeaveTimeout),this.overlayLeaveTimeout=window.setTimeout(this.overlayLeave,100))}}),Object.defineProperty(this,"overlayLeave",{enumerable:!0,configurable:!0,writable:!0,value:()=>{var e;this.dragging=!1,null===(e=this.element)||void 0===e||e.classList.remove(q)}}),Object.defineProperty(this,"overlayStart",{enumerable:!0,configurable:!0,writable:!0,value:()=>{var e;null===(e=this.element)||void 0===e||e.classList.add(Z)}}),Object.defineProperty(this,"rollback",{enumerable:!0,configurable:!0,writable:!0,value:()=>{null!=this.element&&V(".js-account-edit-avatar__button").fileupload("destroy")}}),V(document).on("turbolinks:load",this.initialize),V(document).on("turbolinks:before-cache",this.rollback),V.subscribe("dragenterGlobal",this.overlayStart),V.subscribe("dragendGlobal",this.overlayEnd),V(document).on("dragenter",".js-account-edit-avatar",this.overlayEnter),V(document).on("dragover",".js-account-edit-avatar",this.overlayHover)}}var J=s(4692);const Y=".js-account-edit-blocklist-content",Q=".js-account-edit-blocklist";class ee{constructor(e){Object.defineProperty(this,"core",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"toggle",{enumerable:!0,configurable:!0,writable:!0,value:e=>{e.preventDefault(),J(Y).toggleClass("hidden");const t=J(Y).hasClass("hidden")?(0,y.pw)("common.buttons.show"):(0,y.pw)("common.buttons.hide");J(Q).text(t)}}),Object.defineProperty(this,"updateBlockCount",{enumerable:!0,configurable:!0,writable:!0,value:()=>{var e;null!=this.core.currentUser&&J(".js-account-edit-blocklist-count").text((0,y.pw)("users.blocks.blocked_count",{count:null!==(e=this.core.currentUser.blocks.length)&&void 0!==e?e:0}))}}),J(document).on("click",Q,this.toggle),J((()=>(0,r.mJ)((()=>{var e;return null===(e=this.core.currentUser)||void 0===e?void 0:e.blocks}),this.updateBlockCount)))}}var te=s(4692);class se{constructor(){te(document).on("turbolinks:before-cache",(()=>{document.body.classList.remove("js-animate-nav")})).on("turbolinks:load",(()=>{window.setTimeout((()=>{document.body.classList.add("js-animate-nav")}),0)}))}}var re=s(256),ie=function(e,t,s,r){var i,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(n=(a<3?i(n):a>3?i(t,s,n):i(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n};class ae{set title(e){(0,r.h5)((()=>{this.customTitle=null!=e?`${e} | osu!`:e}))}constructor(e){Object.defineProperty(this,"core",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"customTitle",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"disposer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"origTitle",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"resetTitle",{enumerable:!0,configurable:!0,writable:!0,value:()=>{var e;document.title=this.origTitle,null===(e=this.disposer)||void 0===e||e.call(this)}}),Object.defineProperty(this,"setTitle",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.origTitle=document.title,this.disposer=(0,r.fm)((()=>{var e;const t=this.core.dataStore.notificationStore.unreadStacks.total,s=0===t?"":`(${(0,re.ZV)(t)}) `;document.title=`${s}${null!==(e=this.customTitle)&&void 0!==e?e:this.origTitle}`}))}}),(0,r.Gn)(this),document.addEventListener("turbolinks:load",this.setTitle),document.addEventListener("turbolinks:before-cache",this.resetTitle)}}ie([r.sH],ae.prototype,"customTitle",void 0),ie([r.sH],ae.prototype,"origTitle",void 0),ie([r.XI],ae.prototype,"resetTitle",void 0),ie([r.XI],ae.prototype,"setTitle",void 0);var ne=s(4692);class oe{constructor(){Object.defineProperty(this,"sitekey",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"containers",{enumerable:!0,configurable:!0,writable:!0,value:()=>document.querySelectorAll(".js-captcha--container")}),Object.defineProperty(this,"disableSubmit",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const t=this.submitButton(e);null!=t&&(t.disabled=!0)}}),Object.defineProperty(this,"enableSubmit",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const t=this.submitButton(e);null!=t&&(t.disabled=!1)}}),Object.defineProperty(this,"findContainer",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var t,s;return null===(s=(0,re.e0)(null===(t=(0,re.e0)(e))||void 0===t?void 0:t.closest("form")))||void 0===s?void 0:s.querySelector(".js-captcha--container")}}),Object.defineProperty(this,"init",{enumerable:!0,configurable:!0,writable:!0,value:e=>{this.sitekey=e,this.renderAll()}}),Object.defineProperty(this,"isEnabled",{enumerable:!0,configurable:!0,writable:!0,value:e=>this.isTriggered(e)&&"object"==typeof turnstile&&"function"==typeof turnstile.render&&""!==this.sitekey}),Object.defineProperty(this,"isLoaded",{enumerable:!0,configurable:!0,writable:!0,value:e=>""!==e.innerHTML}),Object.defineProperty(this,"isTriggered",{enumerable:!0,configurable:!0,writable:!0,value:e=>"1"===e.dataset.captchaTriggered}),Object.defineProperty(this,"render",{enumerable:!0,configurable:!0,writable:!0,value:e=>{if(function(e){const t=e.getBoundingClientRect();return(0!==t.x||0!==t.y||0!==t.width||0!==t.height)&&"none"!==window.getComputedStyle(e).pointerEvents}(e)&&this.isEnabled(e)&&!this.isLoaded(e)){const t=()=>this.disableSubmit(e),s=turnstile.render(e,{callback:()=>this.enableSubmit(e),"error-callback":t,"expired-callback":t,language:window.currentLocale,sitekey:this.sitekey,theme:"dark"});if(null==s)throw new Error("failed setting up turnstile widget");e.dataset.captchaId=s,ne(document).one("turbolinks:before-cache",(()=>this.remove(e))),t()}}}),Object.defineProperty(this,"reset",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var t;this.isEnabled(e)&&(turnstile.reset(null!==(t=e.dataset.captchaId)&&void 0!==t?t:""),this.disableSubmit(e))}}),Object.defineProperty(this,"submitButton",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var t;return null===(t=e.closest("form"))||void 0===t?void 0:t.querySelector(".js-captcha--submit-button")}}),Object.defineProperty(this,"trigger",{enumerable:!0,configurable:!0,writable:!0,value:e=>{this.isTriggered(e)||(e.dataset.captchaTriggered="1",this.render(e))}}),Object.defineProperty(this,"remove",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const t=e.dataset.captchaId;delete e.dataset.captchaId,turnstile.remove(null!=t?t:"")}}),Object.defineProperty(this,"renderAll",{enumerable:!0,configurable:!0,writable:!0,value:()=>{for(const e of this.containers())this.render(e)}}),Object.defineProperty(this,"resetOnError",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const t=this.findContainer((0,re.e0)(e.target));null!=t&&this.reset(t)}}),ne(document).on("turbolinks:load",this.renderAll),ne(document).on("ajax:error",".js-captcha--reset-on-error",this.resetOnError)}}var le=s(1491),ce=s(2961),ue=s(4692);class de{constructor(){Object.defineProperty(this,"current",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"documentMouseEventTarget",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"close",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.show()}}),Object.defineProperty(this,"restoreSaved",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.show(document.body.dataset.clickMenuCurrent)}}),Object.defineProperty(this,"saveCurrent",{enumerable:!0,configurable:!0,writable:!0,value:()=>{null==this.current?delete document.body.dataset.clickMenuCurrent:document.body.dataset.clickMenuCurrent=this.current}}),Object.defineProperty(this,"show",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var t,s;const r=this.tree();this.current=e;const i=this.tree(),a=document.querySelectorAll(".js-click-menu[data-click-menu-id]");let n=null,o=!1;for(const c of a){if(!(c instanceof HTMLElement))continue;const e=c.dataset.clickMenuId;null==e||-1===i.indexOf(e)?((0,le.Xn)(c),c.classList.remove("js-click-menu--active"),null===(t=this.menuLink(e))||void 0===t||t.classList.remove("js-click-menu--active")):((0,le.qG)(c),c.classList.add("js-click-menu--active"),null===(s=this.menuLink(e))||void 0===s||s.classList.add("js-click-menu--active"),o=!0,e===this.current&&(n=c))}o||(this.current=null),ue.publish("click-menu:current",{previousTree:r,target:this.current,tree:i});const l=null==n?void 0:n.querySelector(".js-click-menu--autofocus");l instanceof HTMLElement&&l.focus()}}),Object.defineProperty(this,"toggle",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const t=e.currentTarget,s=this.tree();e.preventDefault();const r=t.dataset.clickMenuTarget;let i=r;if(null!=r){const e=s.indexOf(r);-1!==e&&(i=s[e+1])}this.show(i)}}),Object.defineProperty(this,"tree",{enumerable:!0,configurable:!0,writable:!0,value:()=>{if(null==this.current)return[];let e=this.current;const t=[e];for(;e=this.closestMenuId(this.menuLink(e)),null!=e;)t.push(e);return t}}),Object.defineProperty(this,"onDocumentMousedown",{enumerable:!0,configurable:!0,writable:!0,value:e=>{this.documentMouseEventTarget=0===e.button?e.target:null}}),Object.defineProperty(this,"onDocumentMouseup",{enumerable:!0,configurable:!0,writable:!0,value:e=>{this.documentMouseEventTarget===e.target&&0===e.button&&((0,ce.h)()||null!=this.current&&(ue(e.target).closest(".js-click-menu").length>0||this.show()))}}),ue(document).on("click",".js-click-menu--close",this.close),ue(document).on("click",".js-click-menu[data-click-menu-target]",this.toggle),ue(document).on("mousedown",this.onDocumentMousedown),ue(document).on("mouseup",this.onDocumentMouseup),document.addEventListener("turbolinks:load",this.restoreSaved),document.addEventListener("turbolinks:before-cache",this.saveCurrent)}closestMenuId(e){if(null!=e)return ue(e).parents("[data-click-menu-id]").attr("data-click-menu-id")}menu(e){return document.querySelector(`.js-click-menu[data-click-menu-id${null==e?"":`='${e}'`}]`)}menuLink(e){return document.querySelector(`.js-click-menu[data-click-menu-target${null==e?"":`='${e}'`}]`)}}var pe=s(7634),me=s(4692);class he{constructor(e){Object.defineProperty(this,"core",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"avatars",{enumerable:!0,configurable:!0,writable:!0,value:document.getElementsByClassName("js-current-user-avatar")}),Object.defineProperty(this,"covers",{enumerable:!0,configurable:!0,writable:!0,value:document.getElementsByClassName("js-current-user-cover")}),Object.defineProperty(this,"setAvatars",{enumerable:!0,configurable:!0,writable:!0,value:()=>{var e,t;const s=null!==(t=(0,pe.NZ)(null===(e=this.core.currentUser)||void 0===e?void 0:e.avatar_url))&&void 0!==t?t:"";for(const r of this.avatars)r instanceof HTMLElement&&(r.style.backgroundImage=s)}}),Object.defineProperty(this,"setCovers",{enumerable:!0,configurable:!0,writable:!0,value:()=>{var e,t;const s=null!==(t=(0,pe.NZ)(null===(e=this.core.currentUser)||void 0===e?void 0:e.cover.url))&&void 0!==t?t:"";for(const r of this.covers)r instanceof HTMLElement&&(r.style.backgroundImage=s)}}),me(document).on("turbolinks:load",this.setAvatars),me((()=>(0,r.mJ)((()=>{var e;return null===(e=this.core.currentUser)||void 0===e?void 0:e.avatar_url}),this.setAvatars))),me((()=>(0,r.mJ)((()=>{var e;return null===(e=this.core.currentUser)||void 0===e?void 0:e.cover.url}),this.setCovers)))}}var be=s(4692);const fe="//platform.enchant.com";class ve{constructor(e){Object.defineProperty(this,"turbolinksReload",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"load",{enumerable:!0,configurable:!0,writable:!0,value:()=>{null!=document.querySelector(".enchant-help-center")&&(window.enchant=[],this.turbolinksReload.load(fe))}}),Object.defineProperty(this,"showMessageWindow",{enumerable:!0,configurable:!0,writable:!0,value:e=>{e.preventDefault(),null!=window.enchant&&null!=window.enchant.messenger&&"function"==typeof window.enchant.messenger.open&&window.enchant.messenger.open()}}),Object.defineProperty(this,"unload",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.turbolinksReload.forget(fe),be('#enchant-messenger-main, #enchant-messenger-launcher, iframe[src^="https://enchantwidgets-"]').remove(),document.querySelectorAll("style").forEach((e=>{const t=e.textContent;null!=t&&/#enchant-/.exec(t)&&be(e).remove()}))}}),be(document).on("turbolinks:load",this.load),be(document).on("turbolinks:before-cache",this.unload),be(document).on("click",".js-enchant--show",this.showMessageWindow)}}var ge=s(4692);class ye{constructor(){Object.defineProperty(this,"switchEdit",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const t=ge(e.target).parents(".js-forum-poll--container");if("1"===t.attr("data-edit")){t.attr("data-edit","0");const s=ge(e.target).closest("form")[0];null!=s&&s.reset()}else t.attr("data-edit","1")}}),Object.defineProperty(this,"switchPage",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const t=e.currentTarget;if(!(t instanceof HTMLElement))return;const s=t.dataset.targetPage;"string"==typeof s&&ge(e.target).parents(".js-forum-poll--container").attr("data-page",s)}}),ge(document).on("click",".js-forum-poll--switch-page",this.switchPage).on("click",".js-forum-poll--switch-edit",this.switchEdit)}}var we=s(4692);class _e{constructor(){Object.defineProperty(this,"handleCancel",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var t;e.preventDefault(),we.publish("forum-post-input:clear",[e.target]);const s=we(e.target).parents(".js-forum-post-edit--container");s.html(null!==(t=s.attr("data-original-post"))&&void 0!==t?t:"").attr("data-original-post",null)}}),Object.defineProperty(this,"handleEditSaved",{enumerable:!0,configurable:!0,writable:!0,value:(e,t)=>{const s=e.target;setTimeout((()=>{this.saved(s,t)}))}}),Object.defineProperty(this,"handleEditStart",{enumerable:!0,configurable:!0,writable:!0,value:(e,t)=>{const s=e.target;setTimeout((()=>{this.start(s,t)}))}}),Object.defineProperty(this,"saved",{enumerable:!0,configurable:!0,writable:!0,value:(e,t)=>{if(!(e instanceof HTMLElement))throw new Error("target must be instance of HTMLElement");we(e).parents(".js-forum-post").replaceWith(t)}}),Object.defineProperty(this,"start",{enumerable:!0,configurable:!0,writable:!0,value:(e,t)=>{if(!(e instanceof HTMLElement))throw new Error("target must be instance of HTMLElement");const s=we(e).parents(".js-forum-post-edit--container");s.attr("data-original-post",s.html()).html(t).find("[name=body]").focus(),we.publish("forum-post-input:restore",[s[0]])}}),we(document).on("ajax:success",".js-edit-post-start",this.handleEditStart).on("click",".js-edit-post-cancel",this.handleCancel).on("ajax:success",".js-forum-post-edit",this.handleEditSaved)}}var Ee=s(4692);function Pe(e){var t;if(!(e instanceof HTMLElement))return;const s=null!==(t=e.closest(".js-forum-post"))&&void 0!==t?t:e.closest("form");if(!(s instanceof HTMLElement))return;const r=s.querySelector("[name=body]");return r instanceof HTMLTextAreaElement?r:void 0}class Oe{constructor(){Object.defineProperty(this,"handleClear",{enumerable:!0,configurable:!0,writable:!0,value:(e,t)=>{this.clearInput(Pe(t))}}),Object.defineProperty(this,"handlePageLoad",{enumerable:!0,configurable:!0,writable:!0,value:()=>{for(const e of document.querySelectorAll(".js-forum-post-input"))this.handleRestore(null,e)}}),Object.defineProperty(this,"handlePostSaved",{enumerable:!0,configurable:!0,writable:!0,value:e=>{this.clearInput(Pe(e.target))}}),Object.defineProperty(this,"handleRestore",{enumerable:!0,configurable:!0,writable:!0,value:(e,t)=>{const s=Pe(t);if(null==s)return;const r=this.getKeyFromInput(s);if(null==r)return;const i=localStorage.getItem(r);if(null!=i&&(s.value=i),r.startsWith("forum-post-input:topic:")){const e=`forum-topic-reply--${(0,_.bS)().pathname}--text`,t=localStorage.getItem(e);null!=t&&(localStorage.removeItem(e),localStorage.setItem(r,t),s.value=t)}}}),Object.defineProperty(this,"onInput",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const t=e.currentTarget;if(!(t instanceof HTMLTextAreaElement))return;const s=this.getKeyFromInput(t);if(null==s)return;""===t.value?localStorage.removeItem(s):localStorage.setItem(s,t.value)}}),Ee(document).on("input change",".js-forum-post-input",this.onInput).on("turbolinks:load",this.handlePageLoad).on("ajax:success",".js-forum-post-input--form",this.handlePostSaved),Ee.subscribe("forum-post-input:restore",this.handleRestore),Ee.subscribe("forum-post-input:clear",this.handleClear)}clearInput(e){if(null==e)return;const t=this.getKeyFromInput(e);null!=t&&localStorage.removeItem(t)}getKeyFromInput(e){return this.prefixKey(e.dataset.forumPostInputId)}prefixKey(e){if(null!=e&&""!==e)return`forum-post-input:${e}`}}var je=s(4681),ke=s(4692);class Se{constructor(){Object.defineProperty(this,"onClickReportButton",{enumerable:!0,configurable:!0,writable:!0,value:e=>{if(0!==e.button)return;const t=e.currentTarget.closest(".js-forum-post");if(null==t)return;const s=t.dataset.postId,r=t.dataset.postUsername;null!=s&&null!=r&&(0,je.oF)({reportableId:s,reportableType:"forum_post",username:r})}}),ke(document).on("click",".js-forum-post-report",this.onClickReportButton)}}var Ne=s(5093);class Ae{constructor(){Object.defineProperty(this,"observer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"formatElem",{enumerable:!0,configurable:!0,writable:!0,value:e=>{"1"!==e.dataset.localtime&&(e.dataset.localtime="1",e.classList.add("js-tooltip-time"),e.title=e.dateTime,e.innerText=Ne(e.dateTime).format("LLL"))}}),Object.defineProperty(this,"formatElems",{enumerable:!0,configurable:!0,writable:!0,value:e=>(null==e&&(e=this.getElems(document.body)),e.map(this.formatElem))}),Object.defineProperty(this,"getElems",{enumerable:!0,configurable:!0,writable:!0,value:e=>e instanceof HTMLElement?e instanceof HTMLTimeElement&&e.classList.contains("js-localtime")?[e]:[...e.querySelectorAll("time.js-localtime")]:[]}),Object.defineProperty(this,"mutationHandler",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const t=[];e.forEach((e=>{e.addedNodes.forEach((e=>{t.push(...this.getElems(e))}))})),this.formatElems(t)}}),this.observer=new MutationObserver(this.mutationHandler),this.observer.observe(document,{childList:!0,subtree:!0})}}var Te=s(4692);const Ce="js-mobile-toggle--active";class xe{constructor(){Object.defineProperty(this,"toggle",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const t=e.currentTarget;if(!(t instanceof HTMLElement))return;const s=t.dataset.mobileToggleTarget;if(null==s)return;const r=document.querySelector(`.js-mobile-toggle[data-mobile-toggle-id=${s}]`);if(!(r instanceof HTMLElement))return;const i=!t.classList.contains(Ce);t.classList.toggle(Ce,i),r.classList.toggle("hidden-xs",!i)}}),Te(document).on("click",".js-mobile-toggle",this.toggle)}}var Ie=s(4692);const Re=e=>{var t;return null!==(t=e.clientX)&&void 0!==t?t:e.touches[0].clientX};let Me=null;class De{constructor(e){Object.defineProperty(this,"active",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"bar",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"endCallback",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"moveCallback",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"percentage",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"end",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.active=!1,Ie(document).off("mousemove touchmove",this.onMove),Ie(document).off("mouseup touchend",this.end),Ie(window).off("blur",this.end),Ie(document).off("turbolinks:before-cache",this.end),null!=this.endCallback&&this.endCallback(this),this.bar.style.removeProperty("--bar"),this.bar.dataset.audioDragging="0",Me=null}}),Object.defineProperty(this,"getPercentage",{enumerable:!0,configurable:!0,writable:!0,value:()=>this.percentage}),Object.defineProperty(this,"move",{enumerable:!0,configurable:!0,writable:!0,value:e=>{if(!this.active)return;const t=this.bar.getBoundingClientRect(),s=e-t.left,r=t.width;this.percentage=(0,o.clamp)(s/r,0,1),null!=this.moveCallback&&this.moveCallback(this),this.bar.style.setProperty("--bar",this.percentage.toString())}}),Object.defineProperty(this,"onMove",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const t=Re(e);requestAnimationFrame((()=>{this.move(t)}))}}),this.endCallback=e.endCallback,this.moveCallback=e.moveCallback,this.bar=e.bar,this.bar.dataset.audioDragging="1",this.move(Re(e.initialEvent)),Ie(document).on("mousemove touchmove",this.onMove),Ie(document).on("mouseup touchend",this.end),Ie(window).on("blur",this.end),Ie(document).on("turbolinks:before-cache",this.end)}static start(e){if(0===e.initialEvent.which||1===e.initialEvent.which)return null!=Me&&Me.end(),Me=new De(e),Me}}Object.defineProperty(De,"startEvents",{enumerable:!0,configurable:!0,writable:!0,value:"mousedown touchstart"});const He=De,$e=e=>e.toString().padStart(2,"0"),Le={},Ue=(e,t)=>{var s;const r=Math.floor(e);if(Le.time!==r||Le.format!==t){Le.format=t,Le.time=r;const e=r%60,s=Math.floor(r/60);if("minute_minimal"===t)Le.formatted=`'${s}:${$e(e)}'`;else if("minute"===t)Le.formatted=`'${$e(s)}:${$e(e)}'`;else{const r=s%60,i=Math.floor(s/60);Le.formatted="hour_minimal"===t?`'${i}:${$e(r)}:${$e(e)}'`:`'${$e(i)}:${$e(r)}:${$e(e)}'`}}return null!==(s=Le.formatted)&&void 0!==s?s:""};var Be=s(4692),Fe=function(e,t,s,r){var i,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(n=(a<3?i(n):a>3?i(t,s,n):i(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n};class Ge{constructor(e){Object.defineProperty(this,"userPreferences",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"audio",{enumerable:!0,configurable:!0,writable:!0,value:new Audio}),Object.defineProperty(this,"currentSlider",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"durationFormatted",{enumerable:!0,configurable:!0,writable:!0,value:"'0:00'"}),Object.defineProperty(this,"hasWorkingVolumeControl",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"hideMainPlayerTimeout",{enumerable:!0,configurable:!0,writable:!0,value:-1}),Object.defineProperty(this,"mainPlayer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"observer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"pagePlayer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"playerNext",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"playerPrev",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"settingNavigation",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:"paused"}),Object.defineProperty(this,"timeFormat",{enumerable:!0,configurable:!0,writable:!0,value:"minute_minimal"}),Object.defineProperty(this,"url",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"checkVolumeSettings",{enumerable:!0,configurable:!0,writable:!0,value:()=>{const e=this.audio.volume,t=.1===e?.2:.1;this.audio.volume=t,setTimeout((()=>{this.hasWorkingVolumeControl=this.audio.volume===t,this.audio.volume=e,this.syncVolumeDisplay()}),0)}}),Object.defineProperty(this,"ensurePagePlayerIsAttached",{enumerable:!0,configurable:!0,writable:!0,value:()=>{null==this.pagePlayer||document.body.contains(this.pagePlayer)||(this.pagePlayer=void 0)}}),Object.defineProperty(this,"load",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const t=e.dataset.audioUrl;if(null==t)throw new Error("Player is missing url");this.audio.paused||this.stop(),this.setTime(0),this.pagePlayer=e,this.url=t,this.audio.setAttribute("src",t),this.audio.currentTime=0,this.setState("loading");const s=this.audio.play();null==s||s.catch((e=>{if(Ge.ignoredErrors.includes(e.name))return console.error("playback failed:",e.name),void this.stop();throw e})),this.setNavigation()}}),Object.defineProperty(this,"nav",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const t=e.currentTarget;t instanceof HTMLElement&&("prev"===t.dataset.audioNav&&null!=this.playerPrev?this.load(this.playerPrev):"next"===t.dataset.audioNav&&null!=this.playerNext&&this.load(this.playerNext))}}),Object.defineProperty(this,"observePage",{enumerable:!0,configurable:!0,writable:!0,value:e=>{this.ensurePagePlayerIsAttached();const t=[],s=[],r=null==this.pagePlayer;e.forEach((e=>{e.addedNodes.forEach((e=>{if(e instanceof HTMLElement&&(e instanceof HTMLAudioElement?t.push(e):t.push(...e.querySelectorAll("audio")),r))if(e.classList.contains("js-audio--player"))s.push(e);else for(const t of[...e.querySelectorAll(".js-audio--player")])t instanceof HTMLElement&&s.push(t)}))})),s.push(...this.replaceAudioElems(t)),this.reattachPagePlayer(s)}}),Object.defineProperty(this,"onClickPlay",{enumerable:!0,configurable:!0,writable:!0,value:e=>{e.preventDefault();const t=this.findPlayer(e.currentTarget);if(null==t)throw new Error("couldn't find pagePlayer of the play button");t===this.pagePlayer?this.togglePlay():this.load(t)}}),Object.defineProperty(this,"onDocumentReady",{enumerable:!0,configurable:!0,writable:!0,value:()=>{if(null==this.mainPlayer){const e=document.querySelector(".js-audio--main");if(null==e)return void console.error("page is missing main player placeholder");this.mainPlayer=(()=>{const e=document.createElement("div");return e.className="audio-player audio-player--main",e.innerHTML=`\n    <button\n      type="button"\n      class="audio-player__button audio-player__button--prev js-audio--nav"\n      data-audio-nav="prev"\n    ><span class="fas fa-fw fa-step-backward"></span></button>\n\n    <button\n      type="button"\n      class="audio-player__button audio-player__button--play js-audio--main-play"\n    ><span class="fa-fw play-button"></span></button>\n\n    <button\n      type="button"\n      class="audio-player__button audio-player__button--next js-audio--nav"\n      data-audio-nav="next"\n    ><span class="fas fa-fw fa-step-forward"></span></button>\n\n    <div class="audio-player__bar audio-player__bar--progress js-audio--seek">\n      <div class="audio-player__bar-current"></div>\n    </div>\n\n    <div class="audio-player__timestamps">\n      <div class="audio-player__timestamp audio-player__timestamp--current"></div>\n      <div class="audio-player__timestamp-separator">/</div>\n      <div class="audio-player__timestamp audio-player__timestamp--total"></div>\n    </div>\n\n    <div class="audio-player__volume-control">\n      <button type="button" class="audio-player__volume-button js-audio--toggle-mute"></button>\n      <div class="audio-player__bar audio-player__bar--volume js-audio--volume">\n        <div class="audio-player__bar-current"></div>\n      </div>\n    </div>\n\n    <div class="audio-player__autoplay-control">\n      <button type="button" class="audio-player__autoplay-button js-audio--toggle-autoplay" title="${(0,y.pw)("layout.audio.autoplay")}"></button>\n    </div>\n  `,e})(),e.replaceWith(this.mainPlayer),(0,r.fm)((()=>{this.audio.muted=this.userPreferences.get("audio_muted"),this.audio.volume=this.userPreferences.get("audio_volume");const e=this.userPreferences.get("audio_autoplay")?"1":"0";null!=this.mainPlayer&&(this.mainPlayer.dataset.audioAutoplay=e)})),this.checkVolumeSettings(),this.syncState()}null==this.observer&&(this.observer=new MutationObserver(this.observePage),this.observer.observe(document,{childList:!0,subtree:!0})),this.replaceAudioElems(),this.reattachPagePlayer()}}),Object.defineProperty(this,"onEnded",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.stop(),null!=this.playerNext&&this.userPreferences.get("audio_autoplay")&&this.load(this.playerNext)}}),Object.defineProperty(this,"onPause",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.setState("paused")}}),Object.defineProperty(this,"onPlaying",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.setTimeFormat(),this.durationFormatted=Ue(this.audio.duration,this.timeFormat),this.setState("playing")}}),Object.defineProperty(this,"onSeekEnd",{enumerable:!0,configurable:!0,writable:!0,value:e=>{this.currentSlider=void 0;const t=1===e.getPercentage()?this.audio.duration-.01:this.audio.duration*e.getPercentage();this.setTime(t)}}),Object.defineProperty(this,"onSeekStart",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const t=e.currentTarget;t instanceof HTMLElement&&(null!=this.pagePlayer&&this.pagePlayer.contains(t)||null!=this.mainPlayer&&this.mainPlayer.contains(t))&&Number.isFinite(this.audio.duration)&&0!==this.audio.duration&&(this.currentSlider=He.start({bar:t,endCallback:this.onSeekEnd,initialEvent:e}))}}),Object.defineProperty(this,"onTimeupdate",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.audio.paused&&this.syncProgress()}}),Object.defineProperty(this,"onVolumeChangeEnd",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.currentSlider=void 0,this.userPreferences.set("audio_volume",this.audio.volume)}}),Object.defineProperty(this,"onVolumeChangeMove",{enumerable:!0,configurable:!0,writable:!0,value:e=>{this.audio.volume=e.getPercentage()}}),Object.defineProperty(this,"onVolumeChangeStart",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const t=e.currentTarget;t instanceof HTMLElement&&(this.currentSlider=He.start({bar:t,endCallback:this.onVolumeChangeEnd,initialEvent:e,moveCallback:this.onVolumeChangeMove}))}}),Object.defineProperty(this,"reattachPagePlayer",{enumerable:!0,configurable:!0,writable:!0,value:e=>{if(this.ensurePagePlayerIsAttached(),null!=this.url&&null==this.pagePlayer){null==e&&(e=[...document.querySelectorAll(".js-audio--player")]);for(const t of e)if(t instanceof HTMLElement&&t.dataset.audioUrl===this.url){this.pagePlayer=t,this.syncState();break}}this.setNavigation()}}),Object.defineProperty(this,"replaceAudioElem",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var t,s;const r=null!==(t=(0,l.I)(e.src))&&void 0!==t?t:(0,l.I)(null===(s=e.querySelector("source"))||void 0===s?void 0:s.src);if(null==r)throw new Error("audio element is missing src");const i=(()=>{const e=document.createElement("div");return e.className="audio-player js-audio--player",e.innerHTML='\n    <button\n    type="button"\n    class="audio-player__button audio-player__button--play js-audio--play"\n    ><span class="fa-fw play-button"></span></button>\n\n    <div class="audio-player__bar audio-player__bar--progress js-audio--seek">\n      <div class="audio-player__bar-current"></div>\n    </div>\n\n    <div class="audio-player__timestamps">\n      <div class="audio-player__timestamp audio-player__timestamp--current"></div>\n      <div class="audio-player__timestamp-separator">/</div>\n      <div class="audio-player__timestamp audio-player__timestamp--total"></div>\n    </div>\n  ',e})();return i.dataset.audioUrl=r,i.dataset.audioState="paused",e.replaceWith(i),i}}),Object.defineProperty(this,"replaceAudioElems",{enumerable:!0,configurable:!0,writable:!0,value:e=>(null==e&&(e=[...document.querySelectorAll("audio")]),e.map(this.replaceAudioElem))}),Object.defineProperty(this,"setNavigation",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.settingNavigation||(this.settingNavigation=!0,window.setTimeout((()=>{var e;this.playerNext=void 0,this.playerPrev=void 0;const t=null===(e=this.pagePlayer)||void 0===e?void 0:e.closest(".js-audio--group");if(t instanceof HTMLElement){const e=t.querySelectorAll(".js-audio--player");for(let t=0;t<e.length;t++)if(e[t]===this.pagePlayer){if(t>0){const s=e[t-1];s instanceof HTMLElement&&(this.playerPrev=s)}const s=e[t+1];s instanceof HTMLElement&&(this.playerNext=s);break}}null!=this.mainPlayer&&(this.mainPlayer.dataset.audioHasPrev=null==this.playerPrev?"0":"1",this.mainPlayer.dataset.audioHasNext=null==this.playerNext?"0":"1"),this.settingNavigation=!1})))}}),Object.defineProperty(this,"setState",{enumerable:!0,configurable:!0,writable:!0,value:e=>{this.state=e,this.syncState(),window.clearTimeout(this.hideMainPlayerTimeout),"playing"===this.state||"loading"===this.state?null!=this.mainPlayer&&(this.mainPlayer.dataset.audioVisible="1"):this.hideMainPlayerTimeout=window.setTimeout((()=>{null!=this.mainPlayer&&(this.mainPlayer.dataset.audioVisible="0")}),4e3)}}),Object.defineProperty(this,"setTime",{enumerable:!0,configurable:!0,writable:!0,value:e=>{this.audio.currentTime=e,this.syncProgress()}}),Object.defineProperty(this,"setTimeFormat",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.audio.duration<600?this.timeFormat="minute_minimal":this.audio.duration<3600?this.timeFormat="minute":this.audio.duration<36e3?this.timeFormat="hour_minimal":this.timeFormat="hour"}}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:()=>{var e;this.audio.pause(),null===(e=this.currentSlider)||void 0===e||e.end(),this.audio.currentTime=0,this.onPause()}}),Object.defineProperty(this,"syncProgress",{enumerable:!0,configurable:!0,writable:!0,value:()=>{if(this.audio.duration>0){const e=this.audio.currentTime/this.audio.duration,t=e>=.5?"1":"0",s=e.toString(),r=Ue(this.audio.currentTime,this.timeFormat);this.updatePlayers((e=>{e.style.setProperty("--current-time",r),e.style.setProperty("--progress",s),e.dataset.audioOver50=t}))}this.audio.paused||requestAnimationFrame(this.syncProgress)}}),Object.defineProperty(this,"syncState",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.updatePlayers((e=>{e.dataset.audioHasDuration=Number.isFinite(this.audio.duration)?"1":"0",e.dataset.audioState=this.state,e.dataset.audioTimeFormat=this.timeFormat,e.style.setProperty("--duration",this.durationFormatted)})),this.syncProgress(),this.syncVolumeDisplay()}}),Object.defineProperty(this,"syncVolumeDisplay",{enumerable:!0,configurable:!0,writable:!0,value:()=>{null!=this.mainPlayer&&(this.mainPlayer.dataset.audioVolumeBarVisible=this.hasWorkingVolumeControl?"1":"0",this.mainPlayer.dataset.audioVolume=this.volumeIcon(),this.mainPlayer.style.setProperty("--volume",this.audio.volume.toString()))}}),Object.defineProperty(this,"toggleAutoplay",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.userPreferences.set("audio_autoplay",!this.userPreferences.get("audio_autoplay"))}}),Object.defineProperty(this,"toggleMute",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.userPreferences.set("audio_muted",!this.userPreferences.get("audio_muted"))}}),Object.defineProperty(this,"togglePlay",{enumerable:!0,configurable:!0,writable:!0,value:()=>{null!=this.url&&(this.audio.paused?this.audio.play():this.audio.pause())}}),Object.defineProperty(this,"updatePlayers",{enumerable:!0,configurable:!0,writable:!0,value:e=>{[this.mainPlayer,this.pagePlayer].forEach((t=>{null!=t&&e(t)}))}}),Object.defineProperty(this,"volumeIcon",{enumerable:!0,configurable:!0,writable:!0,value:()=>this.audio.muted?"muted":0===this.audio.volume?"silent":this.audio.volume<.4?"quiet":"normal"}),(0,r.Gn)(this),this.audio.volume=0,this.audio.addEventListener("pause",this.onPause),this.audio.addEventListener("playing",this.onPlaying),this.audio.addEventListener("ended",this.onEnded),this.audio.addEventListener("timeupdate",this.onTimeupdate),this.audio.addEventListener("volumechange",this.syncVolumeDisplay),Be(document).on("click",".js-audio--play",this.onClickPlay).on("click",".js-audio--main-play",this.togglePlay).on(He.startEvents,".js-audio--seek",this.onSeekStart).on(He.startEvents,".js-audio--volume",this.onVolumeChangeStart).on("click",".js-audio--toggle-mute",this.toggleMute).on("click",".js-audio--toggle-autoplay",this.toggleAutoplay).on("click",".js-audio--nav",this.nav),document.addEventListener("turbolinks:load",this.onDocumentReady)}findPlayer(e){var t,s;const r=null!==(s=null===(t=this.mainPlayer)||void 0===t?void 0:t.contains(e))&&void 0!==s&&s?this.pagePlayer:e.closest(".js-audio--player");if(r instanceof HTMLElement)return r}}Object.defineProperty(Ge,"ignoredErrors",{enumerable:!0,configurable:!0,writable:!0,value:["AbortError","NotAllowedError","NotSupportedError"]});const Xe=Ge;Fe([r.XI],Ge.prototype,"onEnded",void 0),Fe([r.XI],Ge.prototype,"onVolumeChangeEnd",void 0),Fe([r.XI],Ge.prototype,"toggleAutoplay",void 0),Fe([r.XI],Ge.prototype,"toggleMute",void 0);var We=s(8156),Ve=s(961),qe=s(4692),ze=s(6224);class Ze{constructor(e,t){Object.defineProperty(this,"core",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"turbolinksReload",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"components",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"newVisit",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"pageReady",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"renderedContainers",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"scrolled",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"timeoutScroll",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"boot",{enumerable:!0,configurable:!0,writable:!0,value:()=>{if(this.pageReady&&null!=window.newBody)for(const[e,t]of this.components.entries()){const s=window.newBody.querySelectorAll(`.js-react--${e}`);for(const e of s)e instanceof HTMLElement&&!this.renderedContainers.has(e)&&(this.renderedContainers.add(e),(0,r.h5)((()=>{Ve.render(t(e),e)})))}}}),Object.defineProperty(this,"destroy",{enumerable:!0,configurable:!0,writable:!0,value:()=>{for(const e of this.renderedContainers.values())document.body.contains(e)||(Ve.unmountComponentAtNode(e),this.renderedContainers.delete(e))}}),Object.defineProperty(this,"handleBeforeCache",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.pageReady=!1,window.clearTimeout(this.timeoutScroll)}}),Object.defineProperty(this,"handleBeforeRender",{enumerable:!0,configurable:!0,writable:!0,value:e=>{window.newBody=e.originalEvent.data.newBody,this.setNewUrl(),this.pageReady=!0,(0,We.e)(),this.core.updateCurrentUser(),this.loadScripts(!1),this.boot()}}),Object.defineProperty(this,"handleBeforeVisit",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.newVisit=!0}}),Object.defineProperty(this,"handleLoad",{enumerable:!0,configurable:!0,writable:!0,value:()=>{var e;null!==(e=window.newBody)&&void 0!==e||(window.newBody=document.body),window.newUrl=null,this.pageReady=!0,this.scrolled=!1,qe(window).off("scroll",this.handleWindowScroll),qe(window).on("scroll",this.handleWindowScroll),window.setTimeout((()=>{this.destroy(),this.loadScripts(),this.boot(),this.timeoutScroll=window.setTimeout(this.scrollOnNewVisit,100)}),1)}}),Object.defineProperty(this,"handleWindowScroll",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.scrolled=this.scrolled||0!==window.scrollX||0!==window.scrollY}}),Object.defineProperty(this,"scrollOnNewVisit",{enumerable:!0,configurable:!0,writable:!0,value:()=>{var e;qe(window).off("scroll",this.handleWindowScroll);const t=this.newVisit;if(this.newVisit=!1,!t||this.scrolled)return;const s=decodeURIComponent((0,_.bS)().hash.substr(1));""!==s&&(null===(e=document.getElementById(s))||void 0===e||e.scrollIntoView())}}),qe(document).on("turbolinks:before-cache",this.handleBeforeCache),qe(document).on("turbolinks:before-visit",this.handleBeforeVisit),qe(document).on("turbolinks:load",this.handleLoad),qe(document).on("turbolinks:before-render",this.handleBeforeRender)}register(e,t){this.components.has(e)||(this.components.set(e,t),this.boot())}runAfterPageLoad(e){if(document.body!==window.newBody)return qe(document).one("turbolinks:load",e),()=>{qe(document).off("turbolinks:load",e)};e()}loadScripts(e=!0){if(null==window.newBody)return;const t=e?"load":"loadSync";window.newBody.querySelectorAll(".js-react-turbolinks--script").forEach((e=>{if(e instanceof HTMLDivElement){const s=e.dataset.src;null!=s&&this.turbolinksReload[t](s)}}))}setNewUrl(){var e,t,s,r;const i=null!==(s=null===(t=null===(e=ze.controller.currentVisit)||void 0===e?void 0:e.redirectedToLocation)||void 0===t?void 0:t.absoluteURL)&&void 0!==s?s:null===(r=ze.controller.currentVisit)||void 0===r?void 0:r.location.absoluteURL;window.newUrl=null==i?document.location:new URL(i)}}var Ke=s(8961),Je=s(4692);function Ye(e){var t,s,r;e.stopPropagation(),e.preventDefault();const i=null!==(s=null===(t=(0,re.e0)(e.target))||void 0===t?void 0:t.closest(".js-spoilerbox"))&&void 0!==s?s:(0,Ke.f)("spoiler container is missing"),a=null!==(r=i.querySelector(":scope > .js-spoilerbox__body"))&&void 0!==r?r:(0,Ke.f)("spoiler body is missing"),n=i.classList.toggle("js-spoilerbox--open")?"slideDown":"slideUp";Je(a).stop()[n]({complete(){Je.publish("sync-height:force")}})}class Qe{constructor(){Je(document).on("click",".js-spoilerbox__link",Ye)}}var et=s(4692);class tt{constructor(){Object.defineProperty(this,"permanentFixedFooter",{enumerable:!0,configurable:!0,writable:!0,value:document.getElementsByClassName("js-permanent-fixed-footer")}),Object.defineProperty(this,"stickMarker",{enumerable:!0,configurable:!0,writable:!0,value:document.getElementsByClassName("js-sticky-footer")}),Object.defineProperty(this,"throttledStickOrUnstick",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stickOrUnstick",{enumerable:!0,configurable:!0,writable:!0,value:()=>{if(0===this.stickMarker.length)return;const e=this.permanentFixedFooter[0];if(!(e instanceof HTMLElement))return;const t=window.innerHeight-e.offsetHeight;for(const s of this.stickMarker)if(s instanceof HTMLElement){if("1"===s.dataset.stickyFooterDisabled)continue;if(s.getBoundingClientRect().top>=t)return void et.publish("stickyFooter",s.dataset.stickyFooterTarget)}et.publish("stickyFooter")}}),this.throttledStickOrUnstick=(0,o.throttle)(this.stickOrUnstick,100),et(window).on("scroll resize",this.stickOrUnstick),et.subscribe("stickyFooter:check",this.throttledStickOrUnstick),et(document).on("turbolinks:load",this.throttledStickOrUnstick)}markerDisable(e){e.dataset.stickyFooterDisabled="1"}markerEnable(e){e.dataset.stickyFooterDisabled=""}}var st=s(4692);class rt{get breadcrumbsElement(){var e;return null===(e=window.newBody)||void 0===e?void 0:e.querySelector(".js-sticky-header-breadcrumbs")}get contentElement(){var e;return null===(e=window.newBody)||void 0===e?void 0:e.querySelector(".js-sticky-header-content")}get headerHeight(){const e=window._styles.header;return ur.windowSize.isMobile?e.heightMobile:e.heightSticky}get header(){return document.querySelector(".js-pinned-header")}get marker(){return document.querySelector(".js-sticky-header")}get pinnedSticky(){return document.querySelector(".js-pinned-header-sticky")}get scrollOffsetValue(){const e=this.pinnedSticky,t=null==e?0:e.getBoundingClientRect().height;return this.headerHeight+t}get shouldStick(){const e=this.marker,t=this.pinnedSticky;if(null==e||null==t)return;return e.getBoundingClientRect().top<this.headerHeight+t.getBoundingClientRect().height}constructor(){Object.defineProperty(this,"onScroll",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.pin(),this.stickOrUnstick()}}),Object.defineProperty(this,"stickOrUnstick",{enumerable:!0,configurable:!0,writable:!0,value:()=>{const e=this.shouldStick;null!=e&&this.setVisible(e)}}),st(window).on("scroll",this.onScroll),st(document).on("turbolinks:load",this.onScroll),st(window).on("resize",this.stickOrUnstick)}scrollOffset(e){return Math.max(0,e-this.scrollOffsetValue)}pin(){null!=this.header&&(this.shouldPin()?document.body.classList.add("js-header-is-pinned"):document.body.classList.remove("js-header-is-pinned"))}setVisible(e){(0,le.j6)((0,re.e0)(this.pinnedSticky),e),st(document).trigger("sticky-header:sticking",[e])}shouldPin(e){return(null!=e?e:window.pageYOffset)>30||this.shouldStick}}var it=s(4692);class at{constructor(){Object.defineProperty(this,"observer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"references",{enumerable:!0,configurable:!0,writable:!0,value:document.getElementsByClassName("js-sync-height--reference")}),Object.defineProperty(this,"targets",{enumerable:!0,configurable:!0,writable:!0,value:document.getElementsByClassName("js-sync-height--target")}),Object.defineProperty(this,"onResize",{enumerable:!0,configurable:!0,writable:!0,value:e=>{for(const t of e)if(t.target instanceof HTMLTextAreaElement)return void this.sync()}}),Object.defineProperty(this,"sync",{enumerable:!0,configurable:!0,writable:!0,value:()=>{const e={};for(const t of this.references){if(!(t instanceof HTMLElement))continue;const s=t.dataset.syncHeightTarget;null!=s&&(e[s]=t.offsetHeight)}for(const t of this.targets){if(!(t instanceof HTMLElement))continue;const s=t.dataset.syncHeightId;if(null!=s){const r=e[s];null!=r&&(t.style.minHeight=`${r}px`)}}}}),it(document).on("turbolinks:load",this.sync),it.subscribe("sync-height:force",this.sync),it(window).on("resize",this.sync),this.observer=new MutationObserver(this.onResize),this.observer.observe(document,{attributes:!0,subtree:!0})}}var nt=s(4692);class ot{constructor(){Object.defineProperty(this,"observer",{enumerable:!0,configurable:!0,writable:!0,value:new MutationObserver(ot.handleMutations)}),this.observer.observe(document,{attributeFilter:["datetime"],attributeOldValue:!0,childList:!0,subtree:!0})}static handleMutation(e){switch(e.type){case"childList":nt(e.addedNodes).find(ot.searchQuery).addBack(ot.searchQuery).timeago();break;case"attributes":e.target instanceof HTMLTimeElement&&e.target.dateTime!==e.oldValue&&e.target.classList.contains(ot.className)&&nt(e.target).timeago("updateFromDOM")}}static handleMutations(e){null!=nt.fn.timeago&&e.forEach(ot.handleMutation)}}Object.defineProperty(ot,"className",{enumerable:!0,configurable:!0,writable:!0,value:"js-timeago"}),Object.defineProperty(ot,"searchQuery",{enumerable:!0,configurable:!0,writable:!0,value:`.${ot.className}`});const lt=ot;var ct=s(4692);class ut{constructor(){Object.defineProperty(this,"loaded",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"loading",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"abortLoading",{enumerable:!0,configurable:!0,writable:!0,value:()=>{for(const e of this.loading.values())e.abort()}}),Object.defineProperty(this,"forget",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var t;this.loaded.delete(e),null===(t=this.loading.get(e))||void 0===t||t.abort()}}),ct(document).on("turbolinks:before-cache",this.abortLoading)}load(e){if(this.loaded.has(e)||this.loading.has(e))return this.loading.get(e);const t=ct.ajax(e,{cache:!0,dataType:"script"});return this.loading.set(e,t),t.done((()=>this.loaded.add(e))).always((()=>this.loading.delete(e))),t}loadSync(e){this.loaded.has(e)||(this.loading.has(e)&&this.forget(e),ct.ajax(e,{async:!1,cache:!0,dataType:"script"}),this.loaded.add(e))}}class dt{constructor(e){Object.defineProperty(this,"turbolinksReload",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"playerDivs",{enumerable:!0,configurable:!0,writable:!0,value:document.getElementsByClassName("js-twitch-player")}),Object.defineProperty(this,"startAll",{enumerable:!0,configurable:!0,writable:!0,value:()=>{if(0!==this.playerDivs.length)if(null==window.Twitch)this.initializeEmbed();else for(const e of this.playerDivs)e instanceof HTMLElement&&this.start(e)}}),document.addEventListener("turbolinks:load",this.startAll)}initializeEmbed(){var e;null===(e=this.turbolinksReload.load("https://player.twitch.tv/js/embed/v1.js"))||void 0===e||e.then(this.startAll)}noCookieDiv(e){return document.querySelector(`.js-twitch-player--no-cookie[data-player-id='${e}']`)}openPlayer(e){e.classList.contains("hidden")&&(e.classList.remove("hidden"),(0,le.Xn)(this.noCookieDiv(e.id)))}start(e){if(null==window.Twitch||"true"===e.dataset.twitchPlayerStarted)return;e.dataset.twitchPlayerStarted="true";const t={channel:e.dataset.channel,height:"100%",width:"100%"};new window.Twitch.Player(e.id,t).addEventListener(window.Twitch.Player.PLAY,(()=>this.openPlayer(e)))}}var pt=s(4692),mt=function(e,t,s,r){var i,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(n=(a<3?i(n):a>3?i(t,s,n):i(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n};class ht{constructor(){Object.defineProperty(this,"pins",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),(0,r.Gn)(this)}apiPin(e,t){const s=e.current_user_attributes.pin;if(null==s)throw new Error("can't pin score without current user attributes");return pt.ajax((0,g.w)("score-pins.store"),{data:s,dataType:"json",method:t?"POST":"DELETE"}).done((0,r.XI)((()=>{this.markPinned(e,t),pt.publish("score:pin",[t,e])})))}canBePinned(e){return null!=e.current_user_attributes.pin&&e.passed}isPinned(e){const t=e.current_user_attributes.pin;return null!=t&&(this.pins.has(t.score_id)||(0,r.h5)((()=>{this.pins.set(t.score_id,t.is_pinned)})),this.pins.get(t.score_id))}markPinned(e,t){const s=e.current_user_attributes.pin;null!=s&&this.pins.set(s.score_id,t)}}mt([r.sH],ht.prototype,"pins",void 0),mt([r.XI],ht.prototype,"markPinned",null);var bt=s(4692);class ft{constructor(e){Object.defineProperty(this,"captcha",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"callback",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"show",{enumerable:!0,configurable:!0,writable:!0,value:e=>{this.callback=e,window.setTimeout((()=>{var e;bt(document).trigger("gallery:close"),null===(e=bt(".js-user-login--menu")[0])||void 0===e||e.click()}),0)}}),Object.defineProperty(this,"showIfGuest",{enumerable:!0,configurable:!0,writable:!0,value:e=>null==ur.currentUser&&(this.show(e),!0)}),Object.defineProperty(this,"showOnError",{enumerable:!0,configurable:!0,writable:!0,value:(e,t)=>{var s;return 401===e.status&&"basic"===(null===(s=e.responseJSON)||void 0===s?void 0:s.authentication)&&(null!=ur.currentUser?(0,_.T8)():this.show(t),!0)}}),Object.defineProperty(this,"clearError",{enumerable:!0,configurable:!0,writable:!0,value:()=>{bt(".js-login-form--error").text("")}}),Object.defineProperty(this,"loginError",{enumerable:!0,configurable:!0,writable:!0,value:(e,t)=>{e.preventDefault(),e.stopPropagation(),bt(".js-login-form--error").text((0,$.ER)(t));const s=this.captcha.findContainer(e.currentTarget);null!=s&&window.setTimeout((()=>{const e=t.responseJSON;var r;"object"==typeof(r=e)&&null!=r&&"captcha_triggered"in r&&e.captcha_triggered&&this.captcha.trigger(s),this.captcha.reset(s)}),0)}}),Object.defineProperty(this,"loginSuccess",{enumerable:!0,configurable:!0,writable:!0,value:(e,t,s,r)=>{if("application/javascript"===r.getResponseHeader("content-type"))return;const i=this.callback;null!=i?(this.reset(),this.refreshToken(t.csrf_token),bt.publish("user:update",t.user),window.setTimeout((()=>{var e;null===(e=bt(".js-user-login--menu")[0])||void 0===e||e.click(),bt(".js-user-header").replaceWith(t.header),bt(".js-user-header-popup").html(t.header_popup),i()}),0)):(0,_.T8)()}}),Object.defineProperty(this,"onError",{enumerable:!0,configurable:!0,writable:!0,value:(e,t)=>{this.showOnError(t,(0,re.Qz)(e.target))}}),Object.defineProperty(this,"refreshToken",{enumerable:!0,configurable:!0,writable:!0,value:e=>{bt('[name="_token"]').attr("value",e),bt('[name="csrf-token"]').attr("content",e)}}),Object.defineProperty(this,"reset",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.callback=void 0}}),Object.defineProperty(this,"showOnClick",{enumerable:!0,configurable:!0,writable:!0,value:e=>{e.preventDefault(),this.show()}}),Object.defineProperty(this,"showOnLoad",{enumerable:!0,configurable:!0,writable:!0,value:()=>{window.showLoginModal&&(window.showLoginModal=void 0,this.show())}}),Object.defineProperty(this,"showToContinue",{enumerable:!0,configurable:!0,writable:!0,value:e=>{if(null!=ur.currentUser)return;e.preventDefault();const t=(0,re.Qz)(e.target);window.setTimeout((()=>{this.show(t)}),0)}}),bt(document).on("ajax:success",".js-login-form",this.loginSuccess).on("ajax:error",".js-login-form",this.loginError).on("submit",".js-login-form",this.clearError).on("input",".js-login-form-input",this.clearError).on("click",".js-user-link",this.showOnClick).on("click",".js-login-required--click",this.showToContinue).on("ajax:before",".js-login-required--click",(()=>null!=ur.currentUser)).on("ajax:error",this.onError).on("turbolinks:load",this.showOnLoad),bt.subscribe("nav:popup:hidden",this.reset)}}class vt{}var gt=s(4692);class yt{constructor(){Object.defineProperty(this,"handleUserLogin",{enumerable:!0,configurable:!0,writable:!0,value:()=>{(0,S.JD)(new vt)}}),Object.defineProperty(this,"handleUserLogout",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const t=(0,l.E)(e.currentTarget.dataset.redirectHome);this.logout(t)}}),gt(document).on("ajax:success",".js-logout-link",this.handleUserLogout).on("ajax:success",".js-login-form",this.handleUserLogin)}logout(e=!1){localStorage.clear(),e?location.href=(0,g.w)("home"):location.reload()}}var wt=function(e,t,s,r){var i,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(n=(a<3?i(n):a>3?i(t,s,n):i(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n};class _t{get blocks(){return null==this.core.currentUser?new Set:new Set(this.core.currentUser.blocks.map((e=>e.target_id)))}get followUserMapping(){return null==this.core.currentUser?new Set:new Set(this.core.currentUser.follow_user_mapping)}get friends(){return null==this.core.currentUser?new Map:new Map(this.core.currentUser.friends.map((e=>[e.target_id,e])))}constructor(e){Object.defineProperty(this,"core",{enumerable:!0,configurable:!0,writable:!0,value:e}),(0,r.Gn)(this)}isFriendWith(e){return null!=this.friends.get(e)}updateFollowUserMapping(e,t){const s=this.core.currentUser;null!=s&&(e?s.follow_user_mapping.push(t):(0,o.pull)(s.follow_user_mapping,t))}}wt([r.EW],_t.prototype,"blocks",null),wt([r.EW],_t.prototype,"followUserMapping",null),wt([r.EW],_t.prototype,"friends",null),wt([r.XI],_t.prototype,"updateFollowUserMapping",null);var Et=s(4692),Pt=function(e,t,s,r){var i,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(n=(a<3?i(n):a>3?i(t,s,n):i(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n};const Ot="userPreferences";class jt{constructor(){Object.defineProperty(this,"current",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"updatingOptions",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"updateFromStorage",{enumerable:!0,configurable:!0,writable:!0,value:e=>{null!=e.key&&e.key!==Ot||(this.current=this.fromStorageWithDefaults())}}),this.current=this.fromStorageWithDefaults(),(0,r.Gn)(this),window.addEventListener("storage",this.updateFromStorage)}get(e){return this.current[e]}set(e,t){if(this.current[e]!==t&&(this.current[e]=t,this.updateStorage(),null!=this.user))return this.updatingOptions=!0,Et.ajax((0,g.w)("account.options"),{data:{user_profile_customization:{[e]:t}},dataType:"JSON",method:"PUT"}).done((e=>{Et.publish("user:update",e)})).fail((0,$.dI)()).always((()=>{this.updatingOptions=!1}))}setUser(e){var t;this.user=e,this.updatingOptions||(this.current=null!==(t=null==e?void 0:e.user_preferences)&&void 0!==t?t:{audio_autoplay:!1,audio_muted:!1,audio_volume:.45,beatmapset_card_size:"normal",beatmapset_download:"all",beatmapset_show_nsfw:!1,beatmapset_title_show_original:!1,comments_show_deleted:!1,comments_sort:"new",forum_posts_show_deleted:!0,legacy_score_only:!1,profile_cover_expanded:!0,scoring_mode:"standardised",user_list_filter:"all",user_list_sort:"last_visit",user_list_view:"card"},this.updateStorage())}fromStorage(){try{const e=localStorage.getItem(Ot);if(null!=e){const t=JSON.parse(e);if(null!=t&&"object"==typeof t)return t}}catch(e){}return{}}fromStorageWithDefaults(){return Object.assign({audio_autoplay:!1,audio_muted:!1,audio_volume:.45,beatmapset_card_size:"normal",beatmapset_download:"all",beatmapset_show_nsfw:!1,beatmapset_title_show_original:!1,comments_show_deleted:!1,comments_sort:"new",forum_posts_show_deleted:!0,legacy_score_only:!1,profile_cover_expanded:!0,scoring_mode:"standardised",user_list_filter:"all",user_list_sort:"last_visit",user_list_view:"card"},this.fromStorage())}updateStorage(){localStorage[Ot]=JSON.stringify(this.current)}}Pt([r.sH],jt.prototype,"current",void 0),Pt([r.XI],jt.prototype,"set",null),Pt([r.XI],jt.prototype,"setUser",null),Pt([r.XI],jt.prototype,"updateFromStorage",void 0);var kt=s(4692);function St(e){return 401===e.status&&function(e){return"object"==typeof e&&null!=e&&"authentication"in e&&"verify"===e.authentication&&"box"in e&&"string"==typeof e.box}(e.responseJSON)}class Nt{get inputBox(){return document.querySelector(".js-user-verification--input")}get message(){return document.querySelector(".js-user-verification--message")}get messageSpinner(){return document.querySelector(".js-user-verification--message-spinner")}get messageText(){return document.querySelector(".js-user-verification--message-text")}get reference(){return document.querySelector(".js-user-verification--reference")}constructor(){Object.defineProperty(this,"callback",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"delayShow",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"delayShowCallback",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modal",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"request",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"showOnError",{enumerable:!0,configurable:!0,writable:!0,value:(e,t)=>!!St(e)&&(this.show(e.responseJSON.box,t),!0)}),Object.defineProperty(this,"autoSubmit",{enumerable:!0,configurable:!0,writable:!0,value:()=>{var e;const t=this.inputBox;if(null==t)return;const s=t.value.replace(/\s/g,""),r=t.dataset.lastKey,i=parseInt(null!==(e=t.dataset.verificationKeyLength)&&void 0!==e?e:"",10);0===s.length&&this.setMessage(),i===s.length&&s!==r&&(t.dataset.lastKey=s,this.prepareForRequest("verifying"),this.request=kt.post((0,g.w)("account.verify"),{verification_key:s}).done(this.success).fail(this.error))}}),Object.defineProperty(this,"error",{enumerable:!0,configurable:!0,writable:!0,value:e=>{this.setMessage((0,$.ER)(e))}}),Object.defineProperty(this,"float",{enumerable:!0,configurable:!0,writable:!0,value:(e,t,s)=>{e?(t.classList.add("js-user-verification--center"),t.style.paddingTop=""):(t.classList.remove("js-user-verification--center"),t.style.paddingTop=`${null!=s?s:0}px`)}}),Object.defineProperty(this,"isActive",{enumerable:!0,configurable:!0,writable:!0,value:()=>{var e;return null===(e=this.modal)||void 0===e?void 0:e.classList.contains("js-user-verification--active")}}),Object.defineProperty(this,"onError",{enumerable:!0,configurable:!0,writable:!0,value:(e,t)=>this.showOnError(t,(0,re.Qz)(e.target))}),Object.defineProperty(this,"prepareForRequest",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var t;null===(t=this.request)||void 0===t||t.abort(),this.setMessage((0,y.pw)(`user_verification.box.${e}`),!0)}}),Object.defineProperty(this,"reissue",{enumerable:!0,configurable:!0,writable:!0,value:e=>{e.preventDefault(),this.prepareForRequest("issuing"),this.request=kt.post((0,g.w)("account.reissue-code")).done((e=>{this.setMessage(e.message)})).fail(this.error)}}),Object.defineProperty(this,"reposition",{enumerable:!0,configurable:!0,writable:!0,value:()=>{var e,t;if(this.isActive()&&null!=this.modal)if(ur.windowSize.isMobile)this.float(!0,this.modal);else{const s=null!==(t=null===(e=this.reference)||void 0===e?void 0:e.getBoundingClientRect().bottom)&&void 0!==t?t:0;this.float(s<0,this.modal,s)}}}),Object.defineProperty(this,"setDelayShow",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.delayShow=!0}}),Object.defineProperty(this,"setMessage",{enumerable:!0,configurable:!0,writable:!0,value:(e,t=!1)=>{const s=this.message;if(null==s)return;if(null==e||0===e.length)return void(0,le.Xn)(s);const r=this.messageText,i=this.messageSpinner;null!=r&&null!=i&&(r.textContent=e,(0,le.j6)(i,t),(0,le.qG)(s))}}),Object.defineProperty(this,"setModal",{enumerable:!0,configurable:!0,writable:!0,value:()=>{const e=document.querySelector(".js-user-verification");this.modal=e instanceof HTMLElement?e:void 0}}),Object.defineProperty(this,"show",{enumerable:!0,configurable:!0,writable:!0,value:(e,t)=>{this.delayShow?this.delayShowCallback=()=>this.show(e,t):(this.callback=t,null!=e&&kt(".js-user-verification--box").html(e),this.$modal().modal({backdrop:"static",keyboard:!1,show:!0}).addClass("js-user-verification--active"),this.reposition())}}),Object.defineProperty(this,"showOnLoad",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.delayShow=!1,null!=this.delayShowCallback?(this.delayShowCallback(),this.delayShowCallback=void 0):this.isVerificationPage()&&this.show()}}),Object.defineProperty(this,"success",{enumerable:!0,configurable:!0,writable:!0,value:()=>{if(!this.isActive()||null==this.modal)return;const e=this.inputBox;if(null==e)return;this.$modal().modal("hide"),this.modal.classList.remove("js-user-verification--active");const t=this.callback;if(this.callback=void 0,this.setMessage(),e.value="",e.dataset.lastKey="",this.isVerificationPage())return(0,_.T8)();null==t||t()}}),kt(document).on("ajax:error",this.onError).on("turbolinks:load",this.setModal).on("turbolinks:load",this.showOnLoad).on("turbolinks:visit",this.setDelayShow).on("input",".js-user-verification--input",this.autoSubmit).on("click",".js-user-verification--reissue",this.reissue),kt.subscribe("user-verification:success",this.success),kt(window).on("resize scroll",this.reposition)}$modal(){return kt(".js-user-verification")}isVerificationPage(){return null!=document.querySelector(".js-user-verification--on-load")}}var At=s(4692);class Tt{constructor(){Object.defineProperty(this,"createTooltip",{enumerable:!0,configurable:!0,writable:!0,value:(e,t)=>{At(e).qtip({content:{text:t},hide:{delay:200,effect(){At(this).fadeTo(110,0)},fixed:!0},position:{at:"top center",my:"bottom center",viewport:At(window)},show:{delay:200,effect(){At(this).fadeTo(110,1)},ready:!0},style:{classes:"tooltip-default tooltip-default--interactable"}})}}),Object.defineProperty(this,"showTooltip",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var t,s;if(!(e.currentTarget instanceof HTMLAnchorElement))return;const r=e.currentTarget,i=r.getAttribute("href");if(null==i)return;const a=null===(s=null===(t=document.querySelector(i))||void 0===t?void 0:t.firstElementChild)||void 0===s?void 0:s.cloneNode(!0);if(a instanceof HTMLParagraphElement){a.querySelectorAll("*").forEach((e=>{"doc-backlink"===e.getAttribute("role")?e.remove():e.removeAttribute("class")}));for(let e=a.childNodes.length-1;e>=0;e--){const t=a.childNodes[e];if(" "!==t.textContent)break;t.remove()}this.createTooltip(r,a)}}}),At(document).on("mouseover",".js-reference-link",this.showTooltip)}}var Ct=s(4692),xt=function(e,t,s,r){var i,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(n=(a<3?i(n):a>3?i(t,s,n):i(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n};class It{constructor(){Object.defineProperty(this,"hasFocus",{enumerable:!0,configurable:!0,writable:!0,value:document.hasFocus()}),(0,r.Gn)(this),Ct(window).on("blur focus",(0,r.XI)((()=>this.hasFocus=document.hasFocus())))}}xt([r.sH],It.prototype,"hasFocus",void 0);var Rt=s(4692),Mt=function(e,t,s,r){var i,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(n=(a<3?i(n):a>3?i(t,s,n):i(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n};class Dt{get isDesktop(){return this.privateIsDesktop}get isMobile(){return!this.privateIsDesktop}constructor(){Object.defineProperty(this,"privateIsDesktop",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"handleResize",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.privateIsDesktop=window.matchMedia("(min-width: 900px)").matches;const e=.01*window.innerHeight;document.documentElement.style.setProperty("--vh",`${e}px`)}}),this.handleResize(),(0,r.Gn)(this),Rt(window).on("resize",this.handleResize)}}Mt([r.sH],Dt.prototype,"privateIsDesktop",void 0),Mt([r.XI],Dt.prototype,"handleResize",void 0);class Ht{constructor(e=7500,t=18e5){Object.defineProperty(this,"initialDelay",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"maxDelay",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"current",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.current=Math.max(e,1)}get(){const e=this.current+(0,o.random)(5e3,2e4);return this.current=Math.min(2*this.current,this.maxDelay),e}reset(){this.current=this.initialDelay}}var $t=s(8307),Lt=s(4692),Ut=function(e,t,s,r){var i,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(n=(a<3?i(n):a>3?i(t,s,n):i(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n};let Bt=class{get hasData(){return null!=this.firstLoadedAt}constructor(e){Object.defineProperty(this,"socketWorker",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"waitingVerification",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"firstLoadedAt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"retryDelay",{enumerable:!0,configurable:!0,writable:!0,value:new Ht}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"xhr",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"loadMore",{enumerable:!0,configurable:!0,writable:!0,value:()=>{null==this.xhr&&(window.clearTimeout(this.timeout),this.xhr=Lt.ajax({dataType:"json",url:(0,g.w)("notifications.index",{unread:1})}),this.xhr.always((()=>{this.xhr=null})).done((e=>(0,r.h5)((()=>{this.waitingVerification=!1,this.loadBundle(e),this.retryDelay.reset()})))).fail((e=>(0,r.h5)((()=>{St(e)?this.waitingVerification=!0:401!==e.status&&this.delayedRetryInitialLoadMore()})))))}}),(0,r.lB)(this.socketWorker,"connectionStatus",(e=>{"connected"===e.newValue&&this.loadMore()}),!0),Lt.subscribe("user-verification:success.notifications-worker",(()=>{this.loadMore()})),(0,r.Gn)(this)}handleDispatchAction(e){if(!(e instanceof T))return;const t=e.message;if("delete"===t.event){const e=new Date(t.data.timestamp);null!=this.firstLoadedAt&&e>this.firstLoadedAt&&(0,S.JD)($t.zv.fromJson(t))}else if((e=>"new"===e.event)(t))(0,S.JD)(new $t.kx(t.data));else if((e=>"read"===e.event)(t)){const e=new Date(t.data.timestamp);null!=this.firstLoadedAt&&e>this.firstLoadedAt&&(0,S.JD)($t.an.fromJson(t))}}delayedRetryInitialLoadMore(){this.timeout=window.setTimeout(this.loadMore,this.retryDelay.get())}loadBundle(e){(0,S.JD)(new $t.yz(e,{isWidget:!0})),null==this.firstLoadedAt&&(this.firstLoadedAt=new Date(e.timestamp))}};Ut([r.sH],Bt.prototype,"waitingVerification",void 0),Ut([r.sH],Bt.prototype,"firstLoadedAt",void 0),Ut([r.EW],Bt.prototype,"hasData",null),Ut([r.XI],Bt.prototype,"loadBundle",null),Bt=Ut([S.D6],Bt);const Ft=Bt;class Gt{constructor(e){Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:e})}}class Xt{constructor(e){Object.defineProperty(this,"connected",{enumerable:!0,configurable:!0,writable:!0,value:e})}}var Wt=s(4692),Vt=function(e,t,s,r){var i,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(n=(a<3?i(n):a>3?i(t,s,n):i(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n};let qt=class{get isConnected(){return"connected"===this.connectionStatus}constructor(){Object.defineProperty(this,"connectionStatus",{enumerable:!0,configurable:!0,writable:!0,value:"disconnected"}),Object.defineProperty(this,"hasConnectedOnce",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"userId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"active",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"endpoint",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"retryDelay",{enumerable:!0,configurable:!0,writable:!0,value:new Ht}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"ws",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"xhr",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"handleNewEvent",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const t=this.parseMessageEvent(e);null!=t&&("logout"===t.event?(this.destroy(),ur.userLoginObserver.logout()):(e=>"verified"===e.event)(t)?Wt.publish("user-verification:success"):(0,S.JD)(new T(t)))}}),Object.defineProperty(this,"reconnectWebSocket",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.connectionStatus="disconnected",this.active&&(this.timeout.connectWebSocket=window.setTimeout((0,r.XI)((()=>{this.ws=null,this.connectWebSocket()})),this.retryDelay.get()))}}),Object.defineProperty(this,"startWebSocket",{enumerable:!0,configurable:!0,writable:!0,value:()=>{if(null!=this.endpoint)return this.connectWebSocket();null==this.xhr&&(window.clearTimeout(this.timeout.startWebSocket),this.xhr=Wt.get((0,g.w)("notifications.endpoint")),this.xhr.always((()=>{this.xhr=null})).done((e=>{this.retryDelay.reset(),this.endpoint=e.url,this.connectWebSocket()})).fail((e=>{401!==e.status?this.timeout.startWebSocket=window.setTimeout(this.startWebSocket,this.retryDelay.get()):this.destroy()})))}}),(0,r.Gn)(this),(0,r.mJ)((()=>this.isConnected),(e=>(0,S.JD)(new Xt(e))),{fireImmediately:!0})}boot(){this.active=null!=this.userId,this.active&&this.startWebSocket()}handleDispatchAction(e){var t,s;(null===(t=this.ws)||void 0===t?void 0:t.readyState)===WebSocket.OPEN&&e instanceof Gt&&(null===(s=this.ws)||void 0===s||s.send(JSON.stringify(e.message)))}setUserId(e){e!==this.userId&&(this.active&&this.destroy(),this.userId=e,this.boot())}connectWebSocket(){if(!this.active||null==this.endpoint||null!=this.ws)return;this.connectionStatus="connecting",window.clearTimeout(this.timeout.connectWebSocket);const e=document.querySelector("meta[name=csrf-token]");if(null==e)return;const t=e.getAttribute("content");this.ws=new WebSocket(`${this.endpoint}?csrf=${t}`),this.ws.addEventListener("open",(0,r.XI)((()=>{this.retryDelay.reset(),this.connectionStatus="connected",this.hasConnectedOnce=!0}))),this.ws.addEventListener("close",this.reconnectWebSocket),this.ws.addEventListener("message",this.handleNewEvent)}destroy(){var e;this.connectionStatus="disconnecting",this.userId=null,this.active=!1,null===(e=this.xhr)||void 0===e||e.abort(),(0,o.forEach)(this.timeout,(e=>window.clearTimeout(e))),null!=this.ws&&(this.ws.close(),this.ws=null),this.connectionStatus="disconnected"}parseMessageEvent(e){try{const s=JSON.parse(e.data);if("object"==typeof(t=s)&&null!=t&&"event"in t)return s;console.error("message missing event type.")}catch(s){console.error("Failed parsing data:",e.data)}var t}};Vt([r.sH],qt.prototype,"connectionStatus",void 0),Vt([r.sH],qt.prototype,"hasConnectedOnce",void 0),Vt([r.sH],qt.prototype,"active",void 0),Vt([r.EW],qt.prototype,"isConnected",null),Vt([r.XI],qt.prototype,"connectWebSocket",null),Vt([r.XI],qt.prototype,"destroy",null),Vt([r.XI],qt.prototype,"reconnectWebSocket",void 0),qt=Vt([S.D6],qt);const zt=qt;var Zt=s(4692),Kt=function(e,t,s,r){var i,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(n=(a<3?i(n):a>3?i(t,s,n):i(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n};let Jt=class{constructor(e){Object.defineProperty(this,"beatmapsetStore",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"recommendedDifficulties",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"resultSets",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"xhr",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),(0,r.Gn)(this)}cancel(){this.xhr&&this.xhr.abort()}get(e,t=0){if(t<0)throw Error("from must be > 0");const s=e.toKeyString(),i=this.getOrCreate(s);return t>0&&t<i.beatmapsetIds.size||0===t&&!i.isExpired?Promise.resolve(i):this.fetch(e,t).then((s=>(null!=s&&(0,r.h5)((()=>{0===t&&i.reset(),this.updateBeatmapsetStore(s),i.append(s),this.recommendedDifficulties.set(e.mode,s.recommended_difficulty)})),i)))}getResultSet(e){const t=e.toKeyString();return this.getOrCreate(t)}handleDispatchAction(e){e instanceof vt&&this.clear()}initialize(e,t){this.updateBeatmapsetStore(t);const s=e.toKeyString(),r=this.getOrCreate(s);null==r.fetchedAt&&(r.append(t),this.recommendedDifficulties.set(e.mode,t.recommended_difficulty))}clear(){this.resultSets.clear(),this.recommendedDifficulties.clear()}fetch(e,t){this.cancel();const s=e.queryParams,r=e.toKeyString(),i=this.getOrCreate(r).cursorString;if(t>0)if(null!=i)s.cursor_string=i;else if(null===i)return Promise.resolve(null);const a=(0,g.w)("beatmapsets.search");return this.xhr=Zt.ajax(a,{data:s,dataType:"json",method:"get"}),this.xhr}getOrCreate(e){let t=this.resultSets.get(e);return null==t&&(t=new n,this.resultSets.set(e,t)),t}updateBeatmapsetStore(e){for(const t of e.beatmapsets)this.beatmapsetStore.update(t)}};Kt([r.sH],Jt.prototype,"recommendedDifficulties",void 0),Kt([r.sH],Jt.prototype,"resultSets",void 0),Kt([r.XI],Jt.prototype,"get",null),Kt([r.XI],Jt.prototype,"initialize",null),Kt([r.XI],Jt.prototype,"clear",null),Jt=Kt([S.D6],Jt);class Yt{constructor(e){Object.defineProperty(this,"channelId",{enumerable:!0,configurable:!0,writable:!0,value:e})}}var Qt=s(2097),es=s(6595),ts=s(3437),ss=s(6588),rs=s(903);class is{constructor(e){Object.defineProperty(this,"json",{enumerable:!0,configurable:!0,writable:!0,value:e})}}class as{constructor(e){Object.defineProperty(this,"channelStore",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"lastHistoryId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"retryDelay",{enumerable:!0,configurable:!0,writable:!0,value:new Ht(0,45e3)}),Object.defineProperty(this,"timerId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"xhr",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ping",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.xhr=(0,rs.I_)(this.channelStore.lastReceivedMessageId,this.lastHistoryId).done((e=>{var t;const s=null===(t=(0,o.maxBy)(e.silences,"id"))||void 0===t?void 0:t.id;null!=s&&(this.lastHistoryId=s),(0,S.JD)(new is(e.silences)),this.retryDelay.reset(),this.scheduleNextPing()})).fail((e=>{401!==e.status&&this.scheduleNextPing()}))}})}start(){null==this.timerId&&this.scheduleNextPing()}stop(){var e;null===(e=this.xhr)||void 0===e||e.abort(),this.retryDelay.reset(),null!=this.timerId&&(window.clearTimeout(this.timerId),this.timerId=void 0)}scheduleNextPing(){this.timerId=window.setTimeout(this.ping,this.retryDelay.get())}}var ns=function(e,t,s,r){var i,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(n=(a<3?i(n):a>3?i(t,s,n):i(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n};class os{constructor(){Object.defineProperty(this,"channels",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"error",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"xhr",{enumerable:!0,configurable:!0,writable:!0,value:null}),(0,r.Gn)(this)}load(){null==this.xhr&&(this.xhr=(0,rs.Wr)().done((e=>(0,r.h5)((()=>{this.channels=e})))).fail((0,r.XI)((()=>{this.error=!0}))).always((0,r.XI)((()=>{this.xhr=null}))))}}ns([r.sH],os.prototype,"channels",void 0),ns([r.sH],os.prototype,"error",void 0),ns([r.sH],os.prototype,"xhr",void 0),ns([r.XI],os.prototype,"load",null);var ls=s(6224),cs=function(e,t,s,r){var i,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(n=(a<3?i(n):a>3?i(t,s,n):i(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n},us=function(e,t,s,r){return new(s||(s=Promise))((function(i,a){function n(e){try{l(r.next(e))}catch(t){a(t)}}function o(e){try{l(r.throw(e))}catch(t){a(t)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(n,o)}l((r=r.apply(e,t||[])).next())}))};let ds=class{get isChatMounted(){return this.viewsMounted.size>0}get isAddingChannel(){return null!=this.waitAddChannelId}get joiningChannelId(){return"number"==typeof this.waitAddChannelId?this.waitAddChannelId:null}get joinedPublicChannelIds(){return new Set(this.channelStore.groupedChannels.PUBLIC.map((e=>e.channelId)))}get selectedChannel(){return"number"==typeof this.selected?this.channelStore.get(this.selected):null}get selectedChannelOrType(){return"number"==typeof this.selected?this.channelStore.get(this.selected):this.selected}get channelList(){return es.XB.flatMap((e=>this.channelStore.groupedChannels[e]))}constructor(e){Object.defineProperty(this,"channelStore",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"canChatAnnounce",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"createAnnouncement",{enumerable:!0,configurable:!0,writable:!0,value:new ts.Ay}),Object.defineProperty(this,"isReady",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"publicChannels",{enumerable:!0,configurable:!0,writable:!0,value:new os}),Object.defineProperty(this,"skipRefresh",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"viewsMounted",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"isConnected",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lastHistoryId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"pingService",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"refocusToIndex",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"selected",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"waitAddChannelId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"handleBeforeCache",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.waitAddChannelId=null}}),this.pingService=new as(e),(0,r.Gn)(this),document.addEventListener("turbolinks:before-cache",this.handleBeforeCache),(0,r.lB)(e.channels,(e=>{"delete"===e.type&&this.refocusSelectedChannel()})),(0,r.fm)((()=>{this.isReady&&this.isChatMounted?(this.pingService.start(),(0,S.JD)(new Gt({event:"chat.start"}))):(this.pingService.stop(),(0,S.JD)(new Gt({event:"chat.end"})))})),(0,r.fm)((()=>us(this,void 0,void 0,(function*(){this.isConnected&&this.isChatMounted&&(this.skipRefresh?this.skipRefresh=!1:yield this.updateChannelList(),(0,r.h5)((()=>{var e;null===(e=this.selectedChannel)||void 0===e||e.load(),this.isReady=!0})))})))),(0,r.fm)((()=>{"join"!==this.selected||null!=this.publicChannels.channels||this.publicChannels.error||this.publicChannels.load()}))}addChannel(e){return us(this,void 0,void 0,(function*(){if(!this.isAddingChannel)try{if(null!=e){if(this.channelStore.channels.has(e))return void this.selectChannel(e);this.waitAddChannelId=e,yield(0,rs.Cg)(e,ur.currentUserOrFail.id)}else{if(!this.createAnnouncement.isValid)return;const e=this.createAnnouncement.toJson();this.waitAddChannelId=e.uuid,yield(0,rs.EC)(e)}}catch(t){if((0,r.h5)((()=>{this.waitAddChannelId=null})),!(0,$.OL)(t))throw t;(0,$.S5)(t)}}))}handleDispatchAction(e){e instanceof C?this.handleChatChannelJoinEvent(e):e instanceof x?this.handleChatChannelPartEvent(e):e instanceof Yt?this.handleChatNewConversationAdded(e):e instanceof Qt.A?this.handleFriendUpdated(e):e instanceof Xt&&this.handleSocketStateChanged(e)}selectChannel(e,t="advanceHistory"){var s;if(this.waitAddChannelId=null,null===(s=this.selectedChannel)||void 0===s||s.throttledSendMarkAsRead(),this.selected=e,"string"==typeof e)return void this.updateUrl(e,t);if(null==e)return;const r=this.channelStore.get(e);null!=r&&(this.refocusToIndex=this.channelList.indexOf(r),r.load(),this.updateUrl(r,t))}selectFirst(){0!==this.channelList.length&&(this.selectChannel(this.channelList[0].channelId,null),ls.controller.replaceHistory((0,c.Ze)(null,{channel_id:null,sendto:null})))}focusChannelAtIndex(e){if(0===this.channelList.length)return;const t=(0,o.clamp)(e,0,this.channelList.length-1),s=this.channelList[t];this.selectChannel(s.channelId)}handleChatChannelJoinEvent(e){const t=e.json;this.channelStore.update(t),("string"==typeof this.waitAddChannelId&&this.waitAddChannelId===t.uuid||"number"==typeof this.waitAddChannelId&&this.waitAddChannelId===t.channel_id)&&((0,ss.vV)(),this.selectChannel(t.channel_id),this.waitAddChannelId=null,"ANNOUNCE"===t.type&&this.createAnnouncement.clear())}handleChatChannelPartEvent(e){this.channelStore.partChannel(e.channelId,!1)}handleChatNewConversationAdded(e){this.selectChannel(e.channelId)}handleFriendUpdated(e){if(!this.isChatMounted)return;const t=this.channelStore.groupedChannels.PM.find((t=>t.pmTarget===e.userId));null==t||t.loadMetadata()}handleSocketStateChanged(e){this.isConnected=e.connected,e.connected||(this.channelStore.channels.forEach((e=>e.needsRefresh=!0)),this.isReady=!1)}refocusSelectedChannel(){"string"!=typeof this.selectedChannelOrType&&(null!=this.selectedChannelOrType?this.selectChannel(this.selectedChannelOrType.channelId):this.focusChannelAtIndex(this.refocusToIndex))}updateChannelList(){return us(this,void 0,void 0,(function*(){const e=yield(0,rs.t3)(this.channelStore.lastReceivedMessageId,this.lastHistoryId);(0,r.h5)((()=>{var t;const s=null===(t=(0,o.maxBy)(e.silences,"id"))||void 0===t?void 0:t.id;null!=s&&(this.lastHistoryId=s),this.channelStore.updateWithChatUpdates(e)}))}))}updateUrl(e,t){var s;if(null==t)return;let r="";const i={channel_id:null,sendto:null};"string"==typeof e?r=e:e.newPmChannel?i.sendto=null===(s=e.pmTarget)||void 0===s?void 0:s.toString():i.channel_id=e.channelId.toString(),ls.controller[t]((0,c.Ze)(null,i,r))}};cs([r.sH],ds.prototype,"canChatAnnounce",void 0),cs([r.sH],ds.prototype,"createAnnouncement",void 0),cs([r.sH],ds.prototype,"isReady",void 0),cs([r.sH],ds.prototype,"viewsMounted",void 0),cs([r.sH],ds.prototype,"isConnected",void 0),cs([r.sH],ds.prototype,"selected",void 0),cs([r.sH],ds.prototype,"waitAddChannelId",void 0),cs([r.EW],ds.prototype,"joinedPublicChannelIds",null),cs([r.EW],ds.prototype,"channelList",null),cs([r.XI],ds.prototype,"addChannel",null),cs([r.XI],ds.prototype,"selectChannel",null),cs([r.XI],ds.prototype,"selectFirst",null),cs([r.XI],ds.prototype,"focusChannelAtIndex",null),cs([r.XI],ds.prototype,"handleBeforeCache",void 0),cs([r.XI],ds.prototype,"handleChatChannelJoinEvent",null),cs([r.XI],ds.prototype,"handleChatChannelPartEvent",null),cs([r.XI],ds.prototype,"handleChatNewConversationAdded",null),cs([r.XI],ds.prototype,"handleFriendUpdated",null),cs([r.XI],ds.prototype,"handleSocketStateChanged",null),cs([r.XI],ds.prototype,"refocusSelectedChannel",null),cs([r.XI],ds.prototype,"updateChannelList",null),ds=cs([S.D6],ds);const ps=ds;var ms=function(e,t,s,r){var i,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(n=(a<3?i(n):a>3?i(t,s,n):i(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n};class hs{constructor(){Object.defineProperty(this,"beatmapsets",{enumerable:!0,configurable:!0,writable:!0,value:r.sH.map()}),(0,r.Gn)(this)}get(e){return this.beatmapsets.get(e)}handleDispatchAction(e){e instanceof vt&&this.flushStore()}update(e){this.beatmapsets.set(e.id,e)}flushStore(){this.beatmapsets.clear()}}ms([r.sH],hs.prototype,"beatmapsets",void 0),ms([r.XI],hs.prototype,"update",null),ms([r.XI],hs.prototype,"flushStore",null);var bs=s(9833),fs=s(7542),vs=s(1250),gs=function(e,t,s,r){var i,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(n=(a<3?i(n):a>3?i(t,s,n):i(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n},ys=function(e,t,s,r){return new(s||(s=Promise))((function(i,a){function n(e){try{l(r.next(e))}catch(t){a(t)}}function o(e){try{l(r.throw(e))}catch(t){a(t)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(n,o)}l((r=r.apply(e,t||[])).next())}))};function ws(e,t){return e.name.localeCompare(t.name)}const _s={ANNOUNCE:ws,GROUP:ws,PM:(e,t)=>e.newPmChannel?-1:t.newPmChannel?1:e.lastMessageId===t.lastMessageId?0:e.lastMessageId>t.lastMessageId?-1:1,PUBLIC:ws};let Es=class{get groupedChannels(){const e=function(){const e={};for(const t of es.XB)e[t]=[];return e}();for(const t of this.channels.values())null!=t.supportedType&&e[t.supportedType].push(t);for(const t of es.XB)e[t]=e[t].sort(_s[t]);return e}constructor(){Object.defineProperty(this,"channels",{enumerable:!0,configurable:!0,writable:!0,value:r.sH.map()}),Object.defineProperty(this,"lastReceivedMessageId",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"ignoredChannels",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),(0,r.Gn)(this)}addNewConversation(e,t){const s=this.update(e);return s.addMessages([vs.A.fromJson(t)]),s}findPM(e){var t;if(e===(null===(t=ur.currentUser)||void 0===t?void 0:t.id))return null;for(const[,s]of this.channels)if("PM"===s.type&&s.userIds.includes(e))return s;return null}flushStore(){this.channels.clear()}get(e){return this.channels.get(e)}handleDispatchAction(e){e instanceof I?this.handleChatMessageNewEvent(e):e instanceof bs.u?this.handleChatMessageSendAction(e):e instanceof is&&this.handleChatUpdateSilences(e)}loadChannelEarlierMessages(e){var t;null===(t=this.get(e))||void 0===t||t.loadEarlierMessages()}partChannel(e,t=!0){const s=this.get(e);null!=s&&(e>0&&t&&(s.isHideable||this.ignoredChannels.add(e),(0,rs.R$)(e,ur.currentUserOrFail.id).always((()=>this.ignoredChannels.delete(e)))),this.channels.delete(e))}update(e){const t=e.channel_id;let s=this.channels.get(t);return s||(s=new fs.A(t),this.channels.set(t,s)),s.updateWithJson(e),this.ignoredChannels.delete(t),s}updateMany(e){this.ignoredChannels.clear(),(0,es.$6)(e).forEach((e=>{this.update(e)})),this.channels.forEach((t=>{t.newPmChannel||e.find((e=>e.channel_id===t.channelId))||this.channels.delete(t.channelId)}))}updateWithChatUpdates(e){var t;if(null!=e.presence&&this.updateMany(e.presence),null!=e.messages){this.updateLastReceivedMessageId(e.messages);const s=(0,o.groupBy)(e.messages,"channel_id");for(const e of Object.keys(s)){const r=parseInt(e,10),i=s[r].map(vs.A.fromJson);null===(t=this.channels.get(r))||void 0===t||t.addMessages(i)}}null!=e.silences&&(0,S.JD)(new is(e.silences))}handleChatMessageNewEvent(e){return ys(this,void 0,void 0,(function*(){for(const s of e.json.messages){const e=this.channels.get(s.channel_id);if(null!=e)e.addMessage(s);else if(!this.ignoredChannels.has(s.channel_id))try{const e=yield(0,rs.c)(s.channel_id);this.update(e)}catch(t){if(!(0,$.OL)(t))throw t;404!==t.status&&(0,$.S5)(t)}}this.updateLastReceivedMessageId(e.json.messages)}))}handleChatMessageSendAction(e){return ys(this,void 0,void 0,(function*(){const t=e.message,s=this.get(t.channelId);if(null!=s){s.addSendingMessage(t);try{if(s.newPmChannel){const e=s.pmTarget;if(null==e)return void console.error("sendMessage:: userId not found?? this shouldn't happen");const i=yield(0,rs.Cd)(e,t);(0,r.h5)((()=>{this.channels.delete(t.channelId);const e=this.addNewConversation(i.channel,i.message);(0,S.JD)(new Yt(e.channelId))}))}else{const e=yield(0,rs._z)(t);s.afterSendMesssage(t,e)}}catch(i){if(s.afterSendMesssage(t,null),!(0,$.OL)(i))throw i;(0,$.S5)(i)}}else console.error("channel missing")}))}handleChatUpdateSilences(e){const t=new Set(e.json.map((e=>e.user_id)));this.removePublicMessagesFromUserIds(t)}removePublicMessagesFromUserIds(e){this.groupedChannels.PUBLIC.forEach((t=>{t.removeMessagesFromUserIds(e)}))}updateLastReceivedMessageId(e){var t,s;null!=e&&(this.lastReceivedMessageId=null!==(s=null===(t=(0,o.maxBy)(e,"message_id"))||void 0===t?void 0:t.message_id)&&void 0!==s?s:this.lastReceivedMessageId)}};gs([r.sH],Es.prototype,"channels",void 0),gs([r.EW],Es.prototype,"groupedChannels",null),gs([r.XI],Es.prototype,"addNewConversation",null),gs([r.XI],Es.prototype,"flushStore",null),gs([r.XI],Es.prototype,"loadChannelEarlierMessages",null),gs([r.XI],Es.prototype,"partChannel",null),gs([r.XI],Es.prototype,"update",null),gs([r.XI],Es.prototype,"updateMany",null),gs([r.XI],Es.prototype,"updateWithChatUpdates",null),gs([r.XI],Es.prototype,"handleChatMessageNewEvent",null),gs([r.XI],Es.prototype,"handleChatMessageSendAction",null),gs([r.XI],Es.prototype,"handleChatUpdateSilences",null),gs([r.XI],Es.prototype,"removePublicMessagesFromUserIds",null),gs([r.XI],Es.prototype,"updateLastReceivedMessageId",null),Es=gs([S.D6],Es);const Ps=Es;var Os=s(4692),js=function(e,t,s,r){var i,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(n=(a<3?i(n):a>3?i(t,s,n):i(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n};class ks{constructor(e){Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"isRevoking",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"revoked",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"scopes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"userId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.id=e.id,this.name=e.name,this.scopes=new Set(e.scopes),this.userId=e.user_id,this.user=e.user,(0,r.Gn)(this)}revoke(){this.isRevoking=!0;const e=Os.ajax({method:"DELETE",url:(0,g.w)("oauth.authorized-clients.destroy",{authorized_client:this.id})});return e.done((0,r.XI)((()=>{this.revoked=!0}))).always((0,r.XI)((()=>{this.isRevoking=!1}))),e}}js([r.sH],ks.prototype,"isRevoking",void 0),js([r.sH],ks.prototype,"revoked",void 0),js([r.sH],ks.prototype,"scopes",void 0),js([r.XI],ks.prototype,"revoke",null);var Ss=function(e,t,s,r){var i,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(n=(a<3?i(n):a>3?i(t,s,n):i(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n};class Ns{constructor(){Object.defineProperty(this,"clients",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),(0,r.Gn)(this)}handleDispatchAction(e){e instanceof vt&&this.flushStore()}initialize(e){for(const t of e){const e=new ks(t);this.clients.set(e.id,e)}}flushStore(){this.clients.clear()}}Ss([r.sH],Ns.prototype,"clients",void 0),Ss([r.XI],Ns.prototype,"flushStore",null);var As=s(7448),Ts=s(8408),Cs=function(e,t,s,r){var i,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(n=(a<3?i(n):a>3?i(t,s,n):i(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n};class xs{get canMarkAsRead(){for(const[,e]of this.notifications)if(e.canMarkRead)return!0;return!1}get first(){var e;return null!==(e=this.orderedNotifications[0])&&void 0!==e?e:this.lastNotification}get hasMore(){return!(this.notifications.size>=this.total||null==this.cursor)}get hasVisibleNotifications(){return this.notifications.size>0}get id(){return`${this.objectType}-${this.objectId}-${this.category}`}get identity(){return{category:this.category,objectId:this.objectId,objectType:this.objectType}}get isSingle(){return 1===this.total}get orderedNotifications(){return[...this.notifications.values()].sort(((e,t)=>t.id-e.id))}get type(){return this.objectType}constructor(e,t,s,i){Object.defineProperty(this,"objectId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"objectType",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"category",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"resolver",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"cursor",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"displayOrder",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"isDeleting",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"isLoading",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"isMarkingAsRead",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"notifications",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"total",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"lastNotification",{enumerable:!0,configurable:!0,writable:!0,value:null}),(0,r.Gn)(this)}static fromJson(e,t){const s=new xs(e.object_id,e.object_type,e.category,t);return s.updateWithJson(e),s}add(e){this.notifications.set(e.id,e),this.displayOrder=Math.max(e.id,this.displayOrder)}delete(){this.resolver.delete(this)}deleteItem(e){null!=e&&this.notifications.has(e.id)&&this.resolver.delete(e)}loadMore(e){null!=this.cursor&&(this.isLoading=!0,this.resolver.loadMore(this.identity,e,this.cursor).always((0,r.XI)((()=>{this.isLoading=!1}))))}markAsRead(e){null!=e&&this.notifications.has(e.id)&&this.resolver.queueMarkAsRead(e)}markStackAsRead(){this.resolver.queueMarkAsRead(this)}remove(e){1===this.notifications.size&&(this.lastNotification=this.notifications.values().next().value);const t=this.notifications.delete(e.id);return t&&this.total--,t}updateWithJson(e){this.cursor=e.cursor,this.total=e.total}}Cs([r.sH],xs.prototype,"cursor",void 0),Cs([r.sH],xs.prototype,"displayOrder",void 0),Cs([r.sH],xs.prototype,"isDeleting",void 0),Cs([r.sH],xs.prototype,"isLoading",void 0),Cs([r.sH],xs.prototype,"isMarkingAsRead",void 0),Cs([r.sH],xs.prototype,"notifications",void 0),Cs([r.sH],xs.prototype,"total",void 0),Cs([r.sH],xs.prototype,"lastNotification",void 0),Cs([r.EW],xs.prototype,"canMarkAsRead",null),Cs([r.EW],xs.prototype,"first",null),Cs([r.EW],xs.prototype,"hasMore",null),Cs([r.EW],xs.prototype,"hasVisibleNotifications",null),Cs([r.EW],xs.prototype,"id",null),Cs([r.EW],xs.prototype,"isSingle",null),Cs([r.EW],xs.prototype,"orderedNotifications",null),Cs([r.XI],xs.prototype,"add",null),Cs([r.XI],xs.prototype,"delete",null),Cs([r.XI],xs.prototype,"deleteItem",null),Cs([r.XI],xs.prototype,"loadMore",null),Cs([r.XI],xs.prototype,"markAsRead",null),Cs([r.XI],xs.prototype,"markStackAsRead",null),Cs([r.XI],xs.prototype,"remove",null),Cs([r.XI],xs.prototype,"updateWithJson",null);var Is=s(9328),Rs=s(6913),Ms=s(4692),Ds=function(e,t,s,r){var i,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(n=(a<3?i(n):a>3?i(t,s,n):i(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n};class Hs{constructor(){Object.defineProperty(this,"debouncedDeleteByIds",{enumerable:!0,configurable:!0,writable:!0,value:(0,o.debounce)((()=>this.deleteByIds()),500)}),Object.defineProperty(this,"debouncedSendQueuedMarkedAsRead",{enumerable:!0,configurable:!0,writable:!0,value:(0,o.debounce)((()=>this.sendQueuedMarkedAsRead()),500)}),Object.defineProperty(this,"deleteByIdsQueue",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"queuedMarkedAsRead",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"queuedMarkedAsReadIdentities",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),(0,r.Gn)(this)}delete(e){if(e.isDeleting=!0,e instanceof Ts.A)return this.deleteByIdsQueue.set(e.id,e),void this.debouncedDeleteByIds();Ms.ajax({data:{identities:[(0,As.aB)(e.identity)]},dataType:"json",method:"DELETE",url:(0,g.w)("notifications.index")}).done((0,r.XI)((()=>{(0,S.JD)(new $t.zv([e.identity],0))}))).fail($.S5).always((0,r.XI)((()=>e.isDeleting=!1)))}loadMore(e,t,s){const r=(0,As.aB)(e);delete r.id;const i=(0,g.w)("notifications.index",r),a={data:{cursor:s,unread:t.isWidget},dataType:"json",url:i};return Ms.ajax(a).then((e=>{(0,S.JD)(new $t.yz(e,t))}))}queueMarkAsRead(e){e.isMarkingAsRead=!0;const t=e.identity;"stack"!==(0,As.bv)(t)?(e instanceof Ts.A&&e.canMarkRead?this.queuedMarkedAsRead.set(e.id,e):this.queuedMarkedAsReadIdentities.set((0,As.dI)(t),e),this.debouncedSendQueuedMarkedAsRead()):this.sendMarkAsReadRequest({identities:[(0,As.aB)(e.identity)]}).then((0,r.XI)((()=>{(0,S.JD)(new $t.an([t],0))}))).always((0,r.XI)((()=>e.isMarkingAsRead=!1)))}deleteByIds(){if(0===this.deleteByIdsQueue.size)return;const e=[...this.deleteByIdsQueue.values()],t=e.map((e=>e.identity));this.deleteByIdsQueue.clear(),Ms.ajax({data:{notifications:t.map(As.aB)},dataType:"json",method:"DELETE",url:(0,g.w)("notifications.index")}).then((0,r.XI)((()=>{(0,S.JD)(new $t.zv(t,0))}))).always((0,r.XI)((()=>e.forEach((e=>e.isDeleting=!1)))))}sendMarkAsReadRequest(e){const t=Ms.ajax({data:e,dataType:"json",method:"POST",url:(0,g.w)("notifications.mark-read")});return t.fail($.S5),t}sendQueuedMarkedAsRead(){if(this.queuedMarkedAsRead.size>0){const e=[...this.queuedMarkedAsRead.values()],t=e.map((e=>e.identity));this.queuedMarkedAsRead.clear(),this.sendMarkAsReadRequest({notifications:t.map(As.aB)}).then((0,r.XI)((()=>{(0,S.JD)(new $t.an(t,0))}))).always((0,r.XI)((()=>e.forEach((e=>e.isMarkingAsRead=!1)))))}if(this.queuedMarkedAsReadIdentities.size>0){const e=[...this.queuedMarkedAsReadIdentities.values()],t=e.map((e=>e.identity));this.queuedMarkedAsReadIdentities.clear(),this.sendMarkAsReadRequest({identities:t.map(As.aB)}).then((0,r.XI)((()=>{(0,S.JD)(new $t.an(t,0))}))).always((0,r.XI)((()=>e.forEach((e=>e.isMarkingAsRead=!1)))))}}}Ds([r.XI],Hs.prototype,"delete",null),Ds([r.XI],Hs.prototype,"loadMore",null),Ds([r.XI],Hs.prototype,"queueMarkAsRead",null);var $s=function(e,t,s,r){var i,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(n=(a<3?i(n):a>3?i(t,s,n):i(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n};let Ls=class{get allStacks(){return this.allType.stacks}get allType(){return this.getOrCreateType({objectType:null})}get isEmpty(){return 1===this.types.size&&0===this.allStacks.size}get total(){return this.allType.total}set total(e){this.allType.total=e}constructor(e){Object.defineProperty(this,"notificationStore",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"types",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"deletedStacks",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"resolver",{enumerable:!0,configurable:!0,writable:!0,value:new Hs}),Object.defineProperty(this,"removeByNotification",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var t,s;if(null==e.id)return;const r=this.getStack(e),i=this.getOrCreateType(e),a=null==r?void 0:r.notifications.get(e.id);null==a?null!=r&&e.id<(null!==(s=null===(t=r.cursor)||void 0===t?void 0:t.id)&&void 0!==s?s:0)&&(this.total--,r.total--,i.total--):(null==r||r.remove(a),i.total--,this.total--)}}),this.getOrCreateType({objectType:null}),(0,r.Gn)(this)}flushStore(){this.types.clear()}getOrCreateType(e){let t=this.types.get(e.objectType);return null==t&&(t=new Is.Ay(e.objectType,this.resolver),this.types.set(t.name,t)),t}getStack(e){var t;return null===(t=this.types.get(e.objectType))||void 0===t?void 0:t.stacks.get((0,As.UR)(e))}handleDispatchAction(e){e instanceof $t.zv?this.handleNotificationEventDelete(e):e instanceof $t.kx?this.handleNotificationEventNew(e):e instanceof $t.yz?this.handleNotificationEventMoreLoaded(e):e instanceof $t.an?this.handleNotificationEventRead(e):e instanceof vt&&this.flushStore()}handleNotificationEventDelete(e){this.removeByEvent(e)}handleNotificationEventMoreLoaded(e){e.context.isWidget||this.updateWithBundle(e.data)}handleNotificationEventNew(e){const t=e.data;let s=this.notificationStore.get(t.id);null==s?(s=Ts.A.fromJson(t),this.notificationStore.add(s)):s.updateFromJson(t);const r=s.identity,i=this.getOrCreateType(r);let a=this.getStack(r);null==a&&(a=new xs(t.object_id,t.object_type,(0,Rs.cE)(t.name),this.resolver)),a.notifications.has(s.id)||(a.total++,i.total++,this.total++),a.add(s),i.stacks.set(a.id,a),this.allStacks.set(a.id,a)}handleNotificationEventRead(e){}orderedStacksOfType(e){return this.stacksOfType(e).sort(((e,t)=>t.displayOrder-e.displayOrder))}removeByEvent(e){for(const t of e.data){switch((0,As.bv)(t)){case"type":this.removeByType(t);break;case"stack":this.removeByStack(t,e.readCount);break;case"notification":this.removeByNotification(t)}}}stacksOfType(e){var t,s;const r=this.types.get(e),i=[];if(null==r)return i;const a=null!==(s=null===(t=r.cursor)||void 0===t?void 0:t.id)&&void 0!==s?s:0;for(const[,n]of r.stacks)void 0!==(null==r?void 0:r.cursor)&&n.displayOrder>=a&&i.push(n);return i}updateWithBundle(e){var t,s,r;null===(t=e.types)||void 0===t||t.forEach((e=>this.updateWithTypeJson(e))),null===(s=e.stacks)||void 0===s||s.forEach((e=>this.updateWithStackJson(e))),null===(r=e.notifications)||void 0===r||r.forEach((e=>this.updateWithNotificationJson(e)))}removeByStack(e,t){const s=this.getStack(e),r=(0,As.UR)(e);if(null==s)return void(this.deletedStacks.has(r)||(this.deletedStacks.add(r),this.total-=t));this.deletedStacks.add(r),this.allStacks.delete(r),this.total-=s.total;this.getOrCreateType(e).removeStack(s)}removeByType(e){const t=this.getOrCreateType(e);if(null===t.name){for(const[e,t]of this.types)null!==e&&this.removeType(t);t.total=0}else this.removeType(t)}removeType(e){e.stacks.forEach((e=>{this.allType.removeStack(e)})),e.total=0,this.types.delete(e.name)}updateWithNotificationJson(e){var t;let s=this.notificationStore.get(e.id);null==s?(s=Ts.A.fromJson(e),this.notificationStore.add(s)):s.updateFromJson(e);null===(t=this.getOrCreateType(s.identity).stacks.get(s.stackId))||void 0===t||t.add(s)}updateWithStackJson(e){const t=this.getOrCreateType((0,As.Rf)(e));let s=t.stacks.get(function(e){return`${e.object_type}-${e.object_id}-${e.category}`}(e));null==s?(s=xs.fromJson(e,this.resolver),t.stacks.set(s.id,s),this.allType.stacks.set(s.id,s)):s.updateWithJson(e)}updateWithTypeJson(e){this.getOrCreateType({objectType:e.name}).updateWithJson(e)}};$s([r.sH],Ls.prototype,"types",void 0),$s([r.EW],Ls.prototype,"total",null),$s([r.XI],Ls.prototype,"flushStore",null),$s([r.XI],Ls.prototype,"getOrCreateType",null),$s([r.XI],Ls.prototype,"handleDispatchAction",null),$s([r.XI],Ls.prototype,"handleNotificationEventDelete",null),$s([r.XI],Ls.prototype,"handleNotificationEventMoreLoaded",null),$s([r.XI],Ls.prototype,"handleNotificationEventNew",null),$s([r.XI],Ls.prototype,"handleNotificationEventRead",null),$s([r.XI],Ls.prototype,"removeByEvent",null),$s([r.XI],Ls.prototype,"updateWithBundle",null),Ls=$s([S.D6],Ls);const Us=Ls;var Bs=function(e,t,s,r){var i,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(n=(a<3?i(n):a>3?i(t,s,n):i(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n};let Fs=class extends Us{handleNotificationEventMoreLoaded(e){e.context.isWidget&&this.updateWithBundle(e.data)}handleNotificationEventNew(e){e.data.is_read||super.handleNotificationEventNew(e)}handleNotificationEventRead(e){this.removeByEvent(e)}updateWithBundle(e){super.updateWithBundle(e),null!=e.unread_count&&(this.total=e.unread_count)}};Bs([r.$Z],Fs.prototype,"handleNotificationEventMoreLoaded",null),Bs([r.$Z],Fs.prototype,"handleNotificationEventNew",null),Bs([r.$Z],Fs.prototype,"handleNotificationEventRead",null),Bs([r.$Z],Fs.prototype,"updateWithBundle",null),Fs=Bs([S.D6],Fs);const Gs=Fs;var Xs=function(e,t,s,r){var i,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(n=(a<3?i(n):a>3?i(t,s,n):i(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n};let Ws=class{constructor(){Object.defineProperty(this,"notifications",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"stacks",{enumerable:!0,configurable:!0,writable:!0,value:new Us(this)}),Object.defineProperty(this,"unreadStacks",{enumerable:!0,configurable:!0,writable:!0,value:new Gs(this)}),(0,r.Gn)(this)}add(e){this.notifications.set(e.id,e)}flushStore(){this.notifications.clear()}get(e){return this.notifications.get(e)}handleDispatchAction(e){e instanceof $t.zv?this.handleNotificationEventDelete(e):e instanceof $t.an?this.handleNotificationEventRead(e):e instanceof vt&&this.flushStore()}handleNotificationEventDelete(e){this.eachByEvent(e,(e=>{this.notifications.delete(e.id)}))}handleNotificationEventRead(e){this.eachByEvent(e,(e=>{e.isRead=!0}))}eachByEvent(e,t){for(const s of e.data){switch((0,As.bv)(s)){case"type":this.eachByType(s,t);break;case"stack":this.eachByStack(s,t);break;case"notification":{if(null==s.id)return;const e=this.get(s.id);null!=e&&t(e);break}}}}eachByStack(e,t){const s=(0,As.UR)(e);this.notifications.forEach((e=>{e.stackId===s&&t(e)}))}eachByType(e,t){this.notifications.forEach((s=>{null!=e.objectType&&s.objectType!==e.objectType||t(s)}))}};Xs([r.sH],Ws.prototype,"notifications",void 0),Xs([r.XI],Ws.prototype,"add",null),Xs([r.XI],Ws.prototype,"flushStore",null),Xs([r.XI],Ws.prototype,"handleDispatchAction",null),Xs([r.XI],Ws.prototype,"handleNotificationEventDelete",null),Xs([r.XI],Ws.prototype,"handleNotificationEventRead",null),Ws=Xs([S.D6],Ws);const Vs=Ws;var qs=s(4692),zs=function(e,t,s,r){var i,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(n=(a<3?i(n):a>3?i(t,s,n):i(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n};class Zs extends ks{get redirect(){return this.redirectOrig.replace(/,/g,"\r\n")}constructor(e){super(e),Object.defineProperty(this,"isResetting",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"isUpdating",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"secret",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"redirectOrig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.redirectOrig=e.redirect,this.secret=e.secret,(0,r.Gn)(this)}delete(){this.isRevoking=!0;const e=qs.ajax({method:"DELETE",url:(0,g.w)("oauth.clients.destroy",{client:this.id})});return e.done((0,r.XI)((()=>{this.revoked=!0}))).always((0,r.XI)((()=>{this.isRevoking=!1}))),e}resetSecret(){this.isResetting=!0;const e=qs.ajax({method:"POST",url:(0,g.w)("oauth.clients.reset-secret",{client:this.id})});return e.done((e=>{this.updateFromJson(e)})).always((0,r.XI)((()=>{this.isResetting=!1}))),e}updateFromJson(e){this.id=e.id,this.name=e.name,this.scopes=new Set(e.scopes),this.userId=e.user_id,this.user=e.user,this.redirectOrig=e.redirect,this.secret=e.secret}updateWith(e){const{redirect:t}=e;this.isUpdating=!0;const s=qs.ajax({data:{redirect:t},method:"PUT",url:(0,g.w)("oauth.clients.update",{client:this.id})});return s.done((e=>{this.updateFromJson(e)})).always((0,r.XI)((()=>{this.isUpdating=!1}))),s}}zs([r.sH],Zs.prototype,"isResetting",void 0),zs([r.sH],Zs.prototype,"isUpdating",void 0),zs([r.sH],Zs.prototype,"redirectOrig",void 0),zs([r.EW],Zs.prototype,"redirect",null),zs([r.XI],Zs.prototype,"delete",null),zs([r.XI],Zs.prototype,"resetSecret",null),zs([r.XI],Zs.prototype,"updateFromJson",null),zs([r.XI],Zs.prototype,"updateWith",null);var Ks=function(e,t,s,r){var i,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(n=(a<3?i(n):a>3?i(t,s,n):i(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n};class Js{constructor(){Object.defineProperty(this,"clients",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),(0,r.Gn)(this)}handleDispatchAction(e){e instanceof vt&&this.flushStore()}initialize(e){for(const t of e)this.updateWithJson(t)}updateWithJson(e){const t=new Zs(e);return this.clients.set(t.id,t),t}flushStore(){this.clients.clear()}}Ks([r.sH],Js.prototype,"clients",void 0),Ks([r.XI],Js.prototype,"updateWithJson",null),Ks([r.XI],Js.prototype,"flushStore",null);var Ys=function(e,t,s,r){var i,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(n=(a<3?i(n):a>3?i(t,s,n):i(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n};class Qs{constructor(){Object.defineProperty(this,"account",{enumerable:!0,configurable:!0,writable:!0,value:{client:null,isCreatingNewClient:!1,newClientVisible:!1}}),(0,r.Gn)(this)}}Ys([r.sH],Qs.prototype,"account",void 0);var er=s(8443),tr=function(e,t,s,r){var i,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(n=(a<3?i(n):a>3?i(t,s,n):i(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n};let sr=class{constructor(){Object.defineProperty(this,"users",{enumerable:!0,configurable:!0,writable:!0,value:r.sH.map()}),(0,r.Gn)(this)}flushStore(){this.users=r.sH.map()}get(e){return this.users.get(e)}handleDispatchAction(e){e instanceof I&&this.updateMany(e.json.users)}update(e){const t=e.id;let s=this.users.get(t);return null==s&&(s=new er.Ay(t),this.users.set(t,s)),s.updateWithJson(e),s}updateMany(e){if(null!=e)for(const t of e)this.update(t)}};tr([r.sH],sr.prototype,"users",void 0),tr([r.XI],sr.prototype,"flushStore",null),tr([r.XI],sr.prototype,"update",null),tr([r.XI],sr.prototype,"updateMany",null),sr=tr([S.D6],sr);const rr=sr;class ir{constructor(){Object.defineProperty(this,"beatmapsetSearch",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"beatmapsetStore",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"channelStore",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"chatState",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientStore",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"notificationStore",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ownClientStore",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"uiState",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"userStore",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.beatmapsetStore=new hs,this.beatmapsetSearch=new Jt(this.beatmapsetStore),this.clientStore=new Ns,this.notificationStore=new Vs,this.ownClientStore=new Js,this.userStore=new rr,this.channelStore=new Ps,this.chatState=new ps(this.channelStore),this.uiState=new Qs}}var ar=s(2599),nr=s(4692),or=function(e,t,s,r){var i,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(n=(a<3?i(n):a>3?i(t,s,n):i(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n};class lr{get currentUserOrFail(){if(null==this.currentUser)throw new Error("current user is null");return this.currentUser}constructor(){Object.defineProperty(this,"accountEdit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"accountEditAvatar",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"accountEditBlocklist",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"animateNav",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"beatmapsetSearchController",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"browserTitleWithNotificationCount",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"captcha",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"chatWorker",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clickMenu",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"currentUser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"currentUserModel",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"currentUserObserver",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dataStore",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"enchant",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"forumPoll",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"forumPostEdit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"forumPostInput",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"forumPostReport",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"localtime",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"mobileToggle",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"notificationsWorker",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"osuAudio",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reactTurbolinks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"referenceLinkTooltip",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"scorePins",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"socketWorker",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"spoilerbox",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stickyFooter",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stickyHeader",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"syncHeight",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeago",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"turbolinksReload",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"twitchPlayer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"userLogin",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"userLoginObserver",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"userPreferences",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"userVerification",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"windowFocusObserver",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"windowSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"setCurrentUser",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var t;const s=null==e.id?void 0:e;null!=s&&this.dataStore.userStore.update(s),this.socketWorker.setUserId(null!==(t=null==s?void 0:s.id)&&void 0!==t?t:null),this.currentUser=s,window.currentUser=e,this.userPreferences.setUser(this.currentUser)}}),Object.defineProperty(this,"updateCurrentUser",{enumerable:!0,configurable:!0,writable:!0,value:()=>{const e=(0,ar.Do)("json-current-user",!0);null!=e&&this.setCurrentUser(e)}}),Object.defineProperty(this,"onCurrentUserUpdate",{enumerable:!0,configurable:!0,writable:!0,value:(e,t)=>{this.setCurrentUser(t)}});const e="loading"===document.readyState;e&&document.addEventListener("DOMContentLoaded",this.updateCurrentUser),nr.subscribe("user:update",this.onCurrentUserUpdate),this.animateNav=new se,this.captcha=new oe,this.chatWorker=new H,this.clickMenu=new de,this.currentUserObserver=new he(this),this.currentUserModel=new _t(this),this.forumPoll=new ye,this.forumPostEdit=new _e,this.forumPostInput=new Oe,this.forumPostReport=new Se,this.localtime=new Ae,this.mobileToggle=new xe,this.browserTitleWithNotificationCount=new ae(this),this.referenceLinkTooltip=new Tt,this.scorePins=new ht,this.spoilerbox=new Qe,this.stickyFooter=new tt,this.stickyHeader=new rt,this.syncHeight=new at,this.timeago=new lt,this.turbolinksReload=new ut,this.userPreferences=new jt,this.userVerification=new Nt,this.windowSize=new Dt,this.enchant=new ve(this.turbolinksReload),this.osuAudio=new Xe(this.userPreferences),this.reactTurbolinks=new Ze(this,this.turbolinksReload),this.twitchPlayer=new dt(this.turbolinksReload),this.userLogin=new ft(this.captcha),this.dataStore=new ir,this.accountEditBlocklist=new ee(this),this.accountEdit=new W(this),this.accountEditAvatar=new K(this),this.userLoginObserver=new yt,this.windowFocusObserver=new It,this.beatmapsetSearchController=new k(this.dataStore.beatmapsetSearch),this.socketWorker=new zt,this.notificationsWorker=new Ft(this.socketWorker),(0,r.Gn)(this),e||this.updateCurrentUser()}}or([r.sH],lr.prototype,"currentUser",void 0),or([r.EW],lr.prototype,"currentUserOrFail",null),or([r.XI],lr.prototype,"setCurrentUser",void 0);const cr=new lr;window.osuCore=cr;const ur=cr},8837:(e,t,s)=>{s.d(t,{A:()=>c});var r=s(5191),i=s(5093),a=s(6540),n=s(7634),o=s(5812);class l extends a.PureComponent{render(){return 0===this.props.badges.length?null:a.createElement("div",{className:(0,n.Zt)("profile-badges",this.props.modifiers)},this.props.badges.map((e=>{const t=(0,o.E)(e.awarded_at)?`<div>${e.description}</div>\n            <div class='profile-badges__date'>${i(e.awarded_at).format("LL")}</div>`:null,s=a.createElement(r.A,{className:"profile-badges__badge","data-html-title":t,src:e.image_url,title:e.description});return(0,o.E)(e.url)?a.createElement("a",{key:e.image_url,href:e.url},s):a.createElement("span",{key:e.image_url},s)})))}}Object.defineProperty(l,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{badges:[]}});const c=l},7256:(e,t,s)=>{s.d(t,{A:()=>g});var r=s(8789),i=s(8623),a=s(241),n=s(4944),o=s(9981),l=s(2543),c=s(7813),u=s(1370),d=s(6823),p=s(6540),m=s(7634),h=s(1883),b=function(e,t,s,r){var i,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(n=(a<3?i(n):a>3?i(t,s,n):i(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n};function f(){}let v=class extends p.Component{get showCover(){return d.A.userPreferences.get("profile_cover_expanded")}constructor(e){super(e),Object.defineProperty(this,"onCoverExpandedToggle",{enumerable:!0,configurable:!0,writable:!0,value:()=>{d.A.userPreferences.set("profile_cover_expanded",!this.showCover)}}),(0,c.Gn)(this)}render(){var e,t;return p.createElement("div",{className:(0,m.Zt)("profile-info",this.props.modifiers,{cover:this.showCover})},this.showCover&&p.createElement("div",{className:"profile-info__bg",style:{backgroundImage:(0,m.NZ)(this.props.coverUrl)}},this.props.isUpdatingCover&&p.createElement("div",{className:"profile-info__spinner"},p.createElement(i.y,null)),this.props.editor),p.createElement("div",{className:"profile-info__details"},this.props.user.id===(null===(e=d.A.currentUser)||void 0===e?void 0:e.id)?p.createElement("a",{className:"profile-info__avatar",href:`${(0,o.w)("account.edit")}#avatar`,title:(0,h.pw)("users.show.change_avatar")},this.renderAvatar()):p.createElement("div",{className:"profile-info__avatar"},this.renderAvatar()),p.createElement("div",{className:"profile-info__info"},p.createElement("h1",{className:"profile-info__name"},p.createElement("span",{className:"u-ellipsis-pre-overflow"},this.props.user.username),p.createElement("div",{className:"profile-info__previous-usernames"},this.renderPreviousUsernames()),p.createElement("div",{className:"profile-info__icons profile-info__icons--name-inline"},this.renderIcons())),this.renderTitle(),p.createElement("div",{className:"profile-info__flags"},null!=(null===(t=this.props.user.country)||void 0===t?void 0:t.code)&&p.createElement("a",{className:"profile-info__flag",href:(0,o.w)("rankings",{country:this.props.user.country.code,mode:this.props.currentMode,type:"performance"})},p.createElement("span",{className:"profile-info__flag-flag"},p.createElement(r.A,{country:this.props.user.country})),p.createElement("span",{className:"profile-info__flag-text"},this.props.user.country.name)),p.createElement("div",{className:"profile-info__icons profile-info__icons--flag-inline"},this.renderIcons()))),p.createElement("div",{className:"profile-info__cover-toggle"},p.createElement("button",{className:"btn-circle btn-circle--page-toggle",onClick:this.onCoverExpandedToggle,title:(0,h.pw)("users.show.cover.to_"+(this.showCover?"0":"1")),type:"button"},p.createElement("span",{className:this.showCover?"fas fa-chevron-up":"fas fa-chevron-down"})))))}renderAvatar(){return p.createElement(a.A,{modifiers:"full",user:this.props.user})}renderIcons(){var e;return p.createElement(p.Fragment,null,this.props.user.is_supporter&&p.createElement("a",{className:"profile-info__icon profile-info__icon--supporter",href:(0,o.w)("support-the-game"),title:(0,h.pw)("users.show.is_supporter")},(0,l.times)(null!==(e=this.props.user.support_level)&&void 0!==e?e:0,(e=>p.createElement("span",{key:e,className:"fas fa-heart"})))),p.createElement(n.A,{groups:this.props.user.groups,modifiers:"profile-page",wrapper:"profile-info__icon"}))}renderPreviousUsernames(){if(null==this.props.user.previous_usernames||0===this.props.user.previous_usernames.length)return null;const e=this.props.user.previous_usernames.join(", ");return p.createElement("div",{className:"profile-previous-usernames"},p.createElement("a",{className:"profile-previous-usernames__icon profile-previous-usernames__icon--with-title",onClick:f,title:`${(0,h.pw)("users.show.previous_usernames")}: ${e}`},p.createElement("span",{className:"fas fa-address-card"})),p.createElement("div",{className:"profile-previous-usernames__icon profile-previous-usernames__icon--plain"},p.createElement("span",{className:"fas fa-address-card"})),p.createElement("div",{className:"profile-previous-usernames__content"},p.createElement("div",{className:"profile-previous-usernames__title"},(0,h.pw)("users.show.previous_usernames")),p.createElement("div",{className:"profile-previous-usernames__names"},e)))}renderTitle(){var e;if(null==this.props.user.title)return null;const t={children:this.props.user.title,className:"profile-info__title",style:{color:null!==(e=this.props.user.profile_colour)&&void 0!==e?e:void 0}};return null!=this.props.user.title_url?p.createElement("a",Object.assign({href:this.props.user.title_url},t)):p.createElement("span",Object.assign({},t))}};b([c.EW],v.prototype,"showCover",null),v=b([u.PA],v);const g=v},3925:(e,t,s)=>{s.d(t,{A:()=>y});var r=s(1547),i=s(2175),a=s(4617),n=s(6540),o=s(1883);function l({level:e}){let t="iron";return e>=110?t="lustrous":e>=105?t="radiant":e>=100?t="rhodium":e>=80?t="platinum":e>=60?t="gold":e>=40?t="silver":e>=20&&(t="bronze"),n.createElement("div",{className:"user-level",style:{"--bg":`var(--level-tier-${t})`},title:(0,o.pw)("users.show.stats.level",{level:e})},n.createElement("div",{className:"user-level__icon"}),n.createElement("span",{className:"user-level__level"},e))}var c=s(9981),u=s(1370),d=s(6823),p=s(2370),m=s(6968),h=s(5953),b=s(1980);function f(e){return n.createElement("div",{className:"btn-circle btn-circle--page-toggle btn-circle--page-toggle-detail",title:(0,o.pw)("common.buttons.show_more_options")},n.createElement(m.A,null,(t=>n.createElement("div",{className:"simple-menu"},n.createElement("a",{className:"simple-menu__item",href:(0,b.SS)(e.user),onClick:t},n.createElement("span",{className:"fas fa-gift"}),` ${(0,o.pw)("users.card.gift_supporter")}`),n.createElement(p.A,{modifiers:"inline",onClick:t,userId:e.user.id,wrapperClass:"simple-menu__item"}),n.createElement(h.r,{className:"simple-menu__item",icon:!0,onFormOpen:t,reportableId:e.user.id.toString(),reportableType:"user",user:e.user})))))}var v=function(e,t,s,r){var i,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(n=(a<3?i(n):a>3?i(t,s,n):i(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n};let g=class extends n.Component{get showMessageButton(){return null==d.A.currentUser||d.A.currentUser.id!==this.props.user.id&&!d.A.currentUserModel.blocks.has(this.props.user.id)}render(){return n.createElement("div",{className:"profile-detail-bar"},n.createElement(a.A,{alwaysVisible:!0,followers:this.props.user.follower_count,modifiers:"profile-page",userId:this.props.user.id}),this.props.user.is_bot?this.renderMessageButton():this.renderNonBotButtons())}renderMessageButton(){return this.showMessageButton?n.createElement("div",null,n.createElement("a",{className:"user-action-button user-action-button--profile-page",href:(0,c.w)("messages.users.show",{user:this.props.user.id}),title:(0,o.pw)("users.card.send_message")},n.createElement("i",{className:"fas fa-envelope"}))):null}renderNonBotButtons(){return n.createElement(n.Fragment,null,n.createElement(i.A,{alwaysVisible:!0,followers:this.props.user.mapping_follower_count,modifiers:"profile-page",showFollowerCounter:!0,userId:this.props.user.id}),this.renderMessageButton(),(e=this.props.user,null!=d.A.currentUser&&d.A.currentUser.id!==e.id&&n.createElement(f,{user:this.props.user})),null!=this.props.user.statistics&&n.createElement("div",{className:"profile-detail-bar__level"},n.createElement("div",{className:"profile-detail-bar__level-bar"},n.createElement(r.A,{current:this.props.user.statistics.level.progress,modifiers:"user-profile",textPrecision:0,title:(0,o.pw)("users.show.stats.level_progress"),total:100})),n.createElement(l,{level:this.props.user.statistics.level.current})));var e}};g=v([u.PA],g);const y=g},8293:(e,t,s)=>{s.d(t,{A:()=>a});var r=s(6540),i=s(1883);function a(e){return r.createElement("div",{className:"u-relative"},r.createElement("h2",{className:"title title--page-extra"},(0,i.pw)(`users.show.extra.${e.name}.title`)),e.withEdit&&r.createElement("span",{className:"sortable-handle sortable-handle--profile-page-extra hidden-xs js-profile-page-extra--sortable-handle"},r.createElement("i",{className:"fas fa-bars"})))}},5349:(e,t,s)=>{s.d(t,{A:()=>a});var r=s(9981),i=s(4692);function a(e,t,s){return i.ajax((0,r.w)("users.extra-page",{mode:s,page:t,user:e.id}))}},8586:(e,t,s)=>{s.d(t,{A:()=>l});var r=s(9981),i=s(1883);const a=["modding","playlists","realtime"],n={modding:e=>(0,r.w)("users.modding.index",{user:e}),playlists:e=>(0,r.w)("users.multiplayer.index",{typeGroup:"playlists",user:e}),realtime:e=>(0,r.w)("users.multiplayer.index",{typeGroup:"realtime",user:e}),show:e=>(0,r.w)("users.show",{user:e})};function o(e,t,s){return{active:t,title:(0,i.pw)(`layout.header.users.${e}`),url:n[e](s)}}function l(e,t){const s=[o("show","show"===t,e.id)];return e.is_bot||a.forEach((r=>{s.push(o(r,t===r,e.id))})),s}},7290:(e,t,s)=>{function r(e,t,s){var r;const i=null!==(r=e.data(t))&&void 0!==r?r:[];e.data(t,[...i,...s])}s.d(t,{A:()=>r})},6978:(e,t,s)=>{s.d(t,{A:()=>n});var r=s(3721),i=s(7419),a=s(7290);function n(){(0,a.A)(this,"micromarkExtensions",[i.$]),(0,a.A)(this,"fromMarkdownExtensions",[r.C])}},5780:(e,t,s)=>{s.d(t,{A:()=>c});var r=s(7290);const i=["attention","autolink","blankLine","blockQuote","characterReference","codeFenced","codeIndented","codeText","definition","hardBreakEscape","headingAtx","htmlFlow","htmlText","labelEnd","labelStartImage","labelStartLink","list","setextUnderline","thematicBreak"];const a=["autolink","definition","hardBreakEscape","headingAtx","htmlFlow","htmlText","setextUnderline","thematicBreak"],n=[...a,"blockQuote","codeFenced","codeIndented","codeText","list"],o={chat:["definition","htmlFlow","htmlText","labelStartImage","setextUnderline"],chatPlain:(l=["autolink","labelEnd","labelStartLink"],i.filter((e=>!l.includes(e)))),default:a,editor:[...n,"codeFenced","codeIndented","codeText","labelEnd","labelStartImage","labelStartLink"],reviews:n};var l;function c(e){var t;(0,r.A)(this,"micromarkExtensions",[{disable:{null:o[null!==(t=null==e?void 0:e.type)&&void 0!==t?t:"default"]}}])}},7901:(e,t,s)=>{s.d(t,{A:()=>n});var r=s(6540),i=s(256),a=s(1883);function n({score:e,suffix:t}){return"solo_score"!==e.type&&null==e.best_id?r.createElement("span",{title:(0,a.pw)("scores.status.non_best")},"-"):"solo_score"!==e.type||e.preserve&&e.ranked&&(null!=e.pp||!e.processed)?null==e.pp?r.createElement("span",{title:(0,a.pw)("scores.status.processing")},r.createElement("span",{className:"fas fa-sync"})):r.createElement("span",{title:(0,i.ZV)(e.pp)},(0,i.ZV)(Math.round(e.pp)),t):r.createElement("span",{title:(0,a.pw)("scores.status.no_pp")},"-")}},5374:(e,t,s)=>{s.d(t,{Bz:()=>a,tx:()=>n,xb:()=>i});var r=s(6540);function i(e){this.setState({activeKey:e})}const a=(0,r.createContext)({activeKeyDidChange:e=>{}}),n=(0,r.createContext)(null)},6288:(e,t,s)=>{s.d(t,{A:()=>a});var r=s(7813),i=function(e,t,s,r){var i,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(n=(a<3?i(n):a>3?i(t,s,n):i(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n};class a{constructor(){Object.defineProperty(this,"cursorString",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"rooms",{enumerable:!0,configurable:!0,writable:!0,value:[]}),(0,r.Gn)(this)}updateWithJson(e){for(const t of e.rooms)this.rooms.push(t);this.cursorString=e.cursor_string}}i([r.sH],a.prototype,"cursorString",void 0),i([r.sH],a.prototype,"rooms",void 0),i([r.XI],a.prototype,"updateWithJson",null)},4466:(e,t,s)=>{s.d(t,{l:()=>r});const r=(0,s(6540).createContext)(void 0)},4909:(e,t,s)=>{s.d(t,{A:()=>r});const r=(0,s(6540).createContext)({isFriendsPage:!1})},6407:(e,t,s)=>{s.d(t,{ER:()=>v,OL:()=>m,S5:()=>h,dI:()=>b,eO:()=>u,ho:()=>p,uR:()=>f,z3:()=>d});var r=s(6823),i=s(256),a=s(1883),n=s(3135),o=s(5812),l=s(4692);const c=["status","statusText","readyState"];function u(e=document.body){return(t,s,r)=>l(e).trigger("ajax:error",[t,s,r])}const d=(e,t,s)=>{"abort"!==t&&(r.A.userLogin.showOnError(e,s)||r.A.userVerification.showOnError(e,s)||(0,n.l)(v(e),"danger"))},p=(e,t)=>{d(t.jqXHR,t.textStatus,(()=>{var e;null===(e=t.submit)||void 0===e||e.call(t)}))};function m(e){return"object"==typeof e&&null!=e&&c.every((t=>t in e))}const h=e=>d(e,e.statusText),b=e=>(t,s)=>{d(t,s,e)},f=e=>b((0,i.Qz)(e));function v(e){var t,s;if(null==e||null==e.responseJSON)return(0,a.pw)("errors.unknown");const r=e.responseJSON;if(null!=r.validation_error)return`${Object.values(r.validation_error).flat().join(", ")}.`;let i=null!==(s=null!==(t=r.error)&&void 0!==t?t:r.message)&&void 0!==s?s:"";if(!(0,o.E)(i)){const t=`errors.codes.http-${e.status}`;i=(0,a.pw)(t),i===t&&(i=(0,a.pw)("errors.unknown"))}return i}},8243:(e,t,s)=>{s.d(t,{I6:()=>d,bE:()=>u,ID:()=>p,Os:()=>m,kM:()=>h,tl:()=>b,U0:()=>f});var r=s(7679);var i=s(3702),a=s(2543),n=s(6823),o=s(2599),l=s(4692);const c=r.scaleLinear().domain([.1,1.25,2,2.5,3.3,4.2,4.9,5.8,6.7,7.7,9]).clamp(!0).range(["#4290FB","#4FC0FF","#4FFFD5","#7CFF4F","#F6F05C","#FF8068","#FF4E6F","#C645B8","#6563DE","#18158E","#000000"]).interpolate(r.interpolateRgb.gamma(2.2));function u(e){var t,s,r,n;if(null!=e.items){let r=null,c=null;const u=function(e){var t,s;null==g&&(g=null!==(t=(0,o.Do)("json-recommended-star-difficulty-all"))&&void 0!==t?t:{},l(document).one("turbolinks:before-cache",(()=>{g=null})));return null!==(s=g[e])&&void 0!==s?s:1}(null!==(t=e.mode)&&void 0!==t?t:i.g[0]);for(const t of e.items){const e=Math.abs(t.difficulty_rating-u);(null==(n=t).accuracy||null==n.deleted_at&&!n.convert)&&(null==r||e<r)&&(r=e,c=t)}return null!==(s=null!=c?c:a.last(e.items))&&void 0!==s?s:null}if(null==e.group)return null;const c=null==e.mode?v():[e.mode];for(const i of c){const t=u({items:null!==(r=e.group.get(i))&&void 0!==r?r:[],mode:i});if(null!=t)return t}return null}function d(e){var t;const s=null==e.mode?v():[e.mode];for(const r of s){const s=null===(t=e.group.get(r))||void 0===t?void 0:t.find((t=>t.id===e.id));if(null!=s)return s}return null}function p(e){return e<.1?"#AAAAAA":e>=9?"#000000":c(e)}function m(e,t=!0){const s=a.groupBy(null!=e?e:[],"mode"),r=new Map;return i.g.forEach((e=>{const i=s[e];(null!=i||t)&&r.set(e,function(e){if(0===e.length)return[];if("mania"===e[0].mode)return a.orderBy(e,["convert","cs","difficulty_rating"],["desc","asc","asc"]);return a.orderBy(e,["convert","difficulty_rating"],["desc","asc"])}(null!=i?i:[]))})),r}function h(e){switch(e){case 0:return"osu";case 1:return"taiko";case 2:return"fruits";case 3:return"mania";default:throw new Error("invalid ruleset id passed")}}function b(e){return"ranked"===e.status||"approved"===e.status}function f(e){return[...m(e).values()].flat()}function v(){var e;const t=null===(e=n.A.currentUser)||void 0===e?void 0:e.playmode;if(null==t||!i.g.includes(t))return i.g;const s=a.without(i.g,t);return s.unshift(t),s}let g=null},6606:(e,t,s)=>{s.d(t,{lz:()=>E,pd:()=>P,Ey:()=>k,k5:()=>A,Gm:()=>T,yD:()=>y,Y5:()=>w,F3:()=>C,EH:()=>I,Dl:()=>R,ML:()=>M,JL:()=>D,A2:()=>H,_R:()=>v,Fm:()=>g,as:()=>$});var r=s(447),i=s(6614);const a=Object.freeze({colour:"hsl(var(--hsl-l1))",has_listing:!1,has_playmodes:!1,id:-1,identifier:"guest",is_probationary:!1,name:"Difficulty Guest",short_name:"GUEST"});var n=s(3863),o=s(3702),l=s(9981),c=s(2543),u=s(5093),d=s(6823),p=s(3944),m=(s(1980),s(723));const h=new Set(r.u),b=new Set(["events","generalAll","reviews"]),f="-",v=/\b(((\d{2,}):([0-5]\d)[:.](\d{3}))(\s\((?:\d+[,|])*\d+\))?)/,g=new RegExp(v,"g"),y=750,w=100,_=new Set(["suggestion","problem"]);function E({beatmapset:e,currentBeatmap:t,discussion:s,user:r}){return null==r?null:r.id===(null==e?void 0:e.user_id)?n.A:null!=t&&s.beatmap_id===t.id&&r.id===t.user_id?a:null==r.groups||0===r.groups.length?null:r.groups[0]}function P(){const e=d.A.currentUser;return null!=e&&(e.is_admin||e.is_moderator)}function O(e){return null!=e&&e!==f?"timeline":"generalAll"}function j(e){return"review"===e.message_type?"reviews":null!=e.beatmap_id?null!=e.timestamp?"timeline":"general":"generalAll"}function k(e){const t=e%1e3,s=Math.floor(e/1e3)%60,r=Math.floor(e/1e3/60);return`${(0,c.padStart)(r.toString(),2,"0")}:${(0,c.padStart)(s.toString(),2,"0")}:${(0,c.padStart)(t.toString(),3,"0")}`}function S(e){return null==e.deleted_at&&null!=e.timestamp&&_.has(e.message_type)&&(e.user_id!==d.A.currentUserOrFail.id||u(e.updated_at).diff(u(),"hour")<=-24)}const N={nat:o.g};function A(e,t){return null!=e&&null!=e.groups&&e.groups.some((e=>{var s,r;if(null!=t){let i=null!==(s=e.playmodes)&&void 0!==s?s:[];return 0===i.length&&(i=null!==(r=N[e.identifier])&&void 0!==r?r:[]),("bng"===e.identifier||"nat"===e.identifier)&&i.includes(t)}return"bng"===e.identifier||"nat"===e.identifier}))}function T(e){var t,s;const{beatmap:r,discussion:i,filter:a,post:n,user:o}=e;let{beatmapId:c,beatmapsetId:u,discussionId:d,mode:p,postId:m}=e;if(null!=r&&(u=r.beatmapset_id,c=r.id),null!=i){d=i.id;const e=H(i);null!=e&&(u=e.beatmapsetId,c=null!==(t=e.beatmapId)&&void 0!==t?t:void 0,p=e.mode)}m=null!==(s=null==n?void 0:n.id)&&void 0!==s?s:m;const h={beatmap:null==c||b.has(p)?f:c,beatmapset:u,mode:null!=p?p:O(c)};null!=a&&"events"!==h.mode&&(h.filter=a);const v=new URL((0,l.w)("beatmapsets.discussion",h));return null!=d&&(v.hash=`/${d}`,null!=m&&(v.hash+=`/${m}`)),null!=o&&v.searchParams.set("user",o.toString()),v.toString()}function C(e,t){var s,r,i,a,n,o;const l={};for(const c of e)if(S(c)){const e=x(Math.abs(c.timestamp-t));null!=e&&(null!==(s=l[e])&&void 0!==s||(l[e]=[]),null===(r=l[e])||void 0===r||r.push(c))}const u=null!==(o=null!==(n=null!==(a=null!==(i=l.d0)&&void 0!==i?i:l.d100)&&void 0!==a?a:l.d1000)&&void 0!==n?n:l.other)&&void 0!==o?o:[];return(0,c.sortBy)(u,"timestamp")}function x(e){return e>5e3?null:0===e?"d0":e<100?"d100":e<1e3?"d1000":"other"}function I(e){if(null==e)return null;const t=e.match(v);if(null==t)return null;const s=t.slice(1).map((e=>{var t;return null!==(t=(0,m.y)(e))&&void 0!==t?t:0}));return 1e3*(60*s[2]+s[3])+s[4]}function R(e,t,s="total"){const r=new URL(null!=e?e:(0,p.bS)().href),[,a,n,o,l,u,d]=r.pathname.split(/\/+/),b=(0,m.y)(n);if("beatmapsets"!==a||"discussion"!==o||null==b)return null;const f=(0,m.y)(l),v={beatmapId:f,beatmapsetId:b,filter:(g=d,h.has(g)?d:s),mode:(0,i.u)(u)?u:O(f),user:(0,m.y)(r.searchParams.get("user"))};var g;if("/"===r.hash[1]){const[e,s]=r.hash.split("/").slice(1,3).map(m.y);if(null!=e&&(v.discussionId=e,null!=s&&(v.postId=s),null!=t&&null!=e)){const r=t.find((t=>t.id===e));if(null!=r){if((0,c.assign)(v,H(r)),null!=r.posts){const e=r.posts.find((e=>e.id===s));null==e&&(v.postId=void 0)}}else v.discussionId=void 0,v.postId=void 0}}return v}function M(e=""){const t=R(),s={href:e,rel:"nofollow noreferrer",target:"_blank"};let r;try{r=new URL(e)}catch(i){}if(null!=r&&r.host===(0,p.bS)().host){const e=R(r.href);if(null!=(null==e?void 0:e.discussionId)&&null!=e.beatmapsetId){const r=[e.discussionId,e.postId].filter(Number.isFinite).join("/");(null==t?void 0:t.beatmapsetId)===e.beatmapsetId?(s.children=`#${r}`,s.className="js-beatmap-discussion--jump",s.target=void 0):s.children=`${e.beatmapsetId}#${r}`}}return s}function D(e){return"posts"in e&&null!=e.posts?e.posts[0]:e.starting_post}function H(e){return{beatmapId:e.beatmap_id,beatmapsetId:e.beatmapset_id,discussionId:e.id,mode:j(e)}}function $(e,t=!1){return null!=e&&0!==e.length&&(!t||e.length<=y)}},9232:(e,t,s)=>{s.d(t,{KY:()=>d,LK:()=>u,Mb:()=>p,PR:()=>l,wp:()=>c});var r=s(9981),i=s(7813),a=s(6823),n=s(6407),o=s(4692);function l(e){return null==e.availability||e.availability.download_disabled||null!=e.availability.more_information}function c(e){return a.A.userPreferences.get("beatmapset_title_show_original")?e.artist_unicode:e.artist}function u(e){return a.A.userPreferences.get("beatmapset_title_show_original")?e.title_unicode:e.title}function d(e){return!e.nsfw||a.A.userPreferences.get("beatmapset_show_nsfw")}const p=(0,i.XI)((e=>{const t=()=>{p(e)};if(a.A.userLogin.showIfGuest(t))return;const s=!e.has_favourited;e.has_favourited=s,e.favourite_count+=s?1:-1;const l=o.ajax((0,r.w)("beatmapsets.favourites.store",{beatmapset:e.id}),{data:{action:s?"favourite":"unfavourite"},method:"POST"});return l.fail(((r,a)=>(0,i.h5)((()=>{e.has_favourited=!s,e.favourite_count+=s?-1:1,(0,n.z3)(r,a,t)})))).done((t=>(0,i.h5)((()=>{e.favourite_count=t.favourite_count})))),l}))},4920:(e,t,s)=>{s.d(t,{cM:()=>o,hd:()=>l,qg:()=>n});var r=s(3702),i=s(723),a=s(3944);function n(e){const[t,s]=e.slice(1).split("/");return{beatmapId:(0,i.y)(s),playmode:(0,r.H)(t)}}function o({beatmap:e,ruleset:t}){let s="";return null!=t||(t=null==e?void 0:e.mode),null!=t&&(s+=`#${t}`,null!=e&&(s+=`/${e.id}`)),s}function l(e){const t=(0,a.bS)().href,s=`${t.replace(/#.*/,"")}${e}`;s!==t&&history.replaceState(history.state,"",s)}},3368:(e,t,s)=>{s.d(t,{A:()=>n,Q:()=>a});var r=s(1491);const i=new Set;function a(e,t){var s;t?i.add(e):i.delete(e),(0,r.j6)(null===(s=window.newBody)||void 0===s?void 0:s.querySelector(".js-blackout"),n())}function n(){return i.size>0}},7634:(e,t,s)=>{s.d(t,{NZ:()=>c,OS:()=>o,Zt:()=>n,hL:()=>l});var r=s(2543),i=s(5812);const a=(e,t)=>{e.forEach((e=>{Array.isArray(e)?e.forEach((e=>{null!=e&&t(e)})):"string"==typeof e?t(e):(0,r.forEach)(e,((e,s)=>{e&&t(s)}))}))};function n(e,...t){let s=e;return a(t,(t=>s+=` ${e}--${t}`)),s}function o(e){var t;return{"--group-colour":null!==(t=null==e?void 0:e.colour)&&void 0!==t?t:"initial"}}function l(...e){const t=[];return a(e,(e=>t.push(e))),t}function c(e){return(0,i.E)(e)?`url("${String(e).replace(/"/g,"%22")}")`:void 0}},1491:(e,t,s)=>{function r(e){null==e||e.setAttribute("data-visibility","visible")}function i(e){null==e||e.setAttribute("data-visibility","hidden")}function a(e,t){if(null==e)return;const s=(null!=t?t:!function(e){return"hidden"!==(null==e?void 0:e.getAttribute("data-visibility"))}(e))?r:i;s(e)}s.d(t,{Xn:()=>i,j6:()=>a,qG:()=>r})},8961:(e,t,s)=>{function r(e){throw new Error(e)}s.d(t,{f:()=>r})},256:(e,t,s)=>{s.d(t,{B6:()=>_,Dk:()=>d,JD:()=>w,Kq:()=>O,Lh:()=>E,Qz:()=>u,ZV:()=>f,a3:()=>h,b5:()=>P,e0:()=>y,h$:()=>g,rJ:()=>l,wM:()=>c,z3:()=>m});var r=s(2543),i=s(7634),a=s(4692);const n=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],o=1e3;function l(){return 0===c()}function c(){const e=document.documentElement;return e.scrollHeight-e.scrollTop-e.clientHeight}function u(e){if(e instanceof HTMLElement)return e instanceof HTMLFormElement?()=>a(e).submit():()=>e.click()}function d(e){if(null!=e)return{"--bg":(0,i.NZ)(e),"--bg-2x":(0,i.NZ)(P(e))}}function p(e){return(0,r.padStart)(e.toString(),2,"0")}function m(e,t=2){if(e<o)return`${e} B`;const s=Math.floor(Math.log(e)/Math.log(o));return`${f(e/Math.pow(o,s),t)} ${n[s]}`}function h(e){const t=e%60,s=Math.floor(e/60)%60,r=Math.floor(e/3600);return r>0?`${r}:${p(s)}:${p(t)}`:`${s}:${p(t)}`}const b=new Intl.NumberFormat(window.currentLocale);function f(e,t,s,r){return null==t&&null==s&&null==r?b.format(e):(null!=s||(s={}),null!=t&&(s.minimumFractionDigits=t,s.maximumFractionDigits=t),e.toLocaleString(null!=r?r:window.currentLocale,s))}const v=new Intl.NumberFormat(window.currentLocale,{maximumFractionDigits:1,minimumFractionDigits:0,notation:"compact"});function g(e){return null==e?void 0:v.format(e)}function y(e){return e instanceof HTMLElement?e:null}function w(e){const t=y(e);if(null==t)return!1;if(_(t)||["A","BUTTON"].includes(t.tagName))return!0;const s=y(t.parentNode);return null!=s&&w(s)}function _(e){return["INPUT","OPTION","SELECT","TEXTAREA"].includes(e.tagName)||e.isContentEditable}const E="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";function P(e){if(null!=e)return e.replace(/(\.[^.]+)$/,"@2x$1")}function O(e){return e.replace(/<[^>]*>/g,"")}},7144:(e,t,s)=>{s.d(t,{R:()=>a,p:()=>r});var r,i=s(6823);function a(e){return t=>{let s=null;"Escape"===t.key?s=r.Cancel:"Enter"===t.key&&!t.shiftKey&&i.A.windowSize.isDesktop&&(t.preventDefault(),s=r.Submit),e(s,t)}}!function(e){e.Cancel="cancel",e.Submit="submit"}(r||(r={}))},2599:(e,t,s)=>{function r(e,t){return 0===e.length?t:`${e}[${t}]`}function i(e,t){let s="";for(const i of t)s=r(s,i);return r(s,e)}function a(e,t=[]){const s=new Map;for(const r of Object.keys(e)){const n=e[r];if(null!=n)if(Array.isArray(n))s.set(i(r,t),n);else for(const[e,i]of a(n,t.concat(r)))s.set(e,i)}return s}function n(e){return null!=e?JSON.parse(JSON.stringify(e)):e}function o(e,t=!1){const s=l(e,t);if(null==s)throw new Error(`script element ${e} is missing or contains nullish value.`);return s}function l(e,t=!1,s){var r;const i=(null!==(r=window.newBody)&&void 0!==r?r:document.body).querySelector(`#${e}`);if(!(i instanceof HTMLScriptElement))return;const a=JSON.parse(i.text,s);return t&&i.remove(),a}function c(e,t){const s=JSON.stringify(t),r=document.getElementById(e);let i;if(null==r)i=document.createElement("script"),i.id=e,i.type="application/json",document.body.appendChild(i);else{if(!(r instanceof HTMLScriptElement))throw new Error(`existing ${e} is not a script element.`);i=r}i.text=s}s.d(t,{Do:()=>l,FI:()=>a,KU:()=>n,Qv:()=>c,qF:()=>o})},1883:(e,t,s)=>{s.d(t,{B_:()=>n,Mq:()=>c,fP:()=>u,pw:()=>o,sc:()=>l});s(1035);var r=s(6540),i=s(256),a=s(5812);function n(e,t="common.array_and"){const s=[];if(e.length>0&&(s.push(e[0]),e.length>1)){const i=e.length-1,a=o(1===i?`${t}.two_words_connector`:`${t}.last_word_connector`),n=o(`${t}.words_connector`);for(let t=1;t<i;t++)s.push(r.createElement(r.Fragment,{key:e[t].key},n,e[t]));s.push(r.createElement(r.Fragment,{key:e[i].key},a,e[i]))}return r.createElement(r.Fragment,null,s)}function o(e,t={},s){return u(e,s)||(s=fallbackLocale),window.Lang.get(e,t,s)}function l(e,t="common.array_and"){switch(e.length){case 0:return"";case 1:return`${e[0]}`;case 2:return e.join(o(`${t}.two_words_connector`));default:return`${e.slice(0,-1).join(o(`${t}.words_connector`))}${o(`${t}.last_word_connector`)}${e.slice(-1)[0]}`}}function c(e,t,s={},r){null!=r||(r=currentLocale);const a=r===fallbackLocale;if(!a&&!u(e,r))return c(e,t,s,fallbackLocale);s.count_delimited=(0,i.ZV)(t,void 0,void 0,r);const n=window.Lang.choice(e,t,s,r);return a||null!=n?n:(delete s.count,c(e,t,s,fallbackLocale))}function u(e,t){null!=t||(t=window.currentLocale),window.Lang.setFallback(t);const s=window.Lang.get(e,void 0,t),r=(0,a.E)(s)&&s!==e;return window.Lang.setFallback(window.fallbackLocale),r}},6588:(e,t,s)=>{s.d(t,{MB:()=>n,vV:()=>o,zt:()=>a});var r=s(2543);function i(){const e=document.querySelector(".js-loading-overlay");if(e instanceof HTMLElement)return e}function a(){const e=i();null!=e&&e.classList.add("loading-overlay--visible")}const n=(0,r.debounce)(a,5e3,{maxWait:5e3});function o(){n.cancel();const e=i();null!=e&&e.classList.remove("loading-overlay--visible")}},9979:(e,t,s)=>{function r(e,t){const s=new Map;for(const r of e)s.set(r[t],r);return s}function i(e,t){const s=new Map;for(const r of e)s.set(r[t],r);return s}s.d(t,{E:()=>r,a:()=>i})},723:(e,t,s)=>{function r(e){if(Number.isInteger(e))return e;if("string"==typeof e){const t=parseInt(e,10);if(Number.isInteger(t))return t}}s.d(t,{y:()=>r})},2961:(e,t,s)=>{s.d(t,{h:()=>a});var r=s(6131),i=s(4692);function a(){return(0,r.o)()||i("#overlay").is(":visible")||document.body.classList.contains("modal-open")}},6900:(e,t,s)=>{s.d(t,{$7:()=>l,un:()=>u,zi:()=>o});var r=s(9981),i=s(7813),a=s(723),n=s(4692);const o=(0,i.XI)(((e,t,s)=>{var o;e.pagination.loading=!0;const l=(null!==(o=(0,a.y)(s.limit))&&void 0!==o?o:50)+1,u=Object.assign(Object.assign({},s),{limit:l,offset:e.items.length});return n.ajax((0,r.w)(t,u)).done((t=>{c(e,t,l)})).always((0,i.XI)((()=>{e.pagination.loading=!1})))})),l=(e,t)=>o(e,"users.kudosu",{user:t}),c=(0,i.XI)(((e,t,s)=>{e.pagination.hasMore=u(s-1,t),e.items.push(...t)})),u=(0,i.XI)(((e,t)=>{const s=t.length>e;return s&&t.pop(),s}))},3135:(e,t,s)=>{s.d(t,{l:()=>n});var r=s(256),i=s(4692);const a=["danger","warning"];function n(e,t="info"){var s;const n=i("#popup-container"),o=i(".popup-clone").clone(),l=()=>o.trigger("click");o.addClass(`alert-${t} popup-active`).removeClass("popup-clone"),o.find(".popup-text").html(e),a.includes(t)?i("#overlay").off("click.close-alert").one("click.close-alert",l).fadeIn():setTimeout(l,5e3),null===(s=(0,r.e0)(document.activeElement))||void 0===s||s.blur(),o.appendTo(n).fadeIn()}},3431:(e,t,s)=>{s.d(t,{y2:()=>u,as:()=>y,N3:()=>d,ed:()=>p,J6:()=>m,mu:()=>h,gI:()=>b,YH:()=>f,hT:()=>g,Tm:()=>w,yz:()=>_,qp:()=>E,bP:()=>O});var r=s(9981),i=s(6823),a=s(8243),n=s(1883);let o={};function l(e){return e.mods.some((e=>"FI"===e.acronym||"FL"===e.acronym||"HD"===e.acronym))}function c(e){var t,s,r,i,a,n,c,u,d,p,m,h;const b=`${e.type}:${e.id}`;let f=o[b];if(null==f){const v=null!==(t=e.statistics.miss)&&void 0!==t?t:0,g=null!==(s=e.statistics.great)&&void 0!==s?s:0;let y,w;switch(e.ruleset_id){case 0:{const t=null!==(r=e.statistics.meh)&&void 0!==r?r:0,s=null!==(i=e.statistics.ok)&&void 0!==i?i:0,a=t+s+g+v;y=a>0?(50*t+100*s+300*g)/(300*a):1;const n=a>0?g/a:1,o=a>0?t/a:1;w="F"===e.rank?"F":1===n?l(e)?"XH":"X":n>.9&&o<=.01&&0===v?l(e)?"SH":"S":n>.8&&0===v||n>.9?"A":n>.7&&0===v||n>.8?"B":n>.6?"C":"D";break}case 1:{const t=null!==(a=e.statistics.ok)&&void 0!==a?a:0,s=t+g+v;y=s>0?(150*t+300*g)/(300*s):1;const r=s>0?g/s:1;w="F"===e.rank?"F":1===r?l(e)?"XH":"X":r>.9&&0===v?l(e)?"SH":"S":r>.8&&0===v||r>.9?"A":r>.7&&0===v||r>.8?"B":r>.6?"C":"D";break}case 2:{const t=null!==(n=e.statistics.large_tick_hit)&&void 0!==n?n:0,s=null!==(c=e.statistics.small_tick_hit)&&void 0!==c?c:0,r=s+t+g+v+(null!==(u=e.statistics.small_tick_miss)&&void 0!==u?u:0);y=r>0?(s+t+g)/r:1,w="F"===e.rank?"F":1===y?l(e)?"XH":"X":y>.98?l(e)?"SH":"S":y>.94?"A":y>.9?"B":y>.85?"C":"D";break}case 3:{const t=null!==(d=e.statistics.perfect)&&void 0!==d?d:0,s=null!==(p=e.statistics.good)&&void 0!==p?p:0,r=null!==(m=e.statistics.ok)&&void 0!==m?m:0,i=null!==(h=e.statistics.meh)&&void 0!==h?h:0,a=t+s+r+i+g+v;y=a>0?(300*(g+t)+200*s+100*r+50*i)/(300*a):1,w="F"===e.rank?"F":1===y?l(e)?"XH":"X":y>.95?l(e)?"SH":"S":y>.9?"A":y>.8?"B":y>.7?"C":"D";break}default:throw new Error("unknown score ruleset")}f=o[b]={accuracy:y,rank:w}}return f}function u(e){return P(e)?c(e).accuracy:e.accuracy}function d(e){return(null!=e.best_id||"solo_score"===e.type)&&null!=i.A.currentUser&&e.user_id!==i.A.currentUser.id}function p(e){return P(e)?e.mods.filter((e=>"CL"!==e.acronym)):e.mods}function m(e){return d(e)||h(e)||b(e)||i.A.scorePins.canBePinned(e)}function h(e){return e.has_replay}function b(e){return null!=e.best_id||"solo_score"===e.type}function f(e){return P(e)?e.legacy_perfect:e.is_perfect_combo}document.addEventListener("turbolinks:load",(()=>{o={}}));const v=(0,n.pw)("beatmapsets.show.scoreboard.headers.miss"),g={fruits:[{attributes:["great"],key:"great",label:"fruits"},{attributes:["large_tick_hit"],key:"ticks",label:"ticks"},{attributes:["small_tick_miss"],key:"drp_miss",label:"drp miss"},{attributes:["miss","large_tick_miss"],key:"miss",label:v}],mania:[{attributes:["perfect"],key:"perfect",label:"max"},{attributes:["great"],key:"great",label:"300"},{attributes:["good"],key:"good",label:"200"},{attributes:["ok"],key:"ok",label:"100"},{attributes:["meh"],key:"meh",label:"50"},{attributes:["miss"],key:"miss",label:v}],osu:[{attributes:["great"],key:"great",label:"300"},{attributes:["ok"],key:"ok",label:"100"},{attributes:["meh"],key:"meh",label:"50"},{attributes:["miss"],key:"miss",label:v}],taiko:[{attributes:["great"],key:"great",label:"great"},{attributes:["ok"],key:"ok",label:"good"},{attributes:["miss"],key:"miss",label:v}]};function y(e,t){return g[e].map((e=>({key:e.key,label:e.label,total:e.attributes.reduce(((e,s)=>{var r;return e+(null!==(r=t.statistics[s])&&void 0!==r?r:0)}),0)})))}function w(e){return P(e)?c(e).rank:e.rank}function _(e){if("solo_score"===e.type)return(0,r.w)("scores.download",{score:e.id});if(null!=e.best_id)return(0,r.w)("scores.download-legacy",{rulesetOrScore:(0,a.kM)(e.ruleset_id),score:e.best_id});throw new Error("score json doesn't have download url")}function E(e){if("solo_score"===e.type)return(0,r.w)("scores.show",{rulesetOrScore:e.id});if(null!=e.best_id)return(0,r.w)("scores.show",{rulesetOrScore:(0,a.kM)(e.ruleset_id),score:e.best_id});throw new Error("score json doesn't have url")}function P(e){return null!==e.legacy_score_id&&i.A.userPreferences.get("legacy_score_only")}function O(e){return P(e)?e.legacy_total_score:"solo_score"===e.type&&"classic"===i.A.userPreferences.get("scoring_mode")?e.classic_total_score:e.total_score}},3938:(e,t,s)=>{s.d(t,{L:()=>a,u:()=>n});var r=s(6224);let i=0;function a(){return++i}function n(){return r.uuid()}},5812:(e,t,s)=>{function r(e){return i(e)?e:null}function i(e){return null!=e&&""!==e}s.d(t,{E:()=>i,I:()=>r})},450:(e,t,s)=>{function r(e){}s.d(t,{J:()=>r})},3944:(e,t,s)=>{s.d(t,{T8:()=>l,bN:()=>n,bS:()=>a,oo:()=>o});var r=s(4692),i=s(6224);function a(){var e;return null!==(e=window.newUrl)&&void 0!==e?e:document.location}function n(){const e=a();return e instanceof URL?e.searchParams:new URLSearchParams(e.search)}function o(e,t=!1,{action:s}={action:"advance"}){t&&function(){const{pageXOffset:e,pageYOffset:t}=window;r(document).one("turbolinks:load",(()=>window.scrollTo(e,t)))}(),i.visit(e,{action:s})}function l(e=!0){r(document).off(".ujsHideLoadingOverlay"),i.clearCache(),o(a().href,e,{action:"replace"})}},1980:(e,t,s)=>{s.d(t,{AH:()=>m,At:()=>l,Gs:()=>y,Ir:()=>h,Nd:()=>f,SS:()=>p,Ze:()=>v,eq:()=>b,h1:()=>d,iD:()=>g,ou:()=>c,sM:()=>u});var r=s(9981),i=s(2543),a=s(4920),n=s(3944),o=function(e,t){var s={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(s[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(s[r[i]]=e[r[i]])}return s};function l(e){return`osu://b/${e}`}function c(e){return`osu://s/${e}`}function u(e,t){return(0,r.w)("beatmapsets.show",{beatmapset:e.beatmapset_id})+(0,a.cM)({beatmap:e,ruleset:t})}function d(e){return(0,r.w)("changelog.build",{build:e.version,stream:e.update_stream.name})}function p(e){return(0,r.w)("store.products.show",{product:"supporter-tag",target:e.username})}function m(e){return e.isHTML()||(0,i.startsWith)(e.getPath(),"/home/changelog/")}function h(e){return`osu://edit/${e}`}function b(e,t,s){(null==s?void 0:s.unescape)&&(e=(0,i.unescape)(e),t=(0,i.unescape)(t));const r=document.createElement("a");if(r.textContent=t,r.setAttribute("href",e),null!=s&&(s.isRemote&&r.setAttribute("data-remote","1"),null!=s.classNames&&(r.className=s.classNames.join(" ")),null!=s.props)){const e=s.props,{className:t}=e,i=o(e,["className"]);null!=t&&(r.className=t);for(const[s,a]of Object.entries(i))null!=a&&r.setAttribute(s,a)}return r.outerHTML}function f(e){if("javascript:void(0)"!==e)return e}function v(e,t,s){const r=(0,n.bS)(),i=new URL(null!=e?e:r.href,r.origin);for(const[a,n]of Object.entries(t))null!=n?i.searchParams.set(a,n):i.searchParams.delete(a);return null!=s&&(i.hash=s),i.href}function g(e,t){return(0,r.w)("wiki.show",{locale:null!=t?t:currentLocale,path:"WIKI_PATH"}).replace("WIKI_PATH",encodeURI(e))}function y(e){return(0,r.w)("wiki.show",{path:"WIKI_PATH"}).replace("/WIKI_PATH",encodeURI(e))}},4758:(e,t,s)=>{s.d(t,{n:()=>a});var r=s(9981),i=s(4692);function a(e){return i.ajax((0,r.w)("users.lookup-users"),{data:{ids:e},dataType:"json",type:"POST"})}}}]);
//# sourceMappingURL=commons.55cc33ed.js.map